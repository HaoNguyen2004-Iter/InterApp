(function(n){typeof define=="function"&&define.amd?define(["jquery"],n):n(jQuery)})(function(){!function(n,t,i,r){"use strict";function u(t,i){t||(i=i?": "+i:"",n.error("Fancytree assertion failed"+i))}function o(n,i){var r,u,f=t.console?t.console[n]:null;if(f)try{f.apply(t.console,i)}catch(e){for(u="",r=0;r<i.length;r++)u+=i[r];f(u)}}function et(n){return!(!n.tree||n.statusNodeType===r)}function ot(t){for(var r,u,e=n.map(n.trim(t).split("."),function(n){return parseInt(n,10)}),f=n.map(Array.prototype.slice.call(arguments,1),function(n){return parseInt(n,10)}),i=0;i<f.length;i++)if(r=e[i]||0,u=f[i]||0,r!==u)return r>u;return!0}function k(n,t,i,r,u){return function(){var i=t[n],f=r[n],e=t.ext[u],o=function(){return i.apply(t,arguments)},s=function(n){return i.apply(t,n)};return function(){var n=t._local,i=t._super,r=t._superApply;try{return t._local=e,t._super=o,t._superApply=s,f.apply(t,arguments)}finally{t._local=n;t._super=i;t._superApply=r}}}()}function st(t,i,r,u){for(var f in r)"function"==typeof r[f]?"function"==typeof t[f]?t[f]=k(f,t,i,r,u):"_"===f.charAt(0)?t.ext[u][f]=k(f,t,i,r,u):n.error("Could not override tree."+f+". Use prefix '_' to create tree."+u+"._"+f):"options"!==f&&(t.ext[u][f]=r[f])}function f(t,i){return t===r?n.Deferred(function(){this.resolve()}).promise():n.Deferred(function(){this.resolveWith(t,i)}).promise()}function p(t,i){return t===r?n.Deferred(function(){this.reject()}).promise():n.Deferred(function(){this.rejectWith(t,i)}).promise()}function d(n,t){return function(){n.resolveWith(t)}}function w(t){var i=n.extend({},t.data()),r=i.json;return delete i.fancytree,delete i.uiFancytree,r&&(delete i.json,i=n.extend(i,r)),i}function g(n){return(""+n).replace(at,function(n){return it[n]})}function ht(n){return(""+n).replace(vt,function(n){return it[n]})}function nt(n){return n=n.toLowerCase(),function(t){return t.title.toLowerCase().indexOf(n)>=0}}function ct(n){var t=new RegExp("^"+n,"i");return function(n){return t.test(n.title)}}function c(t,i){var f,o,r,e;for(this.parent=t,this.tree=t.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},f=0,o=h.length;f<o;f++)r=h[f],this[r]=i[r];i.data&&n.extend(this.data,i.data);for(r in i)y[r]||n.isFunction(i[r])||ft[r]||(this.data[r]=i[r]);null==this.key?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),u(this.key,"defaultKey() must return a unique key")):this.key="_"+s._nextNodeKey++:this.key=""+this.key;i.active&&(u(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this);i.selected&&(this.tree.lastSelectedNode=this);e=i.children;e?e.length?this._setChildren(e):this.children=this.lazy?[]:null:this.children=null;this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function a(t){this.widget=t;this.$div=t.element;this.options=t.options;this.options&&(n.isFunction(this.options.lazyload)&&!n.isFunction(this.options.lazyLoad)&&(this.options.lazyLoad=function(){return s.warn("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),t.options.lazyload.apply(this,arguments)}),n.isFunction(this.options.loaderror)&&n.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),this.options.fx!==r&&s.warn("The 'fx' option was replaced by 'toggleEffect' since 2014-11-30."),this.options.removeNode!==r&&n.error("The 'removeNode' event was replaced by 'modifyChild' since 2.20 (2016-09-10)."));this.ext={};this.data=w(this.$div);this._id=n.ui.fancytree._nextId++;this._ns=".fancytree-"+this._id;this.activeNode=null;this.focusNode=null;this._hasFocus=null;this._enableUpdate=!0;this.lastSelectedNode=null;this.systemFocusElement=null;this.lastQuicksearchTerm="";this.lastQuicksearchTime=0;this.statusClassPropName="span";this.ariaPropName="li";this.nodeContainerAttrName="li";this.$div.find(">ul.fancytree-container").remove();var i,u={tree:this};this.rootNode=new c(u,{title:"root",key:"root_"+this._id,children:null,expanded:!0});this.rootNode.parent=null;i=n("<ul>",{"class":"ui-fancytree fancytree-container fancytree-plain"}).appendTo(this.$div);this.$container=i;this.rootNode.ul=i[0];null==this.options.debugLevel&&(this.options.debugLevel=s.debugLevel);this.$container.attr("tabindex",this.options.tabindex);this.options.rtl&&this.$container.attr("DIR","RTL").addClass("fancytree-rtl");this.options.aria&&(this.$container.attr("role","tree"),1!==this.options.selectMode&&this.$container.attr("aria-multiselectable",!0))}if(n.ui&&n.ui.fancytree)return void n.ui.fancytree.warn("Fancytree: ignored duplicate include");for(var l,s=null,lt=new RegExp(/\.|\//),at=/[&<>"'\/]/g,vt=/[<>"'\/]/g,tt="$recursive_request",it={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},yt={16:!0,17:!0,18:!0},rt={8:"backspace",9:"tab",10:"return",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},pt={0:"",1:"left",2:"middle",3:"right"},v="active expanded focus folder hideCheckbox lazy selected unselectable".split(" "),ut={},h="expanded extraClasses folder hideCheckbox icon key lazy refKey selected statusNodeType title tooltip unselectable".split(" "),y={},b={},ft={active:!0,children:!0,data:!0,focus:!0},e=0;e<v.length;e++)ut[v[e]]=!0;for(e=0;e<h.length;e++)l=h[e],y[l]=!0,l!==l.toLowerCase()&&(b[l.toLowerCase()]=l);u(n.ui,"Fancytree requires jQuery UI (http://jqueryui.com)");c.prototype={_findDirectChild:function(n){var t,r,i=this.children;if(i)if("string"==typeof n){for(t=0,r=i.length;t<r;t++)if(i[t].key===n)return i[t]}else{if("number"==typeof n)return this.children[n];if(n.parent===this)return n}return null},_setChildren:function(n){u(n&&(!this.children||0===this.children.length),"only init supported");this.children=[];for(var t=0,i=n.length;t<i;t++)this.children.push(new c(this,n[t]))},addChildren:function(t,i){var r,e,o,s=this.getFirstChild(),h=this.getLastChild(),l=null,f=[];for(n.isPlainObject(t)&&(t=[t]),this.children||(this.children=[]),r=0,e=t.length;r<e;r++)f.push(new c(this,t[r]));if(l=f[0],null==i?this.children=this.children.concat(f):(i=this._findDirectChild(i),o=n.inArray(i,this.children),u(o>=0,"insertBefore must be an existing child"),this.children.splice.apply(this.children,[o,0].concat(f))),s){for(r=0,e=f.length;r<e;r++)f[r].render();s!==this.getFirstChild()&&s.renderStatus();h!==this.getLastChild()&&h.renderStatus()}else(!this.parent||this.parent.ul||this.tr)&&this.render();return 3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes(),this.triggerModifyChild("add",1===f.length?f[0]:null),l},addClass:function(n){return this.toggleClass(n,!0)},addNode:function(n,t){switch(t!==r&&"over"!==t||(t="child"),t){case"after":return this.getParent().addChildren(n,this.getNextSibling());case"before":return this.getParent().addChildren(n,this);case"firstChild":var i=this.children?this.children[0]:null;return this.addChildren(n,i);case"child":case"over":return this.addChildren(n)}u(!1,"Invalid mode: "+t)},addPagingNode:function(t,i){var r,u;if(i=i||"child",t===!1){for(r=this.children.length-1;r>=0;r--)u=this.children[r],"paging"===u.statusNodeType&&this.removeChild(u);return void(this.partload=!1)}return t=n.extend({title:this.tree.options.strings.moreData,statusNodeType:"paging",icon:!1},t),this.partload=!0,this.addNode(t,i)},appendSibling:function(n){return this.addNode(n,"after")},applyPatch:function(t){if(null===t)return this.remove(),f(this);var i,u,r,e={children:!0,expanded:!0,parent:!0};for(i in t)r=t[i],e[i]||n.isFunction(r)||(y[i]?this[i]=r:this.data[i]=r);return t.hasOwnProperty("children")&&(this.removeChildren(),t.children&&this._setChildren(t.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),u=t.hasOwnProperty("expanded")?this.setExpanded(t.expanded):f(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(n,t,i){return n.addNode(this.toDict(!0,i),t)},countChildren:function(n){var t,u,i,r=this.children;if(!r)return 0;if(i=r.length,n!==!1)for(t=0,u=i;t<u;t++)i+=r[t].countChildren();return i},debug:function(){this.tree.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),o("log",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},discardMarkup:function(n){var t=n?"nodeRemoveMarkup":"nodeRemoveChildMarkup";this.tree._callHook(t,this)},findAll:function(t){t=n.isFunction(t)?t:nt(t);var i=[];return this.visit(function(n){t(n)&&i.push(n)}),i},findFirst:function(t){t=n.isFunction(t)?t:nt(t);var i=null;return this.visit(function(n){if(t(n))return i=n,!1}),i},_changeSelectStatusAttrs:function(n){var t=!1;switch(n){case!1:t=this.selected||this.partsel;this.selected=!1;this.partsel=!1;break;case!0:t=!this.selected||!this.partsel;this.selected=!0;this.partsel=!0;break;case r:t=this.selected||!this.partsel;this.selected=!1;this.partsel=!0;break;default:u(!1,"invalid state: "+n)}return t&&this.renderStatus(),t},fixSelection3AfterClick:function(){var n=this.isSelected();this.visit(function(t){t._changeSelectStatusAttrs(n)});this.fixSelection3FromEndNodes()},fixSelection3FromEndNodes:function(){function n(t){var i,h,c,e,u,o,s,f=t.children;if(f&&f.length){for(o=!0,s=!1,i=0,h=f.length;i<h;i++)c=f[i],e=n(c),e!==!1&&(s=!0),e!==!0&&(o=!1);u=!!o||!!s&&r}else u=!!t.selected;return t._changeSelectStatusAttrs(u),u}u(3===this.tree.options.selectMode,"expected selectMode 3");n(this);this.visitParents(function(n){for(var t,f,e=n.children,o=!0,s=!1,i=0,u=e.length;i<u;i++)t=e[i],(t.selected||t.partsel)&&(s=!0),t.unselectable||t.selected||(o=!1);f=!!o||!!s&&r;n._changeSelectStatusAttrs(f)})},fromDict:function(t){for(var i in t)y[i]?this[i]=t[i]:"data"===i?n.extend(this.data,t.data):n.isFunction(t[i])||ft[i]||(this.data[i]=t[i]);t.children&&(this.removeChildren(),this.addChildren(t.children));this.renderTitle()},getChildren:function(){return this.hasChildren()===r?r:this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return n.inArray(this,this.parent.children)},getIndexHier:function(t,i){t=t||".";var r,u=[];return n.each(this.getParentList(!1,!0),function(n,t){r=""+(t.getIndex()+1);i&&(r=("0000000"+r).substr(-i));u.push(r)}),u.join(t)},getKeyPath:function(n){var t=[],i=this.tree.options.keyPathSeparator;return this.visitParents(function(n){n.parent&&t.unshift(n.key)},!n),i+t.join(i)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var t=0,n=this.parent;n;)t++,n=n.parent;return t},getNextSibling:function(){if(this.parent)for(var t=this.parent.children,n=0,i=t.length-1;n<i;n++)if(t[n]===this)return t[n+1];return null},getParent:function(){return this.parent},getParentList:function(n,t){for(var r=[],i=t?this:this.parent;i;)(n||i.parent)&&r.unshift(i),i=i.parent;return r},getPrevSibling:function(){if(this.parent)for(var t=this.parent.children,n=1,i=t.length;n<i;n++)if(t[n]===this)return t[n-1];return null},getSelectedNodes:function(n){var t=[];return this.visit(function(i){if(i.selected&&(t.push(i),n===!0))return"skip"}),t},hasChildren:function(){return this.lazy?null==this.children?r:0!==this.children.length&&(1!==this.children.length||!this.children[0].isStatusNode()||r):!(!this.children||!this.children.length)},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(){this.tree.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),o("info",arguments))},isActive:function(){return this.tree.activeNode===this},isChildOf:function(n){return this.parent&&this.parent===n},isDescendantOf:function(n){if(!n||n.tree!==this.tree)return!1;for(var t=this.parent;t;){if(t===n)return!0;t=t.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var n=this.parent;return!n||n.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var n=this.parent;return!n||n.children[n.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||this.hasChildren()!==r},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isPartload:function(){return!!this.partload},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isPagingNode:function(){return"paging"===this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return this.hasChildren()===r},isVisible:function(){for(var i=this.getParentList(!1,!1),n=0,t=i.length;n<t;n++)if(!i[n].expanded)return!1;return!0},lazyLoad:function(n){return this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead."),this.load(n)},load:function(n){var t,i,r=this,e=this.isExpanded();return u(this.isLazy(),"load() requires a lazy node"),n||this.isUndefined()?(this.isLoaded()&&this.resetLazy(),i=this.tree._triggerNodeEvent("lazyLoad",this),i===!1?f(this):(u("boolean"!=typeof i,"lazyLoad event must return source in data.result"),t=this.tree._callHook("nodeLoadChildren",this,i),e?(this.expanded=!0,t.always(function(){r.render()})):t.always(function(){r.renderStatus()}),t)):f(this)},makeVisible:function(t){for(var e=this,u=[],r=new n.Deferred,f=this.getParentList(!1,!1),o=f.length,s=!(t&&t.noAnimation===!0),h=!(t&&t.scrollIntoView===!1),i=o-1;i>=0;i--)u.push(f[i].setExpanded(!0,t));return n.when.apply(n,u).done(function(){h?e.scrollIntoView(s).done(function(){r.resolve()}):r.resolve()}),r.promise()},moveTo:function(t,i,f){i===r||"over"===i?i="child":"firstChild"===i&&(t.children&&t.children.length?(i="before",t=t.children[0]):i="child");var o,s=this.parent,e="child"===i?t:t.parent;if(this!==t){if(this.parent?e.isDescendantOf(this)&&n.error("Cannot move a node to its own descendant"):n.error("Cannot move system root"),e!==s&&s.triggerModifyChild("remove",this),1===this.parent.children.length){if(this.parent===e)return;this.parent.children=this.parent.lazy?[]:null;this.parent.expanded=!1}else o=n.inArray(this,this.parent.children),u(o>=0,"invalid source parent"),this.parent.children.splice(o,1);if(this.parent=e,e.hasChildren())switch(i){case"child":e.children.push(this);break;case"before":o=n.inArray(t,e.children);u(o>=0,"invalid target parent");e.children.splice(o,0,this);break;case"after":o=n.inArray(t,e.children);u(o>=0,"invalid target parent");e.children.splice(o+1,0,this);break;default:n.error("Invalid mode "+i)}else e.children=[this];f&&t.visit(f,!0);e===s?e.triggerModifyChild("move",this):e.triggerModifyChild("add",this);this.tree!==t.tree&&(this.warn("Cross-tree moveTo is experimantal!"),this.visit(function(n){n.tree=t.tree},!0));s.isDescendantOf(e)||s.render();e.isDescendantOf(s)||e===s||e.render()}},navigate:function(t,i){function e(r){if(r){try{r.makeVisible({scrollIntoView:!1})}catch(u){}return n(r.span).is(":visible")?i===!1?r.setFocus():r.setActive():(r.debug("Navigate: skipping hidden node"),void r.navigate(t,i))}}var s,h,u,c=!0,o=n.ui.keyCode,r=null;switch(t){case o.BACKSPACE:this.parent&&this.parent.parent&&(u=e(this.parent));break;case o.HOME:this.tree.visit(function(t){if(n(t.span).is(":visible"))return u=e(t),!1});break;case o.END:this.tree.visit(function(t){n(t.span).is(":visible")&&(u=t)});u&&(u=e(u));break;case o.LEFT:this.expanded?(this.setExpanded(!1),u=e(this)):this.parent&&this.parent.parent&&(u=e(this.parent));break;case o.RIGHT:this.expanded||!this.children&&!this.lazy?this.children&&this.children.length&&(u=e(this.children[0])):(this.setExpanded(),u=e(this));break;case o.UP:for(r=this.getPrevSibling();r&&!n(r.span).is(":visible");)r=r.getPrevSibling();for(;r&&r.expanded&&r.children&&r.children.length;)r=r.children[r.children.length-1];!r&&this.parent&&this.parent.parent&&(r=this.parent);u=e(r);break;case o.DOWN:if(this.expanded&&this.children&&this.children.length)r=this.children[0];else for(h=this.getParentList(!1,!0),s=h.length-1;s>=0;s--){for(r=h[s].getNextSibling();r&&!n(r.span).is(":visible");)r=r.getNextSibling();if(r)break}u=e(r);break;default:c=!1}return u||f()},remove:function(){return this.parent.removeChild(this)},removeChild:function(n){return this.tree._callHook("nodeRemoveChild",this,n)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},removeClass:function(n){return this.toggleClass(n,!1)},render:function(n,t){return this.tree._callHook("nodeRender",this,n,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},replaceWith:function(t){var f,i=this.parent,o=n.inArray(this,i.children),r=this;return u(this.isPagingNode(),"replaceWith() currently requires a paging status node"),f=this.tree._callHook("nodeLoadChildren",this,t),f.done(function(){var n=r.children;for(e=0;e<n.length;e++)n[e].parent=i;i.children.splice.apply(i.children,[o+1,0].concat(n));r.children=null;r.remove();i.render()}).fail(function(){r.setExpanded()}),f},resetLazy:function(){this.removeChildren();this.expanded=!1;this.lazy=!0;this.children=r;this.renderStatus()},scheduleAction:function(t,i){this.tree.timer&&clearTimeout(this.tree.timer);this.tree.timer=null;var r=this;switch(t){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){r.tree.debug("setTimeout: trigger expand");r.setExpanded(!0)},i);break;case"activate":this.tree.timer=setTimeout(function(){r.tree.debug("setTimeout: trigger activate");r.setActive(!0)},i);break;default:n.error("Invalid mode "+t)}},scrollIntoView:function(e,o){o!==r&&et(o)&&(this.warn("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead."),o={topNode:o});var v,a,g,w,c=n.extend({effects:e===!0?{duration:200,queue:!1}:e,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent||this.tree.$container,topNode:null},o),y=new n.Deferred,it=this,nt=n(this.span).height(),s=n(c.scrollParent),b=c.scrollOfs.top||0,tt=c.scrollOfs.bottom||0,k=s.height(),p=s.scrollTop(),d=s,rt=s[0]===t,h=c.topNode||null,l=null;return n(this.span).is(":visible")?(rt?(a=n(this.span).offset().top,v=h&&h.span?n(h.span).offset().top:0,d=n("html,body")):(u(s[0]!==i&&s[0]!==i.body,"scrollParent should be a simple element or `window`, not document or body."),w=s.offset().top,a=n(this.span).offset().top-w+p,v=h?n(h.span).offset().top-w+p:0,g=Math.max(0,s.innerHeight()-s[0].clientHeight),k-=g),a<p+b?l=a-b:a+nt>p+k-tt&&(l=a+nt-k+tt,h&&(u(h.isRootNode()||n(h.span).is(":visible"),"topNode must be visible"),v<l&&(l=v-b))),null!==l?c.effects?(c.effects.complete=function(){y.resolveWith(it)},d.stop(!0).animate({scrollTop:l},c.effects)):(d[0].scrollTop=l,y.resolveWith(this)):y.resolveWith(this),y.promise()):(this.warn("scrollIntoView(): node is invisible."),f())},setActive:function(n,t){return this.tree._callHook("nodeSetActive",this,n,t)},setExpanded:function(n,t){return this.tree._callHook("nodeSetExpanded",this,n,t)},setFocus:function(n){return this.tree._callHook("nodeSetFocus",this,n)},setSelected:function(n){return this.tree._callHook("nodeSetSelected",this,n)},setStatus:function(n,t,i){return this.tree._callHook("nodeSetStatus",this,n,t,i)},setTitle:function(n){this.title=n;this.renderTitle();this.triggerModify("rename")},sortChildren:function(n,t){var i,u,r=this.children;if(r){if(n=n||function(n,t){var i=n.title.toLowerCase(),r=t.title.toLowerCase();return i===r?0:i>r?1:-1},r.sort(n),t)for(i=0,u=r.length;i<u;i++)r[i].children&&r[i].sortChildren(n,"$norender$");"$norender$"!==t&&this.render();this.triggerModifyChild("sort")}},toDict:function(t,i){var u,o,e,r={},f=this;if(n.each(h,function(n,t){(f[t]||f[t]===!1)&&(r[t]=f[t])}),n.isEmptyObject(this.data)||(r.data=n.extend({},this.data),n.isEmptyObject(r.data)&&delete r.data),i&&i(r,f),t&&this.hasChildren())for(r.children=[],u=0,o=this.children.length;u<o;u++)e=this.children[u],e.isStatusNode()||r.children.push(e.toDict(!0,i));return r},toggleClass:function(t,i){var f,e,h=t.match(/\S+/g)||[],c=0,o=!1,s=this[this.tree.statusClassPropName],u=" "+(this.extraClasses||"")+" ";for(s&&n(s).toggleClass(t,i);f=h[c++];)if(e=u.indexOf(" "+f+" ")>=0,i=i===r?!e:!!i)e||(u+=f+" ",o=!0);else for(;u.indexOf(" "+f+" ")>-1;)u=u.replace(" "+f+" "," ");return this.extraClasses=n.trim(u),o},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"<FancytreeNode(#"+this.key+", '"+this.title+"')>"},triggerModifyChild:function(t,i,r){var u,f=this.tree.options.modifyChild;f&&(i&&i.parent!==this&&n.error("childNode "+i+" is not a child of "+this),u={node:this,tree:this.tree,operation:t,childNode:i||null},r&&n.extend(u,r),f({type:"modifyChild"},u))},triggerModify:function(n,t){this.parent.triggerModifyChild(n,this,t)},visit:function(n,t){var r,f,i=!0,u=this.children;if(t===!0&&(i=n(this),i===!1||"skip"===i))return i;if(u)for(r=0,f=u.length;r<f&&(i=u[r].visit(n,!0),i!==!1);r++);return i},visitAndLoad:function(t,i,r){var o,u,s,e=this;return t&&i===!0&&(u=t(e),u===!1||"skip"===u)?r?u:f():e.children||e.lazy?(o=new n.Deferred,s=[],e.load().done(function(){for(var i=0,r=e.children.length;i<r;i++){if(u=e.children[i].visitAndLoad(t,!0,!0),u===!1){o.reject();break}"skip"!==u&&s.push(u)}n.when.apply(this,s).then(function(){o.resolve()})}),o.promise()):f()},visitParents:function(n,t){if(t&&n(this)===!1)return!1;for(var i=this.parent;i;){if(n(i)===!1)return!1;i=i.parent}return!0},warn:function(){Array.prototype.unshift.call(arguments,this.toString());o("warn",arguments)}};a.prototype={_makeHookContext:function(t,i,u){var f,e;return t.node!==r?(i&&t.originalEvent!==i&&n.error("invalid args"),f=t):t.tree?(e=t.tree,f={node:t,tree:e,widget:e.widget,options:e.widget.options,originalEvent:i}):t.widget?f={node:null,tree:t,widget:t.widget,options:t.widget.options,originalEvent:i}:n.error("invalid args"),u&&n.extend(f,u),f},_callHook:function(t,i){var f=this._makeHookContext(i),r=this[t],u=Array.prototype.slice.call(arguments,2);return n.isFunction(r)||n.error("_callHook('"+t+"') is not a function"),u.unshift(f),r.apply(this,u)},_requireExtension:function(t,i,r,f){r=!!r;var e=this._local.name,s=this.options.extensions,c=n.inArray(t,s)<n.inArray(e,s),o=i&&null==this.ext[t],h=!o&&null!=r&&r!==c;return u(e&&e!==t,"invalid or same name"),!o&&!h||(f||(o||i?(f="'"+e+"' extension requires '"+t+"'",h&&(f+=" to be registered "+(r?"before":"after")+" itself")):f="If used together, `"+t+"` must be registered "+(r?"before":"after")+" `"+e+"`"),n.error(f),!1)},activateKey:function(n){var t=this.getNodeByKey(n);return t?t.setActive():this.activeNode&&this.activeNode.setActive(!1),t},addPagingNode:function(n,t){return this.rootNode.addPagingNode(n,t)},applyPatch:function(t){for(var o,r,f,s,e,c=t.length,h=[],i=0;i<c;i++)r=t[i],u(2===r.length,"patchList must be an array of length-2-arrays"),f=r[0],s=r[1],e=null===f?this.rootNode:this.getNodeByKey(f),e?(o=new n.Deferred,h.push(o),e.applyPatch(s).always(d(o,e))):this.warn("could not find node with key '"+f+"'");return n.when.apply(n,h).promise()},clear:function(){this._callHook("treeClear",this)},count:function(){return this.rootNode.countChildren()},debug:function(){this.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),o("log",arguments))},enableUpdate:function(n){return n=n!==!1,!!this._enableUpdate==!!n?n:(this._enableUpdate=n,n?(this.debug("enableUpdate(true): redraw ",this._dirtyRoots),this.render()):this.debug("enableUpdate(false)..."),!n)},findAll:function(n){return this.rootNode.findAll(n)},findFirst:function(n){return this.rootNode.findFirst(n)},findNextNode:function(t,i){var u=null,e=i.parent.children,f=null,r=function(n,t,i){var f,e,o=n.children,s=o.length,u=o[t];if(u&&i(u)===!1||u&&u.children&&u.expanded&&r(u,0,i)===!1)return!1;for(f=t+1;f<s;f++)if(r(n,f,i)===!1)return!1;return e=n.parent,e?r(e,e.children.indexOf(n)+1,i):r(n,0,i)};return t="string"==typeof t?ct(t):t,i=i||this.getFirstChild(),r(i.parent,e.indexOf(i),function(r){return r!==u&&(u=u||r,n(r.span).is(":visible")?(!t(r)||(f=r,f===i))&&void 0:void r.debug("quicksearch: skipping hidden node"))}),f},generateFormElements:function(t,i,r){function f(t){u.append(n("<input>",{type:"checkbox",name:s,value:t.key,checked:!0}))}r=r||{};var e,s="string"==typeof t?t:"ft_"+this._id+"[]",h="string"==typeof i?i:"ft_"+this._id+"_active",o="fancytree_result_"+this._id,u=n("#"+o),c=3===this.options.selectMode&&r.stopOnParents!==!1;u.length?u.empty():u=n("<div>",{id:o}).hide().insertAfter(this.$container);i!==!1&&this.activeNode&&u.append(n("<input>",{type:"radio",name:h,value:this.activeNode.key,checked:!0}));r.filter?this.visit(function(n){var t=r.filter(n);return"skip"===t?t:void(t!==!1&&f(n))}):t!==!1&&(e=this.getSelectedNodes(c),n.each(e,function(n,t){f(t)}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getNodeByKey:function(n,t){var r,u;return!t&&(r=i.getElementById(this.options.idPrefix+n))?r.ftnode?r.ftnode:null:(t=t||this.rootNode,u=null,t.visit(function(t){if(t.key===n)return u=t,!1},!0),u)},getRootNode:function(){return this.rootNode},getSelectedNodes:function(n){return this.rootNode.getSelectedNodes(n)},hasFocus:function(){return!!this._hasFocus},info:function(){this.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),o("info",arguments))},loadKeyPath:function(t,i,u){function w(n,t,r){i.call(o,t,"loading");t.load().done(function(){o.loadKeyPath.call(o,s[n],i,t).always(d(r,o))}).fail(function(){o.warn("loadKeyPath: error loading: "+n+" (parent: "+h+")");i.call(o,t,"error");r.reject()})}var y,p,a,l,e,s,f,h,c,v=this.options.keyPathSeparator,o=this;for(i=i||n.noop,n.isArray(t)||(t=[t]),s={},a=0;a<t.length;a++)for(h=u||this.rootNode,l=t[a],l.charAt(0)===v&&(l=l.substr(1)),c=l.split(v);c.length;){if(e=c.shift(),f=h._findDirectChild(e),!f){this.warn("loadKeyPath: key not found: "+e+" (parent: "+h+")");i.call(this,e,"error");break}if(0===c.length){i.call(this,f,"ok");break}if(f.lazy&&f.hasChildren()===r){i.call(this,f,"loaded");s[e]?s[e].push(c.join(v)):s[e]=[c.join(v)];break}i.call(this,f,"loaded");h=f}y=[];for(e in s)f=h._findDirectChild(e),null==f&&(f=o.getNodeByKey(e)),p=new n.Deferred,y.push(p),w(e,f,p);return n.when.apply(n,y).promise()},reactivate:function(n){var i,t=this.activeNode;return t?(this.activeNode=null,i=t.setActive(!0,{noFocus:!0}),n&&t.setFocus(),i):f()},reload:function(n){return this._callHook("treeClear",this),this._callHook("treeLoad",this,n)},render:function(n,t){return this.rootNode.render(n,t)},setFocus:function(n){return this._callHook("treeSetFocus",this,n)},toDict:function(n,t){var i=this.rootNode.toDict(!0,t);return n?i:i.children},toString:function(){return"<Fancytree(#"+this._id+")>"},_triggerNodeEvent:function(n,t,i,u){var f=this._makeHookContext(t,i,u),e=this.widget._trigger(n,i,f);return e!==!1&&f.result!==r?f.result:e},_triggerTreeEvent:function(n,t,i){var u=this._makeHookContext(this,t,i),f=this.widget._trigger(n,t,u);return f!==!1&&u.result!==r?u.result:f},visit:function(n){return this.rootNode.visit(n,!1)},warn:function(){Array.prototype.unshift.call(arguments,this.toString());o("warn",arguments)}};n.extend(a.prototype,{nodeClick:function(n){var t,i,u=n.targetType,r=n.node;if("expander"===u){if(r.isLoading())return void r.debug("Got 2nd click while loading: ignored");this._callHook("nodeToggleExpanded",n)}else if("checkbox"===u)this._callHook("nodeToggleSelected",n),n.options.focusOnSelect&&this._callHook("nodeSetFocus",n,!0);else{if(i=!1,t=!0,r.folder)switch(n.options.clickFolderMode){case 2:i=!0;t=!1;break;case 3:t=!0;i=!0}t&&(this.nodeSetFocus(n),this._callHook("nodeSetActive",n,!0));i&&this._callHook("nodeToggleExpanded",n)}},nodeCollapseSiblings:function(n,t){var r,i,f,u=n.node;if(u.parent)for(r=u.parent.children,i=0,f=r.length;i<f;i++)r[i]!==u&&r[i].expanded&&this._callHook("nodeSetExpanded",r[i],!1,t)},nodeDblclick:function(n){"title"===n.targetType&&4===n.options.clickFolderMode&&this._callHook("nodeToggleExpanded",n);"title"===n.targetType&&n.originalEvent.preventDefault()},nodeKeydown:function(t){var f,e,v,o,r=t.originalEvent,u=t.node,i=t.tree,h=t.options,c=r.which,l=String.fromCharCode(c),y=!(r.altKey||r.ctrlKey||r.metaKey||r.shiftKey),p=n(r.target),a=!0,w=!(r.ctrlKey||!h.autoActivate);if(u||(o=this.getActiveNode()||this.getFirstChild(),o&&(o.setFocus(),u=t.node=this.focusNode,u.debug("Keydown force focus on active node"))),h.quicksearch&&y&&/\w/.test(l)&&!rt[c]&&!p.is(":input:enabled"))return e=(new Date).getTime(),e-i.lastQuicksearchTime>500&&(i.lastQuicksearchTerm=""),i.lastQuicksearchTime=e,i.lastQuicksearchTerm+=l,f=i.findNextNode(i.lastQuicksearchTerm,i.getActiveNode()),f&&f.setActive(),void r.preventDefault();switch(s.eventToString(r)){case"+":case"=":i.nodeSetExpanded(t,!0);break;case"-":i.nodeSetExpanded(t,!1);break;case"space":u.isPagingNode()?i._triggerNodeEvent("clickPaging",t,r):h.checkbox?i.nodeToggleSelected(t):i.nodeSetActive(t,!0);break;case"return":i.nodeSetActive(t,!0);break;case"home":case"end":case"backspace":case"left":case"right":case"up":case"down":v=u.navigate(r.which,w,!0);break;default:a=!1}a&&r.preventDefault()},nodeLoadChildren:function(t,i){var o,e,s,f=t.tree,r=t.node,h=(new Date).getTime();return n.isFunction(i)&&(i=i.call(f,{type:"source"},t),u(!n.isFunction(i),"source callback must not return another function")),i.url&&(r._requestId&&r.warn("Recursive load request #"+h+" while #"+r._requestId+" is pending."),o=n.extend({},t.options.ajax,i),r._requestId=h,o.debugDelay?(e=o.debugDelay,n.isArray(e)&&(e=e[0]+Math.random()*(e[1]-e[0])),r.warn("nodeLoadChildren waiting debugDelay "+Math.round(e)+" ms ..."),o.debugDelay=!1,s=n.Deferred(function(t){setTimeout(function(){n.ajax(o).done(function(){t.resolveWith(this,arguments)}).fail(function(){t.rejectWith(this,arguments)})},e)})):s=n.ajax(o),i=new n.Deferred,s.done(function(u){var o,e;if("json"!==this.dataType&&"jsonp"!==this.dataType||"string"!=typeof u||n.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),r._requestId&&r._requestId>h)return void i.rejectWith(this,[tt]);if(t.options.postProcess){try{e=f._triggerNodeEvent("postProcess",t,t.originalEvent,{response:u,error:null,dataType:this.dataType})}catch(s){e={error:s,message:""+s,details:"postProcess failed"}}if(e.error)return o=n.isPlainObject(e.error)?e.error:{message:e.error},o=f._makeHookContext(r,null,o),void i.rejectWith(this,[o]);u=n.isArray(e)?e:u}else u&&u.hasOwnProperty("d")&&t.options.enableAspx&&(u="string"==typeof u.d?n.parseJSON(u.d):u.d);i.resolveWith(this,[u])}).fail(function(n,t,u){var e=f._makeHookContext(r,null,{error:n,args:Array.prototype.slice.call(arguments),message:u,details:n.status+": "+u});i.rejectWith(this,[e])})),n.isFunction(i.then)&&n.isFunction(i["catch"])&&(s=i,i=new n.Deferred,s.then(function(n){i.resolve(n)},function(n){i.reject(n)})),n.isFunction(i.promise)&&(f.nodeSetStatus(t,"loading"),i.done(function(){f.nodeSetStatus(t,"ok");r._requestId=null}).fail(function(n){var i;return n===tt?void r.warn("Ignored response for obsolete load request #"+h+" (expected #"+r._requestId+")"):(n.node&&n.error&&n.message?i=n:(i=f._makeHookContext(r,null,{error:n,args:Array.prototype.slice.call(arguments),message:n?n.message||n.toString():""}),"[object Object]"===i.message&&(i.message="")),r.warn("Load children failed ("+i.message+")",i),void(f._triggerNodeEvent("loadError",i,null)!==!1&&f.nodeSetStatus(t,"error",i.message,i.details)))})),n.when(i).done(function(t){var i;n.isPlainObject(t)&&(u(r.isRootNode(),"source may only be an object for root nodes (expecting an array of child objects otherwise)"),u(n.isArray(t.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),i=t,t=t.children,delete i.children,n.extend(f.data,i));u(n.isArray(t),"expected array of children");r._setChildren(t);f._triggerNodeEvent("loadChildren",r)})},nodeLoadKeyPath:function(){},nodeRemoveChild:function(t,i){var f,e=t.node,o=n.extend({},t,{node:i}),r=e.children;return 1===r.length?(u(i===r[0],"invalid single child"),this.nodeRemoveChildren(t)):(this.activeNode&&(i===this.activeNode||this.activeNode.isDescendantOf(i))&&this.activeNode.setActive(!1),this.focusNode&&(i===this.focusNode||this.focusNode.isDescendantOf(i))&&(this.focusNode=null),this.nodeRemoveMarkup(o),this.nodeRemoveChildren(o),f=n.inArray(i,r),u(f>=0,"invalid child"),e.triggerModifyChild("remove",i),i.visit(function(n){n.parent=null},!0),this._callHook("treeRegisterNode",this,!1,i),void r.splice(f,1))},nodeRemoveChildMarkup:function(t){var i=t.node;i.ul&&(i.isRootNode()?n(i.ul).empty():(n(i.ul).remove(),i.ul=null),i.visit(function(n){n.li=n.ul=null}))},nodeRemoveChildren:function(t){var u,r=t.tree,i=t.node,f=i.children;f&&(this.activeNode&&this.activeNode.isDescendantOf(i)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(i)&&(this.focusNode=null),this.nodeRemoveChildMarkup(t),u=n.extend({},t),i.triggerModifyChild("remove",null),i.visit(function(n){n.parent=null;r._callHook("treeRegisterNode",r,!1,n)}),i.children=i.lazy?[]:null,i.isRootNode()||(i.expanded=!1),this.nodeRenderStatus(t))},nodeRemoveMarkup:function(t){var i=t.node;i.li&&(n(i.li).remove(),i.li=null);this.nodeRemoveChildMarkup(t)},nodeRender:function(t,r,f,e,o){var h,b,a,c,p,d,g,s=t.node,k=t.tree,l=t.options,nt=l.aria,tt=!1,w=s.parent,v=!w,y=s.children,it=null;if(k._enableUpdate!==!1&&(v||w.ul)){if(u(v||w.ul,"parent UL must exist"),v||(s.li&&(r||s.li.parentNode!==s.parent.ul)&&(s.li.parentNode===s.parent.ul?it=s.li.nextSibling:this.debug("Unlinking "+s+" (must be child of "+s.parent+")"),this.nodeRemoveMarkup(t)),s.li?this.nodeRenderStatus(t):(tt=!0,s.li=i.createElement("li"),s.li.ftnode=s,s.key&&l.generateIds&&(s.li.id=l.idPrefix+s.key),s.span=i.createElement("span"),s.span.className="fancytree-node",nt&&n(s.li).attr("aria-labelledby","ftal_"+l.idPrefix+s.key),s.li.appendChild(s.span),this.nodeRenderTitle(t),l.createNode&&l.createNode.call(k,{type:"createNode"},t)),l.renderNode&&l.renderNode.call(k,{type:"renderNode"},t)),y){if(v||s.expanded||f===!0){for(s.ul||(s.ul=i.createElement("ul"),(e!==!0||o)&&s.expanded||(s.ul.style.display="none"),nt&&n(s.ul).attr("role","group"),s.li?s.li.appendChild(s.ul):s.tree.$div.append(s.ul)),c=0,p=y.length;c<p;c++)g=n.extend({},t,{node:y[c]}),this.nodeRender(g,r,f,!1,!0);for(h=s.ul.firstChild;h;)a=h.ftnode,a&&a.parent!==s?(s.debug("_fixParent: remove missing "+a,h),d=h.nextSibling,h.parentNode.removeChild(h),h=d):h=h.nextSibling;for(h=s.ul.firstChild,c=0,p=y.length-1;c<p;c++)b=y[c],a=h.ftnode,b!==a?s.ul.insertBefore(b.li,a.li):h=h.nextSibling}}else s.ul&&(this.warn("remove child markup for "+s),this.nodeRemoveChildMarkup(t));v||tt&&w.ul.insertBefore(s.li,it)}},nodeRenderTitle:function(t,i){var y,e,h,a,p,c,u=t.node,v=t.tree,f=t.options,l=f.aria,w=u.getLevel(),o=[];i!==r&&(u.title=i);u.span&&v._enableUpdate!==!1&&(w<f.minExpandLevel?(u.lazy||(u.expanded=!0),w>1&&(l?o.push("<span role='button' class='fancytree-expander fancytree-expander-fixed'><\/span>"):o.push("<span class='fancytree-expander fancytree-expander-fixed''><\/span>"))):l?o.push("<span role='button' class='fancytree-expander'><\/span>"):o.push("<span class='fancytree-expander'><\/span>"),f.checkbox&&u.hideCheckbox!==!0&&!u.isStatusNode()&&(l?o.push("<span role='checkbox' class='fancytree-checkbox'><\/span>"):o.push("<span class='fancytree-checkbox'><\/span>")),u.data.iconClass!==r&&(u.icon?n.error("'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead"):(u.warn("'iconClass' node option is deprecated since v2.14.0: use 'icon' instead"),u.icon=u.data.iconClass)),e=s.evalOption("icon",u,u,f,!0),"boolean"!=typeof e&&(e=""+e),e!==!1&&(a=l?" role='img'":"","string"==typeof e?lt.test(e)?(e="/"===e.charAt(0)?e:(f.imagePath||"")+e,o.push("<img src='"+e+"' class='fancytree-icon' alt='' />")):o.push("<span "+a+" class='fancytree-custom-icon "+e+"'><\/span>"):o.push("<span "+a+" class='fancytree-icon'><\/span>")),h="",f.renderTitle&&(h=f.renderTitle.call(v,{type:"renderTitle"},t)||""),h||(u.tooltip?c=u.tooltip:f.tooltip&&(c=f.tooltip===!0?u.title:f.tooltip.call(v,u)),c=c?" title='"+ht(c)+"'":"",y=l?" id='ftal_"+f.idPrefix+u.key+"'":"",a=l?" role='treeitem'":"",p=f.titlesTabbable?" tabindex='0'":"",h="<span "+a+" class='fancytree-title'"+y+c+p+">"+(f.escapeTitles?g(u.title):u.title)+"<\/span>"),o.push(h),u.span.innerHTML=o.join(""),this.nodeRenderStatus(t),f.enhanceTitle&&(t.$title=n(">span.fancytree-title",u.span),h=f.enhanceTitle.call(v,{type:"enhanceTitle"},t)||""))},nodeRenderStatus:function(t){var i=t.node,e=t.tree,c=t.options,h=i.hasChildren(),o=i.isLastSibling(),s=c.aria,f=n(i.span).find(".fancytree-title"),u=c._classNames,r=[],l=i[e.statusClassPropName];l&&e._enableUpdate!==!1&&(r.push(u.node),e.activeNode===i&&r.push(u.active),e.focusNode===i&&r.push(u.focused),i.expanded?(r.push(u.expanded),s&&f.attr("aria-expanded",!0)):s&&(h?f.attr("aria-expanded",!1):f.removeAttr("aria-expanded")),i.folder&&r.push(u.folder),h!==!1&&r.push(u.hasChildren),o&&r.push(u.lastsib),i.lazy&&null==i.children&&r.push(u.lazy),i.partload&&r.push(u.partload),i.partsel&&r.push(u.partsel),i.unselectable&&r.push(u.unselectable),i._isLoading&&r.push(u.loading),i._error&&r.push(u.error),i.statusNodeType&&r.push(u.statusNodePrefix+i.statusNodeType),i.selected?(r.push(u.selected),s&&f.attr("aria-selected",!0)):s&&f.attr("aria-selected",!1),i.extraClasses&&r.push(i.extraClasses),h===!1?r.push(u.combinedExpanderPrefix+"n"+(o?"l":"")):r.push(u.combinedExpanderPrefix+(i.expanded?"e":"c")+(i.lazy&&null==i.children?"d":"")+(o?"l":"")),r.push(u.combinedIconPrefix+(i.expanded?"e":"c")+(i.folder?"f":"")),l.className=r.join(" "),i.li&&n(i.li).toggleClass(u.lastsib,o))},nodeSetActive:function(t,i,r){r=r||{};var h,o=t.node,e=t.tree,l=t.options,s=r.noEvents===!0,c=r.noFocus===!0,a=o===e.activeNode;return i=i!==!1,a===i?f(o):i&&!s&&this._triggerNodeEvent("beforeActivate",o,t.originalEvent)===!1?p(o,["rejected"]):(i?(e.activeNode&&(u(e.activeNode!==o,"node was active (inconsistency)"),h=n.extend({},t,{node:e.activeNode}),e.nodeSetActive(h,!1),u(null===e.activeNode,"deactivate was out of sync?")),l.activeVisible&&o.makeVisible({scrollIntoView:c&&null==e.focusNode}),e.activeNode=o,e.nodeRenderStatus(t),c||e.nodeSetFocus(t),s||e._triggerNodeEvent("activate",o,t.originalEvent)):(u(e.activeNode===o,"node was not active (inconsistency)"),e.activeNode=null,this.nodeRenderStatus(t),s||t.tree._triggerNodeEvent("deactivate",o,t.originalEvent)),f(o))},nodeSetExpanded:function(t,i,u){u=u||{};var h,o,c,y,a,w,e=t.node,b=t.tree,s=t.options,l=u.noAnimation===!0,v=u.noEvents===!0;if((i=i!==!1,e.expanded&&i||!e.expanded&&!i)||i&&!e.lazy&&!e.hasChildren())return f(e);if(!i&&e.getLevel()<s.minExpandLevel)return p(e,["locked"]);if(!v&&this._triggerNodeEvent("beforeExpand",e,t.originalEvent)===!1)return p(e,["rejected"]);if(l||e.isVisible()||(l=u.noAnimation=!0),o=new n.Deferred,i&&!e.expanded&&s.autoCollapse){a=e.getParentList(!1,!0);w=s.autoCollapse;try{for(s.autoCollapse=!1,c=0,y=a.length;c<y;c++)this._callHook("nodeCollapseSiblings",a[c],u)}finally{s.autoCollapse=w}}return o.done(function(){var n=e.getLastChild();i&&s.autoScroll&&!l&&n?n.scrollIntoView(!0,{topNode:e}).always(function(){v||t.tree._triggerNodeEvent(i?"expand":"collapse",t)}):v||t.tree._triggerNodeEvent(i?"expand":"collapse",t)}),h=function(r){var o,h,u=s._classNames,f=s.toggleEffect;if(e.expanded=i,b._callHook("nodeRender",t,!1,!1,!0),e.ul)if(o="none"!==e.ul.style.display,h=!!e.expanded,o===h)e.warn("nodeSetExpanded: UL.style.display already set");else{if(f&&!l)return n(e.li).addClass(u.animating),void n(e.ul).addClass(u.animating).toggle(f.effect,f.options,f.duration,function(){n(this).removeClass(u.animating);n(e.li).removeClass(u.animating);r()});e.ul.style.display=e.expanded||!parent?"":"none"}r()},i&&e.lazy&&e.hasChildren()===r?e.load().done(function(){o.notifyWith&&o.notifyWith(e,["loaded"]);h(function(){o.resolveWith(e)})}).fail(function(n){h(function(){o.rejectWith(e,["load failed ("+n+")"])})}):h(function(){o.resolveWith(e)}),o.promise()},nodeSetFocus:function(t,r){var o,u=t.tree,f=t.node,e=u.options,s=!!t.originalEvent&&n(t.originalEvent.target).is(":input");if(r=r!==!1,u.focusNode){if(u.focusNode===f&&r)return;o=n.extend({},t,{node:u.focusNode});u.focusNode=null;this._triggerNodeEvent("blur",o);this._callHook("nodeRenderStatus",o)}r&&(this.hasFocus()||(f.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",t,!0,{calledByNode:!0})),f.makeVisible({scrollIntoView:!1}),u.focusNode=f,e.titlesTabbable?s||n(f.span).find(".fancytree-title").focus():0===n(i.activeElement).closest(".fancytree-container").length&&n(u.$container).focus(),e.aria&&n(u.$container).attr("aria-activedescendant","ftal_"+e.idPrefix+f.key),this._triggerNodeEvent("focus",t),e.autoScroll&&f.scrollIntoView(),this._callHook("nodeRenderStatus",t))},nodeSetSelected:function(n,t){var i=n.node,r=n.tree,u=n.options;if(t=t!==!1,!i.unselectable){if(i.selected&&t||!i.selected&&!t||this._triggerNodeEvent("beforeSelect",i,n.originalEvent)===!1)return!!i.selected;t&&1===u.selectMode?r.lastSelectedNode&&r.lastSelectedNode.setSelected(!1):3===u.selectMode&&(i.selected=t,i.fixSelection3AfterClick());i.selected=t;this.nodeRenderStatus(n);r.lastSelectedNode=t?i:null;r._triggerNodeEvent("select",n)}},nodeSetStatus:function(t,i,r,u){function s(){var n=f.children?f.children[0]:null;if(n&&n.isStatusNode()){try{f.ul&&(f.ul.removeChild(n.li),n.li=null)}catch(t){}1===f.children.length?f.children=[]:f.children.shift()}}function o(t,i){var r=f.children?f.children[0]:null;return r&&r.isStatusNode()?(n.extend(r,t),r.statusNodeType=i,e._callHook("nodeRenderTitle",r)):(f._setChildren([t]),f.children[0].statusNodeType=i,e.render()),f.children[0]}var f=t.node,e=t.tree;switch(i){case"ok":s();f._isLoading=!1;f._error=null;f.renderStatus();break;case"loading":f.parent||o({title:e.options.strings.loading+(r?" ("+r+")":""),checkbox:!1,tooltip:u},i);f._isLoading=!0;f._error=null;f.renderStatus();break;case"error":o({title:e.options.strings.loadError+(r?" ("+r+")":""),checkbox:!1,tooltip:u},i);f._isLoading=!1;f._error={message:r,details:u};f.renderStatus();break;case"nodata":o({title:e.options.strings.noData,checkbox:!1,tooltip:u},i);f._isLoading=!1;f._error=null;f.renderStatus();break;default:n.error("invalid node status "+i)}},nodeToggleExpanded:function(n){return this.nodeSetExpanded(n,!n.node.expanded)},nodeToggleSelected:function(n){return this.nodeSetSelected(n,!n.node.selected)},treeClear:function(n){var t=n.tree;t.activeNode=null;t.focusNode=null;t.$div.find(">ul.fancytree-container").empty();t.rootNode.children=null},treeCreate:function(){},treeDestroy:function(){this.$div.find(">ul.fancytree-container").remove();this.$source&&this.$source.removeClass("ui-helper-hidden")},treeInit:function(n){this.treeLoad(n)},treeLoad:function(t,i){var o,s,f,r=t.tree,e=t.widget.element,h=n.extend({},t,{node:this.rootNode});if(r.rootNode.children&&this.treeClear(t),i=i||this.options.source)"string"==typeof i&&n.error("Not implemented");else switch(s=e.data("type")||"html"){case"html":f=e.find(">ul:first");f.addClass("ui-fancytree-source ui-helper-hidden");i=n.ui.fancytree.parseHtml(f);this.data=n.extend(this.data,w(f));break;case"json":i=n.parseJSON(e.text());e.contents().filter(function(){return 3===this.nodeType}).remove();n.isPlainObject(i)&&(u(n.isArray(i.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),o=i,i=i.children,delete o.children,n.extend(r.data,o));break;default:n.error("Invalid data-type: "+s)}return this.nodeLoadChildren(h,i).done(function(){r.render();3===t.options.selectMode&&r.rootNode.fixSelection3FromEndNodes();r.activeNode&&r.options.activeVisible&&r.activeNode.makeVisible();r._triggerTreeEvent("init",null,{status:!0})}).fail(function(){r.render();r._triggerTreeEvent("init",null,{status:!1})})},treeRegisterNode:function(){},treeSetFocus:function(t,i,r){function u(n){!n.activeNode&&n.getFirstChild()&&n.getFirstChild().setFocus()}if(i=i!==!1,i!==this.hasFocus()&&(this._hasFocus=i,!i&&this.focusNode?this.focusNode.setFocus(!1):!i||r&&r.calledByNode||n(this.$container).focus(),this.$container.toggleClass("fancytree-treefocus",i),this._triggerTreeEvent(i?"focusTree":"blurTree"),i)){var f=this;setTimeout(function(){u(f)},0)}},treeSetOption:function(t,i,r){var u=t.tree,e=!0,f=!1;switch(i){case"aria":case"checkbox":case"icon":case"minExpandLevel":case"tabindex":u._callHook("treeCreate",u);f=!0;break;case"escapeTitles":case"tooltip":f=!0;break;case"rtl":r===!1?u.$container.attr("DIR",null).removeClass("fancytree-rtl"):u.$container.attr("DIR","RTL").addClass("fancytree-rtl");f=!0;break;case"source":e=!1;u._callHook("treeLoad",u,r);f=!0}u.debug("set option "+i+"="+r+" <"+typeof r+">");e&&(this.widget._super?this.widget._super.call(this.widget,i,r):n.Widget.prototype._setOption.call(this.widget,i,r));f&&u.render(!0,!1)}});n.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!1,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:!0,escapeTitles:!1,extensions:[],toggleEffect:{effect:"blind",options:{direction:"vertical",scale:"box"},duration:200},generateIds:!1,icon:!0,idPrefix:"ft_",focusOnSelect:!1,keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,quicksearch:!1,rtl:!1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading&#8230;",loadError:"Load error!",moreData:"More&#8230;",noData:"No data."},tabindex:"0",titlesTabbable:!1,tooltip:!1,_classNames:{node:"fancytree-node",folder:"fancytree-folder",animating:"fancytree-animating",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partload:"fancytree-partload",partsel:"fancytree-partsel",unselectable:"fancytree-unselectable",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error",statusNodePrefix:"fancytree-statusnode-"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new a(this);this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul:first");for(var f,i,t=this.options,o=t.extensions,s=this.tree,e=0;e<o.length;e++)i=o[e],f=n.ui.fancytree._extensions[i],f||n.error("Could not apply extension '"+i+"' (it is not registered, did you forget to include it?)"),this.tree.options[i]=n.extend(!0,{},f.options,this.tree.options[i]),u(this.tree.ext[i]===r,"Extension name must not exist as Fancytree.ext attribute: '"+i+"'"),this.tree.ext[i]={},st(this.tree,s,f,i),s=f;t.icons!==r&&(t.icon!==!0?n.error("'icons' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'icons' tree option is deprecated since v2.14.0: use 'icon' instead"),t.icon=t.icons));t.iconClass!==r&&(t.icon?n.error("'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead"),t.icon=t.iconClass));t.tabbable!==r&&(t.tabindex=t.tabbable?"0":"-1",this.tree.warn("'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='"+t.tabindex+"' instead"));this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree);this._bind()},_setOption:function(n,t){return this.tree._callHook("treeSetOption",this.tree,n,t)},destroy:function(){this._unbind();this.tree._callHook("treeDestroy",this.tree);n.Widget.prototype.destroy.call(this)},_unbind:function(){var t=this.tree._ns;this.element.off(t);this.tree.$container.off(t);n(i).off(t)},_bind:function(){var r=this,i=this.options,n=this.tree,t=n._ns;this._unbind();n.$container.on("focusin"+t+" focusout"+t,function(t){var i=s.getNode(t),r="focusin"===t.type;i?n._callHook("nodeSetFocus",n._makeHookContext(i,t),r):n._callHook("treeSetFocus",n,r)}).on("selectstart"+t,"span.fancytree-title",function(n){n.preventDefault()}).on("keydown"+t,function(t){if(i.disabled||i.keyboard===!1)return!0;var r,u=n.focusNode,f=n._makeHookContext(u||n,t),e=n.phase;try{return n.phase="userEvent",r=u?n._triggerNodeEvent("keydown",u,t):n._triggerTreeEvent("keydown",t),"preventNav"===r?r=!0:r!==!1&&(r=n._callHook("nodeKeydown",f)),r}finally{n.phase=e}}).on("mousedown"+t+" dblclick"+t,function(n){if(i.disabled)return!0;var u,f=s.getEventTarget(n),e=f.node,t=r.tree,o=t.phase;if(!e)return!0;u=t._makeHookContext(e,n);try{switch(t.phase="userEvent",n.type){case"mousedown":return u.targetType=f.type,e.isPagingNode()?t._triggerNodeEvent("clickPaging",u,n)===!0:t._triggerNodeEvent("click",u,n)!==!1&&t._callHook("nodeClick",u);case"dblclick":return u.targetType=f.type,t._triggerNodeEvent("dblclick",u,n)!==!1&&t._callHook("nodeDblclick",u)}}finally{t.phase=o}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(n){return this.tree.getNodeByKey(n)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}});s=n.ui.fancytree;n.extend(n.ui.fancytree,{version:"2.22.1",buildType:"production",debugLevel:1,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:a,_FancytreeNodeClass:c,jquerySupports:{positionMyOfs:ot(n.ui.version,1,9)},assert:function(n,t){return u(n,t)},debounce:function(n,t,i,r){var u;return 3===arguments.length&&"boolean"!=typeof i&&(r=i,i=!1),function(){var f=arguments;r=r||this;i&&!u&&t.apply(r,f);clearTimeout(u);u=setTimeout(function(){i||t.apply(r,f);u=null},n)}},debug:function(){n.ui.fancytree.debugLevel>=2&&o("log",arguments)},error:function(){o("error",arguments)},escapeHtml:g,fixPositionOptions:function(t){if((t.offset||(""+t.my+t.at).indexOf("%")>=0)&&n.error("expected new position syntax (but '%' is not supported)"),!n.ui.fancytree.jquerySupports.positionMyOfs){var i=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(t.my),r=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(t.at),u=(i[2]?+i[2]:0)+(r[2]?+r[2]:0),f=(i[4]?+i[4]:0)+(r[4]?+r[4]:0);t=n.extend({},t,{my:i[1]+" "+i[3],at:r[1]+" "+r[3]});(u||f)&&(t.offset=""+u+" "+f)}return t},getEventTargetType:function(n){return this.getEventTarget(n).type},getEventTarget:function(t){var u=t&&t.target?t.target.className:"",i={node:this.getNode(t.target),type:r};return/\bfancytree-title\b/.test(u)?i.type="title":/\bfancytree-expander\b/.test(u)?i.type=i.node.hasChildren()===!1?"prefix":"expander":/\bfancytree-checkbox\b/.test(u)||/\bfancytree-radio\b/.test(u)?i.type="checkbox":/\bfancytree-icon\b/.test(u)?i.type="icon":/\bfancytree-node\b/.test(u)?i.type="title":t&&t.target&&n(t.target).closest(".fancytree-title").length&&(i.type="title"),i},getNode:function(n){if(n instanceof c)return n;for(n instanceof jQuery?n=n[0]:n.originalEvent!==r&&(n=n.target);n;){if(n.ftnode)return n.ftnode;n=n.parentNode}return null},getTree:function(t){var i;return t instanceof a?t:(t===r&&(t=0),"number"==typeof t?t=n(".fancytree-container").eq(t):"string"==typeof t?t=n(t).eq(0):t.selector!==r?t=t.eq(0):t.originalEvent!==r&&(t=n(t.target)),t=t.closest(":ui-fancytree"),i=t.data("ui-fancytree")||t.data("fancytree"),i?i.tree:null)},evalOption:function(t,i,r,u,f){var c,e,o=i.tree,s=u[t],h=r[t];return n.isFunction(s)?(c={node:i,tree:o,widget:o.widget,options:o.widget.options},e=s.call(o,{type:t},c),null==e&&(e=h)):e=null!=h?h:s,null==e&&(e=f),e},eventToString:function(n){var i=n.which,r=n.type,t=[];return n.altKey&&t.push("alt"),n.ctrlKey&&t.push("ctrl"),n.metaKey&&t.push("meta"),n.shiftKey&&t.push("shift"),"click"===r||"dblclick"===r?t.push(pt[n.button]+r):yt[i]||t.push(rt[i]||String.fromCharCode(i).toLowerCase()),t.join("+")},info:function(){n.ui.fancytree.debugLevel>=1&&o("info",arguments)},keyEventToString:function(n){return this.warn("keyEventToString() is deprecated: use eventToString()"),this.eventToString(n)},overrideMethod:function(t,i,r){var u,f=t[i]||n.noop;t[i]=function(){try{return u=this._super,this._super=f,r.apply(this,arguments)}finally{this._super=u}}},parseHtml:function(t){var o,e,s,i,c,f,u,l,y=t.find(">li"),a=[];return y.each(function(){var p,g,k=n(this),nt=k.find(">span:first",this),d=nt.length?null:k.find(">a:first"),y={tooltip:null,data:{}};for(nt.length?y.title=nt.html():d&&d.length?(y.title=d.html(),y.data.href=d.attr("href"),y.data.target=d.attr("target"),y.tooltip=d.attr("title")):(y.title=k.html(),c=y.title.search(/<ul/i),c>=0&&(y.title=y.title.substring(0,c))),y.title=n.trim(y.title),i=0,f=v.length;i<f;i++)y[v[i]]=r;for(o=this.className.split(" "),s=[],i=0,f=o.length;i<f;i++)e=o[i],ut[e]?y[e]=!0:s.push(e);if(y.extraClasses=s.join(" "),u=k.attr("title"),u&&(y.tooltip=u),u=k.attr("id"),u&&(y.key=u),p=w(k),p&&!n.isEmptyObject(p)){for(g in b)p.hasOwnProperty(g)&&(p[b[g]]=p[g],delete p[g]);for(i=0,f=h.length;i<f;i++)u=h[i],l=p[u],null!=l&&(delete p[u],y[u]=l);n.extend(y.data,p)}t=k.find(">ul:first");y.children=t.length?n.ui.fancytree.parseHtml(t):y.lazy?r:null;a.push(y)}),a},registerExtension:function(t){u(null!=t.name,"extensions must have a `name` property.");u(null!=t.version,"extensions must have a `version` property.");n.ui.fancytree._extensions[t.name]=t},unescapeHtml:function(n){var t=i.createElement("div");return t.innerHTML=n,0===t.childNodes.length?"":t.childNodes[0].nodeValue},warn:function(){o("warn",arguments)}})}(jQuery,window,document);!function(n){"use strict";n.ui.fancytree._FancytreeClass.prototype.countSelected=function(n){var t=this;return t.options,t.getSelectedNodes(n).length};n.ui.fancytree._FancytreeNodeClass.prototype.updateCounters=function(){var t=this,i=n("span.fancytree-childcounter",t.span),r=t.tree.options.childcounter,u=t.countChildren(r.deep);t.data.childCounter=u;!u&&r.hideZeros||t.isExpanded()&&r.hideExpanded?i.remove():(i.length||(i=n("<span class='fancytree-childcounter'/>").appendTo(n("span.fancytree-icon",t.span))),i.text(u));!r.deep||t.isTopLevel()||t.isRoot()||t.parent.updateCounters()};n.ui.fancytree.prototype.widgetMethod1=function(n){return this.tree,n};n.ui.fancytree.registerExtension({name:"childcounter",version:"2.22.1",options:{deep:!0,hideZeros:!0,hideExpanded:!1},foo:42,_appendCounter:function(){},treeInit:function(n){n.options;n.options.childcounter;this._superApply(arguments);this.$container.addClass("fancytree-ext-childcounter")},treeDestroy:function(){this._superApply(arguments)},nodeRenderTitle:function(t,i){var r=t.node,u=t.options.childcounter,f=null==r.data.childCounter?r.countChildren(u.deep):+r.data.childCounter;this._super(t,i);!f&&u.hideZeros||r.isExpanded()&&u.hideExpanded||n("span.fancytree-icon",r.span).append(n("<span class='fancytree-childcounter'/>").text(f))},nodeSetExpanded:function(n){var t=n.tree;return n.node,this._superApply(arguments).always(function(){t.nodeRenderTitle(n)})}})}(jQuery);!function(n){"use strict";function t(t,i){t||(i=i?": "+i:"",n.error("Assertion failed"+i))}function i(n,t){for(var i=n.length-1;i>=0;i--)if(n[i]===t)return n.splice(i,1),!0;return!1}function r(n,t,i){for(var s,r,h=3&n.length,c=n.length-h,u=i,e=3432918353,o=461845907,f=0;f<c;)r=255&n.charCodeAt(f)|(255&n.charCodeAt(++f))<<8|(255&n.charCodeAt(++f))<<16|(255&n.charCodeAt(++f))<<24,++f,r=(65535&r)*e+(((r>>>16)*e&65535)<<16)&4294967295,r=r<<15|r>>>17,r=(65535&r)*o+(((r>>>16)*o&65535)<<16)&4294967295,u^=r,u=u<<13|u>>>19,s=5*(65535&u)+((5*(u>>>16)&65535)<<16)&4294967295,u=(65535&s)+27492+(((s>>>16)+58964&65535)<<16);switch(r=0,h){case 3:r^=(255&n.charCodeAt(f+2))<<16;case 2:r^=(255&n.charCodeAt(f+1))<<8;case 1:r^=255&n.charCodeAt(f);r=(65535&r)*e+(((r>>>16)*e&65535)<<16)&4294967295;r=r<<15|r>>>17;r=(65535&r)*o+(((r>>>16)*o&65535)<<16)&4294967295;u^=r}return u^=n.length,u^=u>>>16,u=2246822507*(65535&u)+((2246822507*(u>>>16)&65535)<<16)&4294967295,u^=u>>>13,u=3266489909*(65535&u)+((3266489909*(u>>>16)&65535)<<16)&4294967295,u^=u>>>16,t?("0000000"+(u>>>0).toString(16)).substr(-8):u>>>0}function u(t){var u,i=n.map(t.getParentList(!1,!0),function(n){return n.refKey||n.key});return i=i.join("/"),u="id_"+r(i,!0)}n.ui.fancytree._FancytreeNodeClass.prototype.getCloneList=function(t){var r,u=this.tree,i=u.refMap[this.refKey]||null,f=u.keyMap;return i&&(r=this.key,t?i=n.map(i,function(n){return f[n]}):(i=n.map(i,function(n){return n===r?null:f[n]}),i.length<1&&(i=null))),i};n.ui.fancytree._FancytreeNodeClass.prototype.isClone=function(){var n=this.refKey||null,t=n&&this.tree.refMap[n]||null;return!!(t&&t.length>1)};n.ui.fancytree._FancytreeNodeClass.prototype.reRegister=function(t,i){t=null==t?null:""+t;i=null==i?null:""+i;var h=this.tree,e=this.key,f=this.refKey,o=h.keyMap,r=h.refMap,u=r[f]||null,s=!1;return null!=t&&t!==this.key&&(o[t]&&n.error("[ext-clones] reRegister("+t+"): already exists: "+this),delete o[e],o[t]=this,u&&(r[f]=n.map(u,function(n){return n===e?t:n})),this.key=t,s=!0),null!=i&&i!==this.refKey&&(u&&(1===u.length?delete r[f]:r[f]=n.map(u,function(n){return n===e?null:n})),r[i]?r[i].append(t):r[i]=[this.key],this.refKey=i,s=!0),s};n.ui.fancytree._FancytreeNodeClass.prototype.setRefKey=function(n){return this.reRegister(null,n)};n.ui.fancytree._FancytreeClass.prototype.getNodesByRef=function(t,i){var u=this.keyMap,r=this.refMap[t]||null;return r&&(r=i?n.map(r,function(n){var t=u[n];return t.isDescendantOf(i)?t:null}):n.map(r,function(n){return u[n]}),r.length<1&&(r=null)),r};n.ui.fancytree._FancytreeClass.prototype.changeRefKey=function(n,t){var i,u,f=this.keyMap,r=this.refMap[n]||null;if(r){for(i=0;i<r.length;i++)u=f[r[i]],u.refKey=t;delete this.refMap[n];this.refMap[t]=r}};n.ui.fancytree.registerExtension({name:"clones",version:"2.22.1",options:{highlightActiveClones:!0,highlightClones:!1},treeCreate:function(n){this._superApply(arguments);n.tree.refMap={};n.tree.keyMap={}},treeInit:function(n){this.$container.addClass("fancytree-ext-clones");t(null==n.options.defaultKey);n.options.defaultKey=function(n){return u(n)};this._superApply(arguments)},treeClear:function(n){return n.tree.refMap={},n.tree.keyMap={},this._superApply(arguments)},treeRegisterNode:function(r,u,f){var e,c,a=r.tree,s=a.keyMap,l=a.refMap,o=f.key,h=f&&null!=f.refKey?""+f.refKey:null;return f.isStatusNode()?this._super(r,u,f):(u?(null!=s[f.key]&&n.error("clones.treeRegisterNode: node.key already exists: "+f),s[o]=f,h&&(e=l[h],e?(e.push(o),2===e.length&&r.options.clones.highlightClones&&s[e[0]].renderStatus()):l[h]=[o])):(null==s[o]&&n.error("clones.treeRegisterNode: node.key not registered: "+f.key),delete s[o],h&&(e=l[h],e&&(c=e.length,c<=1?(t(1===c),t(e[0]===o),delete l[h]):(i(e,o),2===c&&r.options.clones.highlightClones&&s[e[0]].renderStatus())))),this._super(r,u,f))},nodeRenderStatus:function(t){var i,r,u=t.node;return r=this._super(t),t.options.clones.highlightClones&&(i=n(u[t.tree.statusClassPropName]),i.length&&u.isClone()&&i.addClass("fancytree-clone")),r},nodeSetActive:function(t,i){var r,f=t.tree.statusClassPropName,u=t.node;return r=this._superApply(arguments),t.options.clones.highlightActiveClones&&u.isClone()&&n.each(u.getCloneList(!0),function(t,r){n(r[f]).toggleClass("fancytree-active-clone",i!==!1)}),r}})}(jQuery,window,document);!function(n,t,i,r){"use strict";function h(n){return 0===n?"":n>0?"+"+n:""+n}function c(){e||(n.ui.plugin.add("draggable","connectToFancytree",{start:function(t,i){var r=n(this).data("ui-draggable")||n(this).data("draggable"),u=i.helper.data("ftSourceNode")||null;if(u)return r.offset.click.top=-2,r.offset.click.left=16,u.tree.ext.dnd._onDragEvent("start",u,null,t,i,r)},drag:function(t,i){var s,c,h,e=n(this).data("ui-draggable")||n(this).data("draggable"),u=i.helper.data("ftSourceNode")||null,f=i.helper.data("ftTargetNode")||null,r=n.ui.fancytree.getNode(t.target),o=u&&u.tree.options.dnd;return t.target&&!r&&(c=n(t.target).closest("div.fancytree-drag-helper,#fancytree-drop-marker").length>0)?(h=u||f||n.ui.fancytree,void h.debug("Drag event over helper: ignored.")):(i.helper.data("ftTargetNode",r),o&&o.updateHelper&&(s=u.tree._makeHookContext(u,t,{otherNode:r,ui:i,draggable:e,dropMarker:n("#fancytree-drop-marker")}),o.updateHelper.call(u.tree,u,s)),f&&f!==r&&f.tree.ext.dnd._onDragEvent("leave",f,u,t,i,e),void(r&&r.tree.options.dnd.dragDrop&&(r===f?r.tree.ext.dnd._onDragEvent("over",r,u,t,i,e):(r.tree.ext.dnd._onDragEvent("enter",r,u,t,i,e),r.tree.ext.dnd._onDragEvent("over",r,u,t,i,e)))))},stop:function(t,i){var e,f=n(this).data("ui-draggable")||n(this).data("draggable"),r=i.helper.data("ftSourceNode")||null,u=i.helper.data("ftTargetNode")||null,o="mouseup"===t.type&&1===t.which;o||(e=r||u||n.ui.fancytree,e.debug("Drag was cancelled"));u&&(o&&u.tree.ext.dnd._onDragEvent("drop",u,r,t,i,f),u.tree.ext.dnd._onDragEvent("leave",u,r,t,i,f));r&&r.tree.ext.dnd._onDragEvent("stop",r,null,t,i,f)}}),e=!0)}function l(t){var i=t.options.dnd||null,r=t.options.glyph||null;i&&c();i&&i.dragStart&&t.widget.element.draggable(n.extend({addClasses:!1,appendTo:t.$container,containment:!1,delay:0,distance:4,revert:!1,scroll:!0,scrollSpeed:7,scrollSensitivity:10,connectToFancytree:!0,helper:function(t){var u,e,f,i=n.ui.fancytree.getNode(t.target);return i?(f=i.tree.options.dnd,e=n(i.span),u=n("<div class='fancytree-drag-helper'><span class='fancytree-drag-helper-img' /><\/div>").css({zIndex:3,position:"relative"}).append(e.find("span.fancytree-title").clone()),u.data("ftSourceNode",i),r&&u.find(".fancytree-drag-helper-img").addClass(r.map.dragHelper),f.initHelper&&f.initHelper.call(i.tree,i,{node:i,tree:i.tree,originalEvent:t,ui:{helper:u}}),u):"<div>ERROR?: helper requested but sourceNode not found<\/div>"},start:function(n,t){var i=t.helper.data("ftSourceNode");return!!i}},t.options.dnd.draggable));i&&i.dragDrop&&t.widget.element.droppable(n.extend({addClasses:!1,tolerance:"intersect",greedy:!1},t.options.dnd.droppable))}var e=!1,u="fancytree-drop-accept",o="fancytree-drop-after",s="fancytree-drop-before",a="fancytree-drop-over",f="fancytree-drop-reject",v="fancytree-drop-target";n.ui.fancytree.registerExtension({name:"dnd",version:"2.22.1",options:{autoExpandMS:1e3,draggable:null,droppable:null,focusOnClick:!1,preventVoidMoves:!0,preventRecursiveMoves:!0,smartRevert:!0,dropMarkerOffsetX:-24,dropMarkerInsertOffsetX:-16,dragStart:null,dragStop:null,initHelper:null,updateHelper:null,dragEnter:null,dragOver:null,dragExpand:null,dragDrop:null,dragLeave:null},treeInit:function(t){var i=t.tree;this._superApply(arguments);i.options.dnd.dragStart&&i.$container.on("mousedown",function(i){if(t.options.dnd.focusOnClick){var r=n.ui.fancytree.getNode(i);r&&r.debug("Re-enable focus that was prevented by jQuery UI draggable.");setTimeout(function(){n(i.target).closest(":tabbable").focus()},10)}});l(i)},_setDndStatus:function(t,i,r,e,c){var y,p="center",l=this._local,w=this.options.dnd,b=this.options.glyph,k=t?n(t.span):null,d=n(i.span),g=d.find("span.fancytree-title");if(l.$dropMarker||(l.$dropMarker=n("<div id='fancytree-drop-marker'><\/div>").hide().css({"z-index":1e3}).prependTo(n(this.$div).parent()),b&&l.$dropMarker.addClass(b.map.dropMarker)),"after"===e||"before"===e||"over"===e){switch(y=w.dropMarkerOffsetX||0,e){case"before":p="top";y+=w.dropMarkerInsertOffsetX||0;break;case"after":p="bottom";y+=w.dropMarkerInsertOffsetX||0}l.$dropMarker.toggleClass(o,"after"===e).toggleClass(a,"over"===e).toggleClass(s,"before"===e).show().position(n.ui.fancytree.fixPositionOptions({my:"left"+h(y)+" center",at:"left "+p,of:g}))}else l.$dropMarker.hide();k&&k.toggleClass(u,c===!0).toggleClass(f,c===!1);d.toggleClass(v,"after"===e||"before"===e||"over"===e).toggleClass(o,"after"===e).toggleClass(s,"before"===e).toggleClass(u,c===!0).toggleClass(f,c===!1);r.toggleClass(u,c===!0).toggleClass(f,c===!1)},_onDragEvent:function(t,u,f,e,o,s){var b,k,d,g,nt,p,a,h,l,it=this.options,c=it.dnd,v=this._makeHookContext(u,e,{otherNode:f,ui:o,draggable:s}),y=null,tt=this,w=n(u.span);switch(c.smartRevert&&(s.options.revert="invalid"),t){case"start":u.isStatusNode()?y=!1:c.dragStart&&(y=c.dragStart(u,v));y===!1?(this.debug("tree.dragStart() cancelled"),o.helper.trigger("mouseup").hide()):(c.smartRevert&&(g=u[v.tree.nodeContainerAttrName].getBoundingClientRect(),d=n(s.options.appendTo)[0].getBoundingClientRect(),s.originalPosition.left=Math.max(0,g.left-d.left),s.originalPosition.top=Math.max(0,g.top-d.top)),w.addClass("fancytree-drag-source"),n(i).on("keydown.fancytree-dnd,mousedown.fancytree-dnd",function(t){"keydown"===t.type&&t.which===n.ui.keyCode.ESCAPE?tt.ext.dnd._cancelDrag():"mousedown"===t.type&&tt.ext.dnd._cancelDrag()}));break;case"enter":l=(!c.preventRecursiveMoves||!u.isDescendantOf(f))&&(c.dragEnter?c.dragEnter(u,v):null);y=!!l&&(n.isArray(l)?{over:n.inArray("over",l)>=0,before:n.inArray("before",l)>=0,after:n.inArray("after",l)>=0}:{over:l===!0||"over"===l,before:l===!0||"before"===l,after:l===!0||"after"===l});o.helper.data("enterResponse",y);break;case"over":a=o.helper.data("enterResponse");h=null;a===!1||("string"==typeof a?h=a:(k=w.offset(),nt={x:e.pageX-k.left,y:e.pageY-k.top},p={x:nt.x/w.width(),y:nt.y/w.height()},a.after&&p.y>.75?h="after":!a.over&&a.after&&p.y>.5?h="after":a.before&&p.y<=.25?h="before":!a.over&&a.before&&p.y<=.5?h="before":a.over&&(h="over"),c.preventVoidMoves&&(u===f?(this.debug("    drop over source node prevented"),h=null):"before"===h&&f&&u===f.getNextSibling()?(this.debug("    drop after source node prevented"),h=null):"after"===h&&f&&u===f.getPrevSibling()?(this.debug("    drop before source node prevented"),h=null):"over"===h&&f&&f.parent===u&&f.isLastSibling()&&(this.debug("    drop last child over own parent prevented"),h=null)),o.helper.data("hitMode",h)));"before"===h||"after"===h||!c.autoExpandMS||u.hasChildren()===!1||u.expanded||c.dragExpand&&c.dragExpand(u,v)===!1||u.scheduleAction("expand",c.autoExpandMS);h&&c.dragOver&&(v.hitMode=h,y=c.dragOver(u,v));b=y!==!1&&null!==h;c.smartRevert&&(s.options.revert=!b);this._local._setDndStatus(f,u,o.helper,h,b);break;case"drop":h=o.helper.data("hitMode");h&&c.dragDrop&&(v.hitMode=h,c.dragDrop(u,v));break;case"leave":u.scheduleAction("cancel");o.helper.data("enterResponse",null);o.helper.data("hitMode",null);this._local._setDndStatus(f,u,o.helper,"out",r);c.dragLeave&&c.dragLeave(u,v);break;case"stop":w.removeClass("fancytree-drag-source");n(i).off(".fancytree-dnd");c.dragStop&&c.dragStop(u,v);break;default:n.error("Unsupported drag event: "+t)}return y},_cancelDrag:function(){var t=n.ui.ddmanager.current;t&&t.cancel()}})}(jQuery,window,document);!function(n,t,i,r){"use strict";function w(n){return 0===n?"":n>0?"+"+n:""+n}function b(t){var i;return!!t&&(i=n.isPlainObject(t)?{over:!!t.over,before:!!t.before,after:!!t.after}:n.isArray(t)?{over:n.inArray("over",t)>=0,before:n.inArray("before",t)>=0,after:n.inArray("after",t)>=0}:{over:t===!0||"over"===t,before:t===!0||"before"===t,after:t===!0||"after"===t},0!==Object.keys(i).length&&i)}function k(r,u){var c,f,l,a=r.options.dnd5,o=r.$scrollParent[0],s=a.scrollSensitivity,h=a.scrollSpeed,e=0;return o!==i&&"HTML"!==o.tagName?(c=r.$scrollParent.offset(),f=o.scrollTop,c.top+o.offsetHeight-u.pageY<s?(l=o.scrollHeight-r.$scrollParent.innerHeight()-f,l>0&&(o.scrollTop=e=f+h)):f>0&&u.pageY-c.top<s&&(o.scrollTop=e=f-h)):(f=n(i).scrollTop(),f>0&&u.pageY-f<s?(e=f-h,n(i).scrollTop(e)):n(t).height()-(u.pageY-f)<s&&(e=f+h,n(i).scrollTop(e))),e&&r.debug("autoScroll: "+e+"px"),e}function d(t,i){if(i.options.dnd5.scroll&&k(i.tree,t),!i.node)return i.tree.warn("Ignore dragover for non-node"),s;var b,tt,v,r=null,it=i.tree,rt=it.options,a=rt.dnd5,o=i.node,l=i.otherNode,d="center",nt=n(o.span),ut=nt.find("span.fancytree-title");if(u===!1)return it.warn("Ignore dragover, since dragenter returned false"),!1;if("string"==typeof u?n.error("assert failed: dragenter returned string"):(tt=nt.offset(),v=(t.pageY-tt.top)/nt.height(),u.after&&v>.75?r="after":!u.over&&u.after&&v>.5?r="after":u.before&&v<=.25?r="before":!u.over&&u.before&&v<=.5?r="before":u.over&&(r="over"),a.preventVoidMoves&&(o===l?(o.debug("drop over source node prevented"),r=null):"before"===r&&l&&o===l.getNextSibling()?(o.debug("drop after source node prevented"),r=null):"after"===r&&l&&o===l.getPrevSibling()?(o.debug("drop before source node prevented"),r=null):"over"===r&&l&&l.parent===o&&l.isLastSibling()&&(o.debug("drop last child over own parent prevented"),r=null))),i.hitMode=r,r&&a.dragOver&&(a.dragOver(o,i),r=i.hitMode),s=r,"after"===r||"before"===r||"over"===r){switch(b=a.dropMarkerOffsetX||0,r){case"before":d="top";b+=a.dropMarkerInsertOffsetX||0;break;case"after":d="bottom";b+=a.dropMarkerInsertOffsetX||0}f.toggleClass(y,"after"===r).toggleClass(e,"over"===r).toggleClass(p,"before"===r).show().position(n.ui.fancytree.fixPositionOptions({my:"left"+w(b)+" center",at:"left "+d,of:ut}))}else f.hide();return n(o.span).toggleClass(g,"after"===r||"before"===r||"over"===r).toggleClass(y,"after"===r).toggleClass(p,"before"===r).toggleClass(h,"over"===r).toggleClass(c,r===!1),r}var a="fancytree-drag-source",v="fancytree-drag-remove",h="fancytree-drop-accept",y="fancytree-drop-after",p="fancytree-drop-before",e="fancytree-drop-over",c="fancytree-drop-reject",g="fancytree-drop-target",l="application/x-fancytree-node",f=null,o=null,u=null,s=null;n.ui.fancytree.registerExtension({name:"dnd5",version:"2.22.1",options:{autoExpandMS:1500,setTextTypeJson:!1,preventForeignNodes:!1,preventNonNodes:!1,preventRecursiveMoves:!0,preventVoidMoves:!0,scroll:!0,scrollSensitivity:20,scrollSpeed:5,dropMarkerOffsetX:-24,dropMarkerInsertOffsetX:-16,dragStart:null,dragDrag:n.noop,dragEnd:n.noop,dragEnter:null,dragOver:n.noop,dragExpand:n.noop,dragDrop:n.noop,dragLeave:n.noop},treeInit:function(t){var y=t.tree,p=t.options,i=p.dnd5,w=n.ui.fancytree.getNode;n.inArray("dnd",p.extensions)>=0&&n.error("Extensions 'dnd' and 'dnd5' are mutually exclusive.");i.dragStop&&n.error("dragStop is not used by ext-dnd5. Use dragEnd instead.");i.dragStart&&n.ui.fancytree.overrideMethod(t.options,"createNode",function(n,t){this._super.apply(this,arguments);t.node.span.draggable=!0});this._superApply(arguments);this.$container.addClass("fancytree-ext-dnd5");this.$scrollParent=this.$container.children(":first").scrollParent();f=n("#fancytree-drop-marker");f.length||(f=n("<div id='fancytree-drop-marker'><\/div>").hide().css({"z-index":1e3,"pointer-events":"none"}).prependTo("body"));i.dragStart&&y.$container.on("dragstart drag dragend",function(t){var c,e=w(t),s=t.dataTransfer||t.originalEvent.dataTransfer,p="move"===s.dropEffect,b=e?n(e.span):null,h={node:e,tree:y,options:y.options,originalEvent:t,dataTransfer:s,isCancelled:r};switch(t.type){case"dragstart":n(e.span).addClass(a);o=e;c=JSON.stringify(e.toDict());try{s.setData(l,c);s.setData("text/html",n(e.span).html());s.setData("text/plain",e.title)}catch(k){y.warn("Could not set data (IE only accepts 'text') - "+k)}return i.setTextTypeJson?s.setData("text",c):s.setData("text",e.title),s.effectAllowed="all",s.setDragImage&&s.setDragImage(n(e.span).find(".fancytree-title")[0],-10,-10),i.dragStart(e,h)!==!1;case"drag":b.toggleClass(v,p);i.dragDrag(e,h);break;case"dragend":n(e.span).removeClass(a+" "+v);o=null;u=null;h.isCancelled="none"===s.dropEffect;f.hide();i.dragEnd(e,h)}});i.dragEnter&&y.$container.on("dragenter dragover dragleave drop",function(t){var nt,p,it,k,tt=null,a=w(t),g=t.dataTransfer||t.originalEvent.dataTransfer,v={node:a,tree:y,options:y.options,hitMode:u,originalEvent:t,dataTransfer:g,otherNode:o||null,otherNodeData:null,dropEffect:r,isCancelled:r};switch(t.type){case"dragenter":if(!a){y.debug("Ignore non-node "+t.type+": "+t.target.tagName+"."+t.target.className);u=!1;break}if(n(a.span).addClass(e).removeClass(h+" "+c),i.preventNonNodes&&!p){a.debug("Reject dropping a non-node");u=!1;break}if(i.preventForeignNodes&&(!o||o.tree!==a.tree)){a.debug("Reject dropping a foreign node");u=!1;break}setTimeout(function(){!i.autoExpandMS||a.hasChildren()===!1||a.expanded||i.dragExpand&&i.dragExpand(a,v)===!1||a.scheduleAction("expand",i.autoExpandMS)},0);f.show();i.preventRecursiveMoves&&a.isDescendantOf(v.otherNode)?k=!1:(it=i.dragEnter(a,v),k=b(it));u=k;tt=k&&(k.over||k.before||k.after);break;case"dragover":s=d(t,v);tt=!!s;break;case"dragleave":if(!a){y.debug("Ignore non-node "+t.type+": "+t.target.tagName+"."+t.target.className);break}if(!n(a.span).hasClass(e)){a.debug("Ignore dragleave (multi)");break}n(a.span).removeClass(e+" "+h+" "+c);a.scheduleAction("cancel");i.dragLeave(a,v);f.hide();break;case"drop":if(n.inArray(l,g.types)>=0&&(p=g.getData(l),y.info(t.type+": getData('application/x-fancytree-node'): '"+p+"'")),p||(p=g.getData("text"),y.info(t.type+": getData('text'): '"+p+"'")),p)try{nt=JSON.parse(p);nt.title!==r&&(v.otherNodeData=nt)}catch(rt){}y.debug(t.type+": nodeData: '"+p+"', otherNodeData: ",v.otherNodeData);n(a.span).removeClass(e+" "+h+" "+c);f.hide();v.hitMode=s;v.dropEffect=g.dropEffect;v.isCancelled="none"===v.dropEffect;i.dragDrop(a,v);t.preventDefault()}if(tt)return t.preventDefault(),!1})}})}(jQuery,window,document);!function(n,t,i){"use strict";var r=/Mac/.test(navigator.platform),u=n.ui.fancytree.escapeHtml,f=n.ui.fancytree.unescapeHtml;n.ui.fancytree._FancytreeNodeClass.prototype.editStart=function(){var r,t=this,u=this.tree,s=u.ext.edit,e=u.options.edit,h=n(".fancytree-title",t.span),o={node:t,tree:u,options:u.options,isNew:n(t[u.statusClassPropName]).hasClass("fancytree-edit-new"),orgTitle:t.title,input:null,dirty:!1};return e.beforeEdit.call(t,{type:"beforeEdit"},o)!==!1&&(n.ui.fancytree.assert(!s.currentNode,"recursive edit"),s.currentNode=this,s.eventData=o,u.widget._unbind(),n(i).on("mousedown.fancytree-edit",function(i){n(i.target).hasClass("fancytree-edit-input")||t.editEnd(!0,i)}),r=n("<input />",{"class":"fancytree-edit-input",type:"text",value:u.options.escapeTitles?o.orgTitle:f(o.orgTitle)}),s.eventData.input=r,null!=e.adjustWidthOfs&&r.width(h.width()+e.adjustWidthOfs),null!=e.inputCss&&r.css(e.inputCss),h.html(r),r.focus().change(function(){r.addClass("fancytree-edit-dirty")}).keydown(function(i){switch(i.which){case n.ui.keyCode.ESCAPE:t.editEnd(!1,i);break;case n.ui.keyCode.ENTER:return t.editEnd(!0,i),!1}i.stopPropagation()}).blur(function(n){return t.editEnd(!0,n)}),void e.edit.call(t,{type:"edit"},o))};n.ui.fancytree._FancytreeNodeClass.prototype.editEnd=function(t,r){var o,e=this,s=this.tree,h=s.ext.edit,f=h.eventData,c=s.options.edit,a=n(".fancytree-title",e.span),l=a.find("input.fancytree-edit-input");return c.trim&&l.val(n.trim(l.val())),o=l.val(),f.dirty=o!==e.title,f.originalEvent=r,f.save=t===!1?!1:f.isNew?""!==o:f.dirty&&""!==o,c.beforeClose.call(e,{type:"beforeClose"},f)!==!1&&(!f.save||c.save.call(e,{type:"save"},f)!==!1)&&(l.removeClass("fancytree-edit-dirty").off(),n(i).off(".fancytree-edit"),f.save?(e.setTitle(s.options.escapeTitles?o:u(o)),e.setFocus()):f.isNew?(e.remove(),e=f.node=null,h.relatedNode.setFocus()):(e.renderTitle(),e.setFocus()),h.eventData=null,h.currentNode=null,h.relatedNode=null,s.widget._bind(),n(s.$container).focus(),f.input=null,c.close.call(e,{type:"close"},f),!0)};n.ui.fancytree._FancytreeNodeClass.prototype.editCreateNode=function(t,i){var r,f=this.tree,u=this;return t=t||"child",null==i?i={title:""}:"string"==typeof i?i={title:i}:n.ui.fancytree.assert(n.isPlainObject(i)),"child"!==t||this.isExpanded()||this.hasChildren()===!1?(r=this.addNode(i,t),r.match=!0,n(r[f.statusClassPropName]).removeClass("fancytree-hide").addClass("fancytree-match"),void r.makeVisible().done(function(){n(r[f.statusClassPropName]).addClass("fancytree-edit-new");u.tree.ext.edit.relatedNode=u;r.editStart()})):void this.setExpanded().done(function(){u.editCreateNode(t,i)})};n.ui.fancytree._FancytreeClass.prototype.isEditing=function(){return this.ext.edit?this.ext.edit.currentNode:null};n.ui.fancytree._FancytreeNodeClass.prototype.isEditing=function(){return!!this.tree.ext.edit&&this.tree.ext.edit.currentNode===this};n.ui.fancytree.registerExtension({name:"edit",version:"2.22.1",options:{adjustWidthOfs:4,allowEmpty:!1,inputCss:{minWidth:"3em"},triggerStart:["f2","shift+click","mac+enter"],trim:!0,beforeClose:n.noop,beforeEdit:n.noop,close:n.noop,edit:n.noop,save:n.noop},currentNode:null,treeInit:function(){this._superApply(arguments);this.$container.addClass("fancytree-ext-edit")},nodeClick:function(t){return n.inArray("shift+click",t.options.edit.triggerStart)>=0&&t.originalEvent.shiftKey?(t.node.editStart(),!1):this._superApply(arguments)},nodeDblclick:function(t){return n.inArray("dblclick",t.options.edit.triggerStart)>=0?(t.node.editStart(),!1):this._superApply(arguments)},nodeKeydown:function(t){switch(t.originalEvent.which){case 113:if(n.inArray("f2",t.options.edit.triggerStart)>=0)return t.node.editStart(),!1;break;case n.ui.keyCode.ENTER:if(n.inArray("mac+enter",t.options.edit.triggerStart)>=0&&r)return t.node.editStart(),!1}return this._superApply(arguments)}})}(jQuery,window,document);!function(n){"use strict";function i(n){return(n+"").replace(/([.?*+\^\$\[\]\\(){}|-])/g,"\\$1")}function r(t){return t.indexOf(">")>=0?n("<div/>").html(t).text():t}var t="__not_found__",u=n.ui.fancytree.escapeHtml;n.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(f,e,o){var a,s,v,y,l=0,c=this.options,p=c.escapeTitles,b=c.autoCollapse,h=n.extend({},c.filter,o),w="hide"===h.mode,k=!!h.leavesOnly&&!e;return"string"==typeof f&&(a=h.fuzzy?f.split("").reduce(function(n,t){return n+"[^"+t+"]*"+t}):i(f),v=new RegExp(".*"+a+".*","i"),y=new RegExp(i(f),"gi"),f=function(n){var t,i=p?n.title:r(n.title),f=!!v.test(i);return f&&h.highlight&&(t=p?u(n.title):i,n.titleWithHighlight=t.replace(y,function(n){return"<mark>"+n+"<\/mark>"})),f}),this.enableFilter=!0,this.lastFilterArgs=arguments,this.$div.addClass("fancytree-ext-filter"),w?this.$div.addClass("fancytree-ext-filter-hide"):this.$div.addClass("fancytree-ext-filter-dimm"),this.$div.toggleClass("fancytree-ext-filter-hide-expanders",!!h.hideExpanders),this.visit(function(n){delete n.match;delete n.titleWithHighlight;n.subMatchCount=0}),s=this.getRootNode()._findDirectChild(t),s&&s.remove(),c.autoCollapse=!1,this.visit(function(n){if(!k||null==n.children){var t=f(n),i=!1;if("skip"===t)return n.visit(function(n){n.match=!1},!0),"skip";!t&&(e||"branch"===t)&&n.parent.match&&(t=!0,i=!0);t&&(l++,n.match=!0,n.visitParents(function(n){n.subMatchCount+=1;!h.autoExpand||i||n.expanded||(n.setExpanded(!0,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),n._filterAutoExpanded=!0)}))}}),c.autoCollapse=b,0===l&&h.nodata&&w&&(s=h.nodata,n.isFunction(s)&&(s=s()),s===!0?s={}:"string"==typeof s&&(s={title:s}),s=n.extend({statusNodeType:"nodata",key:t,title:this.options.strings.noData},s),this.getRootNode().addNode(s).match=!0),this.render(),l};n.ui.fancytree._FancytreeClass.prototype.filterNodes=function(n,t){return"boolean"==typeof t&&(t={leavesOnly:t},this.warn("Fancytree.filterNodes() leavesOnly option is deprecated since 2.9.0 / 2015-04-19. Use opts.leavesOnly instead.")),this._applyFilterImpl(n,!1,t)};n.ui.fancytree._FancytreeClass.prototype.applyFilter=function(){return this.warn("Fancytree.applyFilter() is deprecated since 2.1.0 / 2014-05-29. Use .filterNodes() instead."),this.filterNodes.apply(this,arguments)};n.ui.fancytree._FancytreeClass.prototype.filterBranches=function(n,t){return this._applyFilterImpl(n,!0,t)};n.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){var i,r=this.getRootNode()._findDirectChild(t),f=this.options.escapeTitles,u=this.options.enhanceTitle;r&&r.remove();this.visit(function(t){t.match&&t.span&&(i=n(t.span).find(">span.fancytree-title"),f?i.text(t.title):i.html(t.title),u&&u({type:"enhanceTitle"},{node:t,$title:i}));delete t.match;delete t.subMatchCount;delete t.titleWithHighlight;t.$subMatchBadge&&(t.$subMatchBadge.remove(),delete t.$subMatchBadge);t._filterAutoExpanded&&t.expanded&&t.setExpanded(!1,{noAnimation:!0,noEvents:!0,scrollIntoView:!1});delete t._filterAutoExpanded});this.enableFilter=!1;this.lastFilterArgs=null;this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide");this.render()};n.ui.fancytree._FancytreeClass.prototype.isFilterActive=function(){return!!this.enableFilter};n.ui.fancytree._FancytreeNodeClass.prototype.isMatched=function(){return!(this.tree.enableFilter&&!this.match)};n.ui.fancytree.registerExtension({name:"filter",version:"2.22.1",options:{autoApply:!0,autoExpand:!1,counter:!0,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:!0,leavesOnly:!1,nodata:!0,mode:"dimm"},nodeLoadChildren:function(n){return this._superApply(arguments).done(function(){n.tree.enableFilter&&n.tree.lastFilterArgs&&n.options.filter.autoApply&&n.tree._applyFilterImpl.apply(n.tree,n.tree.lastFilterArgs)})},nodeSetExpanded:function(n,t){return delete n.node._filterAutoExpanded,!t&&n.options.filter.hideExpandedCounter&&n.node.$subMatchBadge&&n.node.$subMatchBadge.show(),this._superApply(arguments)},nodeRenderStatus:function(t){var u,i=t.node,f=t.tree,e=t.options.filter,r=n(i.span).find("span.fancytree-title"),o=n(i[f.statusClassPropName]),s=t.options.enhanceTitle,h=t.options.escapeTitles;return u=this._super(t),o.length&&f.enableFilter?(o.toggleClass("fancytree-match",!!i.match).toggleClass("fancytree-submatch",!!i.subMatchCount).toggleClass("fancytree-hide",!(i.match||i.subMatchCount)),!e.counter||!i.subMatchCount||i.isExpanded()&&e.hideExpandedCounter?i.$subMatchBadge&&i.$subMatchBadge.hide():(i.$subMatchBadge||(i.$subMatchBadge=n("<span class='fancytree-childcounter'/>"),n("span.fancytree-icon, span.fancytree-custom-icon",i.span).append(i.$subMatchBadge)),i.$subMatchBadge.show().text(i.subMatchCount)),!i.span||i.isEditing&&i.isEditing.call(i)||(i.titleWithHighlight?r.html(i.titleWithHighlight):h?r.text(i.title):r.html(i.title),s&&s({type:"enhanceTitle"},{node:i,$title:r})),u):u}})}(jQuery,window,document);!function(n){"use strict";function t(n,t){return n.map[t]}n.ui.fancytree.registerExtension({name:"glyph",version:"2.22.1",options:{map:{checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",nodata:"icon-meh",noExpander:"",dragHelper:"icon-caret-right",dropMarker:"icon-caret-right",doc:"icon-file-alt",docOpen:"icon-file-alt",loading:"icon-refresh icon-spin",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt"}},treeInit:function(n){var t=n.tree;this._superApply(arguments);t.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(i){var f,o,u,r=i.node,s=n(r.span),e=i.options.glyph,h=e.map;return o=this._super(i),r.isRoot()?o:(u=s.children("span.fancytree-expander").get(0),u&&(f=r.expanded&&r.hasChildren()?"expanderOpen":r.isUndefined()?"expanderLazy":r.hasChildren()?"expanderClosed":"noExpander",u.className="fancytree-expander "+h[f]),u=r.tr?n("td",r.tr).find("span.fancytree-checkbox").get(0):s.children("span.fancytree-checkbox").get(0),u&&(f=r.selected?"checkboxSelected":r.partsel?"checkboxUnknown":"checkbox",u.className="fancytree-checkbox "+h[f]),u=s.children("span.fancytree-icon").get(0),u&&(f=r.statusNodeType?t(e,r.statusNodeType):r.folder?r.expanded&&r.hasChildren()?t(e,"folderOpen"):t(e,"folder"):r.expanded?t(e,"docOpen"):t(e,"doc"),u.className="fancytree-icon "+f),o)},nodeSetStatus:function(i,r){var e,u,o=i.options.glyph,f=i.node;return e=this._superApply(arguments),"error"!==r&&"loading"!==r&&"nodata"!==r||(f.parent?(u=n("span.fancytree-expander",f.span).get(0),u&&(u.className="fancytree-expander "+t(o,r))):(u=n(".fancytree-statusnode-"+r,f[this.nodeContainerAttrName]).find("span.fancytree-icon").get(0),u&&(u.className="fancytree-icon "+t(o,r)))),e}})}(jQuery,window,document);!function(n){"use strict";function i(t,i){var r,f=i.get(0),u=0;return t.children().each(function(){return this!==f&&(r=n(this).prop("colspan"),void(u+=r?r:1))}),u}function r(t,i){var r,u=null,f=0;return t.children().each(function(){return f>=i?(u=n(this),!1):(r=n(this).prop("colspan"),void(f+=r?r:1))}),u}function u(n,u){var f,s,o=n.closest("td"),e=null;switch(u){case t.LEFT:e=o.prev();break;case t.RIGHT:e=o.next();break;case t.UP:case t.DOWN:for(f=o.parent(),s=i(f,o);;){if(f=u===t.UP?f.prev():f.next(),!f.length)break;if(!f.is(":hidden")&&(e=r(f,s),e&&e.find(":input,a").length))break}}return e}var t=n.ui.keyCode,f={text:[t.UP,t.DOWN],checkbox:[t.UP,t.DOWN,t.LEFT,t.RIGHT],link:[t.UP,t.DOWN,t.LEFT,t.RIGHT],radiobutton:[t.UP,t.DOWN,t.LEFT,t.RIGHT],"select-one":[t.LEFT,t.RIGHT],"select-multiple":[t.LEFT,t.RIGHT]};n.ui.fancytree.registerExtension({name:"gridnav",version:"2.22.1",options:{autofocusInput:!1,handleCursorKeys:!0},treeInit:function(t){this._requireExtension("table",!0,!0);this._superApply(arguments);this.$container.addClass("fancytree-ext-gridnav");this.$container.on("focusin",function(i){var u,r=n.ui.fancytree.getNode(i.target);r&&!r.isActive()&&(u=t.tree._makeHookContext(r,i),t.tree._callHook("nodeSetActive",u,!0))})},nodeSetActive:function(t,i){var u,e=t.options.gridnav,r=t.node,o=t.originalEvent||{},f=n(o.target).is(":input");i=i!==!1;this._superApply(arguments);i&&(t.options.titlesTabbable?(f||(n(r.span).find("span.fancytree-title").focus(),r.setFocus()),t.tree.$container.attr("tabindex","-1")):e.autofocusInput&&!f&&(u=n(r.tr||r.span),u.find(":input:enabled:first").focus()))},nodeKeydown:function(t){var i,o,r,h=t.options.gridnav,s=t.originalEvent,e=n(s.target);return e.is(":input:enabled")?i=e.prop("type"):e.is("a")&&(i="link"),i&&h.handleCursorKeys?(o=f[i],!(o&&n.inArray(s.which,o)>=0&&(r=u(e,s.which),r&&r.length))||(r.find(":input:enabled,a").focus(),!1)):this._superApply(arguments)}})}(jQuery,window,document);!function(n,t,i,r){"use strict";function l(t,i,r,u,e){var o,c,a,s,y=!1,v=[],h=[];for(r=r||[],e=e||n.Deferred(),o=0,a=r.length;o<a;o++)c=r[o],s=t.getNodeByKey(c),s?u&&s.isUndefined()?(y=!0,t.debug("_loadLazyNodes: "+s+" is lazy: loading..."),"expand"===u?v.push(s.setExpanded()):v.push(s.load())):(t.debug("_loadLazyNodes: "+s+" already loaded."),s.setExpanded()):(h.push(c),t.debug("_loadLazyNodes: "+s+" was not yet found."));return n.when.apply(n,v).always(function(){if(y&&h.length>0)l(t,i,h,u,e);else{if(h.length)for(t.warn("_loadLazyNodes: could not load those keys: ",h),o=0,a=h.length;o<a;o++)c=r[o],i._appendKey(f,r[o],!1);e.resolve()}}),e}var s,h,c,a=n.ui.fancytree.assert,e="active",f="expanded",o="focus",u="selected";"function"==typeof Cookies?(c=Cookies.set,s=Cookies.get,h=Cookies.remove):(c=s=n.cookie,h=n.removeCookie);n.ui.fancytree._FancytreeClass.prototype.clearCookies=function(n){var t=this.ext.persist,i=t.cookiePrefix;n=n||"active expanded focus selected";n.indexOf(e)>=0&&t._data(i+e,null);n.indexOf(f)>=0&&t._data(i+f,null);n.indexOf(o)>=0&&t._data(i+o,null);n.indexOf(u)>=0&&t._data(i+u,null)};n.ui.fancytree._FancytreeClass.prototype.getPersistData=function(){var n=this.ext.persist,i=n.cookiePrefix,r=n.cookieDelimiter,t={};return t[e]=n._data(i+e),t[f]=(n._data(i+f)||"").split(r),t[u]=(n._data(i+u)||"").split(r),t[o]=n._data(i+o),t};n.ui.fancytree.registerExtension({name:"persist",version:"2.22.1",options:{cookieDelimiter:"~",cookiePrefix:r,cookie:{raw:!1,expires:"",path:"",domain:"",secure:!1},expandLazy:!1,fireActivate:!0,overrideSource:!0,store:"auto",types:"active expanded focus selected"},_data:function(n,t){var i=this._local.localStorage;return t===r?i?i.getItem(n):s(n):void(null===t?i?i.removeItem(n):h(n):i?i.setItem(n,t):c(n,t,this.options.persist.cookie))},_appendKey:function(t,i,r){i=""+i;var f=this._local,c=this.options.persist,e=c.cookieDelimiter,o=f.cookiePrefix+t,s=f._data(o),u=s?s.split(e):[],h=n.inArray(i,u);h>=0&&u.splice(h,1);r&&u.push(i);f._data(o,u.join(e))},treeInit:function(i){var v=i.tree,y=i.options,h=this._local,c=this.options.persist;return a("auto"!==c.store&&"cookie"!==c.store||s,"Missing required plugin for 'persist' extension: js.cookie.js or jquery.cookie.js"),h.cookiePrefix=c.cookiePrefix||"fancytree-"+v._id+"-",h.storeActive=c.types.indexOf(e)>=0,h.storeExpanded=c.types.indexOf(f)>=0,h.storeSelected=c.types.indexOf(u)>=0,h.storeFocus=c.types.indexOf(o)>=0,h.localStorage="cookie"!==c.store&&t.localStorage?"local"===c.store?t.localStorage:t.sessionStorage:null,v.$div.bind("fancytreeinit",function(){if(v._triggerTreeEvent("beforeRestore",null,{})!==!1){var i,p,a,s,t,w=h._data(h.cookiePrefix+o),b=c.fireActivate===!1;i=h._data(h.cookiePrefix+f);s=i&&i.split(c.cookieDelimiter);p=h.storeExpanded?l(v,h,s,!!c.expandLazy&&"expand",null):(new n.Deferred).resolve();p.done(function(){if(h.storeSelected){if(i=h._data(h.cookiePrefix+u))for(s=i.split(c.cookieDelimiter),a=0;a<s.length;a++)t=v.getNodeByKey(s[a]),t?(t.selected===r||c.overrideSource&&t.selected===!1)&&(t.selected=!0,t.renderStatus()):h._appendKey(u,s[a],!1);3===v.options.selectMode&&v.visit(function(n){if(n.selected)return n.fixSelection3AfterClick(),"skip"})}h.storeActive&&(i=h._data(h.cookiePrefix+e),!i||!y.persist.overrideSource&&v.activeNode||(t=v.getNodeByKey(i),t&&(t.debug("persist: set active",i),t.setActive(!0,{noFocus:!0,noEvents:b}))));h.storeFocus&&w&&(t=v.getNodeByKey(w),t&&(v.options.titlesTabbable?n(t.span).find(".fancytree-title").focus():n(v.$container).focus()));v._triggerTreeEvent("restore",null,{})})}}),this._superApply(arguments)},nodeSetActive:function(n,t){var r,i=this._local;return t=t!==!1,r=this._superApply(arguments),i.storeActive&&i._data(i.cookiePrefix+e,this.activeNode?this.activeNode.key:null),r},nodeSetExpanded:function(n,t){var i,u=n.node,r=this._local;return t=t!==!1,i=this._superApply(arguments),r.storeExpanded&&r._appendKey(f,u.key,t),i},nodeSetFocus:function(n,t){var r,i=this._local;return t=t!==!1,r=this._superApply(arguments),i.storeFocus&&i._data(i.cookiePrefix+o,this.focusNode?this.focusNode.key:null),r},nodeSetSelected:function(t,i){var e,r,o=t.tree,s=t.node,f=this._local;return i=i!==!1,e=this._superApply(arguments),f.storeSelected&&(3===o.options.selectMode?(r=n.map(o.getSelectedNodes(!0),function(n){return n.key}),r=r.join(t.options.persist.cookieDelimiter),f._data(f.cookiePrefix+u,r)):f._appendKey(u,s.key,s.selected)),e}})}(jQuery,window,document);!function(n,t,i){"use strict";function r(t,i){i=i||"";t||n.error("Assertion failed "+i)}function f(n,t){n.insertBefore(t,n.firstChild)}function e(n,t){n.parentNode.insertBefore(t,n.nextSibling)}function u(n,t){n.visit(function(n){var i=n.tr;if(i&&(i.style.display=n.hide||!t?"none":""),!n.expanded)return"skip"})}function o(t){var o,f,i,e=t.parent,u=e?e.children:null;if(u&&u.length>1&&u[0]!==t)for(o=n.inArray(t,u),i=u[o-1],r(i.tr);i.children&&i.children.length&&(f=i.children[i.children.length-1],f.tr);)i=f;else i=e;return i}n.ui.fancytree.registerExtension({name:"table",version:"2.22.1",options:{checkboxColumnIdx:null,indentation:16,nodeColumnIdx:0},treeInit:function(t){var c,o,s,f,l,u=t.tree,e=t.options,a=e.table,h=u.widget.element;if(null!=a.customStatus&&(null!=e.renderStatusColumns?n.error("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' only instead."):(u.warn("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' instead."),e.renderStatusColumns=a.customStatus)),e.renderStatusColumns&&e.renderStatusColumns===!0&&(e.renderStatusColumns=e.renderColumns),h.addClass("fancytree-container fancytree-ext-table"),u.tbody=h.find(">tbody")[0],l=n(u.tbody),o=n("thead >tr:last >th",h).length,f=l.children("tr:first"),f.length)s=f.children("td").length,o&&s!==o&&(u.warn("Column count mismatch between thead ("+o+") and tbody ("+s+"): using tbody."),o=s),f=f.clone();else for(r(o>=1,"Need either <thead> or <tbody> with <td> elements to determine column count."),f=n("<tr />"),c=0;c<o;c++)f.append("<td />");f.find(">td").eq(a.nodeColumnIdx).html("<span class='fancytree-node' />");e.aria&&(f.attr("role","row"),f.find("td").attr("role","gridcell"));u.rowFragment=i.createDocumentFragment();u.rowFragment.appendChild(f.get(0));l.empty();u.statusClassPropName="tr";u.ariaPropName="tr";this.nodeContainerAttrName="tr";u.$container=h;this._superApply(arguments);n(u.rootNode.ul).remove();u.rootNode.ul=null;this.$container.attr("tabindex",e.tabindex);e.aria&&u.$container.attr("role","treegrid").attr("aria-readonly",!0)},nodeRemoveChildMarkup:function(t){var i=t.node;i.visit(function(t){t.tr&&(n(t.tr).remove(),t.tr=null)})},nodeRemoveMarkup:function(t){var i=t.node;i.tr&&(n(i.tr).remove(),i.tr=null);this.nodeRemoveChildMarkup(t)},nodeRender:function(t,i,s,h,c){var p,g,k,nt,y,w,b,d,a=t.tree,l=t.node,v=t.options,tt=!l.parent;if(a._enableUpdate!==!1){if(c||(t.hasCollapsedParents=l.parent&&!l.parent.expanded),!tt)if(l.tr&&i&&this.nodeRemoveMarkup(t),l.tr)i?this.nodeRenderTitle(t):this.nodeRenderStatus(t);else{if(t.hasCollapsedParents&&!s)return void l.debug("nodeRender ignored due to unrendered parent");y=a.rowFragment.firstChild.cloneNode(!0);w=o(l);r(w);h===!0&&c?y.style.display="none":s&&t.hasCollapsedParents&&(y.style.display="none");w.tr?e(w.tr,y):(r(!w.parent,"prev. row must have a tr, or be system root"),f(a.tbody,y));l.tr=y;l.key&&v.generateIds&&(l.tr.id=v.idPrefix+l.key);l.tr.ftnode=l;v.aria&&n(l.tr).attr("aria-labelledby","ftal_"+l.key);l.span=n("span.fancytree-node",l.tr).get(0);this.nodeRenderTitle(t);v.createNode&&v.createNode.call(a,{type:"createNode"},t)}if(v.renderNode&&v.renderNode.call(a,{type:"renderNode"},t),p=l.children,p&&(tt||s||l.expanded))for(k=0,nt=p.length;k<nt;k++)d=n.extend({},t,{node:p[k]}),d.hasCollapsedParents=d.hasCollapsedParents||!l.expanded,this.nodeRender(d,i,s,h,!0);p&&!c&&(b=l.tr||null,g=a.tbody.firstChild,l.visit(function(n){if(n.tr){if(n.parent.expanded||"none"===n.tr.style.display||(n.tr.style.display="none",u(n,!1)),n.tr.previousSibling!==b){l.debug("_fixOrder: mismatch at node: "+n);var t=b?b.nextSibling:g;a.tbody.insertBefore(n.tr,t)}b=n.tr}}))}},nodeRenderTitle:function(t,i){var e,f,u=t.node,r=t.options,o=u.isStatusNode();return f=this._super(t,i),u.isRootNode()?f:(r.checkbox&&!o&&null!=r.table.checkboxColumnIdx&&(e=n("span.fancytree-checkbox",u.span),n(u.tr).find("td").eq(+r.table.checkboxColumnIdx).html(e)),this.nodeRenderStatus(t),o?r.renderStatusColumns&&r.renderStatusColumns.call(t.tree,{type:"renderStatusColumns"},t):r.renderColumns&&r.renderColumns.call(t.tree,{type:"renderColumns"},t),f)},nodeRenderStatus:function(t){var r,i=t.node,u=t.options;this._super(t);n(i.tr).removeClass("fancytree-node");r=(i.getLevel()-1)*u.table.indentation;n(i.span).css({paddingLeft:r+"px"})},nodeSetExpanded:function(t,i,r){function e(n){u(t.node,i);n?i&&t.options.autoScroll&&!r.noAnimation&&t.node.hasChildren()?t.node.getLastChild().scrollIntoView(!0,{topNode:t.node}).always(function(){r.noEvents||t.tree._triggerNodeEvent(i?"expand":"collapse",t);f.resolveWith(t.node)}):(r.noEvents||t.tree._triggerNodeEvent(i?"expand":"collapse",t),f.resolveWith(t.node)):(r.noEvents||t.tree._triggerNodeEvent(i?"expand":"collapse",t),f.rejectWith(t.node))}if(i=i!==!1,t.node.expanded&&i||!t.node.expanded&&!i)return this._superApply(arguments);var f=new n.Deferred,o=n.extend({},r,{noEvents:!0,noAnimation:!0});return r=r||{},this._super(t,i,o).done(function(){e(!0)}).fail(function(){e(!1)}),f.promise()},nodeSetStatus:function(t,i){if("ok"===i){var u=t.node,r=u.children?u.children[0]:null;r&&r.isStatusNode()&&n(r.tr).remove()}return this._superApply(arguments)},treeClear:function(){return this.nodeRemoveChildMarkup(this._makeHookContext(this.rootNode)),this._superApply(arguments)},treeDestroy:function(){return this.$container.find("tbody").empty(),this.$source&&this.$source.removeClass("ui-helper-hidden"),this._superApply(arguments)}})}(jQuery,window,document);!function(n){"use strict";n.ui.fancytree.registerExtension({name:"themeroller",version:"2.22.1",options:{activeClass:"ui-state-active",addClass:"ui-corner-all",focusClass:"ui-state-focus",hoverClass:"ui-state-hover",selectedClass:"ui-state-highlight"},treeInit:function(t){var i=t.widget.element,r=t.options.themeroller;this._superApply(arguments);"TABLE"===i[0].nodeName?(i.addClass("ui-widget ui-corner-all"),i.find(">thead tr").addClass("ui-widget-header"),i.find(">tbody").addClass("ui-widget-conent")):i.addClass("ui-widget ui-widget-content ui-corner-all");i.delegate(".fancytree-node","mouseenter mouseleave",function(t){var i=n.ui.fancytree.getNode(t.target),u="mouseenter"===t.type;n(i.tr?i.tr:i.span).toggleClass(r.hoverClass+" "+r.addClass,u)})},treeDestroy:function(n){this._superApply(arguments);n.widget.element.removeClass("ui-widget ui-widget-content ui-corner-all")},nodeRenderStatus:function(t){var r={},u=t.node,f=n(u.tr?u.tr:u.span),i=t.options.themeroller;this._super(t);r[i.activeClass]=!1;r[i.focusClass]=!1;r[i.selectedClass]=!1;u.isActive()&&(r[i.activeClass]=!0);u.hasFocus()&&(r[i.focusClass]=!0);u.isSelected()&&!u.isActive()&&(r[i.selectedClass]=!0);f.toggleClass(i.activeClass,r[i.activeClass]);f.toggleClass(i.focusClass,r[i.focusClass]);f.toggleClass(i.selectedClass,r[i.selectedClass]);f.addClass(i.addClass)}})}(jQuery,window,document);!function(n){"use strict";function i(t,i){t="fancytree-style-"+t;var r=n("#"+t);if(!i)return r.remove(),null;r.length||(r=n("<style />").attr("id",t).addClass("fancytree-style").prop("type","text/css").appendTo("head"));try{r.html(i)}catch(u){r[0].styleSheet.cssText=i}return r}function r(n,t,i,r,u,f){for(var s="#"+n+" span.fancytree-level-",o=[],e=0;e<t;e++)o.push(s+(e+1)+" span.fancytree-title { padding-left: "+(e*i+r)+f+"; }");return o.push("#"+n+" div.ui-effects-wrapper ul li span.fancytree-title, #"+n+" ul.fancytree-animating span.fancytree-title { padding-left: "+u+f+"; position: static; width: auto; }"),o.join("\n")}var t=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;n.ui.fancytree.registerExtension({name:"wide",version:"2.22.1",options:{iconWidth:null,iconSpacing:null,labelSpacing:null,levelOfs:null},treeCreate:function(u){this._superApply(arguments);this.$container.addClass("fancytree-ext-wide");var c,a,v,y,f,p,o=u.options.wide,l=n("<li id='fancytreeTemp'><span class='fancytree-node'><span class='fancytree-icon' /><span class='fancytree-title' /><\/span><ul />").appendTo(u.tree.$container),w=l.find(".fancytree-icon"),k=l.find("ul"),e=o.iconSpacing||w.css("margin-left"),s=o.iconWidth||w.css("width"),h=o.labelSpacing||"3px",b=o.levelOfs||k.css("padding-left");l.remove();v=e.match(t)[2];e=parseFloat(e,10);y=h.match(t)[2];h=parseFloat(h,10);f=s.match(t)[2];s=parseFloat(s,10);p=b.match(t)[2];v===f&&p===f&&y===f||n.error("iconWidth, iconSpacing, and levelOfs must have the same css measure unit");this._local.measureUnit=f;this._local.levelOfs=parseFloat(b);this._local.lineOfs=(1+(u.options.checkbox?1:0)+(u.options.icon===!1?0:1))*(s+e)+e;this._local.labelOfs=h;this._local.maxDepth=10;c=this.$container.uniqueId().attr("id");a=r(c,this._local.maxDepth,this._local.levelOfs,this._local.lineOfs,this._local.labelOfs,this._local.measureUnit);i(c,a)},treeDestroy:function(){return i(this.$container.attr("id"),null),this._superApply(arguments)},nodeRenderStatus:function(t){var u,e,o,f=t.node,s=f.getLevel();return o=this._super(t),s>this._local.maxDepth&&(u=this.$container.attr("id"),this._local.maxDepth*=2,f.debug("Define global ext-wide css up to level "+this._local.maxDepth),e=r(u,this._local.maxDepth,this._local.levelOfs,this._local.lineOfs,this._local.labelSpacing,this._local.measureUnit),i(u,e)),n(f.span).addClass("fancytree-level-"+s),o}})}(jQuery,window,document)})