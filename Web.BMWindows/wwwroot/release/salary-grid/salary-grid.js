(function(n){n.fn.salaryGrid=function(t){var i=this,u=this.selector,r;return i.searchParams={keyword:"",limit:null},i.editParams={},i.sourceData=[],i.viewData=[],i.count=0,i.rowIndex=0,i.sequentially={number:5,total:0,first:!1,done:!1,loading:!1,loaded:0},i.formId="",i.sumarray=[],i.tounchTr=null,i.moveObjectId=null,i.colRight,i.searching,i.editLoader=".salary-grid-edit-loader",i.clickSubContextMenu=!1,r=n.extend({tableSize:null,lazy:null,rootUrl:null,dataUrl:null,params:null,autoLoad:null,width:null,height:null,selectRow:null,toolbars:null,idAttribute:null,rows:[],cols:null,editController:null,model:"",filterable:!1,checkAll:null,beforeSubmit:null,detailRow:null,childs:null,modal:null,contextMenu:null,skipCols:0,loadDataCallback:null,loadModalCallback:null,selectRowCallback:null,submitFormCallback:null,sumInfo:null,beforeSearch:null,hideable:!1},t),i.set=r,i.filter={attrs:[]},r.params!=null&&(typeof r.params.search!="undefined"&&n.extend(i.searchParams,r.params.search),typeof r.params.edit!="undefined"&&n.extend(i.editParams,r.params.edit)),i.showTableLoading=function(){var t=n(u).find(".main-content");n(t).find(".loading").length==0&&n(t).append(app.loading());n(u).find(".loading").show()},i.hideTableLoading=function(){n(u).find(".loading").hide()},i.drawCheckbox=function(n){return'<td class="first-col" style="width: 40px"><div class="checkbox checkbox-info"><input type="checkbox"  class="styled check-item" value="" dataId="'+n+'"/><label><\/label><\/div><\/td>'},i.drawExpandNode=function(n,t){var i='<span class="expand-child position-left level-'+n+'" level="'+n+'" >';return i+=t>0?'<i class="icon-arrow-right13"><\/i>':"",i+"<\/span>"},i.setTdData=function(t,u,f,e){var o='<td attr="'+u.attribute+'" ci="'+f+'"',b="",h="",v,y,p,s,c,w,l,a,k;u.class!=null&&(b+=n.isFunction(u.class)?" "+u.class(t)+" ":" "+u.class+" ");u.editInline&&(b+=" edit-inline ");o+=' class="'+b+'"';o+=' style="height: '+r.height.row+"px; ";v="";u.style!=null&&(v+=n.isFunction(u.style)?" "+u.style(t)+" ":u.style);o+=v+'"';u.colspan!=null&&u.colspan.if(t)&&(o+=' colspan="'+u.colspan.value+'" ');switch(u.type){case"text":u.sumable?typeof i.sumarray[f]=="undefined"&&(i.sumarray[f]=0):i.sumarray[f]=null;o+=">";u.expandChild!=null&&(o+=i.drawExpandNode(level,t.TotalChild));s="";u.attribute!=null&&t[u.attribute]!=null&&(s=t[u.attribute]);u.editInline!=null?(y=u.editInline,y==!0?(o+='<span class="span-edit-inline" >'+s+"<\/span>",o+='<div class="form-group inline-form"><input style="'+v+'" class="form-control" data-type="text" attr="'+u.attribute+'" value="'+s+'" /><\/div>'):y.type=="option"&&(h="",p='<select style="'+v+'" class="form-control" data-type="text" attr="'+u.attribute+'" >',n(y.lst).each(function(){p+='<option value="'+this.id+'" '+(s==this.id?'selected="selected"':"")+">"+this.text+"<\/option>";this.id==s&&(h=this.text)}),p+="<\/select>",o+='<span class="span-edit-inline" >'+h+"<\/span>",o+='<div class="form-group inline-form">'+p+"<\/div>")):u.render!=null?o+="<span> "+u.render(t)+"<\/span>":(o+="<span",u.aline!=null&&(o+=' class="aline" title="'+s+'"'),o+="> "+s+"<\/span>");break;case"checkbox":o+=">";s=t[u.attribute];o+='<div class="form-group"><input class="" type="checkbox" attr="'+u.attribute+'" value="true" '+(s==!0?'checked="checked"':"")+" /><\/div>";i.sumarray[f]=null;break;case"option":for(o+=' style="width: 40px;">',c='<ul class="icons-list">',c+='<li class="dropdown">',c+='<a class="dropdown-toggle" href="#" data-toggle="dropdown" aria-expanded="false"><i class="icon-menu9" style="font-size: 16px;"><\/i><\/a>',c+='<ul class="dropdown-menu dropdown-menu-right" style="width: 200px">',w=0;w<u.render.length;w++)l=u.render[w],l!=null&&(l.condition==null||l.condition(t))&&(c+='<li><a href="javascript:void(0)"',l.class!=null&&(c+='class="'+l.class+'"'),c+='><i style="margin-right:5px" class="'+l.icon+" "+l.iconColor+'"><\/i>'+l.text+"<\/a><\/li>");c+="<\/li><\/ul>";o+=c+"<\/ul>";break;case"date":o+=">";o+="<span>"+app.formatDate(t[u.attribute])+"<\/span>";i.sumarray[f]=null;break;case"time":o+=">";o+=app.formatTime(t[u.attribute]);i.sumarray[f]=null;break;case"datetime":o+=">";o+=app.formatDateTime(t[u.attribute]);i.sumarray[f]=null;break;case"html":o+=">";u.render!=null?o+=u.render(t).replace(/\n/g,"<br/>"):u.attribute!=null&&(o+=t[u.attribute]!=null?t[u.attribute]:"");i.sumarray[f]=null;break;case"price":case"number":u.sumable&&typeof i.sumarray[f]=="undefined"&&(i.sumarray[f]=0);o+=">";a=0;a=u.render!=null?u.render(t,u.attribute):parseFloat(t[u.attribute]);i.sumarray[f]+=a;h=u.fixed!=null?a.toFixed(u.fixed):Math.round(a);h=u.renderText!=null?u.renderText(t):u.type=="price"?app.formatPrice(h):h;u.editInline?(o+='<span class="span-edit-inline"> '+h+"<\/span>",k=u.style!=null?u.style:"",o+='<div class="form-group inline-form"><input style="'+k+'" class="form-control" data-type="price" attr="'+u.attribute+'" value="'+a+'" /><\/div>'):o+='<span class=""> '+h+"<\/span>";break;case"ai":o+=">";o+=e;u.sumable?(typeof i.sumarray[f]=="undefined"&&(i.sumarray[f]=0),i.sumarray[f]+=1):i.sumarray[f]=null}return o+"<\/td>"},i.drawRow=function(n,t,u,f,e,o){var w={left:"",right:""},v=r.skipCols,h='<tr data-top="##top##"',b,y,p,c,a,s,l;if(r.contextMenu!=null&&(h+=' data-toggle="context" data-target=".context-table-row" '),h+=' dataid="'+n[t]+'" ai="'+f+'" groupid="'+o+'" ',b=' class="tr-child tr-real ',r.rowStyle!=null&&(h+=" "+r.rowStyle(n)+'" '),b+='"',h+=b,typeof n.Code!="undefined"&&(h+=' datacode="'+n.Code+'" '),n.ParentId!=null&&(h+=' parent="'+n.ParentId+'" '),h+=">",v>0){for(l="",v>0&&(r.checkAll==null||r.checkAll)&&(l+=i.drawCheckbox(n.Id),v--),y=0,p=v,s=y;s<p;s++)c=r.rows[s],a=!1,a=app.hasValue(c.visible)?c.visible():!0,a&&(l+=i.setTdData(n,c,s,f));w.left=h+l+"<td>&nbsp;<\/td><\/tr>"}for(l="",y=v,p=r.rows.length,s=y;s<p;s++)c=r.rows[s],a=!1,a=app.hasValue(c.visible)?c.visible():!0,a&&(l+=i.setTdData(n,c,s,f));return w.right=h+l+"<td>&nbsp;<\/td><\/tr>",w},i.drawSuminfo=function(n){var t=i.set.sumInfo,f,o,h,c,u,e,l,s;for(r.skipCols>0&&n.find(".area-bl tbody").append('<tr class="warning tr-total"><td colspan="'+r.skipCols+'" style="height: 31px" class="text-bold text-center">TỔNG CỘNG<\/td><\/tr>'),f='<tr class="warning tr-total">',o=0,t.colspan!=null&&(o=t.colspan,f+='<td colspan="'+t.colspan+'" style="text-align: right"><strong>Tổng<\/strong><\/td>'),r.skipCols>0&&(o+=r.skipCols),h=-1,c="",t.label!=null&&(h=t.label.col!=null?t.label.col:0,c=t.label.text!=null?t.label.text:"TỔNG CỘNG"),u=o;u<i.set.rows.length;u++)u==h?f+='<td style="text-align: right"><strong>'+c+"<\/strong><\/td>":(e=i.set.rows[u],e.sumable?(l="",i.sumarray.length>u&&(l=e.fixed!=null?i.sumarray[u].toFixed(e.fixed):app.formatPrice(i.sumarray[u])),s='<td class="text-right" data-attr="'+e.attribute+'" ',e.style!=null&&(s+='style="'+e.style+'"'),s+=" ><strong>"+l+"<\/strong><\/td>",f+=s):f+="<td>&nbsp;<\/td>");f+="<td><\/td><\/tr>";n.find(".area-br tbody").append(f)},i.rowFilter=function(t){var o=r.skipCols,h='<tr class="tr-filter">',c,l,f,u,v,y,e,s,a,p,i;if(t){if(o==0)return"";o>0&&(r.checkAll==null||r.checkAll)&&(h+="<td><\/td>",o--);c=0;l=o}else(r.checkAll==null||r.checkAll)&&(o==0?h+="<td><\/td>":o--),c=o,l=r.rows.length;for(f=c;f<l;f++)if(u=r.rows[f],v=app.hasValue(u.visible)?u.visible():!0,v){if(y=r.model,u.model!=null&&(y=u.model),e="<td ",u.colspan!=null&&u.colspan.if(item)&&(e+=' colspan="'+u.colspan.value+'" '),e+=">",s=u.filter,s!=null)switch(s.type){case"contains":i='<div class="input-group input-group-sm"><div class="input-group-btn" > <button type="button" class="btn btn-default btn-left dropdown-toggle" title="Lộc dữ liệu" data-toggle="dropdown"><i class="icon-search4"><\/i><\/button><\/div > <input type="text" class="form-control filter-contains" data-index="'+f+'" attr="'+s.attr+'" placeholder="..."><\/div>';e+=i;break;case"option":a=r.head.groups[f];i='<div class="form-group form-group-sm"><div class="input-group input-group-sm"><select class="form-control filter-option select-option" attr="'+u.attribute+'"  data-index="'+f+'" data-width="'+a+'" style="width: '+a+'px"><option value="">Tất cả<\/option>';s.lst!=null&&(p=s.lst(),n(p).each(function(){i+='<option value="'+this.id+'">'+this.text+"<\/option>"}));i+="<\/select><\/div><\/div>";e+=i;break;case"optionRemote":i='<div class="form-group form-group-sm"><div class="input-group input-group-sm"><div class="input-group-btn" > <button type="button" class="btn btn-default btn-left dropdown-toggle" title="Lộc dữ liệu" data-toggle="dropdown"><i class="icon-filter4"><\/i><\/button><\/div><input type="text" attr="'+u.attribute+'" class="form-control filter-option select-option-remote" data-index="'+f+'" data-width="'+r.head.groups[f]+'"/>';i+="<\/div><\/div>";e+=i;break;case"compoTree":i='<div class="form-group form-group-sm"><div class="input-group input-group-sm"><div class="input-group-btn" > <button type="button" class="btn btn-default btn-left dropdown-toggle" title="Lộc dữ liệu" data-toggle="dropdown"><i class="icon-filter4"><\/i><\/button><\/div>';i+='<input class="form-control compo-tree" id="'+app.newGuid()+'" data-index="'+f+'" type="text" />';i+="<\/div><\/div>";e+=i;break;case"date":i='<div class="datepicker" from to name="'+u.attribute+'" data-index="'+f+'" ><\/div>';e+=i}e+="<\/td>";h+=e}return h+"<td>&nbsp;<\/td><\/tr>"},i.drawEmptyRow=function(n){var t=r.skipCols,u='<tr class="empty">',f;if(n){if(t==0)return"";t>0&&(r.checkAll==null||r.checkAll)&&(u+=i.drawCheckbox(),t--);f=t}else(r.checkAll==null||r.checkAll)&&(t==0?u+=i.drawCheckbox():t--),f=r.rows.length-t;return u+='<td colspan="'+f+'"><\/td>',u+"<td>&nbsp;<\/td><\/tr>"},i.showBackground=function(){var t=n(u).find("> .salary-table > .main-content"),r=t.find(".area-bl tbody"),f=t.find(".area-br tbody");t.find(".area-bl tbody tr").css("display","none");t.find(".area-br tbody tr").css("display","none");t.find(".area-bl tbody tr.tr-background").remove();t.find(".area-br tbody tr.tr-background").remove();n(i.viewData).each(function(){var i;if(this.active)if(t.find('tr.tr-group[groupid="'+this.gid+'"]').css("display","table-row"),this.groupChilds.length>0)n(this.groupChilds).each(function(){var i;if(this.active){t.find('tr.tr-group[groupid="'+this.gid+'"]').css("display","table-row");var u="",e="",o=r.find('tr.tr-group[groupid="'+this.gid+'"]'),s=f.find('tr.tr-group[groupid="'+this.gid+'"]');for(i=0;i<this.count;i++)this.left[i].active&&(u+=this.left[i].bg,e+=this.right[i].bg);for(n(o).after(u),n(s).after(e),i=0;i<this.count;i++)this.left[i].active&&(r.find('tr.tr-child[dataid="'+this.left[i].id+'"]').attr("data-top",this.left[i].top),f.find('tr.tr-child[dataid="'+this.left[i].id+'"]').attr("data-top",this.left[i].top))}});else{var u="",e="",o=r.find('tr.tr-group[groupid="'+this.gid+'"]'),s=f.find('tr.tr-group[groupid="'+this.gid+'"]');for(i=0;i<this.count;i++)this.left[i].active&&(u+=this.left[i].bg,e+=this.right[i].bg,r.find('tr.tr-child[dataid="'+this.left[i].id+'"]').attr("data-top",this.left[i].top),f.find('tr.tr-child[dataid="'+this.left[i].id+'"]').attr("data-top",this.left[i].top));for(n(o).after(u),n(s).after(e),i=0;i<this.count;i++)this.left[i].active&&(r.find('tr.tr-child[dataid="'+this.left[i].id+'"]').attr("data-top",this.left[i].top),f.find('tr.tr-child[dataid="'+this.left[i].id+'"]').attr("data-top",this.left[i].top))}})},i.showData=function(t){var s=n(u).find("> .salary-table > .main-content"),f=s.find(".area-bl tbody"),e=s.find(".area-br tbody"),l=f.find("tr.tr-child"),a=s.find(".area-br").height(),o=[],h=[],c;n(l).each(function(){var i=parseInt(n(this).attr("data-top")),u=r.height.row;(i<=t&&t<=i+u||i-a<=t&&t<i)&&o.push(parseInt(n(this).attr("dataid")))});c=f.find("tr.tr-child.tr-real");n(c).each(function(){var t=parseInt(n(this).attr("dataid"));n.inArray(t,o)<0&&h.push(t)});n(i.viewData).each(function(){if(this.groupChilds.length>0)n(this.groupChilds).each(function(){for(var t=0;t<this.count;t++)n.inArray(this.left[t].id,h)>=0&&(f.find('tr.tr-real[dataid="'+this.left[t].id+'"]').replaceWith(this.left[t].bg),e.find('tr.tr-real[dataid="'+this.right[t].id+'"]').replaceWith(this.right[t].bg))});else for(var t=0;t<this.count;t++)n.inArray(this.left[t].id,h)>=0&&(f.find('tr.tr-real[dataid="'+this.left[t].id+'"]').replaceWith(this.left[t].bg),e.find('tr.tr-real[dataid="'+this.right[t].id+'"]').replaceWith(this.right[t].bg))});n(i.viewData).each(function(){if(this.active)if(this.groupChilds.length>0)n(this.groupChilds).each(function(){if(this.active)for(var t=0;t<this.count;t++)n.inArray(this.left[t].id,o)>=0&&(f.find('tr.tr-background[dataid="'+this.left[t].id+'"]').replaceWith(this.left[t].html),e.find('tr.tr-background[dataid="'+this.right[t].id+'"]').replaceWith(this.right[t].html))});else for(var t=0;t<this.count;t++)n.inArray(this.left[t].id,o)>=0&&(f.find('tr.tr-background[dataid="'+this.left[t].id+'"]').replaceWith(this.left[t].html),e.find('tr.tr-background[dataid="'+this.right[t].id+'"]').replaceWith(this.right[t].html),f.find('tr.tr-child[dataid="'+this.left[t].id+'"]').attr("data-top",this.left[t].top),e.find('tr.tr-child[dataid="'+this.left[t].id+'"]').attr("data-top",this.left[t].top))});i.setRowEvents()},i.setViewData=function(t){var f="Id",e,u;r.idAttribute!=null&&(f=r.idAttribute);n.each(t,function(t,o){var s=o[r.group.attr];u=i.drawRow(o,f,1,t+1,!0,s);e=!1;n(i.viewData).each(function(){var t=this,c,i,h;if(t.groupChilds.length>0)n(t.groupChilds).each(function(){var n=this;if(n.gid==s){n.active=!0;t.active=!0;e=!0;n.left.push({active:!0,id:o[f],html:u.left,bg:"",keyword:o.Keyword});n.right.push({id:o[f],html:u.right,bg:""});n.count+=1;return}});else if(t.gid==s){for(t.active=!0,e=!0,t.left.push({active:!0,id:o[f],html:u.left,bg:"",keyword:o.Keyword}),c={id:o[f],html:u.right,bg:""},i=0;i<r.rows.length;i++)h=r.rows[i],h.filter!=null&&(c[h.attribute]=o[h.attribute]);t.right.push(c);t.count+=1;return}});e||i.viewData.push({active:!0,gid:s,checked:!1,left:[{active:!0,html:u.left,bg:"",keyword:o.Keyword}],right:[{html:u.left,bg:""}],count:1,loaded:!0,groupChilds:[],top:0})})},i.loadDataSequentially=function(t,u){i.searchParams.orgStr=t.join(";");i.sequentially.ajax=n.ajax({url:r.dataUrl!=null?r.dataUrl:"/api/"+r.model+"List",type:"GET",dataType:"JSON",contentType:"application/json; charset=utf-8",data:i.searchParams,success:function(f){var o=f.Count!=null?f.Count:0,e=f.Many!=null?f.Many:f.length>0?f:[];i.sourceData=n.merge(i.sourceData,e);i.count+=f.Count;i.sumarray=[];r.rows.length>0&&e!=null&&e.length>0&&i.setViewData(e);i.sequentially.loaded+=t.length;app.loadingAsyncData({mode:1,tl:i.sequentially.loaded/i.viewData.length});t=[];n(i.viewData).each(function(){if(!this.loaded)if(t.length<i.sequentially.number)t.push(this.gid),this.loaded=!0;else return});t.length>0?i.loadDataSequentially(t):(i.sequentially.loading=!1,app.loadingAsyncData({mode:2}),i.sortai(),i.setRowPositions(),i.showBackground(),i.showData(0),i.hideTableLoading(),r.loadDataCallback!=null&&r.loadDataCallback(f),u!=null&&u(f))}})},i.loadData=function(t,f,e){if(t!=null&&n.extend(i.searchParams,t),app.cleanJson(i.searchParams),i.searchParams.limit=n.isEmptyObject(i.searchParams)?r.params.limitClear:null,r.group!=null)if(r.group.sequentially){var o=[];i.sequentially.total=i.viewData%i.sequentially.number==0?i.viewData/i.sequentially.number:i.viewData/i.sequentially.number+1;n(i.viewData).each(function(){if(!this.loaded)if(o.length<i.sequentially.number)o.push(this.gid),this.loaded=!0;else return});o.length>0&&(i.sequentially.loading=!0,i.sequentially.first=!0,app.loadingAsyncData({mode:0,text:"Đang tải dữ liệu ..."}),i.clearViewData(),i.loadDataSequentially(o,f))}else i.showTableLoading(),n.ajax({url:r.dataUrl!=null?r.dataUrl:"/api/"+r.model+"List",type:"GET",dataType:"JSON",contentType:"application/json; charset=utf-8",data:i.searchParams,success:function(t){var c=t.Count!=null?t.Count:0,s=t.Many!=null?t.Many:t.length>0?t:[],l,o,h;c==0&&(c=s.length);l=r.optionMenu!=null;o=n(u).find("> .salary-table > .main-content");o.find(".area-bl tbody tr").removeClass("showed-child");o.find(".area-br tbody tr").removeClass("showed-child");i.sourceData=s;i.count=t.Count;i.sumarray=[];i.clearViewData();r.rows.length>0&&(s!=null&&s.length>0?(i.setViewData(s),o.find("tbody tr.tr-child").remove(),i.sortai(),i.setRowPositions(),i.showBackground(),i.showData(0),i.set.sumInfo!=null&&i.drawSuminfo(o),o.find(".empty-message").css("display","none")):(i.showBackground(),i.showData(0),h=i.drawEmptyRow(!0),o.find(".area-bl tbody").append(h),h=i.drawEmptyRow(!1),o.find(".area-br tbody").append(h),o.find(".empty-message").css("display","block")));i.hideTableLoading();r.loadDataCallback!=null&&r.loadDataCallback(t,e);f!=null&&f(t)}});else i.showTableLoading(),n.ajax({url:r.dataUrl!=null?r.dataUrl:"/api/"+r.model+"List",type:"GET",dataType:"JSON",contentType:"application/json; charset=utf-8",data:i.searchParams,success:function(t){var c=t.Count!=null?t.Count:0,s=t.Many!=null?t.Many:t.length>0?t:[],o,h;c==0&&(c=s.length);o=n(u).find("> .salary-table > .main-content");o.find(".area-bl tbody").html("");o.find(".area-br tbody").html("");o.find(".area-bom tbody").html("");i.sourceData=s;i.count=t.Count;i.sumarray=[];r.rows.length>0&&s!=null&&s.length>0&&(h="Id",r.idAttribute!=null&&(h=r.idAttribute),i.sumarray=[],n.each(s,function(n,t){var r=i.drawRow(t,h,1,n+1,!0);o.find(".area-bl tbody").append(r.left);o.find(".area-br tbody").append(r.right)}),i.set.sumInfo!=null&&i.drawSuminfo(o));i.setRowEvents();i.hideTableLoading();r.loadDataCallback!=null&&r.loadDataCallback(t,e);f!=null&&f(t)}})},i.setRowPositions=function(){var u=r.height.row,t=-r.height.row;n(i.viewData).each(function(){var f,r,o,e;if(this.active)if(t+=u,this.top=t,this.groupChilds.length>0)n(this.groupChilds).each(function(){var r,n,e,f;if(this.active&&(t+=u,this.count>0)){for(r=0,n=0;n<this.count;n++)this.left[n].active&&(t+=u,r++,e=this.left[n].id,this.left[n].top,f=i.drawBackground(e,u,t,this.gid),this.left[n].html=this.left[n].html.replace("##top##",t),this.right[n].html=this.right[n].html.replace("##top##",t),this.left[n].bg=f.left,this.right[n].bg=f.right);this.top=u*r}});else if(this.count>0){for(f=0,r=0;r<this.count;r++)this.left[r].active&&(t+=u,f++,o=this.left[r].id,this.left[r].top=t,e=i.drawBackground(o,u,t,this.gid),this.left[r].html=this.left[r].html.replace("##top##",t),this.right[r].html=this.right[r].html.replace("##top##",t),this.left[r].bg=e.left,this.right[r].bg=e.right);this.top=u*f}})},i.drawBackground=function(n,t,u,f){var e='<tr dataid="'+n+'" data-top="'+u+'" class="tr-background tr-child" groupid="'+f+'" style=""><td style="height: '+t+'px" colspan="'+r.skipCols+'">&nbsp;<\/td><\/tr>',o='<tr dataid="'+n+'" data-top="'+u+'" class="tr-background tr-child" groupid="'+f+'" style=""><td style="height: '+t+'px" colspan="'+i.colRight+'">&nbsp;<\/td><\/tr>';return{left:e,right:o}},i.sortai=function(){var t;n(i.viewData).each(function(){this.groupChilds.length>0?n(this.groupChilds).each(function(){this.active&&(t=0,n(this.left).each(function(){var i,u;this.active&&(i=n(this.html),t++,r.checkAll?i.find("td:eq(1)").text(t):i.find("td:eq(0)").text(t),u=n("<div>").append(i.clone()).html(),this.html=u)}))}):this.active&&(t=0,n(this.left).each(function(){var i,u;this.active&&(i=n(this.html),t++,r.checkAll?i.find("td:eq(1)").text(t):i.find("td:eq(0)").text(t),u=n("<div>").append(i.clone()).html(),this.html=u)}))})},i.reloadDataGroup=function(t){i.showTableLoading();var f=0;n(i.viewData).each(function(n){if(t==this.gid){f=n;return}});i.viewData[f].left="";i.viewData[f].right="";i.sourceData=n.grep(i.sourceData,function(n){return n[r.group.attr]!=t});i.searchParams.orgStr=t+"";i.count-=i.viewData[f].count;i.viewData[f].count=0;n.ajax({url:r.dataUrl!=null?r.dataUrl:"/api/"+r.model+"List",type:"GET",dataType:"JSON",contentType:"application/json; charset=utf-8",data:i.searchParams,success:function(e){var h=e.Many!=null?e.Many:e.length>0?e:[],o=n(u).find("> .salary-table > .main-content"),s,c,l;i.sourceData=n.merge(i.sourceData,h);i.count+=e.Count;r.rows.length>0&&(h!=null&&h.length>0?(c="Id",r.idAttribute!=null&&(c=r.idAttribute),n.each(h,function(n,t){var u=t[r.group.attr];s=i.drawRow(t,c,1,n+1,!0,u);i.viewData[f].left+=s.left;i.viewData[f].right+=s.right;i.viewData[f].count+=1}),o.find('tbody tr.tr-child[groupid="'+t+'"]').remove(),l=r.height.row*i.viewData[f].count,o.find('.areas tbody tr[groupid="'+t+'"]').attr("data-height",l+r.height.row).removeClass("showed-child"),o.find('.areas tbody tr.tr-background[groupid="'+t+'"] td').css("height",l),i.resetGroupPosition(),o.find(".empty-message").css("display","none")):(s=i.drawEmptyRow(!0),o.find(".area-bl tbody").append(s),s=i.drawEmptyRow(!1),o.find(".area-br tbody").append(s),o.find(".empty-message").css("display","block")));i.hideTableLoading();r.loadDataCallback!=null&&r.loadDataCallback(e)}})},i.clearViewData=function(){n(i.viewData).each(function(){this.left=[];this.right=[];this.count=0;this.active=!1});var t=n(u).find("> .salary-table > .main-content .area tbody");t.find("tr.tr-child").remove();t.find(".tr-group").removeClass("showed-child");t.find(".tr-background").remove()},i.searchGroup=function(n){i.filter.groupId=n!=null&&n.length>0?parseInt(n):null;i.search(null)},i.search=function(t){t!=null&&n.extend(i.filter,t);var r=n(u).find("> .salary-table > .main-content .area tbody");r.find("tr.tr-child").remove();r.find(".tr-group").removeClass("showed-child");r.find(".tr-background").remove();i.showTableLoading();setTimeout(function(){n(i.viewData).each(function(){var n=this,o,u,f,r,e,t;if(n.active=i.filter.groupId!=null?n.gid==i.filter.groupId?!0:!1:n.count>0?!0:!1,n.active){for(o=0,r=0;r<n.count;r++){for(u=!0,e=0;e<i.filter.attrs.length;e++){t=i.filter.attrs[e];switch(t.type){case"option":f=n.right[r];t.v!=null&&f[t.attr]!=t.v&&(u=!1);break;case"contains":f=n.left[r];t.v!=null&&t.v.length>0&&f.keyword.indexOf(t.v)<0&&(u=!1)}}n.left[r].active=u;u&&o++}n.active=o>0}});i.sortai();i.setRowPositions();i.showBackground();i.showData(0);i.hideTableLoading()},300)},i.setData=function(t,f){var o=t.Count!=null?t.Count:0,e=t.Many!=null?t.Many:t.length>0?t:null,s;e!=null&&(o==0&&(o=e.length),n(u).find(".area-bl tbody").html(""),n(u).find(".area-br tbody").html(""),i.sourceData=e);i.count=o;r.rows.length>0&&e!=null&&e.length>0&&(s="Id",r.idAttribute!=null&&(s=r.idAttribute),i.sumarray=[],n.each(e,function(t,r){var f=i.drawRow(r,s,1,t+1,!0);n(u).find(".area-bl tbody").append(f);f=i.drawRow(r,s,1,t+1,!1);n(u).find(".area-br tbody").append(f)}));n(u).find(".main-content .total-row span").text(o);i.hideTableLoading();i.setRowEvents();r.loadDataCallback!=null&&r.loadDataCallback(t);f!=null&&f(t)},i.setSubmitEvent=function(n){var t=!0;if(r.beforeSubmit!=null&&(t=r.beforeSubmit()),!t||!r.autoSubmit)return!1;i.submitForm(n)},i.hideModal=function(){var t=parseInt(n("#"+r.model+"FormEditModal").attr("data-type"));t==2?n("#"+r.model+"FormEditModal").fadeOut("fast",function(){n("#"+r.model+"FormEditModal").remove()}):n("#"+r.model+"FormEditModal").modal("hide");n("body").removeClass("overflow-hidden")},i.eventModal=function(){var u;n(".form-cancel").unbind().click(function(){i.hideModal()});var t=n(window).height(),f="#formEditModal",e=n(f+" form").height();e+=117;u=(t-e)/4;t<e&&(u=0,e=t);n(f+" .wtable-epanel-content").css("height",e+"px").css("top",u+"px");n(window).resize(function(){var h=r.modal,s,i,o,e;h.type==2&&(s=n(window).width(),t=n(window).height(),i=h.width,o="",i.indexOf("%")>-1?(i=i.substr(0,i.length-1),o=(100-parseInt(i))/2+"%"):i.indexOf("px")>-1&&(i=i.substr(0,i.length-2),i=parseInt(i),o=s>i?(s-i)/2+"px":"0px"),e=n(f+" form").height(),e+=117,u=(t-e)/4,t<e&&(u=0,e=t),n(f+" .wtable-epanel-content").css("left",o).css("height",e+"px").css("top",u+"px"))});n(f).on("keyup keypress",function(n){var t=n.keyCode||n.which;if(t===13)return n.preventDefault(),!1})},i.initModal=function(t,i){var u="";if(t.type==2){var o=n(window).width(),f=t.width,e="";f.indexOf("%")>-1?(f=f.substr(0,f.length-1),e=(100-parseInt(f))/2+"%"):f.indexOf("px")>-1&&(f=f.substr(0,f.length-2),f=parseInt(f),o>f&&(e=(o-f)/2+"px"));u='<div class="wtable-epanel" id="'+r.model+'FormEditModal" data-type="'+t.type+'">';u+=t.width!=""?'<div class="wtable-epanel-content" style="width:'+t.width+";left: "+e+'">':'<div class="wtable-epanel-content">';u+='<div class="panel panel-flat wtable-panel">';u+=i;u+="<\/div><\/div><\/div>";n("body").append(u)}else{if(u='<div class="modal" id="'+r.model+'FormEditModal" data-type="'+t.type+'" data-backdrop="static"  role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">',u+=t.width!=""?'    <div class="modal-dialog" style="width:'+t.width+'">':'    <div class="modal-dialog" >',u+='<div class="modal-content">',u+='      <div class="modal-header p-15 '+(t.headerClass!=null?t.headerClass:"")+'">',u+='          <button class="close" aria-hidden="true" data-dismiss="modal" type="button">×<\/button>',u+='              <h5 class="modal-title text-bold">'+t.title+"<\/h5>",u+='          <\/div><form id="'+r.model+'Form" class="form-horizontal"><div class="modal-body '+(t.noPaddingBody!=null?"no-padding":"pt-15 pl-15 pr-15 pb-5")+'">',u+=i,u+="<\/div>",t.footerTemplate!=null)u+=n(t.footerTemplate).html();else switch(t.mode){case 2:u+='<div class="panel-footer panel-footer p-15"><div class="pull-right"><button class="btn btn-sm btn-default form-cancel mr-10 btn-rounded" data-dismiss="modal"><i class="fa fa-remove"><\/i> Thoát<\/button><button class="btn btn-sm bg-slate mr-10 btn-submit btn-rounded" type="button" data-mode="1" data-loading-text="<i class=\'icon-spinner4 fa-spin position-left\'><\/i> Lưu tạm"><i class="icon-floppy-disk position-left"><\/i> Lưu tạm<\/button><button class="btn btn-sm btn-success btn-submit btn-rounded" type="button" data-mode="2" data-loading-text="<i class=\'icon-spinner4 fa-spin position-left\'><\/i> Lưu và gửi đề xuất"><i class="icon-paperplane position-left"><\/i> Lưu và gửi đề xuất<\/button><\/div><\/div>';break;case 3:u+='<div class="panel-footer panel-footer p-15"><div class="pull-right"><button class="btn btn-sm btn-default form-cancel mr-10 btn-rounded" data-dismiss="modal"><i class="fa fa-remove"><\/i> Thoát<\/button><button class="btn btn-sm bg-slate mr-10 btn-submit btn-rounded" type="button" data-mode="1" data-loading-text="<i class=\'icon-spinner4 fa-spin position-left\'><\/i> Lưu tạm"><i class="icon-floppy-disk position-left"><\/i> Lưu tạm<\/button><button class="btn btn-sm btn-success btn-submit btn-rounded" type="button" data-mode="3" data-loading-text="<i class=\'icon-spinner4 fa-spin position-left\'><\/i> Lưu và gửi đề xuất"><i class="icon-check position-left"><\/i> Lưu và ký chốt<\/button><\/div><\/div>';break;default:u+='<div class="panel-footer panel-footer p-15"><div class="pull-right"><button class="btn btn-sm btn-default form-cancel mr-10 btn-rounded" data-dismiss="modal"><i class="fa fa-remove"><\/i> Thoát<\/button><button class="btn btn-sm btn-fill btn-primary m-r-5 btn-submit btn-rounded" type="button" data-loading-text="<i class=\'icon-spinner4 fa-spin\'><\/i> Đang xử lý ..."><i class="fa fa-save"><\/i> Lưu lại<\/button><\/div><\/div>'}u+="<\/form><\/div><\/div><\/div>";n("body").append(u);n("#"+r.model+"FormEditModal").on("hidden.bs.modal",function(){n("body").removeClass("overflow-hidden");n("#"+r.model+"FormEditModal").remove()})}},i.showModal=function(){var t=parseInt(n("#"+r.model+"FormEditModal").attr("data-type"));t==2?n("#"+r.model+"FormEditModal").fadeIn("fast"):n("#"+r.model+"FormEditModal").modal("show");n("body").addClass("overflow-hidden")},i.createOrUpdateObject=function(t,u,f){i.showTableLoading();var e=r.editController!=null?r.editController+"/":"/admin/";e+=r.model+"Edit";n.extend(i.editParams,t);n.ajax({url:e,type:"GET",data:i.editParams,dataType:"html",success:function(n){i.hideTableLoading();var t=r.modal;i.initModal({title:"Thêm mới "+t.title,width:t.width,type:t.type!=null?t.type:1,noPaddingBody:t.noPaddingBody,headerClass:t.headerClass,noFooter:t.noFooter,mode:t.mode},n);i.eventModal();i.showModal();r.loadModalCallback!=null&&r.loadModalCallback(f);u&&u()}})},i.getSelectedIds=function(){var t=[];return n.each(n(u).find("> .salary-table > .main-content .area-br tr"),function(i,r){n(r).hasClass("active")&&t.push(n(r).attr("dataid"))}),t},i.unique=function(t){var i=[];return n.each(t,function(t,r){n.inArray(r,i)==-1&&i.push(r)}),i},i.getCheckedRowIds=function(){var t=[];return n.each(i.viewData,function(){var r=this,i;r.left.length>0&&(i=[],n(r.left).each(function(){this.checked&&i.push(parseInt(this.id))}),i.length>0&&t.push({g:r.gid,ids:i}))}),t},i.getCheckedDatas=function(){var f=[],e="Id",u,t;for(r.idAttribute!=null&&(e=r.idAttribute),u=i.getCheckedRowIds(),t=0;t<u.length;t++)n(i.sourceData).each(function(){if(this[e]==u[t])return f.push(this),!1});return f},i.setCheckedRowIds=function(t){for(var r,f,e=n(u).find("> .salary-table > .main-content"),i=0;i<t.length;i++)r=e.find('.area-bl tr[dataid="'+t[i]+'"]'),f=n(r).find('.first-col input[type="checkbox"]'),f.prop("checked",!0);n.uniform.update()},i.getSelectedRow=function(){return n(u).find('> .salary-table > .main-content .area-br tr[class="active"]').first()},i.getSelectedDatas=function(){var f=[],e="Id",u,t;for(r.idAttribute!=null&&(e=r.idAttribute),u=i.getSelectedIds(),t=0;t<u.length;t++)n(i.sourceData).each(function(){if(this[e]==u[t])return f.push(this),!1});return f},i.addChild=function(t,u){var e,f;i.showTableLoading();e=r.editController!=null?r.editController+"/":"/admin/";e+=r.model+"Edit";f=r.modal;n.ajax({url:e,type:"GET",data:t,dataType:"html",success:function(n){i.hideTableLoading();i.initModal({title:"Thêm "+f.title.toLowerCase(),width:f.width,type:f.type!=null?f.type:1,mode:f.mode},n);i.eventModal();i.showModal();r.loadModalCallback!=null&&r.loadModalCallback(u)}})},i.getDataById=function(t){var u,f="Id";return r.idAttribute!=null&&(f=r.idAttribute),n(i.sourceData).each(function(){if(this[f]==t)return u=this,!1}),u},i.getActiveTabIndex=function(){return n(u).find("> .salary-table > .sub-content > .tab-content > div.active").index()},i.loadFilterOption=function(t,i){var f,u,e;if(!n(t).hasClass("loaded")&&(f=t.attr("data-index"),u=r.rows[f].filter,u.ajax!=null))return e=u.ajax.data,app.loadData(u.ajax.url,e,null,function(r){t.addClass("loaded");var f=r.Many!=null?r.Many:r;n(f).each(function(){var n=new Option(this[u.ajax.attr.text],this[u.ajax.attr.id],!0,!0);t.append(n)});t.select2("val","");i!=null&&i()}),!0},i.setStaticEvents=function(){var c,e,o,s;i.resize();n(window).resize(function(){i.resize()});var t=n(u).find("> .salary-table > .main-content"),h=n(u).find("> .salary-table > .resize"),f=n(u).find("> .salary-table > .sub-content"),l=n("#sub_content_modal");window.addEventListener("touchstart",function(t){i.tounchTr=n(t.target).closest(".area")});n(t).find(" .area").mouseover(function(){i.tounchTr=n(this)});t.find(".area-tr > div").scroll(function(){if(n(i.tounchTr).length==0||n(i.tounchTr).hasClass("area-tr")){var r=n(this).scrollLeft();t.find(".area-br > div").scrollLeft(r)}});t.find(".area-br > div").scroll(function(){if(n(i.tounchTr).length==0||n(i.tounchTr).hasClass("area-br")){clearTimeout(n.data(this,"scrollCheck"));var r=n(this).scrollTop(),u=n(this).scrollLeft();t.find(".area-bl > div").scrollTop(r);t.find(".area-tr > div").scrollLeft(u);n.data(this,"scrollCheck",setTimeout(function(){i.searching||i.showData(r)},100))}});t.find(".area-bl > div").scroll(function(){if(n(i.tounchTr).length==0||n(i.tounchTr).hasClass("area-bl")){var r=n(this).scrollTop();t.find(".area-br > div").scrollTop(r);clearTimeout(n.data(this,"scrollCheck"));n.data(this,"scrollCheck",setTimeout(function(){i.searching||i.showData(r)},200))}});t.find(".styled").uniform();h.draggable({axis:"y",start:function(n,t){c=t.position.top},stop:function(n,r){var o=r.position.top,e=o-c,u=t.find(".areas").height();i.setMainTableHeight(u+e);h.css("top",0);u=f.find("> .tab-content").height();i.setSubContentHeight(u+70-e)}});h.find(".btn-expand-main-content").unbind().click(function(){var t=n(u).find(".salary-table"),o=n(this),e=t.height();t.hasClass("expand")?(f.css("display","block"),t.removeClass("expand"),o.find("i").removeClass("icon-arrow-up5").addClass("icon-arrow-down5"),i.setMainTableHeight(parseInt(e/2))):(f.css("display","none"),t.addClass("expand"),o.find("i").removeClass("icon-arrow-down5").addClass("icon-arrow-up5"),r.footer==null||r.footer?i.setMainTableHeight(e-35):i.setMainTableHeight(e))});f.find(".btn-scroll-tab-right").unbind().click(function(){var t=n(this).closest(".tabbable").find(".tabs-group > div"),i=t.scrollLeft();t.animate({scrollLeft:i+200},100)});f.find(".btn-scroll-tab-left").unbind().click(function(){var t=n(this).closest(".tabbable").find(".tabs-group > div"),i=t.scrollLeft();t.animate({scrollLeft:i-200},100)});f.find(".btn-select-tab").unbind().click(function(){var u=n(this).attr("href"),t=f.find('.tabs-group a[href="'+u+'"]'),i,r;t.tab("show");i=f.find(".tabs-group > div");r=parseInt(t.closest("li").attr("data-pos"));i.animate({scrollLeft:r},100)});f.find(' > .tabbable a[data-toggle="tab"]').unbind().on("shown.bs.tab",function(t){var r=n(t.target).attr("data-index");i.selectContentTab(r,n(t.target).attr("href"))});l.find(' .tabbable a[data-toggle="tab"]').unbind().on("shown.bs.tab",function(t){var r=n(t.target).attr("data-index");i.selectContentTab(r,n(t.target).attr("href"))});if(r.toolbars!=null&&(r.toolbars.create!=null&&n(r.toolbars.create.ele).unbind().click(function(){if(r.toolbars.create.click!=null)r.toolbars.create.click();else{var t=n(this);t.button("loading");i.createOrUpdateObject(null,function(){t.button("reset")})}}),r.toolbars.edit!=null&&(e=r.toolbars.edit,n(e.ele).prop("disabled",!0),n(e.ele).unbind().click(function(){var t=i.getSelectedIds()[0],f=i.getSelectedRow(),r=n(this),u;app.hasValue(t)?(u=i.getDataById(t),(e.before==null||e.before(u))&&(e.click!=null?e.click(t):(r.button("loading"),i.createOrUpdateObject({id:t},function(){r.button("reset")},f)))):app.notify("warning","Vui lòng chọn đối tượng cần sửa")})),r.toolbars.delete!=null&&(o=r.toolbars.delete,n(o.ele).prop("disabled",!0),n(o.ele).unbind().click(function(){var n=i.getCheckedRowIds();n.length>0?(o.before==null||o.before(n))&&i.deleteObjects("bulk",n,function(){i.loadData()}):app.notify("warning","Vui lòng chọn đối tượng cần xóa")})),r.toolbars.reload!=null&&n(r.toolbars.reload.ele).unbind().click(function(){i.loadData()}),r.toolbars.reorder!=null&&n(r.toolbars.reorder.ele).unbind().click(function(){var n=i.getCheckedRowIds();n.length==0&&app.notify("warning","Vui lòng chọn dữ liệu để sắp xếp")})),t.find('.first-col input[type="checkbox"]').click(function(){var e=t.find(".checkAll"),s=n(this).closest("tr"),i=s.attr("dataid"),f,o;n(this).prop("checked")?(n(u).find('.area-bl tr[dataid="'+i+'"]').addClass("active"),n(u).find('.area-br tr[dataid="'+i+'"]').addClass("active")):(n(u).find('.area-bl tr[dataid="'+i+'"]').removeClass("active"),n(u).find('.area-br tr[dataid="'+i+'"]').removeClass("active"),e.prop("checked")&&e.prop("checked",!1));f=0;o=t.find(" .first-col input");o.each(function(){n(this).prop("checked")==!0&&f++});o.length==f&&e.prop("checked",!0);r.toolbars!=null&&r.toolbars.delete!=null&&(f>0?n(r.toolbars.delete.ele).prop("disabled",!1):n(r.toolbars.delete.ele).prop("disabled",!0));n.uniform.update();r.selectRowCallback!=null&&r.selectRowCallback(s)}),r.filterable){t.find(".tr-filter .btn").unbind().click(function(){});t.find(".tr-filter .select-option").unbind().select2({minimumResultsForSearch:1,dropdownCssClass:"bigdrop"}).on("select2-open",function(){var t=n(this);i.loadFilterOption(t,function(){return t.select2("close").select2("open"),!0})}).on("change",function(t){var s=n(t.target),u=r.rows[s.attr("data-index")],f=u.attribute,h=parseInt(s.attr("data-width")),e,o;u.filter.reload?(e={},e[f]=t.val,i.loadData(e,function(){},!0)):(o=!1,n(i.filter.attrs).each(function(){if(this.attr==f){switch(u.filter.dataType){case"int":this.v=t.val!=""?parseInt(t.val):null;break;case"float":this.v=t.val!=""?parseFloat(t.val):null;break;default:this.v=t.val!=""?t.val:null}o=!0}}),o||i.filter.attrs.push({attr:f,type:"option",v:t.val!=""?t.val:null}),i.search())});t.find(".tr-filter .select-option-remote").each(function(){var u=n(this),f=n(this).attr("data-index"),t=r.rows[f].filter;u.unbind().select2({ajax:{url:t.ajax.url,dataType:"json",quietMillis:200,data:function(i){var r=app.toKeyword(i);return n.extend({keyword:r,limit:10},t.ajax.data)},results:function(i){var r=[];return n(i).each(function(){r.push({id:this[t.ajax.attr.id],text:this[t.ajax.attr.text]})}),{results:r}}},minimumInputLength:1,minimumResultsForSearch:1,dropdownCssClass:"bigdrop",allowClear:!0,placeholder:"Tất cả"}).on("change",function(t){var u=n(t.target),f=r.rows[u.attr("data-index")],e={},o;f.filter.prop!=null?e[f.filter.prop]=t.val:e[f.attribute]=t.val;o=parseInt(u.attr("data-width"));u.closest("div").find(".select2-container").css("width",o-30+"px");i.search(e)})});s=null;t.find(".filter-contains").unbind().keyup(function(){var t=n(this).attr("attr"),f=n(this),u=n(this).val(),e=f.attr("data-index"),o=r.rows[e].filter;s!=null&&clearTimeout(s);s=setTimeout(function(){var r,f;o.reload?(r={},r[t]=u,i.loadData(r,function(){},!0)):(f=!1,n(i.filter.attrs).each(function(){this.attr==t&&(this.v=u,f=!0)}),f||i.filter.attrs.push({attr:t,type:"contains",v:u}),i.search());clearTimeout(s)},300)})}r.height.correlate!=null&&r.height.correlate.attrchange({callback:function(){var e=n(this).height(),t=e-(r.toolbars!=null?40:0),f=n(u).find("> .salary-table");f.css("height",t);r.subContent!=null?(f.hasClass("expand")?i.setMainTableHeight(t-35):i.setMainTableHeight(parseInt(t/2)),i.setSubContentHeight(parseInt(t/2))):i.setMainTableHeight(t-35)}});n(document).on("click",function(t){var u,r;n(t.target).hasClass("edit-inline")||n(t.target).hasClass("span-edit-inline")||n(t.target).closest(".inline-form").length===0&&(u=n(".areas tr td.editing"),u.length>0&&(r=u.find(".form-control"),i.closeEditInline(r,r.val(),r.attr("data-type"))))});n(u).find(".btn-export").unbind().click(function(){var t=r.params.export.url,u=i.searchParams;app.cleanJson(u);t+="?"+n.param(u);window.open(t,"_blank")});n(u).find(".btn-import").unbind().click(function(){n("#importModal").modal("show");i.initImportForm()});n("#import_form").ultraForm({uiType:1,action:"/cb/CbFamilyReduceEdit",actionType:"ajax",props:[{name:"employeeType",type:"hidden"},{name:"type",type:"hidden"},{name:"File",type:"file",option:{uploadFirst:!0},required:{message:"Chọn file cần import"}}],validCallback:function(n){n=app.formDataToJson(n)}});n("a").click(function(){r.group!=null&&r.group.sequentially&&i.sequentially.loading&&i.sequentially.ajax!=null&&i.sequentially.ajax.abort()});n(".th-hide").click(function(){var f,e,a=n(this),h=a.closest("th"),v=parseInt(h.attr("ri")),i=[],c=h.attr("ci"),l,o,u,s;if(c.indexOf("-")>0)for(l=c.split("-"),f=parseInt(l[0]),e=parseInt(l[1]),o=f;o<=e;o++)i.push(o);else i.push(parseInt(c));if(u=t.find(".area-tr colgroup col"),n(u).each(function(){var t=parseInt(n(this).attr("i"));n.inArray(t,i)>=0&&n(this).css("width",2)}),u=t.find(".area-br colgroup col"),n(u).each(function(){var t=parseInt(n(this).attr("i"));n.inArray(t,i)>=0&&n(this).css("width",2)}),h.addClass("hided"),i.length>1)for(s=v+1;s<=r.cols.right.length;s++)u=t.find('.area-tr thead th[ri="'+s+'"]'),n(u).each(function(){var t=n(this).attr("ci"),r;t.indexOf("-")>0?(r=t.split("-"),f=parseInt(r[0]),e=parseInt(r[1]),n.inArray(f,i)>=0&&n.inArray(e,i)>=0&&n(this).addClass("hided")):(t=parseInt(t),n.inArray(t,i)>=0&&n(this).addClass("hided"))})});n(".th-unhide").click(function(){var o,s,f,v=n(this),c=v.closest("th"),l=parseInt(c.attr("ri")),i=[],u=c.attr("ci"),a,h,e;if(u.indexOf("-")>0)for(a=u.split("-"),o=parseInt(a[0]),s=parseInt(a[1]),h=o;h<=s;h++)i.push(h);else i.push(parseInt(u));if(e=t.find(".area-tr colgroup col"),n(e).each(function(){var r=parseInt(n(this).attr("i")),t;n.inArray(r,i)>=0&&(t=n(this).attr("w"),n(this).css("width",t+"px"))}),e=t.find(".area-br colgroup col"),n(e).each(function(){var r=parseInt(n(this).attr("i")),t;n.inArray(r,i)>=0&&(t=n(this).attr("w"),n(this).css("width",t+"px"))}),c.removeClass("hided"),i.length>1)for(f=l+1;f<=r.cols.right.length;f++)e=t.find('.area-tr thead th[ri="'+f+'"]'),n(e).each(function(){if(u=n(this).attr("ci"),u.indexOf("-")>0){var t=u.split("-");o=parseInt(t[0]);s=parseInt(t[1]);n.inArray(o,i)>=0&&n.inArray(s,i)>=0&&n(this).removeClass("hided")}else u=parseInt(u),n.inArray(u,i)>=0&&n(this).removeClass("hided")});if(l>1)for(f=1;f<l;f++)e=t.find('.area-tr thead th[ri="'+f+'"]'),n(e).each(function(){if(u=n(this).attr("ci"),u.indexOf("-")>0){var t=u.split("-");o=parseInt(t[0]);s=parseInt(t[1]);i.length>1?o<=i[0]&&s>=i[i.length-1]&&n(this).removeClass("hided"):o<=i[0]&&i[0]<=s&&n(this).removeClass("hided")}else u=parseInt(u),i.length==1&&u==i[0]&&n(this).removeClass("hided")})});n('[data-toggle="tooltip"]').tooltip({html:!0})},i.initImportForm=function(){},i.reorder=function(){var t;n("#reorder_modal").length==0&&(t='<div class="modal fade" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"><div class="modal-dialog modal-sm" role="document"><div class="modal-content"><\/div><\/div><\/div>')},i.resetGroupPosition=function(){var f=n(u).find("> .salary-table > .main-content"),o=f.find("tr.tr-group"),t=0,e;n(o).each(function(){if(n(this).attr("data-top",t),n(this).hasClass("expanded")){var i=n(this).attr("data-height");t+=parseInt(i)}else t+=r.height.row});e=f.find(".area-br > div").scrollTop();i.showData(e)},i.expandChild=function(t,r,u){var f=parseInt(r.attr("groupid")),e=t.find("i"),o=u.find('tr[groupid="'+f+'"]:not(.tr-group)');u.find("tbody tr.tr-real").remove();r.hasClass("expanded")?(o.remove(),n(i.viewData).each(function(){if(this.active=!0,this.gid==f&&this.count>0)for(var n=0;n<this.count;n++)this.left[n].active=!1}),r.removeClass("expanded"),e.removeClass("icon-arrow-down5").addClass("icon-arrow-right5")):(n(i.viewData).each(function(){if(this.active=!0,this.gid==f&&this.count>0)for(var n=0;n<this.count;n++)this.left[n].active=!0}),r.addClass("expanded"),e.removeClass("icon-arrow-right5").addClass("icon-arrow-down5"));i.setRowPositions();i.showBackground();i.showData(0)},i.setRowEvents=function(){var t=n(u).find("> .salary-table > .main-content"),f,e;t.find(".styled").uniform();t.find(".area-bl tbody tr").each(function(){var i=n(this).height(),f=n(this).attr("dataid"),u=t.find('.area-br tr[dataid="'+f+'"]'),r;u.height()>=i?n(this).css("height",u.height()):n(u).css("height",i);r=t.find('.area-bom tr[dataid="'+f+'"]');r.height()>=i?n(this).css("height",r.height()):n(r).css("height",i)});t.find(".area-bl tr td").unbind().click(function(t){t.target==this&&i.selectRow(n(this).closest("tr"))});t.find(".area-bl tr").unbind().hover(function(){var t=n(this).attr("dataid");n(u).find('.area-br tr[dataid="'+t+'"]').addClass("hover");n(this).addClass("hover");n(this).addClass("hover")},function(){var t=n(this).attr("dataid");n(u).find('.area-br tr[dataid="'+t+'"]').removeClass("hover");n(this).removeClass("hover");n(this).removeClass("hover")});t.find(".area-br tr").unbind().hover(function(){var t=n(this).attr("dataid");n(u).find('.area-bl tr[dataid="'+t+'"]').addClass("hover");n(this).addClass("hover");n(this).addClass("hover")},function(){var t=n(this).attr("dataid");n(u).find('.area-bl tr[dataid="'+t+'"]').removeClass("hover");n(this).removeClass("hover");n(this).removeClass("hover")});t.find(".area-br tr td").unbind().click(function(t){t.target==this&&i.selectRow(n(this).closest("tr"))});t.find(".area td.edit-inline").unbind().click(function(r){var u,f;r.target==this&&(n(this).hasClass("editing")||(u=t.find(".area td.editing > .inline-form .form-control"),u.length>0&&i.closeEditInline(u,u.val(),u.attr("data-type")),n(this).addClass("editing"),f=n(this).find(".form-control"),n(f).is("select")?n(f).trigger("open"):f.focus().select()))});t.find(".area td.edit-inline > span").unbind().click(function(){n(this).closest("td").trigger("click")});t.find('.area td.edit-inline input[type="checkbox"]').unbind().change(function(t){t.target==this&&i.closeEditInline(n(this),n(this).prop("checked"))});t.find(".area td.edit-inline select").unbind().change(function(t){t.target==this&&i.closeEditInline(n(this),n(this).val())});t.find(".btn-expander").unbind().click(function(){var r=n(this),u=r.closest("tr");i.expandChild(r,u,t)});t.find(".expand-child").unbind().click(function(){var t=n(this),a=t.hasClass("expand"),e=t.find("i"),s=t.closest("tr"),f=s.attr("dataid"),h=s.attr("ai"),c,o,l;a?(t.removeClass("expand"),e.removeClass("icon-arrow-down12").addClass("icon-arrow-right13"),i.displayChilds(f,"none",!0),i.displayChilds(f,"none",!1)):(t.addClass("expand"),e.removeClass("icon-arrow-right13"),c=t.hasClass("loaded"),c?(e.addClass("icon-arrow-down12"),i.displayChilds(f,"table-row",!0),i.displayChilds(f,"table-row",!1)):(e.addClass("icon-spinner10 spinner"),o=t.attr("level"),l=r.dataUrl!=null?r.dataUrl:"/api/"+r.model+"List",loadData(l,{parentId:f},null,function(s){var c=s.Many,l,a,v;e.removeClass("icon-spinner10 spinner").addClass("icon-arrow-down12");c!=null&&c.length>0&&r.rows.length>0?(l="Id",r.idAttribute!=null&&(l=r.idAttribute),i.sumarray=[],a=n(u).find('.area-bl tbody tr[dataid="'+f+'"]'),v=n(u).find('.area-br tbody tr[dataid="'+f+'"]'),n.each(c,function(t,r){var u=i.drawRow(r,l,parseInt(o)+1,h+"."+(t+1),!0);n(u).insertAfter(a);a=n(a).next();u=i.drawRow(r,l,parseInt(o)+1,h+"."+(t+1),!1);n(u).insertAfter(v);v=n(v).next()}),i.setRowEvents(),i.sourceData=n.merge(c,i.sourceData)):e.addClass("hide");t.addClass("loaded");r.loadDataCallback!=null&&r.loadDataCallback(s)})))});f=t.find(".area td.edit-inline input");f.unbind();f.keydown(function(){var s=event.keyCode?event.keyCode:event.which,u=n(this).val(),h,f,e,t,o,r;if(s==9)return i.closeEditInline(n(this),u),u=n(this).val(),h=n(this).attr("attr"),o=n(this).closest("td"),e=parseInt(o.attr("i")),f=n(this).closest("tr"),r=f.find("td.edit-inline"),t=null,n(r).each(function(){var i=parseInt(n(this).attr("i"));if(i>e)return t=n(this),!1}),t==null&&(t=r.first()),t.length>0&&(t.addClass("editing"),t.find("input").focus().select()),!1});f.keyup(function(){var c=event.keyCode?event.keyCode:event.which,h=n(this).val(),e,u,o,f,t,r,s;if(!(c>=65)||!(c<=90))switch(c){case 13:case 40:i.closeEditInline(n(this),h);e=n(this).closest("td").attr("i");u=n(this).closest("tr");o=u.closest("body");f=parseInt(u.attr("ai"));t=o.find('tr[ai="'+(f+1)+'"]');t.length==0&&(t=o.find('tr[ai="1"]'));t.length>0&&(r=t.find('td[i="'+e+'"]'),r.length>0&&(r.addClass("editing"),r.find("input").focus().select()));break;case 39:i.closeEditInline(n(this),h);e=n(this).attr("attr");r=n(this).closest("td");f=parseInt(r.attr("i"));u=n(this).closest("tr");s=u.find("td.edit-inline");t=null;n(s).each(function(){var i=parseInt(n(this).attr("i"));if(i>f)return t=n(this),!1});t==null&&(t=s.first());t.length>0&&(t.addClass("editing"),t.find("input").focus().select());break;case 37:i.closeEditInline(n(this),h);e=n(this).attr("attr");r=n(this).closest("td");f=parseInt(r.attr("i"));u=n(this).closest("tr");s=u.find("td.edit-inline");t=null;n(s).each(function(){var i=parseInt(n(this).attr("i"));i<f&&(t=n(this))});t==null&&(t=s.last());t.length>0&&(t.addClass("editing"),t.find("input").focus().select());break;case 38:i.closeEditInline(n(this),h);e=n(this).closest("td").attr("i");u=n(this).closest("tr");o=u.closest("body");f=parseInt(u.attr("ai"));t=o.find('tr[ai="'+(f-1)+'"]');t.length==0&&(t=o.find("tr:not(.tr-total)").last());t.length>0&&(r=t.find('td[i="'+e+'"]'),r.length>0&&(r.addClass("editing"),r.find("input").focus().select()))}});t.find(".btn-add-row").unbind().click(function(){var u=n(this).attr("groupid"),f=n(this).closest("tr"),t={};t[r.group.attr]=u;i.createOrUpdateObject(t,null,f)});r.contextMenu!=null&&(e=n(u).find("> .context-menu-salary-grid-popup"),t.find('.area-br tr[data-toggle="context"]').unbind().contextmenu({target:e.selector,before:function(t,u){t.preventDefault();i.moveObjectId!=null?this.getMenu().find("li .near").removeClass("disabled"):this.getMenu().find("li .near").addClass("disabled");var e=this.getMenu(),o=n(u).attr("dataid"),f=i.getDataById(o);return n(r.contextMenu).each(function(){var n=e.find("a."+this.class).closest("li"),t;this.enable==null||this.enable(f)?(n.css("display","block"),this.visible==null||this.visible(f)?this=="edit"||this=="delete"?(t=e.find('a[action="edit"], a[action="delete"]'),f.Status!=null&&f.Status>0?t.addClass("disabled"):t.removeClass("disabled")):n.find("a").removeClass("disabled"):n.find("a").addClass("disabled")):n.css("display","none")}),!0},onItem:function(t,r){var u=n(r.currentTarget);u.hasClass("dropdown-submenu")?i.clickSubContextMenu?i.clickSubContextMenu=!1:(i.clickContextMenu(t,r),i.clickSubContextMenu=!0):n(r.target).hasClass("disabled")||i.clickContextMenu(t,r)}}),t.find('.area-bl tr[data-toggle="context"]').unbind().contextmenu({target:e.selector,before:function(t,u){t.preventDefault();i.moveObjectId!=null?this.getMenu().find("li .near").removeClass("disabled"):this.getMenu().find("li .near").addClass("disabled");var e=this.getMenu(),o=n(u).attr("dataid"),f=i.getDataById(o);return n(r.contextMenu).each(function(){var n=e.find("a."+this.class).closest("li");this.enable==null||this.enable(f)?(n.css("display","block"),this.visible==null||this.visible(f)?n.find("a").removeClass("disabled"):n.find("a").addClass("disabled")):n.css("display","none")}),!0},onItem:function(t,r){var u=n(r.currentTarget);u.hasClass("dropdown-submenu")?i.clickSubContextMenu?i.clickSubContextMenu=!1:(i.clickContextMenu(t,r),i.clickSubContextMenu=!0):n(r.target).hasClass("disabled")||i.clickContextMenu(t,r)}}));t.find(".check-group").click(function(){var u=n(this).attr("groupid"),f=n(this).is(":checked"),e=t.find('.area-bl tr[groupid="'+u+'"]'),o=[];n(e).each(function(){var i=n(this).find(" .first-col  input"),t;i.prop("checked",f);t=i.attr("dataid");typeof t!="undefined"&&o.push(parseInt(t))});t.find('.area-bl tr[groupid="'+u+'"] .first-col  input').prop("checked",f);t.find('.area-br tr[groupid="'+u+'"] .first-col  input').prop("checked",f);n.uniform.update();n(i.viewData).each(function(){var t=this;t.gid==u&&n(t.left).each(function(){this.checked=f})});r.selectRowCallback!=null&&r.selectRowCallback()});t.find(".checkAll").click(function(){var u=n(this).is(":checked");t.find('.area-bl td input[type="checkbox"]').prop("checked",u);t.find('.area-br td input[type="checkbox"]').prop("checked",u);n.uniform.update();n(i.viewData).each(function(){var t=this;t.checked=u;t.left.length>0&&n(t.left).each(function(){this.checked=u})});r.selectRowCallback!=null&&r.selectRowCallback()});r.loadDataCallback!=null&&r.loadDataCallback()},i.clickContextMenu=function(t,u){var h=n(u.target),s,f,c,o,l,a;h[0].hasAttribute("action")||(h=n(u.target).closest("a"));var e=n(t.context),y=h.attr("action"),v=h.attr("class");switch(y){case"edit":s=n(e).attr("dataid");i.createOrUpdateObject({id:s},function(){},n(e));break;case"delete":s=n(e).attr("dataid");i.deleteObjects("bulk",[s],function(){console.log("reload...");i.loadData()});break;case"move-top":s=n(e).attr("dataid");f=r.editController!=null?r.editController+"/":"/admin/";f+="ChangePriority"+r.model;i.showTableLoading();app.postData(f,{PriorityPosition:"Top",id:s},function(){i.search({},function(){i.hideTableLoading()})});break;case"chose-position":app.notify("info","Chọn vị trí sắp xếp");i.moveObjectId=n(e).attr("dataid");break;case"near-above":f=r.editController!=null?r.editController+"/":"/admin/";f+="ChangePriority"+r.model;i.showTableLoading();app.postData(f,{PriorityPosition:"NearAbove",NearId:n(e).attr("dataid"),id:i.moveObjectId},function(){i.moveObjectId=null;i.loadData({},function(){i.hideTableLoading()})});break;case"near-under":f=r.editController!=null?r.editController+"/":"/admin/";f+="ChangePriority"+r.model;i.showTableLoading();app.postData(f,{PriorityPosition:"NearUnder",NearId:n(e).attr("dataid"),id:i.moveObjectId},function(){i.moveObjectId=null;i.loadData({},function(){i.hideTableLoading()})});break;case"add-child":i.showTableLoading();f=r.editController!=null?r.editController+"/":"/admin/";f+=r.model+"Edit";n.extend(i.editParams,{parentId:e.attr("dataid"),id:null});n.ajax({url:f,type:"GET",data:i.editParams,dataType:"html",success:function(n){i.hideTableLoading();i.initModal({title:"Thêm "+r.modal.title.toLowerCase(),width:r.modal.width,type:r.modal.type!=null?r.modal.type:1,mode:m.mode},n);i.eventModal();i.showModal();r.loadModalCallback!=null&&r.loadModalCallback(e)}});break;case"custom":for(c=0;c<r.contextMenu.length;c++)if(o=r.contextMenu[c],v==o.class){if(o.click!=null)return o.click(e),!1}else if(o.childs!=null)for(l=0;l<o.childs.length;l++)if(a=o.childs[l],v==a.class&&a.click!=null)return a.click(e),!1}},i.updateRowValue=function(n){for(var o=parseInt(n.attr("dataid")),e=i.getDataById(o),s=-1,u,t=0;t<i.sourceData.length;t++)if(i.sourceData[t].Id==o){s=t;break}for(t=0;t<r.rows.length;t++)if(u=r.rows[t],u.formula!=null){var h=u.formula(e),f=h,c=n.find('td[attr="'+u.attribute+'"]');f=u.fixed!=null?f.toFixed(u.fixed):Math.round(f);f=u.type=="price"?app.formatPrice(f):f;c.find("span").text(f);c.find("input").val(f);e[u.attribute]=h}return i.sourceData[s]=e,e},i.updateGroupValue=function(t){var s=parseInt(t.attr("groupid")),c=n(u).find('.area-br tr.tr-group[groupid="'+s+'"]'),h=[],f,e,o;for(n(i.sourceData).each(function(){this[r.group.attr]==s&&h.push(this)}),f=r.skipCols;f<r.rows.length;f++)e=r.rows[f],e.sumable&&(o=0,n(h).each(function(){var t=this[e.attribute];app.hasValue(t)&&n.isNumeric(t)&&(o+=parseFloat(t))}),c.find('td[data-attr="'+e.attribute+'"] span').text(app.formatPrice(o)))},i.updateTotalRow=function(){for(var t,u,f=0;f<r.rows.length;f++)t=r.rows[f],t.sumable&&(u=0,n(i.sourceData).each(function(){var n=this,i=parseFloat(n[t.attribute]);u+=i}),u=t.fixed!=null?u.toFixed(t.fixed):app.formatPrice(Math.round(u)),n('.tr-total td[data-attr="'+t.attribute+'"] strong').text(u))},i.closeEditInline=function(t,u){var e=t.closest("tr"),a=parseInt(e.attr("dataid")),v=t.attr("attr"),h=t.attr("data-type"),c=t.closest("td"),l,f,o,s;h=="price"&&(n.isNumeric(u)?(u=u.replace(/,/g,""),u=parseFloat(u),l=parseInt(n(c).attr("ci")),f=r.rows[l],f.min!=null&&u<f.min&&(u=f.min),f.max!=null&&u>f.max&&(u=f.max),t.val(u)):(u="0",t.val(u)));c.removeClass("editing");n(i.sourceData).each(function(){this.Id==a&&(this[v]=u)});o=i.updateRowValue(e);r.group!=null&&r.group.sumable&&i.updateGroupValue(e);i.updateTotalRow();s=r.editController!=null?r.editController+"/":"/admin/";s+=r.model+"EditRow";r.params.edit!=null&&n.extend(o,r.params.edit);n(i.editLoader).show();app.postData(s,o,function(){var r,f;n(i.editLoader).hide();r=t.closest("td");n(t).is("select")?(f=t.find(" option:selected").text(),r.find("> span").text(f)):(h=="price"&&(u=app.formatPrice(u)),r.find("> span").text(u));r.removeClass("editing")})},i.displayChilds=function(t,r,f){var e=f?n(u).find("> .salary-table > .main-content .area-bl tr"):n(u).find("> .salary-table > .main-content .area-br tr");e.each(function(){var u=n(this).attr("parent");u==t&&(n(this).css("display",r),i.displayChilds(n(this).attr("dataid"),r,f))})},i.selectContentTab=function(t,f){var c=browser=="Web"?n(u).find("> .salary-table > .sub-content"):n("#sub_content_modal"),e=r.subContent.tabs[t],s,o,h,l;f==null&&(f=c.find(".tab-content > div").eq(t).attr("id"));s=n(f);o=i.getSelectedIds()[0];o!=null&&(s.hasClass("loaded")||(c.find(".tab-content > .loading").css("display","block"),h={dataType:"html",id:o},n.isFunction(e.data)?(l=e.data(i.getDataById(o)),n.extend(h,l)):n.extend(h,e.data),app.loadData(e.url,h,null,function(n){s.addClass("loaded");c.find(".tab-content > .loading").css("display","none");s.html(n);e.loadCallback!=null&&(e.table=e.loadCallback(o,f,i.getDataById(o)))})))},i.bulkDelete=function(n){var t=i.getSelectedIds();t.length>0?i.deleteObjects("bulk",t,n):app.confirm("info","Vui lòng chọn đối tượng cần xóa",null,null)},i.deleteObjects=function(t,i,f){app.confirm("warning",null,i.length+" đối tượng được chọn để xóa.",function(){var e=r.editController!=null?r.editController:"/admin";t=="bulk"?app.postData(e+"/delete"+r.model+"ByIds",{ids:i},function(){f!=null&&f()}):n.ajax({url:e+"/delete"+r.model,type:"POST",data:{model:r.model,id:i[0]},success:function(){typeof webaby!="undefined"&&webaby.hideModalLoading();n("#deleteModal").modal("hide");f!=null&&f()}});n(u).find(".checkAll").prop("checked",!1);n.uniform.update()})},i.setSubData=function(){},i.selectRow=function(t,f){var o=t.attr("dataid"),h,c,e,s;t.hasClass("active")?(n(u).find('.area-bl tr[dataid="'+o+'"]').removeClass("active"),n(u).find('.area-br tr[dataid="'+o+'"]').removeClass("active"),n(u).find('.area-bom tr[dataid="'+o+'"]').removeClass("active")):(n(u).find(".area-bl tr.active").removeClass("active"),n(u).find('.area-bl tr[dataid="'+o+'"]').addClass("active"),n(u).find(".area-br tr.active").removeClass("active"),n(u).find('.area-br tr[dataid="'+o+'"]').addClass("active"),n(u).find(".area-bom tr.active").removeClass("active"),n(u).find('.area-bom tr[dataid="'+o+'"]').addClass("active"),r.subContent!=null&&i.setSubData(o),r.selectRowCallback!=null&&r.selectRowCallback(t));r.subContent!=null&&(browser=="Web"?(h=n(u).find("> .salary-table > .sub-content"),(h.attr("aid")!=o||f)&&(e=h.find('.tabs-group li[class="active"]'),e.length==0?(e=h.find(".tabs-group li:eq(0)"),e.find("a").tab("show")):(s=e.index(),s<0&&(s=0),h.find(".tab-content .tab-pane").html("").removeClass("loaded"),h.attr("aid",o),i.selectContentTab(s,e.find(" > a").attr("href"))))):(c=n("#sub_content_modal"),c.modal("show"),e=c.find('.tabs-group li[class="active"]'),e.length==0?(e=c.find(".tabs-group li:eq(0)"),e.find("a").tab("show")):(s=e.index(),s<0&&(s=0),c.find(".tab-content .tab-pane").html("").removeClass("loaded"),c.attr("aid",o),i.selectContentTab(s,e.find(" > a").attr("href")))))},i.resize=function(){var t=null;app.hasValue(r.width.fix)&&(t=r.width.fix);var e=n(window).height(),f=e-r.height.top,o=n(u).find("> .salary-table");o.css("height",f);i.setMainTableHeight(f-35);t==null&&i.setMainTableWidth()},i.setMainTableWidth=function(){var t=n(u).find("> .salary-table > .main-content .area-tr"),s=n(u).find("> .salary-table > .main-content .area-br"),r=t.find("> div").width(),f=parseInt(t.find("table").attr("data-w")),e=t.find("table > colgroup col").last(),o=s.find("table > colgroup col").last(),i;r>=f?(i=r-f-19,e.css("width",i),o.css("width",i)):(e.css("width",0),o.css("width",0))},i.setMainTableHeight=function(t){var f=r.head.height!=null?r.head.height:32,i;r.filterable&&(f+=37);i=n(u).find("> .salary-table > .main-content");i.css("height",t+35);i.find("> .areas").css("height",t+35);i.find("> .areas .area-bl").css("height",t-f+17);i.find("> .areas .area-bl > div").css("height",t-f+17);i.find("> .areas .area-br").css("height",t-f+34);i.find("> .areas .area-br > div").css("height",t-f+34)},i.initTable=function(){var o=r.skipCols,k=r.group,ht=n(window).height(),tt="",y="",p=0,w=0,f,g,e=n('<div class="salary-table  '+(r.border?"bordered":"")+'"><\/div>'),it,s,nt,et,ot,c,ut,d,t,b,rt,h,ft,a,l,v,st;if(app.hasValue(r.height.fix)?e.css("height",r.height.fix):e.css("height",ht-r.height.top),e.append('<div class="main-content"><div class="areas '+(o>0?"has-left":"")+'"><span class="empty-message" style="display: none">Không tìm thấy dữ liệu phù hợp<\/span><\/div><\/div>'),n(u).append(e),it=r.head.height!=null?r.head.height:32,r.filterable&&(it+=37),s=n('<div class="area area-tl" style="height: '+it+'px"><div><\/div><\/div>'),o>0){for(e=n('<table class="table table-bordered"><\/table>'),tt=n("<colgroup><\/colgroup>"),p=0,(r.checkAll==null||r.checkAll)&&(tt.append('<col style="width: 40px">'),p+=40,o--),h=0;h<o;h++)tt.append('<col style="width: '+r.head.groups[h]+'px">'),p+=r.head.groups[h];for(e.css("width",p).append(tt.html()),f="<thead>",o=r.skipCols,g=r.cols.left,l=0;l<g.length;l++){for(nt=g[l],f+="<tr>",l==0&&(r.checkAll==null||r.checkAll)&&(f+='<th rowspan="'+g.length+'" style="height: 31px"><div class="checkbox"><input type="checkbox" class="styled checkAll" /><label><\/label><\/div><\/th>',o--),d=0;d<nt.length;d++)t=nt[d],(t.visible==null||t.visible())&&(f+="<th ",t.rowspan!=null&&(f+=' rowspan="'+t.rowspan+'" '),t.colspan!=null&&(f+=' colspan="'+t.colspan+'" '),f+=' style="',t.style!=null&&(f+=t.style+"; "),f+='"',b="",t.class!=null&&(b+=t.class),t.color!=null&&(b+=" hc-"+t.color+" "),f+=t.sort!=null?'class="'+b+' orderable" orderby="'+t.sort+'" currentOrder="desc">':'class="'+b+'" >',f+=t.render!=null?t.render():t.title!=null?t.title:"&nbsp;",f+=(t.sort!=null?'<i style="margin-left:5px;" class="fa fa-caret-down"><\/i>':"")+"<\/th>");f+="<\/tr>"}f+="<\/thead>";e.append(f);r.filterable&&(et=i.rowFilter(!0),e.append("<tbody>"+et+"<\/tbody>"));s.css("width",p+1).find("> div").append(e)}for(n(u).find(".areas").append(s),ot=n(window).width(),s=n('<div class="area area-bl" style="width:'+(p+(ot>375?19:1))+'px"><\/div>'),s.append('<div><table class="table table-bordered table-hover" style="width:'+p+'px"><\/table><\/div>'),s.find("table").append(tt),c="<tbody>",k!=null?n(k.data).each(function(){c+='<tr class="tr-group expanded '+(this.class!=null?this.class:"")+'" groupid="'+this.id+'" ><td colspan="'+(r.checkAll==null||r.checkAll?o+1:o)+'" class="'+(this.class!=null?this.class:"")+'" style="height:'+r.height.row+'px">';c+="<div>";r.checkAll&&(c+='<div class="checkbox"><input type="checkbox" class="styled check-group" groupid="'+this.id+'" /><label><\/label><\/div>');c+='<button class="btn btn-icon btn-xs btn-expander"><i class="icon-arrow-down5"><\/i><\/button> ';c+=k.render!=null?k.render(this):this.text;k.addable&&(c+='<button class="btn btn-icon btn-xs btn-add-row bg-primary" groupid="'+this.id+'" type="button"><i class="icon-plus3"><\/i><\/button>');c+="<\/div><\/td><\/tr>";var t={gid:this.id,active:!0,left:[],right:[],count:0,loaded:!1,groupChilds:[]};this.childs!=null&&n(this.childs).each(function(){c+='<tr class="tr-group-child tr-group" groupid="'+this.id+'" ><td colspan="'+o+'" class="">';c+='<div class="'+(this.class!=null?this.class:"")+'">'+this.text+"<\/div><\/td><\/tr>";t.groupChilds.push({active:!0,gid:this.id,left:[],right:[],count:0,loaded:!1})});i.viewData.push(t)}):i.viewData.push({active:!0,gid:0,left:[],right:[],count:0,loaded:!1,groupChilds:[]}),c+="<\/tbody>",s.find("table").append(c),n(u).find(".areas").append(s),ut=r.optionMenu!=null&&browser=="Wap",o=r.skipCols,s=n('<div class="area area-tr" style="left: '+p+"px; height: "+it+"px; "+(ut?"right: 35px;":"")+'"><div><\/div><\/div>'),e=n('<table class="table table-bordered"><\/table>'),y=n("<colgroup><\/colgroup>"),w=0,(r.checkAll==null||r.checkAll)&&(o==0?(y.append('<col style="width: 40px">'),w+=40):o--),h=o;h<r.head.groups.length;h++)y.append('<col i="'+h+'" w="'+r.head.groups[h]+'" style="width: '+r.head.groups[h]+'px">'),w+=r.head.groups[h];for(y.append("<col>"),e.attr("data-w",w).css("width",+w+"px").append(y),f="<thead>",o=r.skipCols,g=r.cols.right,l=0;l<g.length;l++){for(nt=g[l],f+="<tr>",d=0;d<nt.length;d++)t=nt[d],(t.visible==null||t.visible())&&(f+="<th ",t.rowspan!=null&&(f+=' rowspan="'+t.rowspan+'" '),t.colspan!=null&&(f+=' colspan="'+t.colspan+'" '),f+=' style="',t.style!=null&&(f+=t.style+"; "),f+='"',b="",t.class!=null&&(b+=t.class),t.color!=null&&(b+=" hc-"+t.color+" "),f+='class="'+b+'" ri="'+(l+1)+'" ci="'+t.ci+'" >',t.note!=null&&(f+='<span class="th-tooltip"><i class="icon-info22" data-toggle="tooltip" data-placement="bottom" title="'+t.note+'"><\/i><\/span>'),f+='<span class="title ell">',rt="",rt=t.render!=null?t.render():t.title!=null?t.title:"&nbsp;",f+=rt,r.hideable&&(f+='<\/span><span class="th-hide" i="" data-toggle="tooltip" data-placement="right" title="Ẩn cột '+rt+'" ><i class="icon-shrink7"><\/i><\/span><span class="th-unhide" i=""  data-toggle="tooltip" data-placement="right" title="Bỏ ẩn cột '+rt+'"><i class="icon-enlarge7"><\/i><\/span>'),f+="<\/th>");f+="<th>&nbsp;<\/th>";f+="<\/tr>"}for(f+="<\/thead>",e.append(f),r.filterable&&e.append("<tbody>"+i.rowFilter(!1)+"<\/tbody>"),s.find("> div").append(e),n(u).find(".areas").append(s),o=r.skipCols,s=n('<div class="area area-br" style="left: '+p+"px;"+(ut?"right: 35px;":"")+'"><div><\/div><\/div>'),e=n('<table class="table table-bordered table-hover"><\/table>'),y=n("<colgroup><\/colgroup>"),w=0,(r.checkAll==null||r.checkAll)&&(o==0?(y.append('<col style="width: 40px" w="40">'),w+=40):o--),i.colRight=r.head.groups.length-o,h=o;h<r.head.groups.length;h++)y.append('<col i="'+h+'" w="'+r.head.groups[h]+'" style="width: '+r.head.groups[h]+'px">'),w+=r.head.groups[h];if(y.append("<col>"),c="<tbody>",k!=null&&(ft=k,n(ft.data).each(function(){var s=!0,t,u,f,e;if(k.onlyHasValue&&(s=this.totalChild!=null&&this.totalChild>0?!0:!1),s){if(t='<tr class="tr-group " groupid="'+this.id+'" >',ft.sumable){for(u=o;u<r.rows.length;u++)f=r.rows[u],e=f.style!=null?f.style:"",e+="; height:"+r.height.row+"px",t+=f.sumable?'<td data-attr="'+r.rows[u].attribute+'" class="text-bold text-right  '+(this.class!=null?this.class:"")+'" style="'+e+'"><span>'+app.formatPrice(this[r.rows[u].attribute])+"<\/span><\/td>":'<td data-attr="'+r.rows[u].attribute+'" class=" '+(this.class!=null?this.class:"")+'"><span>&nbsp;<\/span><\/td>';t+="<td>&nbsp;<\/td><\/tr>"}else t+='<td colspan="'+i.colRight+'" style="height:'+r.height.row+'px" class=" '+(this.class!=null?this.class:"")+'">&nbsp;<\/td>';c+=t;this.childs!=null&&n(this.childs).each(function(){t='<tr class="tr-group  tr-group-child " groupid="'+this.id+'" >';t+='<td colspan="'+i.colRight+'" style="height:'+r.height.row+'px">&nbsp;<\/td>';c+=t})}})),c+="<\/tbody>",e.css("width",+w+"px").append(y).append(c),s.find("> div").append(e),n(u).find(".areas").append(s),r.optionMenu!=null&&browser=="Wap"&&(s=n('<div class="area area-tom" style="right: 0; height: '+it+'px"><div><\/div><\/div>'),e=n('<table class="table"><colgroup><col style="width: 40px" /><\/colgroup><thead><th style="height: 30px">&nbsp;<\/th><\/thead><\/table>'),r.filterable&&e.append('<tbody><tr class="tr-filter"><td><\/td> <\/tr><\/tbody>'),s.find("> div").append(e),n(u).find(".areas").append(s),s=n('<div class="area area-bom" style="right: 0; top: 63px"><div><\/div><\/div>'),e=n('<table class="table table-bordered"><tbody><\/tbody><\/table>'),s.find("> div").append(e),n(u).find(".areas").append(s)),n(u).find(".areas").append('<span class="buffer-bl" style="width: '+p+'px"><\/span>'),r.contextMenu!=null){for(a='<div class="context-menu-salary-grid-popup"><ul class="dropdown-menu">',l=0;l<r.contextMenu.length;l++){v=r.contextMenu[l];switch(v){case"edit":a+='<li><a href="#" action="edit"><i class="icon-pencil7 position-left"><\/i>Cập nhật<\/a><\/li>';break;case"delete":a+='<li><a href="#" action="delete"><i class="icon-x position-left"><\/i>Xóa<\/a><\/li> ';break;case"add-child":a+='<li><a href="#" action="add-child"><i class="icon-stack-plus position-left"><\/i>Thêm cấp con<\/a><\/li> ';break;case"-":a+='<li class="divider" ><\/li>';break;default:v.childs!=null?(a+='<li class="dropdown-submenu dropdown-submenu-hover">',a+='<a href="#"><i class="'+v.icon+' position-left" ><\/i>'+v.text+"<\/a>",a+='<ul class="dropdown-menu">',n.each(v.childs,function(){a+='<li> <a href="#"  action="custom" class="'+this.class+'">'+this.text+"<\/a><\/li> "}),a+="<\/ul>",a+="<\/li>"):a+='<li><a href="#" title="'+v.text+'" action="custom" class="'+v.class+'">'+(v.icon!=null?'<i class="'+v.icon+'"><\/i>':"")+v.text+"<\/a><\/li> "}}a+="<\/ul> <\/div>";n(u).append(a)}i.setStaticEvents();r.data!=null?(st=n(u).find("> .salary-table > .main-content"),i.setViewData(r.data),i.sortai(),i.setRowPositions(),i.showBackground(),i.showData(0),i.set.sumInfo!=null&&i.drawSuminfo(st)):r.autoLoad!=!1&&i.loadData()},i.initTable(),this}})(jQuery)