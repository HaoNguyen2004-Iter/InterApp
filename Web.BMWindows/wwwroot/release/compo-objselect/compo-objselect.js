(function(n){n.fn.compoObjSelect=function(t){function e(n,t){n.Id=ko.observable(t.Id);n.Name=ko.observable(t.Name+" ("+t.TotalEmployee+")");n.ParentId=ko.observable(t.ParentId);n.PrivateCount=ko.observable(t.PrivateCount);n.OrgLevelId=ko.observable(t.OrgLevelId);n.OrgLevel=ko.observable(t.OrgLevel)}function o(n){n.Id=ko.observable(0);n.Name=ko.observable("");n.ParentId=ko.observable(null);n.PrivateCount=ko.observable(!1);n.OrgLevelId=ko.observable(null);n.OrgLevel=ko.observable({MoRong1:""});n.TotalEmployee=ko.observable(0)}var i=this,b=this.selector,r=n.extend({api:"",selectCallback:null,width:null,groupSize:null,ajax:null,attr:null,placeHolder:null,name:null},t),k=r.item;i.container=null;i.data=null;i.som="#objectSelectorModal";i.orgTempList=[];var s={Id:0,Name:"",ParentId:"",PrivateCount:!1,OrgLevelId:0,OrgLevel:{MoRong1:""},TotalEmployee:0},h=function(n){var t=this;n!=null?(ko.mapping.fromJS(n,{},t),t.totalChilds=ko.observable(n.childs().length)):(ko.mapping.fromJS(s,{},t),t.totalChilds=ko.observable(0));t.isShowChild=ko.observable(!0);t.active=ko.observable(!1);t.top=ko.observable(0);t.left=ko.observable(0);t.focus=ko.observable(!1)},u=function(t,r,f){var s=this;s.so=f;s.childs=ko.observableArray([]);t!=null?e(s,t):o(s);s.parent=ko.observable(new h(r));s.isShowChild=ko.observable(!0);s.active=ko.observable(!1);s.isChecked=ko.observable(!1);t!=null&&t.Childs!=null&&n.each(t.Childs,function(){i.orgTempList.push({id:this.Id,keyword:this.Keyword,name:this.Name});s.childs.push(new u(this,s,f))})},c=function(n){var t=this;t.Id=n.id;t.Keyword=n.keyword;t.Name=n.name;t.active=ko.observable(!1);t.selected=ko.observable(!1);t.visible=ko.observable(!1)},f=function(n){var t=this;t.Id=n.Id;t.Name=n.Name+" ("+n.TotalEmployee+")";t.Keyword=n.Keyword;t.selected=ko.observable(!1);t.Total=ko.observable(n.Total);t.visible=ko.observable(!0)},l=function(n){var t=this;t.Id=n.Id;t.FullName=n.FullName;t.Keyword=n.Keyword;t.Image=DOMAIN_API+n.Avatar;t.JobPositionName=n.JobPositionName;t.selected=ko.observable(!1)},a=function(){var t=this;t.data=ko.observableArray([]);t.key=ko.observable("");t.loaded=ko.observable(!1);t.tree=ko.observableArray([]);t.list=ko.observableArray([]);t.orgTreeData=[];t.searching=ko.observable(!1);t.treeEvents=function(){n(i.orgTempList).each(function(){t.list.push(new c(this))});n(i.som+" .search-org-control").keyup(function(){var i=n(this).val();i.length>0?(t.searching(!0),n(t.list()).each(function(){this.Keyword!=null&&this.Keyword.indexOf(i)>=0?this.visible(!0):this.visible(!1)})):t.searching(!1)})};t.checkTreeChild=function(n){var i=n.isChecked();n.isChecked(!i);n.childs().length>0&&t.checkChilds(n,!i,!0)};t.checkChilds=function(i,r,u){n(i.childs()).each(function(){this.isChecked(r);u&&this.childs().length>0&&t.checkChilds(this,r,u)})};t.setCheckNode=function(i,r,u){n(i).each(function(){r!=null?this.Id()==r?this.isChecked(u):this.childs().length>0&&t.setCheckNode(this.childs(),r,u):(this.isChecked(u),this.childs().length>0&&t.setCheckNode(this.childs(),null,u))})};t.setSelectListItem=function(i,r){n(t.list()).each(function(){this.Id==i&&this.selected(r)})};t.getCheckedChilds=function(i,r){return n(r.childs()).each(function(){this.isChecked()&&i.push({id:this.Id(),text:this.Name()});i=t.getCheckedChilds(i,this)}),i};t.start=function(){console.log(445454);app.loadData(r.api+"/general/OrganizationTreeBaseList",{unlimited:!0,cache:!0,HasSummary:!0},null,function(r){t.loaded(!0);t.orgTreeData=r;n(".tree-container .overlay").css("display","none");t.tree().length>0&&t.tree.removeAll();i.orgTempList.push({id:r.Id,keyword:r.Keyword,name:r.Name});t.tree.push(new u(t.orgTreeData,null,i.guid));t.treeEvents()})}},v=function(){var t=this;t.data=ko.observableArray([]);t.key=ko.observable("");t.loaded=ko.observable(!1);t.clear=function(){n(t.data()).each(function(){this.selected()&&this.selected(!1)})};t.start=function(){app.loadData(r.api+"/category/jobPositionTotalBaseList",{unlimited:!0,cache:!0,HasSummary:!0},null,function(i){t.loaded(!0);n(i).each(function(){t.data.push(new f(this))})})};setTimeout(function(){var r;n(i.som+" .search-pos-control").keyup(function(){var i=n(this).val();r!=null&&clearTimeout(r);i.length>0?n(t.data()).each(function(){this.Keyword.length>0?this.Keyword.indexOf(i)>=0?this.visible(!0):this.visible(!1):this.visible(!1)}):n(t.data()).each(function(){this.visible(!0)})})},300)},y=function(){var t=this,u;t.data=ko.observableArray([]);t.key=ko.observable("");t.loaded=ko.observable(!1);t.clear=function(){n(t.data()).each(function(){this.selected()&&this.selected(!1)})};t.start=function(){app.loadData(r.api+"/general/JobTitleTotalBaseList",{unlimited:!0,cache:!0,HasSummary:!0},null,function(i){t.loaded(!0);n(i).each(function(){t.data.push(new f(this))})})};setTimeout(function(){n(i.som+" .search-title-control").keyup(function(){var i=n(this).val();u!=null&&clearTimeout(u);i.length>0?n(t.data()).each(function(){this.Keyword.length>0?this.Keyword.indexOf(i)>=0?this.visible(!0):this.visible(!1):this.visible(!1)}):n(t.data()).each(function(){this.visible(!0)})})},300)},p=function(){var t=this;t.data=ko.observableArray([]);t.key=ko.observable("");t.loaded=ko.observable(!1);t.clear=function(){n(t.data()).each(function(){this.selected()&&this.selected(!1)})};t.search=function(i){i=n.extend({limit:10,trangThaiCongViecStr:"0,1,4"},i);app.loadData(r.api+"/employee/EmployeeSuggestionViewList",i,null,function(i){t.data.removeAll();t.loaded(!0);n(i).each(function(){t.data.push(new l(this))})})};t.start=function(){t.search({})};setTimeout(function(){var r;n(i.som+" .search-emp-control").keyup(function(){var i=n(this).val();r!=null&&clearTimeout(r);r=setTimeout(function(){var n={keyword:i};t.search(n);clearTimeout(r)},400)})},300)},w=function(){var t=this;t.mode=ko.observable(0);t.org=ko.observable(new a);t.position=ko.observable(new v);t.title=ko.observable(new y);t.emp=ko.observable(new p);t.selectedPos=ko.observableArray([]);t.selectedTitles=ko.observableArray([]);t.selectedEmps=ko.observableArray([]);t.selectedOrgs=ko.observableArray([]);t.selectEmp=function(n){var i=n.selected();n.selected(!i);t.compute()};t.selectPosition=function(n){var i=n.selected();n.selected(!i);t.compute()};t.selectTitle=function(n){var i=n.selected();n.selected(!i);t.compute()};t.selectOrgList=function(n){var i=n.selected();i=!i;n.selected(i);t.org().setCheckNode(t.org().tree(),n.Id,i);t.compute()};t.removePos=function(n){n.selected(!1);t.selectedPos.remove(n)};t.removeOrg=function(n){t.org().setCheckNode(t.org().tree(),n.id,!1);t.org().setSelectListItem(n.id,!1);t.selectedOrgs.remove(n);t.compute()};t.removeTitle=function(n){n.selected(!1);t.selectedTitles.remove(n)};t.removeEmp=function(n){n.selected(!1);t.selectedEmps.remove(n)};t.compute=function(){t.selectedPos.removeAll();t.selectedTitles.removeAll();t.selectedOrgs.removeAll();n(t.position().data()).each(function(){this.selected()&&t.selectedPos.push(this)});n(t.title().data()).each(function(){this.selected()&&t.selectedTitles.push(this)});n(t.emp().data()).each(function(){var i=this,r;i.selected()?(r=!1,n(t.selectedEmps()).each(function(){if(this.Id==i.Id){r=!0;return}}),r||t.selectedEmps.push(i)):n(t.selectedEmps()).each(function(){this.Id==i.Id&&t.selectedEmps.remove(this)})});var i=[];n(t.org().tree()).each(function(){this.isChecked()&&i.push({id:this.Id(),text:this.Name()});i=t.org().getCheckedChilds(i,this)});n(i).each(function(){t.selectedOrgs.push(this)})};t.selectMode=function(n){t.mode(n);switch(n){case 1:t.title().loaded()||t.title().start();break;case 2:t.position().loaded()||t.position().start();break;case 3:t.emp().loaded()||t.emp().start()}};t.checkTreeChild=function(n){var i=n.isChecked();i=!i;n.isChecked(i);n.childs().length>0&&t.checkChilds(n,i);t.compute()};t.checkChilds=function(i,r){n(i.childs()).each(function(){this.isChecked(r);this.childs().length>0&&t.checkChilds(this,r)})};t.init=function(){t.selectedEmps.removeAll();t.selectedOrgs.removeAll();t.selectedPos.removeAll();t.selectedTitles.removeAll();t.position().clear();t.title().clear();t.emp().clear();t.org().setCheckNode(t.org().tree(),null,!1);t.org().loaded()||t.org().start()};t.getReturnData=function(){var i=[{type:0,data:[]},{type:1,data:[]},{type:2,data:[]},{type:3,data:[]},];return t.selectedOrgs().length>0&&n(t.selectedOrgs()).each(function(){i[0].data.push(this)}),t.selectedTitles().length>0&&n(t.selectedTitles()).each(function(){i[1].data.push({id:this.Id,text:this.Name})}),t.selectedPos().length>0&&n(t.selectedPos()).each(function(){i[2].data.push({id:this.Id,text:this.Name})}),t.selectedEmps().length>0&&n(t.selectedEmps()).each(function(){i[3].data.push({id:this.Id,text:this.FullName,img:this.Image,posName:this.JobPositionName})}),i}};return i.vm=new w,i.callback=null,i.events=function(){n(i.som+" .btn-return-obj").click(function(){var t=i.vm.getReturnData();i.callback!=null&&i.callback(t);n(i.som).modal("hide")})},i.getObjs=function(t){i.callback=t;n(i.som).modal("show");i.vm.init()},i.init=function(){ko.applyBindings(i.vm,n(i.som)[0]);i.events()},i.init(),i}})(jQuery)