(function(n){n.fn.hierarchyGrid=function(t){var i=this,u=this.selector,r;return i.searchParams={keyword:"",limit:null},i.editParams={},i.sourceData=[],i.viewData=[],i.count=0,i.rowIndex=0,i.sequentially={number:20,total:0,first:!1,done:!1,loading:!1,loaded:0},i.formId="",i.sumarray=[],i.tounchTr=null,i.moveObjectId=null,i.colRight,i.searching,i.initData=!1,i.hr=31,i.editLoader=".salary-grid-edit-loader",i.clickSubContextMenu=!1,r=n.extend({tableSize:null,lazy:null,rootUrl:null,dataUrl:null,params:null,autoLoad:null,width:null,height:null,selectRow:null,toolbars:null,idAttribute:null,rows:[],cols:null,editController:null,model:"",filterable:!1,checkAll:null,beforeSubmit:null,detailRow:null,childs:null,modal:null,contextMenu:null,skipCols:0,loadDataCallback:null,loadModalCallback:null,selectRowCallback:null,submitFormCallback:null,sumInfo:null,beforeSearch:null,hideable:!1},t),i.set=r,i.filter={attrs:[]},r.params!=null&&(typeof r.params.search!="undefined"&&n.extend(i.searchParams,r.params.search),typeof r.params.edit!="undefined"&&n.extend(i.editParams,r.params.edit)),i.showTableLoading=function(){var t=n(u).find(".main-content");n(t).find(".loading").length==0&&n(t).append(app.loading());n(u).find(".loading").show()},i.hideTableLoading=function(){n(u).find(".loading").hide()},i.drawCheckbox=function(n){return'<td class="first-col" style="width: 40px"><div class="checkbox checkbox-info"><input type="checkbox"  class="styled check-item" value="" dataId="'+n+'"/><label><\/label><\/div><\/td>'},i.drawExpandNode=function(n,t){var i='<span class="expand-child position-left level-'+n+'" level="'+n+'" >';return i+=t>0?'<i class="icon-arrow-right13"><\/i>':"",i+"<\/span>"},i.setTdData=function(t,r,u,f){var e='<td attr="'+r.attribute+'" ci="'+u+'"',w="",s="",a,v,y,o,h,p,c,l,b;r.class!=null&&(w+=n.isFunction(r.class)?" "+r.class(t)+" ":" "+r.class+" ");r.editInline&&(w+=" edit-inline ");e+=' class="'+w+'"';e+=' style=" ';a="";r.style!=null&&(a+=n.isFunction(r.style)?" "+r.style(t)+" ":r.style);e+=a+'"';r.colspan!=null&&r.colspan.if(t)&&(e+=' colspan="'+r.colspan.value+'" ');switch(r.type){case"text":r.sumable?typeof i.sumarray[u]=="undefined"&&(i.sumarray[u]=0):i.sumarray[u]=null;e+=">";r.expandChild!=null&&(e+=i.drawExpandNode(level,t.TotalChild));o="";r.attribute!=null&&t[r.attribute]!=null&&(o=t[r.attribute]);r.editInline!=null?(v=r.editInline,v==!0?(e+='<span class="span-edit-inline" >'+o+"<\/span>",e+='<div class="form-group inline-form"><input style="'+a+'" class="form-control" data-type="text" attr="'+r.attribute+'" value="'+o+'" /><\/div>'):v.type=="option"&&(s="",y='<select style="'+a+'" class="form-control" data-type="text" attr="'+r.attribute+'" >',n(v.lst).each(function(){y+='<option value="'+this.id+'" '+(o==this.id?'selected="selected"':"")+">"+this.text+"<\/option>";this.id==o&&(s=this.text)}),y+="<\/select>",e+='<span class="span-edit-inline" >'+s+"<\/span>",e+='<div class="form-group inline-form">'+y+"<\/div>")):r.render!=null?e+="<span> "+r.render(t)+"<\/span>":(e+="<span",r.aline!=null&&(e+=' class="aline" title="'+o+'"'),e+="> "+o+"<\/span>");break;case"checkbox":e+=">";o=t[r.attribute];e+='<div class="form-group"><input class="" type="checkbox" attr="'+r.attribute+'" value="true" '+(o==!0?'checked="checked"':"")+" /><\/div>";i.sumarray[u]=null;break;case"option":for(e+=' style="width: 40px;">',h='<ul class="icons-list">',h+='<li class="dropdown">',h+='<a class="dropdown-toggle" href="#" data-toggle="dropdown" aria-expanded="false"><i class="icon-menu9" style="font-size: 16px;"><\/i><\/a>',h+='<ul class="dropdown-menu dropdown-menu-right" style="width: 200px">',p=0;p<r.render.length;p++)c=r.render[p],c!=null&&(c.condition==null||c.condition(t))&&(h+='<li><a href="javascript:void(0)"',c.class!=null&&(h+='class="'+c.class+'"'),h+='><i style="margin-right:5px" class="'+c.icon+" "+c.iconColor+'"><\/i>'+c.text+"<\/a><\/li>");h+="<\/li><\/ul>";e+=h+"<\/ul>";break;case"date":e+=">";e+="<span>"+app.formatDate(t[r.attribute])+"<\/span>";i.sumarray[u]=null;break;case"time":e+=">";e+=app.formatTime(t[r.attribute]);i.sumarray[u]=null;break;case"datetime":e+=">";e+=app.formatDateTime(t[r.attribute]);i.sumarray[u]=null;break;case"html":e+=">";r.render!=null?e+=r.render(t).replace(/\n/g,"<br/>"):r.attribute!=null&&(e+=t[r.attribute]!=null?t[r.attribute]:"");i.sumarray[u]=null;break;case"price":case"number":r.sumable&&typeof i.sumarray[u]=="undefined"&&(i.sumarray[u]=0);e+=">";l=0;l=r.render!=null?r.render(t,r.attribute):parseFloat(t[r.attribute]);i.sumarray[u]+=l;s=r.fixed!=null?l.toFixed(r.fixed):Math.round(l);s=r.renderText!=null?r.renderText(t):r.type=="price"?app.formatPrice(s):s;r.editInline?(e+='<span class="span-edit-inline"> '+s+"<\/span>",b=r.style!=null?r.style:"",e+='<div class="form-group inline-form"><input style="'+b+'" class="form-control" data-type="price" attr="'+r.attribute+'" value="'+l+'" /><\/div>'):e+='<span class=""> '+s+"<\/span>";break;case"ai":e+=">";e+=f;r.sumable?(typeof i.sumarray[u]=="undefined"&&(i.sumarray[u]=0),i.sumarray[u]+=1):i.sumarray[u]=null}return e+"<\/td>"},i.drawRow=function(n,t,u,f){var y={left:"",right:""},l=r.skipCols,o="<tr ",p,a,v,s,c,e,h;if(r.contextMenu!=null&&(o+=' data-toggle="context" data-target=".context-table-row" '),o+=' dataid="'+n[t]+'" ai="'+u+'" groupid="'+f+'" ',p=' class="tr-child tr-real',r.rowStyle!=null&&(o+=" "+r.rowStyle(n)+'" '),p+='"',o+=p,typeof n.Code!="undefined"&&(o+=' datacode="'+n.Code+'" '),n.ParentId!=null&&(o+=' parent="'+n.ParentId+'" '),o+=">",l>0){for(h="",l>0&&(r.checkAll==null||r.checkAll)&&(h+=i.drawCheckbox(n.Id),l--),a=0,v=l,e=a;e<v;e++)s=r.rows[e],c=!1,c=app.hasValue(s.visible)?s.visible():!0,c&&(h+=i.setTdData(n,s,e,u));y.left=o+h+"<td>&nbsp;<\/td><\/tr>"}for(h="",a=l,v=r.rows.length,e=a;e<v;e++)s=r.rows[e],c=!1,c=app.hasValue(s.visible)?s.visible():!0,c&&(h+=i.setTdData(n,s,e,u));return y.right=o+h+"<td>&nbsp;<\/td><\/tr>",y},i.drawGroup=function(t){var a=n(".area-bl table tbody"),v=n(".area-br table tbody"),s=r.group,h=r.skipCols,u='<tr class="tr-group expanded " groupid="'+t.Id+'" ><td colspan="'+(r.checkAll==null||r.checkAll?h+1:h)+'" class="" style="">',e,f,o,c,l;for(u+="<div>",r.checkAll&&(u+='<div class="checkbox"><input type="checkbox" class="styled check-group" groupid="'+t.Id+'" /><label><\/label><\/div>'),u+='<button class="btn btn-icon btn-xs btn-expander"><i class="icon-arrow-down5"><\/i><\/button> ',u+=s.render!=null?s.render(t):this.text,s.addable&&(u+='<button class="btn btn-icon btn-xs btn-add-row bg-primary" groupid="'+t.Id+'" type="button"><i class="icon-plus3"><\/i><\/button>'),u+="<\/div><\/td><\/tr>",a.append(u),u="",e='<tr class="tr-group " groupid="'+t.Id+'" >',f=h;f<r.rows.length;f++)o=r.rows[f],c=o.style!=null?o.style:"",c+="",e+=o.sumable?'<td data-attr="'+r.rows[f].attribute+'" class="text-bold text-right " style="'+c+'"><span>'+app.formatPrice(t[r.rows[f].attribute])+"<\/span><\/td>":'<td data-attr="'+r.rows[f].attribute+'" class="  "><span>&nbsp;<\/span><\/td>';return e+="<td>&nbsp;<\/td><\/tr>",u+=e,v.append(u),l={gid:t.Id,active:!0,count:0,loaded:!1},i.viewData.push(l),null},i.drawAddInline=function(n,t,i){var h={left:"",right:""},e=r.skipCols,l='<tr  groupid="'+n.Id+'" class="tr-child tr-add-inline" >',o,s,c,f,u;if(e>0){for(u="",e>0&&(r.checkAll==null||r.checkAll)&&(u+="<td>&nbsp;<\/td>",e--),o=0,s=e,f=o;f<s;f++)c=r.rows[f],c.addInline?(u+='<td class="add-inline">',u+='<span class="span-add-inline pl-30" ><i class="icon-plus3 position-left"><\/i>Thêm mới<\/span>',u+='<div class="form-group inline-form"><input style="" stt="'+i+'" class="form-control pl-20" data-type="text" attr="'+c.attribute+'" value="" /><\/div>',u+="<\/td>"):u+="<td>&nbsp;<\/td>";h.left=l+u+"<td>&nbsp;<\/td><\/tr>"}for(u="",o=e,s=r.rows.length,f=o;f<s;f++)u+="<td>&nbsp;<\/td>";return h.right=l+u+"<td>&nbsp;<\/td><\/tr>",h},i.drawSuminfo=function(n){var t=i.set.sumInfo,f,o,h,c,u,e,l,s;for(r.skipCols>0&&n.find(".area-bl tbody").append('<tr class="warning tr-total"><td colspan="'+r.skipCols+'" style="height: 31px" class="text-bold text-center">TỔNG CỘNG<\/td><\/tr>'),f='<tr class="warning tr-total">',o=0,t.colspan!=null&&(o=t.colspan,f+='<td colspan="'+t.colspan+'" style="text-align: right"><strong>Tổng<\/strong><\/td>'),r.skipCols>0&&(o+=r.skipCols),h=-1,c="",t.label!=null&&(h=t.label.col!=null?t.label.col:0,c=t.label.text!=null?t.label.text:"TỔNG CỘNG"),u=o;u<i.set.rows.length;u++)u==h?f+='<td style="text-align: right"><strong>'+c+"<\/strong><\/td>":(e=i.set.rows[u],e.sumable?(l="",i.sumarray.length>u&&(l=e.fixed!=null?i.sumarray[u].toFixed(e.fixed):app.formatPrice(i.sumarray[u])),s='<td class="text-right" data-attr="'+e.attribute+'" ',e.style!=null&&(s+='style="'+e.style+'"'),s+=" ><strong>"+l+"<\/strong><\/td>",f+=s):f+="<td>&nbsp;<\/td>");f+="<td><\/td><\/tr>";n.find(".area-br tbody").append(f)},i.rowFilter=function(t){var o=r.skipCols,h='<tr class="tr-filter">',c,l,f,u,v,y,e,s,a,p,i;if(t){if(o==0)return"";o>0&&(r.checkAll==null||r.checkAll)&&(h+="<td><\/td>",o--);c=0;l=o}else(r.checkAll==null||r.checkAll)&&(o==0?h+="<td><\/td>":o--),c=o,l=r.rows.length;for(f=c;f<l;f++)if(u=r.rows[f],v=app.hasValue(u.visible)?u.visible():!0,v){if(y=r.model,u.model!=null&&(y=u.model),e="<td ",u.colspan!=null&&u.colspan.if(item)&&(e+=' colspan="'+u.colspan.value+'" '),e+=">",s=u.filter,s!=null)switch(s.type){case"contains":i='<div class="input-group input-group-sm"><div class="input-group-btn" > <button type="button" class="btn btn-default btn-left dropdown-toggle" title="Lộc dữ liệu" data-toggle="dropdown"><i class="icon-search4"><\/i><\/button><\/div > <input type="text" class="form-control filter-contains" data-index="'+f+'" attr="'+s.attr+'" placeholder="..."><\/div>';e+=i;break;case"option":a=r.head.groups[f];i='<div class="form-group form-group-sm"><div class="input-group input-group-sm"><select class="form-control filter-option select-option" attr="'+u.attribute+'"  data-index="'+f+'" data-width="'+a+'" style="width: '+a+'px"><option value="">Tất cả<\/option>';s.lst!=null&&(p=s.lst(),n(p).each(function(){i+='<option value="'+this.id+'">'+this.text+"<\/option>"}));i+="<\/select><\/div><\/div>";e+=i;break;case"optionRemote":i='<div class="form-group form-group-sm"><div class="input-group input-group-sm"><div class="input-group-btn" > <button type="button" class="btn btn-default btn-left dropdown-toggle" title="Lộc dữ liệu" data-toggle="dropdown"><i class="icon-filter4"><\/i><\/button><\/div><input type="text" attr="'+u.attribute+'" class="form-control filter-option select-option-remote" data-index="'+f+'" data-width="'+r.head.groups[f]+'"/>';i+="<\/div><\/div>";e+=i;break;case"compoTree":i='<div class="form-group form-group-sm"><div class="input-group input-group-sm"><div class="input-group-btn" > <button type="button" class="btn btn-default btn-left dropdown-toggle" title="Lộc dữ liệu" data-toggle="dropdown"><i class="icon-filter4"><\/i><\/button><\/div>';i+='<input class="form-control compo-tree" id="'+app.newGuid()+'" data-index="'+f+'" type="text" />';i+="<\/div><\/div>";e+=i;break;case"date":i='<div class="datepicker" from to name="'+u.attribute+'" data-index="'+f+'" ><\/div>';e+=i}e+="<\/td>";h+=e}return h+"<td>&nbsp;<\/td><\/tr>"},i.drawEmptyRow=function(n){var t=r.skipCols,u='<tr class="empty">',f;if(n){if(t==0)return"";t>0&&(r.checkAll==null||r.checkAll)&&(u+=i.drawCheckbox(),t--);f=t}else(r.checkAll==null||r.checkAll)&&(t==0?u+=i.drawCheckbox():t--),f=r.rows.length-t;return u+='<td colspan="'+f+'"><\/td>',u+"<td>&nbsp;<\/td><\/tr>"},i.showBackground=function(){var t=n(u).find("> .hierarchy-table > .main-content"),r=t.find(".area-bl tbody"),f=t.find(".area-br tbody");t.find(".area-bl tbody tr").css("display","none");t.find(".area-br tbody tr").css("display","none");t.find(".area-bl tbody tr.tr-background").remove();t.find(".area-br tbody tr.tr-background").remove();n(i.viewData).each(function(){var i;if(this.active){t.find('tr.tr-group[groupid="'+this.gid+'"]').css("display","table-row");var u="",e="",o=r.find('tr.tr-group[groupid="'+this.gid+'"]'),s=f.find('tr.tr-group[groupid="'+this.gid+'"]');if(this.left.length>0)for(i=0;i<this.count;i++)this.left[i].active&&(u+=this.left[i].bg,e+=this.right[i].bg,r.find('tr.tr-child[dataid="'+this.left[i].id+'"]').attr("data-top",this.left[i].top),f.find('tr.tr-child[dataid="'+this.left[i].id+'"]').attr("data-top",this.left[i].top));if(n(o).after(u),n(s).after(e),this.left.length>0)for(i=0;i<this.count;i++)this.left[i].active&&(r.find('tr.tr-child[dataid="'+this.left[i].id+'"]').attr("data-top",this.left[i].top),f.find('tr.tr-child[dataid="'+this.left[i].id+'"]').attr("data-top",this.left[i].top))}})},i.showData=function(t){var a=n(u).find("> .hierarchy-table > .main-content"),o=a.find(".area-bl tbody"),s=a.find(".area-br tbody"),y=a.find(".area-br").height(),w=[],h,l,g=o.find(".tr-group"),b,c,e,v,p,k,f,d;n(g).each(function(){h=parseInt(n(this).attr("data-p1"));l=parseInt(n(this).attr("data-p2"));(h<=t&&t<=l||h<=t+y&&t<=l)&&w.push(parseInt(n(this).attr("groupid")))});b=o.find("tr.tr-group.showed");n(b).each(function(t,r){var u=parseInt(n(r).attr("groupid")),e,f;h=parseInt(n(r).attr("data-p1"));l=parseInt(n(r).attr("data-p2"));n.inArray(u,w)<0&&(e=o.find('tr.tr-child[groupid="'+u+'"]'),e.length>0&&(o.find('tr.tr-child[groupid="'+u+'"]').remove(),s.find('tr.tr-child[groupid="'+u+'"]').remove(),o.find('tr.tr-group-overload-top[groupid="'+u+'"]').css("display","none").find("td").css("height",0),s.find('tr.tr-group-overload-top[groupid="'+u+'"]').css("display","none").find("td").css("height",0),f=l-h-i.hr,o.find('tr.tr-group-overload-bot[groupid="'+u+'"]').css("display","table-row").find("td").css("height",f+"px"),s.find('tr.tr-group-overload-bot[groupid="'+u+'"]').css("display","table-row").find("td").css("height",f+"px")),n(this).removeClass("showed"))});c=Math.round(y/i.hr);e=0;n(i.viewData).each(function(u,b){var nt,tt,it,g;if(n.inArray(b.gid,w)>=0&&b.active){for(nt=o.find('tr.tr-group[groupid="'+b.gid+'"]'),nt.hasClass("showed")||nt.addClass("showed"),h=parseInt(nt.attr("data-p1")),l=parseInt(nt.attr("data-p2")),k=l-h,h>0?t<h&&h<t+y?(e=0,d=t+y-h-i.hr,c=Math.round(d/i.hr)):e=t-h-i.hr:e=t-i.hr,e<0&&(e=0),e=Math.floor(e/i.hr),nt=c,e+c>=b.left.length&&(c=b.left.length-e),c<0&&(c=0),tt=[],v=e*i.hr,p=k-c*i.hr-v-i.hr,v>0?(o.find('tr.tr-group-overload-top[groupid="'+b.gid+'"]').css("display","table-row").find("td").css("height",v+"px"),s.find('tr.tr-group-overload-top[groupid="'+b.gid+'"]').css("display","table-row").find("td").css("height",v+"px")):(o.find('tr.tr-group-overload-top[groupid="'+b.gid+'"]').css("display","none").find("td").css("height",0),s.find('tr.tr-group-overload-top[groupid="'+b.gid+'"]').css("display","none").find("td").css("height",0)),p>0?(o.find('tr.tr-group-overload-bot[groupid="'+b.gid+'"]').css("display","table-row").find("td").css("height",p+"px"),s.find('tr.tr-group-overload-bot[groupid="'+b.gid+'"]').css("display","table-row").find("td").css("height",p+"px")):(o.find('tr.tr-group-overload-bot[groupid="'+b.gid+'"]').css("display","none").find("td").css("height",0),s.find('tr.tr-group-overload-bot[groupid="'+b.gid+'"]').css("display","none").find("td").css("height",0)),o.find('tr.tr-child[groupid="'+b.gid+'"]').remove(),s.find('tr.tr-child[groupid="'+b.gid+'"]').remove(),tt=[],f=e;f<e+c;f++)f<b.left.length&&b.right[f].html==""&&tt.push(b.right[f].id);if(it="",g="",tt.length>0)i.loadRightData(u,tt,function(t){for(g="",f=e;f<e+c;f++)f<t.left.length&&t.left[f].active&&(it+=t.left[f].html,g+=t.right[f].html);o.find('tr.tr-group-overload-top[groupid="'+t.gid+'"]').after(it);s=a.find(".area-br tbody");s.find('tr.tr-group-overload-top[groupid="'+t.gid+'"]').after(g);n(t.left).each(function(){if(this.checked){var n=o.find('tr.tr-child[dataid="'+this.id+'"] .first-col input[type="checkbox"]');n.prop("checked",!0)}});i.setRowEvents(t.gid);r.loadDataCallback!=null&&r.loadDataCallback()});else{for(g="",f=e;f<e+c;f++)f<b.left.length&&b.left[f].active&&(it+=b.left[f].html,g+=b.right[f].html);o.find('tr.tr-group-overload-top[groupid="'+b.gid+'"]').after(it);s=a.find(".area-br tbody");s.find('tr.tr-group-overload-top[groupid="'+b.gid+'"]').after(g);n(b.left).each(function(){if(this.checked){var n=o.find('tr.tr-child[dataid="'+this.id+'"] .first-col input[type="checkbox"]');n.prop("checked",!0)}});i.setRowEvents(b.gid);r.loadDataCallback!=null&&r.loadDataCallback()}}})},i.setViewData=function(t){var f="Id",u,e,o;r.idAttribute!=null&&(f=r.idAttribute);e=n(".area-bl table tbody");o=n(".area-br table tbody");n.each(t,function(t,s){var l,a,h,c;i.drawGroup(s,f,t+1);l=e.find('.tr-group[groupid="'+s.Id+'"]');a=o.find('.tr-group[groupid="'+s.Id+'"]');s.Childs!=null&&(h="",c="",n(s.Childs).each(function(n,t){var e=t[r.relateId];u=i.drawRow(t,f,n+1,e);h+=u.left;c+=u.right}),r.addInline&&(u=i.drawAddInline(s,f,s.Childs.length),h+=u.left,c+=u.right),n(l).after(h),n(a).after(c))})},i.loadData=function(t,f,e){t!=null&&n.extend(i.searchParams,t);app.cleanJson(i.searchParams);console.log(i.searchParams);i.searchParams.limit=n.isEmptyObject(i.searchParams)?r.params.limitClear:null;i.showTableLoading();n.ajax({url:r.url,type:"GET",dataType:"JSON",contentType:"application/json; charset=utf-8",data:i.searchParams,success:function(t){var s=t.Groups,c=r.optionMenu!=null,o=n(u).find("> .hierarchy-table > .main-content"),h;o.find(".area-bl tbody").html("");o.find(".area-br tbody").html("");o.find(".area-bom tbody").html("");i.sourceData=s;i.count=t.Count;i.sumarray=[];r.rows.length>0&&(s!=null&&s.length>0?(i.setViewData(s),i.setRowEvents(),r.loadDataCallback!=null&&r.loadDataCallback(),o.find(".empty-message").css("display","none")):(i.showBackground(),i.showData(0),h=i.drawEmptyRow(!0),o.find(".area-bl tbody").append(h),h=i.drawEmptyRow(!1),o.find(".area-br tbody").append(h),o.find(".empty-message").css("display","block")));i.hideTableLoading();r.loadDataCallback!=null&&r.loadDataCallback(t,e);f!=null&&f(t)}})},i.setRowPositions=function(){var s=n(u).find("> .hierarchy-table > .main-content"),t=s.find(".area-bl tbody"),f=s.find(".area-br tbody"),e=i.hr,h=0,o,c;r.group.onlyHasValue&&n(i.viewData).each(function(){});n(i.viewData).each(function(){var i=this,l,s,u;if(r.group.onlyHasValue&&i.left.length==0&&(i.active=!1,n(t).find('tr.tr-group[groupid="'+i.gid+'"]').css("display","none"),n(f).find('tr.tr-group[groupid="'+i.gid+'"]').css("display","none"),n(t).find('tr.tr-group-overload[groupid="'+i.gid+'"]').css("display","none"),n(f).find('tr.tr-group-overload[groupid="'+i.gid+'"]').css("display","none")),i.active){for(l=0,s=0;s<i.left.length;s++)i.left[s].active&&l++;u=e*l;o=h;c=o+u+e;n(t).find('tr.tr-group[groupid="'+i.gid+'"]').css("display","table-row").attr("data-p1",o).attr("data-p2",c);n(f).find('tr.tr-group[groupid="'+i.gid+'"]').css("display","table-row");n(t).find('tr.tr-group-overload-top[groupid="'+i.gid+'"]').css("display","none");n(f).find('tr.tr-group-overload-top[groupid="'+i.gid+'"]').css("display","none");n(t).find('tr.tr-group-overload-bot[groupid="'+i.gid+'"] > td').css("height",u+"px");n(f).find('tr.tr-group-overload-bot[groupid="'+i.gid+'"] > td').css("height",u+"px");h+=e+u}else n(t).find('tr.tr-group-overload[groupid="'+i.gid+'"]').css("display","none"),n(f).find('tr.tr-group-overload[groupid="'+i.gid+'"]').css("display","none")})},i.drawBackground=function(n,t,u,f){var e='<tr dataid="'+n+'" data-top="'+u+'" class="tr-background tr-child" groupid="'+f+'" style=""><td style="height: '+t+'px" colspan="'+r.skipCols+'">&nbsp;<\/td><\/tr>',o='<tr dataid="'+n+'" data-top="'+u+'" class="tr-background tr-child" groupid="'+f+'" style=""><td style="height: '+t+'px" colspan="'+i.colRight+'">&nbsp;<\/td><\/tr>';return{left:e,right:o}},i.sortai=function(){var t;n(i.viewData).each(function(){this.active&&(t=0,n(this.left).each(function(){var i,u;this.active&&(i=n(this.html),t++,r.checkAll?i.find("td:eq(1)").text(t):i.find("td:eq(0)").text(t),u=n("<div>").append(i.clone()).html(),this.html=u)}))})},i.reloadDataGroup=function(t){i.showTableLoading();var f=0;n(i.viewData).each(function(n){if(t==this.gid){f=n;return}});i.viewData[f].left="";i.viewData[f].right="";i.sourceData=n.grep(i.sourceData,function(n){return n[r.group.attr]!=t});i.searchParams.orgStr=t+"";i.count-=i.viewData[f].count;i.viewData[f].count=0;n.ajax({url:r.dataUrl!=null?r.dataUrl:"/api/"+r.model+"List",type:"GET",dataType:"JSON",contentType:"application/json; charset=utf-8",data:i.searchParams,success:function(e){var h=e.Many!=null?e.Many:e.length>0?e:[],o=n(u).find("> .hierarchy-table > .main-content"),s,c,l;i.sourceData=n.merge(i.sourceData,h);i.count+=e.Count;r.rows.length>0&&(h!=null&&h.length>0?(c="Id",r.idAttribute!=null&&(c=r.idAttribute),n.each(h,function(n,t){var u=t[r.group.attr];s=i.drawRow(t,c,1,n+1,!0,u);i.viewData[f].left+=s.left;i.viewData[f].right+=s.right;i.viewData[f].count+=1}),o.find('tbody tr.tr-child[groupid="'+t+'"]').remove(),l=i.hr*i.viewData[f].count,o.find('.areas tbody tr[groupid="'+t+'"]').attr("data-height",l+i.hr).removeClass("showed-child"),o.find('.areas tbody tr.tr-background[groupid="'+t+'"] td').css("height",l),i.resetGroupPosition(),o.find(".empty-message").css("display","none")):(s=i.drawEmptyRow(!0),o.find(".area-bl tbody").append(s),s=i.drawEmptyRow(!1),o.find(".area-br tbody").append(s),o.find(".empty-message").css("display","block")));i.hideTableLoading();r.loadDataCallback!=null&&r.loadDataCallback(e)}})},i.clearViewData=function(t){var f,r;n(i.viewData).each(function(){this.left=[];this.right=[];this.active=t});f=n(u).find("> .hierarchy-table > .main-content .area tbody");f.find("tr.tr-child").remove();f.find(".tr-group").removeClass("showed-child");r=n(u).find("> .advance-table > .main-content");r.find(".area-bl tbody").html("");r.find(".area-br tbody").html("");r.find(".area-bom tbody").html("")},i.searchGroup=function(n){i.filter.groupId=n!=null&&n.length>0?parseInt(n):null;i.search(null)},i.search=function(t){var e,r,f;t!=null&&n.extend(i.filter,t);e=n(u).find("> .hierarchy-table > .main-content");e.find(".area tbody tr.tr-add-inline").css("display","none");r=e.find(" .area-bl tbody");r.find("tr.tr-group").css("display","none");f=e.find(" .area-br tbody");f.find("tr.tr-group").css("display","none");i.showTableLoading();console.log(i.filter.attrs);setTimeout(function(){n(i.sourceData).each(function(){var t=this,u=0;n(t.Childs).each(function(){for(var n,e=!0,t=this,o=0;o<i.filter.attrs.length;o++){n=i.filter.attrs[o];switch(n.type){case"option":n.v!=null&&t[n.attr]+""!=n.v&&(e=!1);break;case"contains":n.v!=null&&n.v.length>0&&(t.Keyword!=null?t.Keyword.indexOf(n.v)<0&&(e=!1):e=!1)}}e?(u++,r.find('tr.tr-child[dataid="'+t.Id+'"]').css("display","table-row"),f.find('tr.tr-child[dataid="'+t.Id+'"]').css("display","table-row")):(r.find('tr.tr-child[dataid="'+t.Id+'"]').css("display","none"),f.find('tr.tr-child[dataid="'+t.Id+'"]').css("display","none"))});u>0&&(r.find('tr.tr-group[groupid="'+t.Id+'"]').css("display","table-row"),f.find('tr.tr-group[groupid="'+t.Id+'"]').css("display","table-row"))});i.hideTableLoading()},300)},i.setData=function(t,f){var o=t.Count!=null?t.Count:0,e=t.Many!=null?t.Many:t.length>0?t:null,s;e!=null&&(o==0&&(o=e.length),n(u).find(".area-bl tbody").html(""),n(u).find(".area-br tbody").html(""),i.sourceData=e);i.count=o;r.rows.length>0&&e!=null&&e.length>0&&(s="Id",r.idAttribute!=null&&(s=r.idAttribute),i.sumarray=[],n.each(e,function(t,r){var f=i.drawRow(r,s,1,t+1,!0);n(u).find(".area-bl tbody").append(f);f=i.drawRow(r,s,1,t+1,!1);n(u).find(".area-br tbody").append(f)}));n(u).find(".main-content .total-row span").text(o);i.hideTableLoading();i.setRowEvents();r.loadDataCallback!=null&&r.loadDataCallback(t);f!=null&&f(t)},i.setSubmitEvent=function(n){var t=!0;if(r.beforeSubmit!=null&&(t=r.beforeSubmit()),!t||!r.autoSubmit)return!1;i.submitForm(n)},i.hideModal=function(){var t=parseInt(n("#"+r.model+"FormEditModal").attr("data-type"));t==2?n("#"+r.model+"FormEditModal").fadeOut("fast",function(){n("#"+r.model+"FormEditModal").remove()}):n("#"+r.model+"FormEditModal").modal("hide");n("body").removeClass("overflow-hidden")},i.eventModal=function(){var u;n(".form-cancel").unbind().click(function(){i.hideModal()});var t=n(window).height(),f="#formEditModal",e=n(f+" form").height();e+=117;u=(t-e)/4;t<e&&(u=0,e=t);n(f+" .wtable-epanel-content").css("height",e+"px").css("top",u+"px");n(window).resize(function(){var h=r.modal,s,i,o,e;h.type==2&&(s=n(window).width(),t=n(window).height(),i=h.width,o="",i.indexOf("%")>-1?(i=i.substr(0,i.length-1),o=(100-parseInt(i))/2+"%"):i.indexOf("px")>-1&&(i=i.substr(0,i.length-2),i=parseInt(i),o=s>i?(s-i)/2+"px":"0px"),e=n(f+" form").height(),e+=117,u=(t-e)/4,t<e&&(u=0,e=t),n(f+" .wtable-epanel-content").css("left",o).css("height",e+"px").css("top",u+"px"))});n(f).on("keyup keypress",function(n){var t=n.keyCode||n.which;if(t===13)return n.preventDefault(),!1})},i.initModal=function(t,i){var u="";if(t.type==2){var o=n(window).width(),f=t.width,e="";f.indexOf("%")>-1?(f=f.substr(0,f.length-1),e=(100-parseInt(f))/2+"%"):f.indexOf("px")>-1&&(f=f.substr(0,f.length-2),f=parseInt(f),o>f&&(e=(o-f)/2+"px"));u='<div class="wtable-epanel" id="'+r.model+'FormEditModal" data-type="'+t.type+'">';u+=t.width!=""?'<div class="wtable-epanel-content" style="width:'+t.width+";left: "+e+'">':'<div class="wtable-epanel-content">';u+='<div class="panel panel-flat wtable-panel">';u+=i;u+="<\/div><\/div><\/div>";n("body").append(u)}else{if(u='<div class="modal" id="'+r.model+'FormEditModal" data-type="'+t.type+'" data-backdrop="static"  role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">',u+=t.width!=""?'    <div class="modal-dialog" style="width:'+t.width+'">':'    <div class="modal-dialog" >',u+='<div class="modal-content">',u+='      <div class="modal-header p-15 '+(t.headerClass!=null?t.headerClass:"")+'">',u+='          <button class="close" aria-hidden="true" data-dismiss="modal" type="button">×<\/button>',u+='              <h5 class="modal-title text-bold">'+t.title+"<\/h5>",u+='          <\/div><form id="'+r.model+'Form" class="form-horizontal"><div class="modal-body '+(t.noPaddingBody!=null?"no-padding":"pt-15 pl-15 pr-15 pb-5")+'">',u+=i,u+="<\/div>",t.footerTemplate!=null)u+=n(t.footerTemplate).html();else switch(t.mode){case 2:u+='<div class="panel-footer panel-footer p-15"><div class="pull-right"><button class="btn btn-sm btn-default form-cancel mr-10 btn-rounded" data-dismiss="modal"><i class="fa fa-remove"><\/i> Thoát<\/button><button class="btn btn-sm bg-slate mr-10 btn-submit btn-rounded" type="button" data-mode="1" data-loading-text="<i class=\'icon-spinner4 fa-spin position-left\'><\/i> Lưu tạm"><i class="icon-floppy-disk position-left"><\/i> Lưu tạm<\/button><button class="btn btn-sm btn-success btn-submit btn-rounded" type="button" data-mode="2" data-loading-text="<i class=\'icon-spinner4 fa-spin position-left\'><\/i> Lưu và gửi đề xuất"><i class="icon-paperplane position-left"><\/i> Lưu và gửi đề xuất<\/button><\/div><\/div>';break;case 3:u+='<div class="panel-footer panel-footer p-15"><div class="pull-right"><button class="btn btn-sm btn-default form-cancel mr-10 btn-rounded" data-dismiss="modal"><i class="fa fa-remove"><\/i> Thoát<\/button><button class="btn btn-sm bg-slate mr-10 btn-submit btn-rounded" type="button" data-mode="1" data-loading-text="<i class=\'icon-spinner4 fa-spin position-left\'><\/i> Lưu tạm"><i class="icon-floppy-disk position-left"><\/i> Lưu tạm<\/button><button class="btn btn-sm btn-success btn-submit btn-rounded" type="button" data-mode="3" data-loading-text="<i class=\'icon-spinner4 fa-spin position-left\'><\/i> Lưu và gửi đề xuất"><i class="icon-check position-left"><\/i> Lưu và ký chốt<\/button><\/div><\/div>';break;default:u+='<div class="panel-footer panel-footer p-15"><div class="pull-right"><button class="btn btn-sm btn-default form-cancel mr-10 btn-rounded" data-dismiss="modal"><i class="fa fa-remove"><\/i> Thoát<\/button><button class="btn btn-sm btn-fill btn-primary m-r-5 btn-submit btn-rounded" type="button" data-loading-text="<i class=\'icon-spinner4 fa-spin\'><\/i> Đang xử lý ..."><i class="fa fa-save"><\/i> Lưu lại<\/button><\/div><\/div>'}u+="<\/form><\/div><\/div><\/div>";n("body").append(u);n("#"+r.model+"FormEditModal").on("hidden.bs.modal",function(){n("body").removeClass("overflow-hidden");n("#"+r.model+"FormEditModal").remove()})}},i.showModal=function(){var t=parseInt(n("#"+r.model+"FormEditModal").attr("data-type"));t==2?n("#"+r.model+"FormEditModal").fadeIn("fast"):n("#"+r.model+"FormEditModal").modal("show");n("body").addClass("overflow-hidden")},i.createOrUpdateObject=function(t,u,f){i.showTableLoading();var e=r.editController!=null?r.editController+"/":"/admin/";e+=r.model+"Edit";n.extend(i.editParams,t);n.ajax({url:e,type:"GET",data:i.editParams,dataType:"html",success:function(n){i.hideTableLoading();var e=r.modal;i.initModal({title:(t.id>0?"Cập nhật ":"Thêm mới ")+e.title,width:e.width,type:e.type!=null?e.type:1,noPaddingBody:e.noPaddingBody,headerClass:e.headerClass,noFooter:e.noFooter,mode:e.mode},n);i.eventModal();i.showModal();r.loadModalCallback!=null&&r.loadModalCallback(f);u&&u()}})},i.getSelectedIds=function(){var t=[];return n.each(n(u).find("> .hierarchy-table > .main-content .area-br tr"),function(i,r){n(r).hasClass("active")&&t.push(n(r).attr("dataid"))}),t},i.unique=function(t){var i=[];return n.each(t,function(t,r){n.inArray(r,i)==-1&&i.push(r)}),i},i.getCheckedRowIds=function(){var t=[];return n.each(n(u).find('> .hierarchy-table > .main-content .first-col input[type="checkbox"]'),function(){n(this).prop("checked")==!0&&t.push(n(this).closest("tr").attr("dataid"))}),t},i.getCheckedDatas=function(){var f=[],e="Id",u,t;for(r.idAttribute!=null&&(e=r.idAttribute),u=i.getCheckedRowIds(),t=0;t<u.length;t++)n(i.sourceData).each(function(){if(this[e]==u[t])return f.push(this),!1;this.Childs!=null&&n(this.Childs).each(function(){if(this[e]==u[t])return f.push(this),!1})});return f},i.setCheckedRowIds=function(t){for(var r,f,e=n(u).find("> .hierarchy-table > .main-content"),i=0;i<t.length;i++)r=e.find('.area-bl tr[dataid="'+t[i]+'"]'),f=n(r).find('.first-col input[type="checkbox"]'),f.prop("checked",!0);n.uniform.update()},i.getSelectedRow=function(){return n(u).find('> .hierarchy-table > .main-content .area-br tr[class="active"]').first()},i.getSelectedDatas=function(){var f=[],e="Id",u,t;for(r.idAttribute!=null&&(e=r.idAttribute),u=i.getSelectedIds(),t=0;t<u.length;t++)n(i.sourceData).each(function(){if(this[e]==u[t])return f.push(this),!1});return f},i.addChild=function(t,u){var e,f;i.showTableLoading();e=r.editController!=null?r.editController+"/":"/admin/";e+=r.model+"Edit";f=r.modal;n.ajax({url:e,type:"GET",data:t,dataType:"html",success:function(n){i.hideTableLoading();i.initModal({title:"Thêm "+f.title.toLowerCase(),width:f.width,type:f.type!=null?f.type:1,mode:f.mode},n);i.eventModal();i.showModal();r.loadModalCallback!=null&&r.loadModalCallback(u)}})},i.getDataById=function(n,t){var u,f,r;for(t==null&&(t=i.sourceData),f=0;f<t.length;f++)if(r=t[f],r.Id==n){u=r;break}else if(r.Childs!=null&&(u=i.getDataById(n,r.Childs),u!=null))break;return u},i.getActiveTabIndex=function(){return n(u).find("> .hierarchy-table > .sub-content > .tab-content > div.active").index()},i.loadFilterOption=function(t,i){var f,u,e;if(!n(t).hasClass("loaded")&&(f=t.attr("data-index"),u=r.rows[f].filter,u.ajax!=null))return e=u.ajax.data,app.loadData(u.ajax.url,e,null,function(r){t.addClass("loaded");var f=r.Many!=null?r.Many:r;n(f).each(function(){var n=new Option(this[u.ajax.attr.text],this[u.ajax.attr.id],!0,!0);t.append(n)});t.select2("val","");i!=null&&i()}),!0},i.setStaticEvents=function(){var t,s,f,e,o;if(i.resize(),n(window).resize(function(){i.resize()}),t=n(u).find("> .hierarchy-table > .main-content"),s=n("#sub_content_modal"),window.addEventListener("touchstart",function(t){i.tounchTr=n(t.target).closest(".area")}),n(t).find(" .area").mouseover(function(){i.tounchTr=n(this)}),t.find(".area-tr > div").scroll(function(){if(n(i.tounchTr).length==0||n(i.tounchTr).hasClass("area-tr")){var r=n(this).scrollLeft();t.find(".area-br > div").scrollLeft(r)}}),t.find(".area-br > div").scroll(function(){if(n(i.tounchTr).length==0||n(i.tounchTr).hasClass("area-br")){clearTimeout(n.data(this,"scrollCheck"));var r=n(this).scrollTop(),u=n(this).scrollLeft();t.find(".area-bl > div").scrollTop(r);t.find(".area-tr > div").scrollLeft(u);n.data(this,"scrollCheck",setTimeout(function(){i.searching||i.showData(r)},100))}}),t.find(".area-bl > div").scroll(function(){if(n(i.tounchTr).length==0||n(i.tounchTr).hasClass("area-bl")){var r=n(this).scrollTop();t.find(".area-br > div").scrollTop(r);clearTimeout(n.data(this,"scrollCheck"));n.data(this,"scrollCheck",setTimeout(function(){i.searching||i.showData(r)},200))}}),t.find(".styled").uniform(),r.toolbars!=null&&(r.toolbars.create!=null&&n(r.toolbars.create.ele).unbind().click(function(){if(r.toolbars.create.click!=null)r.toolbars.create.click();else{var t=n(this);t.button("loading");i.createOrUpdateObject(null,function(){t.button("reset")})}}),r.toolbars.edit!=null&&(f=r.toolbars.edit,n(f.ele).prop("disabled",!0),n(f.ele).unbind().click(function(){var t=i.getSelectedIds()[0],e=i.getSelectedRow(),r=n(this),u;app.hasValue(t)?(u=i.getDataById(t),(f.before==null||f.before(u))&&(f.click!=null?f.click(t):(r.button("loading"),i.createOrUpdateObject({id:t},function(){r.button("reset")},e)))):app.notify("warning","Vui lòng chọn đối tượng cần sửa")})),r.toolbars.delete!=null&&(e=r.toolbars.delete,n(e.ele).prop("disabled",!0),n(e.ele).unbind().click(function(){var n=i.getCheckedRowIds();n.length>0?(e.before==null||e.before(n))&&i.deleteObjects("bulk",n,function(){i.loadData()}):app.notify("warning","Vui lòng chọn đối tượng cần xóa")})),r.toolbars.reload!=null&&n(r.toolbars.reload.ele).unbind().click(function(){i.loadData()}),r.toolbars.reorder!=null&&n(r.toolbars.reorder.ele).unbind().click(function(){var n=i.getCheckedRowIds();n.length==0&&app.notify("warning","Vui lòng chọn dữ liệu để sắp xếp")})),t.find('.first-col input[type="checkbox"]').click(function(){var e=t.find(".checkAll"),s=n(this).closest("tr"),i=s.attr("dataid"),f,o;n(this).prop("checked")?(n(u).find('.area-bl tr[dataid="'+i+'"]').addClass("active"),n(u).find('.area-br tr[dataid="'+i+'"]').addClass("active")):(n(u).find('.area-bl tr[dataid="'+i+'"]').removeClass("active"),n(u).find('.area-br tr[dataid="'+i+'"]').removeClass("active"),e.prop("checked")&&e.prop("checked",!1));f=0;o=t.find(" .first-col input");o.each(function(){n(this).prop("checked")==!0&&f++});o.length==f&&e.prop("checked",!0);r.toolbars!=null&&r.toolbars.delete!=null&&(f>0?n(r.toolbars.delete.ele).prop("disabled",!1):n(r.toolbars.delete.ele).prop("disabled",!0));n.uniform.update();r.selectRowCallback!=null&&r.selectRowCallback(s)}),r.filterable){t.find(".tr-filter .btn").unbind().click(function(){});t.find(".tr-filter .select-option").unbind().select2({minimumResultsForSearch:1,dropdownCssClass:"bigdrop"}).on("select2-open",function(){var t=n(this);i.loadFilterOption(t,function(){return t.select2("close").select2("open"),!0})}).on("change",function(t){var s=n(t.target),u=r.rows[s.attr("data-index")],f=u.attribute,h=parseInt(s.attr("data-width")),e,o;u.filter.reload?(e={},e[f]=t.val,i.loadData(e,function(){},!0)):(o=!1,n(i.filter.attrs).each(function(){if(this.attr==f){switch(u.filter.dataType){case"int":this.v=t.val!=""?parseInt(t.val):null;break;case"float":this.v=t.val!=""?parseFloat(t.val):null;break;default:this.v=t.val!=""?t.val:null}o=!0}}),o||i.filter.attrs.push({attr:f,type:"option",v:t.val!=""?t.val:null}),i.search())});t.find(".tr-filter .select-option-remote").each(function(){var u=n(this),f=n(this).attr("data-index"),t=r.rows[f].filter;u.unbind().select2({ajax:{url:t.ajax.url,dataType:"json",quietMillis:200,data:function(i){var r=app.toKeyword(i);return n.extend({keyword:r,limit:10},t.ajax.data)},results:function(i){var r=[];return n(i).each(function(){r.push({id:this[t.ajax.attr.id],text:this[t.ajax.attr.text]})}),{results:r}}},minimumInputLength:1,minimumResultsForSearch:1,dropdownCssClass:"bigdrop",allowClear:!0,placeholder:"Tất cả"}).on("change",function(t){var u=n(t.target),f=r.rows[u.attr("data-index")],e={},o;f.filter.prop!=null?e[f.filter.prop]=t.val:e[f.attribute]=t.val;o=parseInt(u.attr("data-width"));u.closest("div").find(".select2-container").css("width",o-30+"px");i.search(e)})});t.find(".tr-filter .compo-tree").each(function(){var e=n(this),u=e.attr("data-index"),f=r.rows[u].filter,t=f.option,o;t.placeHolder="Tất cả";t.valueType=1;t.width=r.head.groups[u];t.width-=31;t.selectCallback=function(n){var e=r.rows[u],t={};f.prop!=null?t[f.prop]=n:t[e.attribute]=n;i.search(t)};o=e.attr("id");n("#"+o).compoTree(t)});t.find(".tr-filter .datepicker").each(function(){var e=n(this),u=n(this).attr("name"),o=e.attr("data-index"),f=r.rows[o].filter;t.find('.tr-filter div[name="'+u+'"]').compoDate({placeHolder:"Tất cả",days:f.option!=null?f.option.days:null,selectCallback:function(n){var t={};t[u+"From"]=n.from!=null?app.convertVnToEnDate(n.from):null;t[u+"To"]=n.to!=null?app.convertVnToEnDate(n.to):null;i.search(t)}})});t.find(".tr-filter .compo-money").each(function(){var r=n(this).attr("name");t.find('.tr-filter div[name="'+r+'"]').compoMoney({placeHolder:"Tất cả",selectCallback:function(n){var t={};t[r+"From"]=n.from;t[r+"To"]=n.to;i.search(t)}})});t.find(".tr-filter .compo-number").each(function(){var r=n(this).attr("name");t.find('.tr-filter div[name="'+r+'"]').compoNumber({placeHolder:"Tất cả",selectCallback:function(n){var t={};t[r+"From"]=n.from;t[r+"To"]=n.to;i.search(t)}})});o=null;t.find(".filter-contains").unbind().keyup(function(){var t=n(this).attr("attr"),f=n(this),u=n(this).val(),e=f.attr("data-index"),s=r.rows[e].filter;o!=null&&clearTimeout(o);o=setTimeout(function(){var r,f;s.reload?(r={},r[t]=u,i.loadData(r,function(){},!0)):(f=!1,n(i.filter.attrs).each(function(){this.attr==t&&(this.v=u,f=!0)}),f||i.filter.attrs.push({attr:t,type:"contains",v:u}),i.search());clearTimeout(o)},300)})}n(document).on("click",function(t){var u,r;n(t.target).hasClass("edit-inline")||n(t.target).hasClass("span-edit-inline")||n(t.target).closest(".inline-form").length===0&&(u=n(".areas tr td.editing"),u.length>0&&(r=u.find(".form-control"),i.closeEditInline(r,r.val(),r.attr("data-type"))));n(t.target).hasClass("add-inline")||n(t.target).hasClass("span-add-inline")||n(t.target).closest(".inline-form").length===0&&(u=n(".areas tr td.adding"),u.length>0&&(r=u.find(".form-control"),i.closeAddInline(r,r.val(),r.attr("data-type"))))});n(u).find(".btn-export").unbind().click(function(){var t=r.params.export.url,u=i.searchParams;app.cleanJson(u);t+="?"+n.param(u);window.open(t,"_blank")});n(u).find(".btn-import").unbind().click(function(){n("#importModal").modal("show");i.initImportForm()});n("#import_form").ultraForm({uiType:1,action:"/cb/CbFamilyReduceEdit",actionType:"ajax",props:[{name:"employeeType",type:"hidden"},{name:"type",type:"hidden"},{name:"File",type:"file",option:{uploadFirst:!0},required:{message:"Chọn file cần import"}}],validCallback:function(n){n=app.formDataToJson(n)}});n("a").click(function(){r.group!=null&&r.group.sequentially&&i.sequentially.loading&&i.sequentially.ajax!=null&&i.sequentially.ajax.abort()});n(".th-hide").click(function(){var f,e,a=n(this),h=a.closest("th"),v=parseInt(h.attr("ri")),i=[],c=h.attr("ci"),l,o,u,s;if(c.indexOf("-")>0)for(l=c.split("-"),f=parseInt(l[0]),e=parseInt(l[1]),o=f;o<=e;o++)i.push(o);else i.push(parseInt(c));if(u=t.find(".area-tr colgroup col"),n(u).each(function(){var t=parseInt(n(this).attr("i"));n.inArray(t,i)>=0&&n(this).css("width",2)}),u=t.find(".area-br colgroup col"),n(u).each(function(){var t=parseInt(n(this).attr("i"));n.inArray(t,i)>=0&&n(this).css("width",2)}),h.addClass("hided"),i.length>1)for(s=v+1;s<=r.cols.right.length;s++)u=t.find('.area-tr thead th[ri="'+s+'"]'),n(u).each(function(){var t=n(this).attr("ci"),r;t.indexOf("-")>0?(r=t.split("-"),f=parseInt(r[0]),e=parseInt(r[1]),n.inArray(f,i)>=0&&n.inArray(e,i)>=0&&n(this).addClass("hided")):(t=parseInt(t),n.inArray(t,i)>=0&&n(this).addClass("hided"))})});n(".th-unhide").click(function(){var o,s,f,v=n(this),c=v.closest("th"),l=parseInt(c.attr("ri")),i=[],u=c.attr("ci"),a,h,e;if(u.indexOf("-")>0)for(a=u.split("-"),o=parseInt(a[0]),s=parseInt(a[1]),h=o;h<=s;h++)i.push(h);else i.push(parseInt(u));if(e=t.find(".area-tr colgroup col"),n(e).each(function(){var r=parseInt(n(this).attr("i")),t;n.inArray(r,i)>=0&&(t=n(this).attr("w"),n(this).css("width",t+"px"))}),e=t.find(".area-br colgroup col"),n(e).each(function(){var r=parseInt(n(this).attr("i")),t;n.inArray(r,i)>=0&&(t=n(this).attr("w"),n(this).css("width",t+"px"))}),c.removeClass("hided"),i.length>1)for(f=l+1;f<=r.cols.right.length;f++)e=t.find('.area-tr thead th[ri="'+f+'"]'),n(e).each(function(){if(u=n(this).attr("ci"),u.indexOf("-")>0){var t=u.split("-");o=parseInt(t[0]);s=parseInt(t[1]);n.inArray(o,i)>=0&&n.inArray(s,i)>=0&&n(this).removeClass("hided")}else u=parseInt(u),n.inArray(u,i)>=0&&n(this).removeClass("hided")});if(l>1)for(f=1;f<l;f++)e=t.find('.area-tr thead th[ri="'+f+'"]'),n(e).each(function(){if(u=n(this).attr("ci"),u.indexOf("-")>0){var t=u.split("-");o=parseInt(t[0]);s=parseInt(t[1]);i.length>1?o<=i[0]&&s>=i[i.length-1]&&n(this).removeClass("hided"):o<=i[0]&&i[0]<=s&&n(this).removeClass("hided")}else u=parseInt(u),i.length==1&&u==i[0]&&n(this).removeClass("hided")})});n('[data-toggle="tooltip"]').tooltip({html:!0})},i.initImportForm=function(){},i.reorder=function(){var t;n("#reorder_modal").length==0&&(t='<div class="modal fade" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"><div class="modal-dialog modal-sm" role="document"><div class="modal-content"><\/div><\/div><\/div>')},i.resetGroupPosition=function(){var r=n(u).find("> .hierarchy-table > .main-content"),e=r.find("tr.tr-group"),t=0,f;n(e).each(function(){if(n(this).attr("data-top",t),n(this).hasClass("expanded")){var r=n(this).attr("data-height");t+=parseInt(r)}else t+=i.hr});f=r.find(".area-br > div").scrollTop();i.showData(f)},i.expandChild=function(t,r,u){var f=parseInt(r.attr("groupid")),e=t.find("i"),o=u.find('tr[groupid="'+f+'"]:not(.tr-group)');r.hasClass("expanded")?(o.hide(),r.removeClass("expanded"),e.removeClass("icon-arrow-down5").addClass("icon-arrow-right5")):(o.show(),r.addClass("expanded"),e.removeClass("icon-arrow-right5").addClass("icon-arrow-down5"),i.sourceData.find(n=>n.Id===f).Childs===null&&n.ajax({url:"/home/getStudentDetailListByYear?year="+f,type:"GET",data:i.editParams,dataType:"JSON",success:function(n){var t=i.sourceData.find(n=>n.Id===f);t&&(t.Childs===null&&(t.Childs=[]),t.Childs=t.Childs.concat(n),console.log(i.sourceData))}}));i.showData(0)},i.setRowEvents=function(){var t=n(u).find("> .hierarchy-table > .main-content"),f,e,o,s;t.find(".area-bl tbody tr").each(function(){var i=n(this).height(),f=n(this).attr("dataid"),u=t.find('.area-br tr[dataid="'+f+'"]'),r;u.height()>=i?n(this).css("height",u.height()):n(u).css("height",i);r=t.find('.area-bom tr[dataid="'+f+'"]');r.height()>=i?n(this).css("height",r.height()):n(r).css("height",i)});t.find(".styled").uniform();t.find(".area-bl tr td").unbind().click(function(t){t.target==this&&i.selectRow(n(this).closest("tr"))});t.find(".area-bl tr").unbind().hover(function(){var t=n(this).attr("dataid");n(u).find('.area-br tr[dataid="'+t+'"]').addClass("hover");n(this).addClass("hover");n(this).addClass("hover")},function(){var t=n(this).attr("dataid");n(u).find('.area-br tr[dataid="'+t+'"]').removeClass("hover");n(this).removeClass("hover");n(this).removeClass("hover")});t.find(".area-br tr").unbind().hover(function(){var t=n(this).attr("dataid");n(u).find('.area-bl tr[dataid="'+t+'"]').addClass("hover");n(this).addClass("hover");n(this).addClass("hover")},function(){var t=n(this).attr("dataid");n(u).find('.area-bl tr[dataid="'+t+'"]').removeClass("hover");n(this).removeClass("hover");n(this).removeClass("hover")});t.find(".area-br tr td").unbind().click(function(t){t.target==this&&i.selectRow(n(this).closest("tr"))});t.find(".area td.edit-inline").unbind().click(function(r){var u,f;r.target==this&&(n(this).hasClass("editing")||(u=t.find(".area td.editing > .inline-form .form-control"),u.length>0&&i.closeEditInline(u,u.val(),u.attr("data-type")),n(this).addClass("editing"),f=n(this).find(".form-control"),n(f).is("select")?n(f).trigger("open"):f.focus().select()))});t.find(".area td.edit-inline > span").unbind().click(function(){n(this).closest("td").trigger("click")});t.find('.area td.edit-inline input[type="checkbox"]').unbind().change(function(t){t.target==this&&i.closeEditInline(n(this),n(this).prop("checked"))});t.find(".area td.edit-inline select").unbind().change(function(t){t.target==this&&i.closeEditInline(n(this),n(this).val())});t.find(".area td.add-inline").unbind().click(function(r){var u,f;r.target==this&&(n(this).hasClass("editing")||(u=t.find(".area td.editing > .inline-form .form-control"),u.length>0&&i.closeAddInline(u,u.val()),n(this).addClass("adding"),f=n(this).find(".form-control"),n(f).is("select")?n(f).trigger("open"):f.focus().select()))});t.find(".area td.add-inline > span").unbind().click(function(){n(this).closest("td").trigger("click")});t.find(".btn-expander").unbind().click(function(){var r=n(this),u=r.closest("tr");i.expandChild(r,u,t)});t.find(".expand-child").unbind().click(function(){var t=n(this),a=t.hasClass("expand"),e=t.find("i"),s=t.closest("tr"),f=s.attr("dataid"),h=s.attr("ai"),c,o,l;a?(t.removeClass("expand"),e.removeClass("icon-arrow-down12").addClass("icon-arrow-right13"),i.displayChilds(f,"none",!0),i.displayChilds(f,"none",!1)):(t.addClass("expand"),e.removeClass("icon-arrow-right13"),c=t.hasClass("loaded"),c?(e.addClass("icon-arrow-down12"),i.displayChilds(f,"table-row",!0),i.displayChilds(f,"table-row",!1)):(e.addClass("icon-spinner10 spinner"),o=t.attr("level"),l=r.dataUrl!=null?r.dataUrl:"/api/"+r.model+"List",loadData(l,{parentId:f},null,function(s){var c=s.Many,l,a,v;e.removeClass("icon-spinner10 spinner").addClass("icon-arrow-down12");c!=null&&c.length>0&&r.rows.length>0?(l="Id",r.idAttribute!=null&&(l=r.idAttribute),i.sumarray=[],a=n(u).find('.area-bl tbody tr[dataid="'+f+'"]'),v=n(u).find('.area-br tbody tr[dataid="'+f+'"]'),n.each(c,function(t,r){var u=i.drawRow(r,l,parseInt(o)+1,h+"."+(t+1),!0);n(u).insertAfter(a);a=n(a).next();u=i.drawRow(r,l,parseInt(o)+1,h+"."+(t+1),!1);n(u).insertAfter(v);v=n(v).next()}),i.setRowEvents(),i.sourceData=n.merge(c,i.sourceData)):e.addClass("hide");t.addClass("loaded");r.loadDataCallback!=null&&r.loadDataCallback(s)})))});f=t.find(".area td.edit-inline input");f.unbind();f.keydown(function(){var s=event.keyCode?event.keyCode:event.which,u=n(this).val(),h,f,e,t,o,r;if(s==9)return i.closeEditInline(n(this),u),u=n(this).val(),h=n(this).attr("attr"),o=n(this).closest("td"),e=parseInt(o.attr("i")),f=n(this).closest("tr"),r=f.find("td.edit-inline"),t=null,n(r).each(function(){var i=parseInt(n(this).attr("i"));if(i>e)return t=n(this),!1}),t==null&&(t=r.first()),t.length>0&&(t.addClass("editing"),t.find("input").focus().select()),!1});f.keyup(function(){var c=event.keyCode?event.keyCode:event.which,h=n(this).val(),e,u,o,f,t,r,s;if(!(c>=65)||!(c<=90))switch(c){case 13:case 40:i.closeEditInline(n(this),h);e=n(this).closest("td").attr("i");u=n(this).closest("tr");o=u.closest("body");f=parseInt(u.attr("ai"));t=o.find('tr[ai="'+(f+1)+'"]');t.length==0&&(t=o.find('tr[ai="1"]'));t.length>0&&(r=t.find('td[i="'+e+'"]'),r.length>0&&(r.addClass("editing"),r.find("input").focus().select()));break;case 39:i.closeEditInline(n(this),h);e=n(this).attr("attr");r=n(this).closest("td");f=parseInt(r.attr("i"));u=n(this).closest("tr");s=u.find("td.edit-inline");t=null;n(s).each(function(){var i=parseInt(n(this).attr("i"));if(i>f)return t=n(this),!1});t==null&&(t=s.first());t.length>0&&(t.addClass("editing"),t.find("input").focus().select());break;case 37:i.closeEditInline(n(this),h);e=n(this).attr("attr");r=n(this).closest("td");f=parseInt(r.attr("i"));u=n(this).closest("tr");s=u.find("td.edit-inline");t=null;n(s).each(function(){var i=parseInt(n(this).attr("i"));i<f&&(t=n(this))});t==null&&(t=s.last());t.length>0&&(t.addClass("editing"),t.find("input").focus().select());break;case 38:i.closeEditInline(n(this),h);e=n(this).closest("td").attr("i");u=n(this).closest("tr");o=u.closest("body");f=parseInt(u.attr("ai"));t=o.find('tr[ai="'+(f-1)+'"]');t.length==0&&(t=o.find("tr:not(.tr-total)").last());t.length>0&&(r=t.find('td[i="'+e+'"]'),r.length>0&&(r.addClass("editing"),r.find("input").focus().select()))}});e=t.find(".area td.add-inline input");e.unbind();e.keyup(function(){var t=event.keyCode?event.keyCode:event.which,r=n(this).val();t==13&&i.closeAddInline(n(this))});t.find(".btn-add-row").unbind().click(function(){var u=n(this).attr("groupid"),f=n(this).closest("tr"),t={};t[r.group.attr]=u;i.createOrUpdateObject(t,null,f)});r.contextMenu!=null&&(o=n(u).find("> .context-menu-salary-grid-popup"),t.find('.area-br tr[data-toggle="context"]').unbind().contextmenu({target:o.selector,before:function(t,u){t.preventDefault();i.moveObjectId!=null?this.getMenu().find("li .near").removeClass("disabled"):this.getMenu().find("li .near").addClass("disabled");var e=this.getMenu(),o=n(u).attr("dataid"),f=i.getDataById(o);return n(r.contextMenu).each(function(){var n=e.find("a."+this.class).closest("li"),t;this.enable==null||this.enable(f)?(n.css("display","block"),this.visible==null||this.visible(f)?this=="edit"||this=="delete"?(t=e.find('a[action="edit"], a[action="delete"]'),f.Status!=null&&f.Status>0?t.addClass("disabled"):t.removeClass("disabled")):n.find("a").removeClass("disabled"):n.find("a").addClass("disabled")):n.css("display","none")}),!0},onItem:function(t,r){var u=n(r.currentTarget);u.hasClass("dropdown-submenu")?i.clickSubContextMenu?i.clickSubContextMenu=!1:(i.clickContextMenu(t,r),i.clickSubContextMenu=!0):n(r.target).hasClass("disabled")||i.clickContextMenu(t,r)}}),t.find('.area-bl tr[data-toggle="context"]').unbind().contextmenu({target:o.selector,before:function(t,u){t.preventDefault();i.moveObjectId!=null?this.getMenu().find("li .near").removeClass("disabled"):this.getMenu().find("li .near").addClass("disabled");var e=this.getMenu(),o=n(u).attr("dataid"),f=i.getDataById(o);return n(r.contextMenu).each(function(){var n=e.find("a."+this.class).closest("li");this.enable==null||this.enable(f)?(n.css("display","block"),this.visible==null||this.visible(f)?n.find("a").removeClass("disabled"):n.find("a").addClass("disabled")):n.css("display","none")}),!0},onItem:function(t,r){var u=n(r.currentTarget);u.hasClass("dropdown-submenu")?i.clickSubContextMenu?i.clickSubContextMenu=!1:(i.clickContextMenu(t,r),i.clickSubContextMenu=!0):n(r.target).hasClass("disabled")||i.clickContextMenu(t,r)}}));t.find(".check-group").unbind().click(function(){var u=n(this).attr("groupid"),f=n(this).is(":checked");t.find('.area-bl tr[groupid="'+u+'"] .first-col  input').prop("checked",f);t.find('.area-br tr[groupid="'+u+'"] .first-col  input').prop("checked",f);n.uniform.update();n(i.viewData).each(function(){var t=this;t.gid==u&&n(t.left).each(function(){this.checked=f})});r.selectRowCallback!=null&&r.selectRowCallback()});t.find(".checkAll").unbind().click(function(){var u=n(this).is(":checked");t.find('.area-bl td input[type="checkbox"]').prop("checked",u);t.find('.area-br td input[type="checkbox"]').prop("checked",u);n.uniform.update();n(i.viewData).each(function(){var t=this;t.checked=u;t.left!=null&&t.left.length>0&&n(t.left).each(function(){this.checked=u})});r.selectRowCallback!=null&&r.selectRowCallback()});t.find(".check-item").click(function(){var t=n(this).is(":checked"),r=parseInt(n(this).attr("dataid"));n(i.viewData).each(function(){var i=this;n(i.left).each(function(){this.id==r&&(this.checked=t)})})});r.height.fixHeight!=!0&&(s=t.find(".area-bl tbody tr.tr-child"),s.each(function(){var i=n(this).height(),f=n(this).attr("dataid"),u=t.find('.area-br tr[dataid="'+f+'"]'),r;u.height()>=i?n(this).css("height",u.height()):n(u).css("height",i);r=t.find('.area-bom tr[dataid="'+f+'"]');r.height()>=i?n(this).css("height",r.height()):n(r).css("height",i)}))},i.clearCheckbox=function(){var t=n(u).find("> .hierarchy-table > .main-content");t.find(".checkAll").prop("checked",!1);t.find(".check-group").prop("checked",!1);n.uniform.update()},i.clickContextMenu=function(t,u){var h=n(u.target),s,f,c,o,l,a;h[0].hasAttribute("action")||(h=n(u.target).closest("a"));var e=n(t.context),y=h.attr("action"),v=h.attr("class");switch(y){case"edit":s=n(e).attr("dataid");i.createOrUpdateObject({id:s},function(){},n(e));break;case"delete":s=n(e).attr("dataid");i.deleteObjects("bulk",[s],function(){console.log("reload...");i.loadData()});break;case"move-top":s=n(e).attr("dataid");f=r.editController!=null?r.editController+"/":"/admin/";f+="ChangePriority"+r.model;i.showTableLoading();app.postData(f,{PriorityPosition:"Top",id:s},function(){i.search({},function(){i.hideTableLoading()})});break;case"chose-position":app.notify("info","Chọn vị trí sắp xếp");i.moveObjectId=n(e).attr("dataid");break;case"near-above":f=r.editController!=null?r.editController+"/":"/admin/";f+="ChangePriority"+r.model;i.showTableLoading();app.postData(f,{PriorityPosition:"NearAbove",NearId:n(e).attr("dataid"),id:i.moveObjectId},function(){i.moveObjectId=null;i.loadData({},function(){i.hideTableLoading()})});break;case"near-under":f=r.editController!=null?r.editController+"/":"/admin/";f+="ChangePriority"+r.model;i.showTableLoading();app.postData(f,{PriorityPosition:"NearUnder",NearId:n(e).attr("dataid"),id:i.moveObjectId},function(){i.moveObjectId=null;i.loadData({},function(){i.hideTableLoading()})});break;case"add-child":i.showTableLoading();f=r.editController!=null?r.editController+"/":"/admin/";f+=r.model+"Edit";n.extend(i.editParams,{parentId:e.attr("dataid"),id:null});n.ajax({url:f,type:"GET",data:i.editParams,dataType:"html",success:function(n){i.hideTableLoading();i.initModal({title:"Thêm "+r.modal.title.toLowerCase(),width:r.modal.width,type:r.modal.type!=null?r.modal.type:1,mode:m.mode},n);i.eventModal();i.showModal();r.loadModalCallback!=null&&r.loadModalCallback(e)}});break;case"custom":for(c=0;c<r.contextMenu.length;c++)if(o=r.contextMenu[c],v==o.class){if(o.click!=null)return o.click(e),!1}else if(o.childs!=null)for(l=0;l<o.childs.length;l++)if(a=o.childs[l],v==a.class&&a.click!=null)return a.click(e),!1}},i.updateRowValue=function(t,u,f){var l=t.attr("dataid"),s=i.getDataById(l),h,e;for(console.log(s),s[u]=f,h=0;h<r.rows.length;h++)if(e=r.rows[h],e.formula!=null){var f=e.formula(s),o=f,c=t.find('td[data-attr="'+e.attribute+'"]');o=e.fixed!=null?o.toFixed(e.fixed):Math.round(o);o=e.type=="price"?app.formatPrice(o):o;c.attr("data-val",f);n(c.find("span")).text(o);n(c.find("input")).val(o);s[e.attribute]=f}return i.setDataById(s,null),s},i.updateGroupValue=function(t){var s=parseInt(t.attr("groupid")),c=n(u).find('.area-br tr.tr-group[groupid="'+s+'"]'),h=[],f,e,o;for(n(i.sourceData).each(function(){this[r.group.attr]==s&&h.push(this)}),f=r.skipCols;f<r.rows.length;f++)e=r.rows[f],e.sumable&&(o=0,n(h).each(function(){var t=this[e.attribute];app.hasValue(t)&&n.isNumeric(t)&&(o+=parseFloat(t))}),c.find('td[data-attr="'+e.attribute+'"] span').text(app.formatPrice(o)))},i.updateTotalRow=function(){for(var t,u,f=0;f<r.rows.length;f++)t=r.rows[f],t.sumable&&(u=0,n(i.sourceData).each(function(){var n=this,i=parseFloat(n[t.attribute]);u+=i}),u=t.fixed!=null?u.toFixed(t.fixed):app.formatPrice(Math.round(u)),n('.tr-total td[data-attr="'+t.attribute+'"] strong').text(u))},i.setDataById=function(n,t){t==null&&(t=i.sourceData);for(var r=0;r<t.length;r++){if(t[r].Id==n.Id){t[r]=n;return}t[r].Childs!=null&&i.setDataById(n,t[r].Childs)}},i.closeEditInline=function(t,u){var e=t.closest("tr"),v=parseInt(e.attr("dataid")),h=t.attr("attr"),c=t.attr("data-type"),l=t.closest("td"),a,f,o,s;c=="price"&&(n.isNumeric(u)?(u=u.replace(/,/g,""),u=parseFloat(u),a=parseInt(n(l).attr("ci")),f=r.rows[a],f.min!=null&&u<f.min&&(u=f.min),f.max!=null&&u>f.max&&(u=f.max),t.val(u)):(u="0",t.val(u)));l.removeClass("editing");n(i.sourceData).each(function(){this.Id==v&&(this[h]=u)});o=i.updateRowValue(e,h,u);r.group!=null&&r.group.sumable&&i.updateGroupValue(e);i.updateTotalRow();s=r.editController!=null?r.editController+"/":"/admin/";s+=r.model+"EditRow";r.params.edit!=null&&n.extend(o,r.params.edit);n(i.editLoader).show();app.postData(s,o,function(){var r,f;n(i.editLoader).hide();r=t.closest("td");n(t).is("select")?(f=t.find(" option:selected").text(),r.find("> span").text(f)):(c=="price"&&(u=app.formatPrice(u)),r.find("> span").text(u));r.removeClass("editing")})},i.closeAddInline=function(t){var o=t.val(),c=t.attr("attr"),l=t.closest("tr"),u=parseInt(l.attr("groupid")),s=parseInt(t.attr("stt")),h=t.closest("td"),e,f;o.length>0?(e=r.editController!=null?r.editController+"/":"/admin/",e+=r.model+"addRow",f={stt:s+1},f[c]=o,f[r.relateId]=u,r.params.add!=null&&n.extend(f,r.params.add),n(t).prop("disabled",!0),n(i.editLoader).show(),app.postData(e,f,function(r){if(n(i.editLoader).hide(),r.Success){var f=r.Data,e=n(".area-bl table tbody"),o=n(".area-br table tbody");n(i.sourceData).each(function(){var t,r,s;this.Id==u&&(t=i.drawRow(f,"Id",this.Childs.length+1,u),this.Childs.length>0?(r=e.find('.tr-child.tr-real[groupid="'+u+'"]').last(),s=o.find('.tr-child.tr-real[groupid="'+u+'"]').last(),n(r).after(t.left),n(s).after(t.right)):(r=e.find('.tr-group[groupid="'+u+'"]'),s=o.find('.tr-group[groupid="'+u+'"]'),n(r).after(t.left),n(s).after(t.right)),this.Childs.push(f))});n(t).attr("stt",s+1)}else app.notify("warning",r.Message);n(t).val("").prop("disabled",!1);h.removeClass("adding");i.setRowEvents()})):h.removeClass("adding")},i.displayChilds=function(t,r,f){var e=f?n(u).find("> .hierarchy-table > .main-content .area-bl tr"):n(u).find("> .hierarchy-table > .main-content .area-br tr");e.each(function(){var u=n(this).attr("parent");u==t&&(n(this).css("display",r),i.displayChilds(n(this).attr("dataid"),r,f))})},i.bulkDelete=function(n){var t=i.getSelectedIds();t.length>0?i.deleteObjects("bulk",t,n):app.confirm("info","Vui lòng chọn đối tượng cần xóa",null,null)},i.deleteObjects=function(t,i,f){app.confirm("warning",null,i.length+" đối tượng được chọn để xóa.",function(){var e=r.editController!=null?r.editController:"/admin";t=="bulk"?app.postData(e+"/delete"+r.model+"ByIds",{ids:i},function(){f!=null&&f()}):n.ajax({url:e+"/delete"+r.model,type:"POST",data:{model:r.model,id:i[0]},success:function(){typeof webaby!="undefined"&&webaby.hideModalLoading();n("#deleteModal").modal("hide");f!=null&&f()}});n(u).find(".checkAll").prop("checked",!1);n.uniform.update()})},i.setSubData=function(){},i.selectRow=function(t){var i=t.attr("dataid");t.hasClass("active")?(n(u).find('.area-bl tr[dataid="'+i+'"]').removeClass("active"),n(u).find('.area-br tr[dataid="'+i+'"]').removeClass("active"),n(u).find('.area-bom tr[dataid="'+i+'"]').removeClass("active")):(n(u).find(".area-bl tr.active").removeClass("active"),n(u).find('.area-bl tr[dataid="'+i+'"]').addClass("active"),n(u).find(".area-br tr.active").removeClass("active"),n(u).find('.area-br tr[dataid="'+i+'"]').addClass("active"),n(u).find(".area-bom tr.active").removeClass("active"),n(u).find('.area-bom tr[dataid="'+i+'"]').addClass("active"),r.selectRowCallback!=null&&r.selectRowCallback(t))},i.resize=function(){var t=null,e;app.hasValue(r.width.fix)&&(t=r.width.fix);var o=n(window).height(),f=o-r.height.top,s=n(u).find("> .hierarchy-table");s.css("height",f);i.setMainTableHeight(f);t==null&&i.setMainTableWidth();i.initData&&(e=n(u).find(".area-br > div").scrollTop(),i.showData(e))},i.setMainTableWidth=function(){var t=n(u).find("> .hierarchy-table > .main-content .area-tr"),s=n(u).find("> .hierarchy-table > .main-content .area-br"),r=t.find("> div").width(),f=parseInt(t.find("table").attr("data-w")),e=t.find("table > colgroup col").last(),o=s.find("table > colgroup col").last(),i;r>=f?(i=r-f-19,e.css("width",i),o.css("width",i)):(e.css("width",0),o.css("width",0))},i.setMainTableHeight=function(t){var f=r.head.height!=null?r.head.height:32,i;r.filterable&&(f+=37);i=n(u).find("> .hierarchy-table > .main-content");i.css("height",t);i.find("> .areas").css("height",t);i.find("> .areas .area-bl").css("height",t-f-18);i.find("> .areas .area-bl > div").css("height",t-f-2);i.find("> .areas .area-br").css("height",t-f-1);i.find("> .areas .area-br > div").css("height",t-f-2)},i.initTable=function(){var it,o,g,et,ot,c,ut,ft,k,t,b,rt,s,a,l,v,st;r.height.row!=null&&(i.hr=r.height.row);var h=r.skipCols,nt=r.group,ht=n(window).height(),tt="",y="",p=0,w=0,f,d,e=n('<div class="hierarchy-table  '+(r.border?"bordered":"")+" "+(r.evenColor?"even-color":"")+'"><\/div>');if(app.hasValue(r.height.fix)?e.css("height",r.height.fix):e.css("height",ht-r.height.top),e.append('<div class="main-content"><div class="areas '+(h>0?"has-left":"")+'"><span class="empty-message" style="display: none">Không tìm thấy dữ liệu phù hợp<\/span><\/div><\/div>'),n(u).append(e),it=r.head.height!=null?r.head.height:32,r.filterable&&(it+=37),o=n('<div class="area area-tl" style="height: '+it+'px"><div><\/div><\/div>'),h>0){for(e=n('<table class="table table-bordered"><\/table>'),tt=n("<colgroup><\/colgroup>"),p=0,(r.checkAll==null||r.checkAll)&&(tt.append('<col style="width: 40px">'),p+=40,h--),s=0;s<h;s++)tt.append('<col style="width: '+r.head.groups[s]+'px">'),p+=r.head.groups[s];for(e.css("width",p).append(tt.html()),f="<thead>",h=r.skipCols,d=r.cols.left,l=0;l<d.length;l++){for(g=d[l],f+="<tr>",l==0&&(r.checkAll==null||r.checkAll)&&(f+='<th rowspan="'+d.length+'" style="height: 31px"><div class="checkbox"><input type="checkbox" class="styled checkAll" /><label><\/label><\/div><\/th>',h--),k=0;k<g.length;k++)t=g[k],(t.visible==null||t.visible())&&(f+="<th ",t.rowspan!=null&&(f+=' rowspan="'+t.rowspan+'" '),t.colspan!=null&&(f+=' colspan="'+t.colspan+'" '),f+=' style="',t.style!=null&&(f+=t.style+"; "),f+='"',b="",t.class!=null&&(b+=t.class),t.color!=null&&(b+=" hc-"+t.color+" "),f+=t.sort!=null?'class="'+b+' orderable" orderby="'+t.sort+'" currentOrder="desc">':'class="'+b+'" >',f+=t.render!=null?t.render():t.title!=null?t.title:"&nbsp;",f+=(t.sort!=null?'<i style="margin-left:5px;" class="fa fa-caret-down"><\/i>':"")+"<\/th>");f+="<\/tr>"}f+="<\/thead>";e.append(f);r.filterable&&(et=i.rowFilter(!0),e.append("<tbody>"+et+"<\/tbody>"));o.css("width",p+1).find("> div").append(e)}for(n(u).find(".areas").append(o),ot=n(window).width(),o=n('<div class="area area-bl" style="width:'+(p+(ot>375?19:1)-3)+'px"><\/div>'),o.append('<div><table class="table table-bordered table-hover" style="width:'+p+'px"><\/table><\/div>'),o.find("table").append(tt),c="<tbody>",nt!=null?(ut=0,n(nt.data).each(function(){var n=this,t=0,u,f;t=i.hr*n.totalChild;u=ut+t+i.hr;c+='<tr class="tr-group expanded '+(n.class!=null?n.class:"")+'" groupid="'+n.id+'"  data-p1="'+ut+'" data-p2="'+u+'"><td colspan="'+(r.checkAll==null||r.checkAll?h+1:h)+'" class="'+(n.class!=null?n.class:"")+'" style="height:'+i.hr+'px">';c+="<div>";r.checkAll&&(c+='<div class="checkbox"><input type="checkbox" class="styled check-group" groupid="'+n.id+'" /><label><\/label><\/div>');c+='<button class="btn btn-icon btn-xs btn-expander"><i class="icon-arrow-down5"><\/i><\/button> ';c+=nt.render!=null?nt.render(n):this.text;nt.addable&&(c+='<button class="btn btn-icon btn-xs btn-add-row bg-primary" groupid="'+n.id+'" type="button"><i class="icon-plus3"><\/i><\/button>');c+="<\/div><\/td><\/tr>";c+='<tr class="tr-group-overload tr-group-overload-top"  groupid="'+n.id+'" style = "display: none"><td style="height: 0px">&nbsp;<\/td><\/tr>';c+='<tr class="tr-group-overload tr-group-overload-bot"  groupid="'+n.id+'" '+(n.totalChild==0?'style="display: none"':"")+'><td style="height: '+t+'px">&nbsp;<\/td><\/tr>';f={gid:n.id,active:!0,left:[],right:[],count:n.totalChild,loaded:!1};i.viewData.push(f);ut+=t+i.hr})):i.viewData.push({active:!0,gid:0,left:[],right:[],count:0,loaded:!1}),c+="<\/tbody>",o.find("table").append(c),n(u).find(".areas").append(o),ft=r.optionMenu!=null&&browser=="Wap",h=r.skipCols,o=n('<div class="area area-tr" style="left: '+p+"px; height: "+it+"px; "+(ft?"right: 35px;":"")+'"><div><\/div><\/div>'),e=n('<table class="table table-bordered"><\/table>'),y=n("<colgroup><\/colgroup>"),w=0,(r.checkAll==null||r.checkAll)&&(h==0?(y.append('<col style="width: 40px">'),w+=40):h--),s=h;s<r.head.groups.length;s++)y.append('<col i="'+s+'" w="'+r.head.groups[s]+'" style="width: '+r.head.groups[s]+'px">'),w+=r.head.groups[s];for(y.append("<col>"),e.attr("data-w",w).css("width",+w+"px").append(y),f="<thead>",h=r.skipCols,d=r.cols.right,l=0;l<d.length;l++){for(g=d[l],f+="<tr>",k=0;k<g.length;k++)t=g[k],(t.visible==null||t.visible())&&(f+="<th ",t.rowspan!=null&&(f+=' rowspan="'+t.rowspan+'" '),t.colspan!=null&&(f+=' colspan="'+t.colspan+'" '),f+=' style="',t.style!=null&&(f+=t.style+"; "),f+='"',b="",t.class!=null&&(b+=t.class),t.color!=null&&(b+=" hc-"+t.color+" "),f+='class="'+b+'" ri="'+(l+1)+'" ci="'+t.ci+'" >',t.note!=null&&(f+='<span class="th-tooltip"><i class="icon-info22" data-toggle="tooltip" data-placement="bottom" title="'+t.note+'"><\/i><\/span>'),f+='<span class="title ell">',rt="",rt=t.render!=null?t.render():t.title!=null?t.title:"&nbsp;",f+=rt,r.hideable&&(f+='<\/span><span class="th-hide" i="" data-toggle="tooltip" data-placement="right" title="Ẩn cột '+rt+'" ><i class="icon-shrink7"><\/i><\/span><span class="th-unhide" i=""  data-toggle="tooltip" data-placement="right" title="Bỏ ẩn cột '+rt+'"><i class="icon-enlarge7"><\/i><\/span>'),f+="<\/th>");f+="<th>&nbsp;<\/th>";f+="<\/tr>"}for(f+="<\/thead>",e.append(f),r.filterable&&e.append("<tbody>"+i.rowFilter(!1)+"<\/tbody>"),o.find("> div").append(e),n(u).find(".areas").append(o),h=r.skipCols,o=n('<div class="area area-br" style="left: '+p+"px;"+(ft?"right: 35px;":"")+'"><div><\/div><\/div>'),e=n('<table class="table table-bordered table-hover"><\/table>'),y=n("<colgroup><\/colgroup>"),w=0,(r.checkAll==null||r.checkAll)&&(h==0?(y.append('<col style="width: 40px" w="40">'),w+=40):h--),i.colRight=r.head.groups.length-h,s=h;s<r.head.groups.length;s++)y.append('<col i="'+s+'" w="'+r.head.groups[s]+'" style="width: '+r.head.groups[s]+'px">'),w+=r.head.groups[s];if(y.append("<col>"),c="<tbody>",c+="<\/tbody>",e.css("width",+w+"px").append(y).append(c),o.find("> div").append(e),n(u).find(".areas").append(o),r.optionMenu!=null&&browser=="Wap"&&(o=n('<div class="area area-tom" style="right: 0; height: '+it+'px"><div><\/div><\/div>'),e=n('<table class="table"><colgroup><col style="width: 40px" /><\/colgroup><thead><th style="height: 30px">&nbsp;<\/th><\/thead><\/table>'),r.filterable&&e.append('<tbody><tr class="tr-filter"><td><\/td> <\/tr><\/tbody>'),o.find("> div").append(e),n(u).find(".areas").append(o),o=n('<div class="area area-bom" style="right: 0; top: 63px"><div><\/div><\/div>'),e=n('<table class="table table-bordered"><tbody><\/tbody><\/table>'),o.find("> div").append(e),n(u).find(".areas").append(o)),n(u).find(".areas").append('<span class="buffer-bl" style="width: '+p+'px"><\/span>'),r.contextMenu!=null){for(a='<div class="context-menu-salary-grid-popup"><ul class="dropdown-menu">',l=0;l<r.contextMenu.length;l++){v=r.contextMenu[l];switch(v){case"edit":a+='<li><a href="#" action="edit"><i class="icon-pencil7 position-left"><\/i>Cập nhật<\/a><\/li>';break;case"delete":a+='<li><a href="#" action="delete"><i class="icon-x position-left"><\/i>Xóa<\/a><\/li> ';break;case"add-child":a+='<li><a href="#" action="add-child"><i class="icon-stack-plus position-left"><\/i>Thêm cấp con<\/a><\/li> ';break;case"-":a+='<li class="divider" ><\/li>';break;default:v.childs!=null?(a+='<li class="dropdown-submenu dropdown-submenu-hover">',a+='<a href="#"><i class="'+v.icon+' position-left" ><\/i>'+v.text+"<\/a>",a+='<ul class="dropdown-menu">',n.each(v.childs,function(){a+='<li> <a href="#"  action="custom" class="'+this.class+'">'+this.text+"<\/a><\/li> "}),a+="<\/ul>",a+="<\/li>"):a+='<li><a href="#" title="'+v.text+'" action="custom" class="'+v.class+'">'+(v.icon!=null?'<i class="'+v.icon+'"><\/i>':"")+v.text+"<\/a><\/li> "}}a+="<\/ul> <\/div>";n(u).append(a)}i.setStaticEvents();r.data!=null?(st=n(u).find("> .hierarchy-table > .main-content"),i.setViewData(r.data,!0),i.sortai(),i.setRowPositions(),i.showData(0),i.set.sumInfo!=null&&i.drawSuminfo(st)):(console.log(r.autoLoad),r.autoLoad!=!1&&i.loadData())},i.initTable(),this}})(jQuery)