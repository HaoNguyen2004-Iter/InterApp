function optimizeStr(n){return n!=null&&n.length>0&&(n=n.replace(new RegExp("\n","g"),""),n=n.replace(new RegExp(" ","g"),"")),n}function replaceCongThucDo(n,t,i){var r=i.X,u,f;switch(t){case 1:case 2:case 3:r=r.indexOf(".")>=0?parseFloat(r):app.formatPrice(r);n=n.replace(/\Kế hoạch/g,r);break;case 4:r=r.indexOf(".")>=0?parseFloat(r):app.formatPrice(r);n=n.replace(/\Kế hoạch/g,r);n=n.replace(/ số %/g,i.Y+"%");break;case 5:n=n.replace("dd/mm/yyyy",r);n=n.replace(/ số %/g,i.Y+"%");break;case 7:case 8:case 9:case 14:u=app.formatPrice(i.X);f=app.formatPrice(i.Y);n=n.replace(/\Kế hoạch/g,u);n=n.replace(/\Min/g,f);break;case 11:case 12:case 13:u=app.formatPrice(i.X);f=app.formatPrice(i.Y);n=n.replace(/\Kế hoạch/g,u);n=n.replace(/\Max/g,f)}return n}function tinhCongThucDo(n,t){var i="";return $(formulas).each(function(){if(this.Id==t){var r=replaceCongThucDo(this.Formula,t,n);r=app.replaceBrToNewLine(r);i=r}}),i}function CheckTyLe(n){if(n!=null&&n!=""){if(n=n.replace(/[^0-9\.\-]/g,""),n!=""){if($.isNumeric(n)&&n.indexOf(".")!=n.length-1){var t=0,i=n.split(".");i.length==2&&(t=i[1].length);n=parseFloat(n).toFixed(t);n>100&&(n=100)}n+="%"}return n}return""}function CheckKeHoachX(n,t){var i,u,r;return t=t+"",t!=null&&t!=""&&(n==5?t=="0"||isValidDate(t)||(t=""):(t=t.replace(/[^0-9\.\-]/g,""),t!=""&&(i=t.split("."),i.length>2&&(t=i[0]+"."+i[1]),t.indexOf(".")==0&&(t="0"+t),u=t.indexOf("."),$.isNumeric(t)&&u>=0&&u!=t.length-1&&(r=0,i.length>=2&&(t=parseFloat(i[0]+"."+i[1]),r=i[1].length,i[1].length>3&&(r=3),r==0&&(r=1)),t=parseFloat(t).toFixed(r))))),t}function isValidThucHien(n,t){t=t+"";var i=!0;return t!=null&&t!=""?n==5?t=="0"||isValidDate(t)||(i=!1):$.isNumeric(t)||(i=!1):i=!1,i}function CheckKeHoachY(n,t){var i,r;return t=t+"",t!=null&&t!=""&&(t=t.replace(/[^0-9\.\-]/g,""),t!=""&&(i=t.split("."),i.length>2&&(t=i[0]+"."+i[1]),$.isNumeric(t)&&t.indexOf(".")>=0&&(t.indexOf(".")==0&&(t="0"+t),r=0,i.length>=2&&(t=parseFloat(i[0]+"."+i[1]),r=i[1].length,i[1].length>3&&(r=3),r==0&&(r=1)),t=parseFloat(t).toFixed(r)))),t}function Round(n){var t=n.toFixed(2),i;return t.indexOf(".")>=0&&(i=t.split("."),i[1]=="00")?i[0]:t}function isValidDate(n){var t=n.split("/"),i;return $.isNumeric(t[0])&&$.isNumeric(t[1])&&$.isNumeric(t[2])&&t[2].length==4?(i=new Date(t[2]+"/"+t[1]+"/"+t[0]),!!(i&&i.getMonth()+1==t[1]&&i.getDate()==Number(t[0]))):!1}function tinhTyLeHoanThanh(n,t,i,r){var u,o,f,s;if(r+="",t+="",r!=""&&r!=null&&t!=null&&t!="")switch(n){case 1:return t=parseFloat(t),r>=t?"100%":"0%";case 2:return t=parseFloat(t),r<=t?"100%":"0%";case 3:return t=t.indexOf("%")>=0?parseFloat(t.replace("%","")):parseFloat(t),r=r+"",r=r.indexOf("%")>=0?parseFloat(r.replace("%","")):parseFloat(r),r>=t?"100%":(o=r>0?r/t*100:0,o>0?o.toFixed(2)+"%":"0%");case 4:return i==null&&(i=0),i=parseFloat(i),r=parseInt(r),f=t>0?t-r:r-t,u=f>0?100-f*i:100,u<0&&(u=0),u>0?u.toFixed(2)+"%":"0%";case 5:if(r=="0")return"0%";if(r=optimizeStr(r),isValidDate(t)&&isValidDate(r)){var h=moment(t,"DD/MM/YYYY"),e=moment(r,"DD/MM/YYYY"),f=e.diff(h,"days");if(f<=0)return"100%";for(app.hasValue(holidays)||(holidays=[]),typeof nt7=="undefined"&&(nt7=!1);e>h;)s=e.format("d"),s==6?nt7||f--:s==0?f--:$(holidays).each(function(){var n=moment(this.Date);n.diff(e,"days")==0&&f--}),e=e.subtract(1,"days");return(i==null&&(i=0),i=parseFloat(i),u=100-f*i,u<0&&(u=0),u>=0)?u.toFixed(2)+"%":"0%"}return"";case 7:return t=parseFloat(t),i=parseFloat(i),u=r>=t?100:t>r&&r>=i?50:0,u+"%";case 8:return t=parseFloat(t),i=parseFloat(i),r>=t?u=100:t>r&&r>=i?(u=r/t*100,u=u.toFixed(2)):u=0,u+"%";case 9:return t=parseFloat(t),i=parseFloat(i),r>=t?u=100:t>r&&r>=i?(u=r/t*50,u<0&&(u=0),u=u.toFixed(2)):u=0,u+"%";case 11:return t=parseFloat(t),i=parseFloat(i),u=r<=t?100:t<r&&r<=i?50:0,u.toFixed(2)+"%";case 12:return t=parseFloat(t),i=parseFloat(i),r<=t?u=100:t<r&&r<=i?(u=100-(r-t)/t*100,u<0&&(u=0),u=u.toFixed(2)):u=0,u+"%";case 13:return t=parseFloat(t),i=parseFloat(i),r<=t?u=100:t<r&&r<=i?(u=(100-(r-t)/t*100)/2,u<0&&(u=0),u=u.toFixed(2)):u=0,u+"%";case 14:return t=parseFloat(t),i=parseFloat(i),r>=t?u=100:t>r&&r>=i?(u=parseFloat(r),u=u.toFixed(2)):u=0,u+"%"}return""}function tinhTyLeTrongSo(n,t){if(n!=null&&n!=""&&t!=null&&t!=""){var r=parseFloat(n.substr(0,n.length-1)),u=parseFloat(t.substr(0,t.length-1)),i=u*r/100;return i=i>0?i.toFixed(2):"0",i+"%"}return"0%"}function getGTPT(n){return n!=null&&n.indexOf("%")>=0?parseFloat(n.substr(0,n.length-1)):0}function confirmKhongDuyet(n,t,i){var r=app.newGuid(10);swal({title:"Không đồng ý duyệt",text:'<p>Anh/Chị vui lòng cho biết lý do không đồng ý duyệt<\/p><textarea rows="8" id="confirm_'+r+'" class="form-control" placeHolder="Lý do không đồng ý duyệt"><\/textarea>',html:!0,showCancelButton:!0,closeOnConfirm:!1,confirmButtonColor:"#ff5722",cancelButtonText:"Để sau",confirmButtonText:"Hoàn tất",showLoaderOnConfirm:!0},function(u){if(u){var f=$("#confirm_"+r).val();if(f==="")return swal.showInputError("Anh/Chị vui lòng nhập lý do không đồng ý duyệt !"),!1;t.lyDoKhongDuyet=f;app.postData(n,t,function(n){n.Success?swal({title:"Thao tác thành công",type:"success"},function(){i!=null&&i(!0)}):(swal(n.Message,"","error"),i!=null&&i(!1))})}})}function confirmDuyet(n,t,i){var r=app.newGuid(10);swal({title:"Đồng ý duyệt",text:'<p>Nhập ý kiến của Anh/Chị (nếu có)<\/p><textarea rows="8" id="confirm_'+r+'" class="form-control" placeHolder="Nhập ý kiến của Anh/Chị (nếu có)"><\/textarea>',html:!0,showCancelButton:!0,closeOnConfirm:!1,confirmButtonColor:"#009688",cancelButtonText:"Để sau",confirmButtonText:"Duyệt",showLoaderOnConfirm:!0},function(u){if(u){var f=$("#confirm_"+r).val();t.yKien=f;app.postData(n,t,function(n){n.Success?swal({title:"Duyệt thành công",type:"success"},function(){i!=null&&i(!0)}):(swal(n.Message,"","error"),i!=null&&i(!1))})}})}function confirmCapNhat(n,t,i,r){swal({title:"Anh/Chị chắc chắn ?",html:!0,showCancelButton:!0,closeOnConfirm:!1,confirmButtonColor:"#ff8a65",cancelButtonText:"Để sau",confirmButtonText:"Đề xuất cập nhật",showLoaderOnConfirm:!0},function(t){t&&app.postData(n,i,function(n){n.Success?r!=null&&r(!0):(swal(n.Message,"","error"),r!=null&&r(!1))})})}function confirmComment(n,t,i){var r=app.newGuid(10);swal({title:"Ý kiến người phụ trách",text:'<p>Nhập ý kiến của Anh/Chị<\/p><textarea rows="8" id="confirm_'+r+'" class="form-control" placeHolder="Nhập ý kiến của Anh/Chị (nếu có)"><\/textarea>',html:!0,width:"600px",customClass:"sweet-alert-lg",showCancelButton:!0,closeOnConfirm:!1,confirmButtonColor:"#00bcd4",cancelButtonText:"Để sau",confirmButtonText:"Lưu ý kiến",showLoaderOnConfirm:!0},function(u){if(u){var f=$("#confirm_"+r).val();if(f==="")return swal.showInputError("Anh/Chị vui lòng nhập ý kiến"),!1;t.yKien=f;app.postData(n,t,function(n){n.Success?swal({title:"Duyệt thành công",type:"success"},function(){i!=null&&i(!0)}):(swal(n.Message,"","error"),i!=null&&i(!1))})}})}function toolbarEvents(){}function xepLoaiKPI(n){if(app.hasValue(n)){var t=getGTPT(n);return t>=95?"A+":t>=90?"A":t>=85?"B+":t>=80?"B":t>=75?"C+":t>=70?"C":"D"}return""}function uploadDinhKem(n,t){var u=$(n).closest(".uploader"),i=u.find(".btn i"),r;i.removeClass("icon-file-plus").addClass("icon-spinner4 fa-spin ");r=n.files;(kpiUploader==null||typeof kpiUploader=="undefined")&&(kpiUploader=new FileUploader);kpiUploader.upload(r,["jpg","jpeg","png","gif","txt","pdf","xls","xlsx","doc","docx","ppt","pptx"],function(n){i.removeClass("icon-spinner4 fa-spin").addClass("icon-file-plus");n.length>0&&n[0]!=null?t(n):(app.notify("warning","Định dạng file không hợp lệ. <\/br> Định dạng cho phép: txt, pdf, xls, xlsx, doc, docx, ppt, pptx"),t([]))})}function initPhuongPhapDoModal(n,t,i,r){var u="#edit_muctieu_modal";$(u).length==0?app.loadData(DOMAIN_API+"/kpi/PhuongPhapDoView",{dataType:"html"},null,function(f){$("body").append(f);$(u).modal("show");initPhuongPhapDoForm(n,t,i);r!=null&&r()}):($(u).modal("show"),initPhuongPhapDoForm(n,t,i),r!=null&&r())}function tinhTyLeHoanThanhNam(n){var r,l=n.X,f=0,h,c,u,o,t,i,s,e;switch(n.NguyenTacTinh){case 1:for(u=0,r=0,t=0;t<model.Quarters.length;t++)i=model.Quarters[t],e=getGTPT(n["Quy"+i+"_TrongSo"]),e>0&&u++;for(t=0;t<model.Quarters.length;t++)i=model.Quarters[t],i<=n.quy&&(h=n["Quy"+i+"_TyLeHoanThanh"],h!=""&&h!=null&&(c=getGTPT(h),r+=c));return u>0&&(f=r/u),f;case 2:r=tinhTyLeHoanThanh(n.PhuongPhapDo,n.Nam_KeHoach,n.Y,n.Nam_ThucHien);f=getGTPT(r);break;case 3:for(r=tinhTyLeHoanThanh(n.PhuongPhapDo,n.Nam_KeHoach,n.Y,n.Nam_ThucHien),u=0,o=0,t=0;t<model.Quarters.length;t++)i=model.Quarters[t],i<n.quy?(e=getGTPT(n["Quy"+i+"_TrongSo"]),e>0&&o++):i==n.quy&&(s=n["Quy"+i+"_ThucHien"],s!=""&&s!=null&&o++);for(t=0;t<model.Quarters.length;t++)i=model.Quarters[t],e=getGTPT(n["Quy"+i+"_TrongSo"]),e>0&&u++;u>0&&(r=getGTPT(r),f=r/u*o);break;case 4:r=tinhTyLeHoanThanh(n.PhuongPhapDo,n.Nam_KeHoach,n.Y,n.Nam_ThucHien);f=getGTPT(r);break;case 5:for(r=tinhTyLeHoanThanh(n.PhuongPhapDo,n.Nam_KeHoach,n.Y,n.Nam_ThucHien),u=0,o=0,t=0;t<model.Quarters.length;t++)i=model.Quarters[t],i<n.quy?o++:i==n.quy&&(s=n["Quy"+i+"_ThucHien"],s!=""&&s!=null&&o++);for(t=0;t<model.Quarters.length;t++)i=model.Quarters[t],e=getGTPT(n["Quy"+i+"_TrongSo"]),e>0&&u++;u>0&&(r=getGTPT(r),f=r/u*o)}return f>100&&(f=100),f}function tinhThucHienNam(n){var r="",t,i=ko.toJS(n),o=i.quy,a,v,c,s,u,f,l,e,h;if(i.PhuongPhapDo==5)return a=moment(i.Nam_KeHoach,"DD/MM/YYYY"),v=a.quarter(),i.Quy4_TrongSo!="0%"&&app.hasValue(i.Quy4_ThucHien)?r=i.Quy4_ThucHien:i.Quy3_TrongSo!="0%"&&app.hasValue(i.Quy3_ThucHien)?r=i.Quy3_ThucHien:i.Quy2_TrongSo!="0%"&&app.hasValue(i.Quy2_ThucHien)?r=i.Quy2_ThucHien:i.Quy1_TrongSo!="0%"&&app.hasValue(i.Quy1_ThucHien)&&(r=i.Quy1_ThucHien),r;switch(i.NguyenTacTinh){case 1:for(c=0,u=0;u<model.Quarters.length;u++)f=model.Quarters[u],t=i["Quy"+f+"_ThucHien"],app.hasValue(t)&&$.isNumeric(t)&&t.indexOf(".")!=t.length-1&&(c+=parseFloat(t));for(s=0,u=0;u<model.Quarters.length;u++)f=model.Quarters[u],f<i.quy?s++:f==i.quy&&(l=i["Quy"+f+"_ThucHien"],l!=""&&l!=null&&s++);return r=c/s,r.toFixed(2);case 2:case 3:if(e=[],i.Quy4_TrongSo!="0%"&&app.hasValue(i.Quy4_ThucHien)&&(t=i.Quy4_ThucHien,$.isNumeric(t)&&t.indexOf(".")!=t.length-1&&e.push(parseFloat(t))),i.Quy3_TrongSo!="0%"&&app.hasValue(i.Quy3_ThucHien)&&(t=i.Quy3_ThucHien,$.isNumeric(t)&&t.indexOf(".")!=t.length-1&&e.push(parseFloat(t))),i.Quy2_TrongSo!="0%"&&app.hasValue(i.Quy2_ThucHien)&&(t=i.Quy2_ThucHien,$.isNumeric(t)&&t.indexOf(".")!=t.length-1&&e.push(parseFloat(t))),i.Quy1_TrongSo!="0%"&&app.hasValue(i.Quy1_ThucHien)&&(t=i.Quy1_ThucHien,$.isNumeric(t)&&t.indexOf(".")!=t.length-1&&e.push(parseFloat(t))),e.length>0){for(r=0,h=0;h<e.length;h++)r+=e[h];return r}case 4:if(t=i["Quy"+o+"_ThucHien"],app.hasValue(t))r=t;else for(u=0;u<model.Quarters.length;u++)f=model.Quarters[u],f<o&&(t=i["Quy"+f+"_ThucHien"],app.hasValue(t)&&(r=t));return r;case 5:if(t=i["Quy"+o+"_ThucHien"],app.hasValue(t))r=t;else for(u=0;u<model.Quarters.length;u++)f=model.Quarters[u],f<o&&(t=i["Quy"+f+"_ThucHien"],app.hasValue(t)&&(r=t));return r}return""}var disableMessages=[{id:1,text:"Giá trị được xác định từ danh mục tiêu chí đánh giá chung của công ty, do đó không thể điều chỉnh."},{id:2,text:"Mục tiêu này có phân bổ cho đối tượng nhận mục tiêu, và giá trị thực hiện sẽ được tự động cập nhật khi các đối tượng nhận mục tiêu liên quan được phê duyệt kết quả."},{id:3,text:"Mục tiêu này được phân bổ từ KPIs cấp trên, và giá trị này được xác định từ KPIs cấp trên."},{id:4,text:"Trạng thái KPIs không phù hợp để điều chỉnh giá trị."},{id:5,text:"Giá trị chỉ có thể điều chỉnh bằng cách cập nhật phương pháp đo."}],principles=[{id:1,name:"Trung bình"},{id:2,name:"Cộng dồn"},{id:3,name:"Cộng dồn trung bình"},{id:4,name:"Lũy kế"},{id:5,name:"Lũy kế trung bình"}],tounchTr=null,kpiUploader;(function(n){n.fn.kpiRender=function(t){function g(){n(".resize-x").unbind().draggable({axis:"x",start:function(n,t){var i=t.position.left},stop:function(t,u){var e=u.position.left,o=n(t.target),c=n(o).closest(".area"),s,f,h;e<12&&(e=12,n(o).css("left",12));s=o.attr("i");n('.kpi-col[i="'+s+'"]').css("width",e+12);i.head.groups[s]=e+12;n(c).hasClass("area-tl")&&(f=0,h=n(o).closest("table").find("colgroup col"),n(h).each(function(){f+=n(this).width()}),f=parseInt(f),n(".area-tl").css("width",f),n(".area-bl").css("width",f),n(".area-tl > div").css("width",f),n(".area-bl > div").css("width",f+17),n(".area-tl > div > table").css("width",f),n(".area-bl > div > table").css("width",f),n(".buffer-bl").css("width",f),n(".area-tr").css("left",f),n(".area-br").css("left",f));r.saveColStates()}});window.addEventListener("touchstart",function(t){tounchTr=n(t.target).closest(".area")});n(".kpi-table").find(" .area").mouseover(function(){tounchTr=n(this)});n(".area-br > div").scroll(function(){if(n(tounchTr).length==0||n(tounchTr).hasClass("area-br")){var t=n(this).closest(".kpi-table"),i=n(this).scrollTop(),r=n(this).scrollLeft();n(t).find(".area-tr > div").scrollLeft(r);n(t).find(".area-bl > div").scrollTop(i)}});n(".area-bl > div").scroll(function(){if(n(tounchTr).length==0||n(tounchTr).hasClass("area-bl")){var t=n(this).closest(".kpi-table"),i=n(this).scrollTop();n(t).find(".area-br > div").scrollTop(i)}})}function w(){n(window).resize(function(){r!=null&&r.resize()});setTimeout(function(){var t=Array.prototype.slice.call(document.querySelectorAll(".switchery"));t.forEach(function(n){new Switchery(n,{color:"#2196F3"})});n(".btn-show-info").unbind().click(function(){for(var i,u=n(this).attr("data-m").split(";"),r=[],t=0;t<u.length;t++)n(disableMessages).each(function(){parseInt(u[t])==this.id&&r.push(this.text)});for(console.log(r),i="info_modal",n("#"+i).length==0&&(app.createEmptyModal({id:i,width:"600px",title:'<i class="icon-warning22 text-warning-300 position-left"><\/i>Hướng dẫn'}),n("#"+i+" .modal-body").append('<p class="text-bold">Anh/Chị không được phép điều chỉnh trường thông tin này vì một trong các lý do sau: <\/p><ul class="list list-icons"><\/ul><p class="text-bold">Anh/Chị vui lòng kiểm tra lại.<\/p>')),n("#"+i+" ul").html(""),t=0;t<r.length;t++)n("#"+i+" ul").append('<li><i class="icon-arrow-small-right position-left"><\/i>'+r[t]+"<\/li>");n("#"+i).modal("show")})},300);g();var t;n(".kpi-table").find(" .area").mouseover(function(){t=n(this)});n(".area-br-2 > div").scroll(function(){if(n(t).length==0||n(t).hasClass("area-br-2")){var i=n(this).scrollTop(),r=n(this).scrollLeft();n(".area-br-1 > div").scrollTop(i);n(".area-br-1 > div").scrollLeft(r)}});n(".area-br-1 > div").scroll(function(){if(n(t).length==0||n(t).hasClass("area-br-1")){var i=n(this).scrollTop(),r=n(this).scrollLeft();n(".area-br-2 > div").scrollTop(i);n(".area-br-2 > div").scrollLeft(r)}});n(b).draggable({axis:"x",containment:"parent",drag:function(){var t=n(this).css("left");r.setAreaSize(t)}});n("#btn-save-hs").unbind().click(function(){var u=n(this),t=r.renderSubmitData();t!=null&&(t.perform=model.Id>0?"updateHS":"create",t.AuthEmployeeId=empId,u.button("loading"),app.postData(DOMAIN_API+"/kpi/SaveKpiYear",t,function(n){u.button("reset");n.Success?(app.notify("success","Lưu thành công"),window.location.href="/kpi/yearedit/"+i.cap+"?tab=tab2&id="+model.Id):app.notify("warning",n.Message)}))});n("#btn-save-gui-hs").unbind().click(function(){var u=n(this),t=r.renderSubmitData(),f;t!=null&&(t.perform="updateHS",t.sent=!0,r.isSubmit(!0),t.buocduyet=u.attr("data-buocduyet"),t.landuyet=u.attr("data-landuyet"),t.AuthEmployeeId=empId,f=r.checkHSValid(t),f&&(u.button("loading"),app.postData(DOMAIN_API+"/kpi/SaveKpiYear",t,function(n){u.button("reset");n.Success?(app.notify("success","Lưu thành công"),window.location.href="/kpi/yearedit/"+i.cap+"?id="+model.Id):app.notify("warning",n.Message)})))});n("#btn-duyet-dk").unbind().click(function(){var t=n(this);confirmDuyet(DOMAIN_API+"/kpi/duyetKpiYear",{id:model.Id,approvalId:t.attr("data-approvalId"),type:0,trangThai:2},function(n){n&&(window.location.href="/kpi/yearedit/"+i.cap+"?id="+model.Id)})});n("#btn-khong-duyet-dk").unbind().click(function(){var t=n(this),r={id:model.Id,approvalId:t.attr("data-approvalId"),type:0,trangThai:3,AuthEmployeeId:empId,isAdmin:isAdmin};confirmKhongDuyet(DOMAIN_API+"/kpi/DuyetKpiYear",r,function(n){n&&(window.location.href="/kpi/yearedit/"+i.cap+"?id="+model.Id)})});n("#btn-save-kq").unbind().on("click",function(){var u=n(this),t=r.renderSubmitData();t.perform="updateKQ";t.quy=u.attr("data-quy");t.landuyet=u.attr("data-landuyet");t.buocduyet=u.attr("data-buocduyet");t.AuthEmployeeId=empId;t!=null&&(u.button("loading"),app.postData(DOMAIN_API+"/kpi/SaveKpiYear",t,function(n){u.button("reset");n.Success?(app.notify("success","Lưu thành công"),window.location.href="/kpi/yearedit/"+i.cap+"?tab=tab2&id="+model.Id):app.notify("warning",n.Message)}))});n("#btn-save-gui-kq").unbind().on("click",function(){var u=n(this),t=r.renderSubmitData(),f;t!=null&&(r.isSubmit(!0),t.quy=u.attr("data-quy"),t.perform="updateKQ",t.landuyet=u.attr("data-landuyet"),t.sent=!0,t.buocduyet=u.attr("data-buocduyet"),t.AuthEmployeeId=empId,f=r.checkKQValid(t),f&&(u.button("loading"),app.postData(DOMAIN_API+"/kpi/SaveKpiYear",t,function(n){u.button("reset");n.Success?(app.notify("success","Lưu thành công"),window.location.href="/kpi/yearedit/"+i.cap+"?id="+model.Id):app.notify("warning",n.Message)})))});n("#btn-duyet-kq").unbind().click(function(){var t=n(this);confirmDuyet(DOMAIN_API+"/kpi/duyetKpiYear",{id:model.Id,quy:n(this).attr("data-quy"),approvalId:t.attr("data-approvalId"),trangThai:2,type:1,details:r.renderPheDuyetData(n(this).attr("data-quy"))},function(n){n&&(window.location.href="/kpi/yearedit/"+i.cap+"?id="+model.Id)})});n("#btn-khong-duyet-kq").unbind().click(function(){var t=n(this);confirmKhongDuyet(DOMAIN_API+"/kpi/duyetKpiYear",{id:model.Id,type:1,trangThai:3,approvalId:t.attr("data-approvalId"),isBanKPI:n(this).attr("data-banKPI"),details:r.renderPheDuyetData(n(t).attr("data-quy"))},function(n){n&&(window.location.href="/kpi/yearedit/"+i.cap+"?id="+model.Id)})});n("#btn-admin-update").unbind().click(function(){var t=r.renderSubmitData(),i;t.perform="adminUpdate";i=n(this);t!=null&&(i.button("loading"),app.postData(DOMAIN_API+"/kpi/SaveKpiYear",t,function(n){i.button("reset");n.Success?app.notify("success","Lưu thành công"):app.notify("warning",n.Message)}))});n(".btn-edit-summary").unbind().click(function(){var r=n(this),t;r=r.button("loading");t="edit-summary-modal";n("#"+t).length==0&&app.createEmptyModal({id:t,width:600,headerClass:"bg-primary",title:"Cập nhật thông tin KPIs cấp công ty"});app.loadData(DOMAIN_API+"/kpi/yearSummaryEdit",{dataType:"html",id:model.Id,cap:i.cap,AuthEmployeeId:auth.EmployeeId},null,function(u){n("#"+t+" .modal-body").html(u);n("#"+t).modal("show");r=r.button("reset");initYearSummaryEditForm(function(){n("#"+t).modal("hide");window.location.href="/kpi/yearedit/"+i.cap+"?id="+model.Id})})});n("#btn-request-modify-dk").unbind().click(function(){confirmCapNhat(DOMAIN_API+"/kpi/CreateKpiyearModify",null,{kpiId:model.Id,quy:n("data-quy").val()},function(n){n&&(window.location.href="/kpi/yearedit/"+i.cap+"?id="+model.Id+"&tab=tab3")})});n("#btn-save-modify").unbind().click(function(){var u=n(this),t=r.renderSubmitData();t!=null&&(t.perform=model.Id>0?"updateHS":"create",t.landuyet=u.attr("data-landuyet"),t.quy=u.attr("data-quy"),t.sent=!1,u.button("loading"),app.postData(DOMAIN_API+"/kpi/RequestModifyKpiYear",t,function(n){u.button("reset");n.Success?(app.notify("success","Lưu thành công"),window.location.href="/kpi/yearedit/"+i.cap+"?tab=tab3&id="+model.Id):app.notify("warning",n.Message)}))});n("#btn-add-group").unbind().click(function(){var t=n(this);r.initEditGroup(null,t)});n("#btn-save-send-modify").unbind().click(function(){var u=n(this),t=r.renderSubmitData(),f;t!=null&&(r.isSubmit(!0),t.perform=model.Id>0?"updateHS":"create",t.landuyet=u.attr("data-landuyet"),t.buocduyet=u.attr("data-buocduyet"),t.quy=u.attr("data-quy"),f=r.checkDCValid(t),f&&(t.sent=!0,u.button("loading"),app.postData(DOMAIN_API+"/kpi/RequestModifyKpiYear",t,function(n){u.button("reset");n.Success?(app.notify("success","Lưu thành công"),window.location.href="/kpi/yearedit/"+i.cap+"?tab=tab3&id="+model.Id):app.notify("warning",n.Message)})))});n("#btn-duyet-dc").unbind().click(function(){var t=n(this);confirmDuyet(DOMAIN_API+"/kpi/DuyetKpiYearModify",{id:model.Id,approvalId:t.attr("data-approvalId"),type:2,trangThai:2},function(n){n&&(window.location.href="/kpi/yearedit/"+i.cap+"?id="+model.Id)})});n("#btn-khong-duyet-dc").unbind().click(function(){var t=n(this);confirmKhongDuyet(DOMAIN_API+"/kpi/DuyetKpiYearModify",{id:model.Id,approvalId:t.attr("data-approvalId"),type:2,trangThai:3},function(n){n&&(window.location.href="/kpi/yearedit/"+i.cap+"?id="+model.Id)})});n("#btn-comment-cm").unbind().click(function(){var t=n(this),r={id:model.Id,type:1,buocDuyet:1,approvalId:t.attr("data-approvalId"),quy:t.attr("data-quy"),comment:!0,trangThai:2,ApproverId:empId};confirmComment(DOMAIN_API+"/kpi/DuyetCmKpiYear",r,function(n){n&&(window.location.href="/kpi/yearedit/"+i.cap+"?id="+model.Id+"&tab=tab4")})});n("#btn-duyet-cm-kq").unbind().click(function(){var t=n(this),r={id:model.Id,approvalId:t.attr("data-approvalId"),type:1,quy:t.attr("data-quy"),comment:!1,buocduyet:1,trangThai:2,ApproverId:empId,isAdmin:isAdmin};confirmDuyet(DOMAIN_API+"/kpi/DuyetCmKpiYear",r,function(n){n&&(window.location.href="/kpi/yearappraisers/"+i.cap)})});n("#btn-khong-duyet-cm-kq").unbind().click(function(){var t=n(this),r={id:model.Id,approvalId:t.attr("data-approvalId"),type:1,comment:!1,buocduyet:1,trangThai:3,ApproverId:empId,isAdmin:isAdmin};confirmKhongDuyet(DOMAIN_API+"/kpi/KhongDuyetCmKpiYear",r,function(n){n&&(window.location.href="/kpi/yearappraisers/"+i.cap)})});n("#btn_reset_col_size").unbind().click(function(){var t=n(".kpi_container .area-tl colgroup col"),f,u;e=0;t.each(function(t,r){n(r).css("width",i.defaultGroups[t]);e+=i.defaultGroups[t]});t=n(".kpi_container .area-bl colgroup col");t.each(function(t,r){n(r).css("width",i.defaultGroups[t])});f=t.length;t=n(".kpi_container .area-tr colgroup col");t.each(function(t,r){n(r).css("width",i.defaultGroups[t+f])});t=n(".kpi_container .area-br colgroup col");t.each(function(t,r){n(r).css("width",i.defaultGroups[t+f])});r.setAreaSize(i.mode==2?0:e);n(".kpi_container .area table .resize-x").css("left","unset");n(".kpi_container .area-bl > div table").css("width","unset");n(".kpi_container .area-tl > div table").css("width","unset");r.n(!0);r.q1(!0);r.q2(!0);r.q3(!0);r.q4(!0);u=0;t=n(".area-tr .table").find("colgroup col");n(t).each(function(){n(this).css("display")!="none"&&(u+=n(this).width())});u=parseInt(u);n(".area-tr > div > table").css("width",u);n(".area-br > div > table").css("width",u);i.head.groups=i.defaultGroups;r.saveColStates()})}var u=this,l=this.selector,i=n.extend({dependCompany:null,cap:null,tab:null,perform:null,type:null,allocationEmpty:null,objectEmpty:null,topHeight:null,dataProving:null,trongSoTheoNam:null,head:null,rows:[],cols:null,initTable:null,initCallback:null},t);u.set=i;i.mode>0&&model.ModifyStatus==null&&(model.ModifyStatus=0);i.colStates=null;i.allowModify=0;i.defaultGroups=null;model.ColStates!=null&&(i.colStates=n.parseJSON(model.ColStates));var o=".render_table",a=o+" .area-tl",s=o+" .area-tr",h=o+" .area-bl",c=o+" .area-br",b=o+" .resize-bar",r,e=0,v=function(n){var t=this;n!=null?(t.Id=ko.observable(n.Id),t.Year=ko.observable(n.Year),t.OrganizationId=ko.observable(n.OrganizationId),t.OwnerId=ko.observable(n.OwnerId),t.NguoiDuyet1=ko.observable(n.NguoiDuyet1),t.NguoiDuyet2=ko.observable(n.NguoiDuyet2),t.NgayThanhLap=ko.observable(app.formatDate(n.NgayThanhLap))):(t.Id=ko.observable(0),t.Year=ko.observable(0),t.OrganizationId=ko.observable(0),t.OwnerId=ko.observable(""),t.NguoiDuyet1=ko.observable(""),t.NguoiDuyet2=ko.observable(null),t.NgayThanhLap=ko.observable(""));t.real=ko.computed(function(){})},y=function(n,t){var i=this;i.index=ko.observable(t);i.guid=ko.observable(app.newGuid(10));i.organizationName=ko.observable("");i.ownerName=ko.observable("");n!=null?(i.Id=ko.observable(n.Id),i.KpiCompanyDetailId=ko.observable(n.KpiCompanyDetailId),i.OrganizationId=ko.observable(n.OrganizationId),i.OwnerId=ko.observable(n.OwnerId),i.KpiDetailId=ko.observable(n.KpiDetailId),i.JobPositionId=ko.observable(n.JobPositionId),i.CriteriaAppraiserId=ko.observable(n.CriteriaAppraiserId),n.OrganizationName!=null&&i.organizationName(n.OrganizationName),n.ObjOwner!=null&&i.ownerName(n.ObjOwner.FullName)):(i.Id=ko.observable(0),i.KpiCompanyDetailId=ko.observable(null),i.OrganizationId=ko.observable(null),i.JobPositionId=ko.observable(null),i.KpiDetailId=ko.observable(null),i.CriteriaAppraiserId=ko.observable(null));i.isDelete=ko.observable(!1)},p={CachTinh:"",PhuongPhapDo:0,KpiDetailId:null,CongThucDo:null,CongThucDoHtml:null,ChiTieu:null,DonViTinh:null,GhiChu:null,GhiChuFromCriteria:null,Id:0,KpiCompanyId:0,KpiEvaluationCriteriaId:null,KpiYearAllocationId:null,MucTieu:"",DuLieuChungMinh:null,DongBo_Allow:!1,DongBo_CongThuc:null,DongBo_Text:"",X:null,Y:null,Nam_GhiChu:null,Nam_KeHoach:null,Nam_TrongSo:null,Nam_ThucHien:null,Nam_KetQua:null,Nam_TyLeHTSoHienTai:null,Nam_TyLeHoanThanh:null,Default_Quy_KeHoach_X:null,Default_Quy_KeHoach_Y:null,appraiserText:"",allocationText:"",Nam_TyLeTrongSo:null,DangKy_DinhKem:null,NguonChungMinh:null,NguyenTacTinh:1,ParentId:null,Quy1_GhiChu:null,Quy1_KetQua:null,Quy1_KeHoach_X:null,Quy1_KeHoach_Y:null,Quy1_ThucHien:null,Quy1_TrongSo:null,Quy1_TyLeHoanThanh:null,Quy1_TyLeTrongSo:null,Quy1_DinhKem:null,Quy2_GhiChu:null,Quy2_KetQua:null,Quy2_KeHoach_X:null,Quy2_KeHoach_Y:null,Quy2_ThucHien:null,Quy2_TrongSo:null,Quy2_TyLeHoanThanh:null,Quy2_TyLeTrongSo:null,Quy2_DinhKem:null,Quy3_GhiChu:null,Quy3_KetQua:null,Quy3_KeHoach_X:null,Quy3_KeHoach_Y:null,Quy3_ThucHien:null,Quy3_TrongSo:null,Quy3_TyLeHoanThanh:null,Quy3_TyLeTrongSo:null,Quy3_DinhKem:null,Quy4_GhiChu:null,Quy4_KetQua:null,Quy4_KeHoach_X:null,Quy4_KeHoach_Y:null,Quy4_ThucHien:null,Quy4_TrongSo:null,Quy4_TyLeHoanThanh:null,Quy4_TyLeTrongSo:null,Quy4_DinhKem:null,Summary:!1,STT:"",Group:0,Status:0,RowHeight:80},k=function(){var t=this;n.extend(t,ko.mapping.fromJS(p));t.expanded=ko.observable(!0);t.guid=ko.observable(null);t.placeholderX=ko.observable("");t.placeholderY=ko.observable("");t.Quy1_KeHoach_XStr=ko.observable(null);t.Quy2_KeHoach_XStr=ko.observable(null);t.Quy3_KeHoach_XStr=ko.observable(null);t.Quy4_KeHoach_XStr=ko.observable(null);t.Quy1_KeHoach_YStr=ko.observable(null);t.Quy2_KeHoach_YStr=ko.observable(null);t.Quy3_KeHoach_YStr=ko.observable(null);t.Quy4_KeHoach_YStr=ko.observable(null);t.Quy1_ThucHienStr=ko.observable(null);t.Quy2_ThucHienStr=ko.observable(null);t.Quy3_ThucHienStr=ko.observable(null);t.Quy4_ThucHienStr=ko.observable(null);t.empty=ko.observable(!0);t.Quy1_KeHoach_X=ko.observable(null);t.modifyMucTieu=ko.observable(!1);t.modifyCachTinh=ko.observable(!1);t.modifyPhuongPhapDo=ko.observable(!1);t.modifyNam_TrongSo=ko.observable(!1);t.modifyNam_KeHoach=ko.observable(!1);t.modifyQuy1_TrongSo=ko.observable(!1);t.modifyQuy2_TrongSo=ko.observable(!1);t.modifyQuy3_TrongSo=ko.observable(!1);t.modifyQuy4_TrongSo=ko.observable(!1);t.modifyQuy1_KeHoach_X=ko.observable(!1);t.modifyQuy2_KeHoach_X=ko.observable(!1);t.modifyQuy3_KeHoach_X=ko.observable(!1);t.modifyQuy4_KeHoach_X=ko.observable(!1);t.modifyQuy1_KeHoach_Y=ko.observable(!1);t.modifyQuy2_KeHoach_Y=ko.observable(!1);t.modifyQuy3_KeHoach_Y=ko.observable(!1);t.modifyQuy4_KeHoach_Y=ko.observable(!1);t.modifyNguyenTacTinh=ko.observable(!1);t.modifyDonViTinh=ko.observable(!1);t.modifyBPCM=ko.observable(!1);t.modifyDLCM=ko.observable(!1);t.modifyGhiChu=ko.observable(!1);t.modifyY=ko.observable(null);t.Quy1_KeHoach_X=ko.observable(null)},f=function(t,r){var u=this,f;u.loaded=!1;u.empty=ko.observable(!1);u.guid=ko.observable(app.newGuid(10));u.childs=ko.observableArray([]);u.formulaId=ko.observable(0);u.fDesc=ko.observable("");u.formula=ko.observable("");u.CongThucDoHtml=ko.observable("");u.Nam_KeHoachStr=ko.observable("");u.appraiserText=ko.observable("");u.allocationText=ko.observable("");u.placeholderX=ko.observable("");u.placeholderY=ko.observable("");u.Quy1_KeHoach_XStr=ko.observable("");u.Quy2_KeHoach_XStr=ko.observable("");u.Quy3_KeHoach_XStr=ko.observable("");u.Quy4_KeHoach_XStr=ko.observable("");u.Quy1_KeHoach_YStr=ko.observable("");u.Quy2_KeHoach_YStr=ko.observable("");u.Quy3_KeHoach_YStr=ko.observable("");u.Quy4_KeHoach_YStr=ko.observable("");u.Quy1_KeHoach_X=ko.observable("");u.Quy2_KeHoach_X=ko.observable("");u.Quy3_KeHoach_X=ko.observable("");u.Quy4_KeHoach_X=ko.observable("");u.Quy1_ThucHienStr=ko.observable("");u.Quy2_ThucHienStr=ko.observable("");u.Quy3_ThucHienStr=ko.observable("");u.Quy4_ThucHienStr=ko.observable("");u.quy=ko.computed(function(){return model.Status>=15?4:model.Status>=11?3:model.Status>=7?2:model.Status>=3?1:0});u.updateStr=function(){var n=CheckKeHoachX(u.PhuongPhapDo(),u.Quy1_KeHoach_X()),t=CheckKeHoachX(u.PhuongPhapDo(),u.Quy2_KeHoach_X()),i=CheckKeHoachX(u.PhuongPhapDo(),u.Quy3_KeHoach_X()),r=CheckKeHoachX(u.PhuongPhapDo(),u.Quy4_KeHoach_X()),e=CheckKeHoachY(u.PhuongPhapDo(),u.Quy1_KeHoach_Y()),o=CheckKeHoachY(u.PhuongPhapDo(),u.Quy2_KeHoach_Y()),s=CheckKeHoachY(u.PhuongPhapDo(),u.Quy3_KeHoach_Y()),h=CheckKeHoachY(u.PhuongPhapDo(),u.Quy4_KeHoach_Y()),f=CheckKeHoachX(u.PhuongPhapDo(),u.Nam_KeHoach());u.Quy1_KeHoach_X()!=n&&u.Quy1_KeHoach_X(n);u.Quy2_KeHoach_X()!=t&&u.Quy2_KeHoach_X(t);u.Quy3_KeHoach_X()!=i&&u.Quy3_KeHoach_X(i);u.Quy4_KeHoach_X()!=r&&u.Quy4_KeHoach_X(r);u.PhuongPhapDo()!=5?(u.Quy1_KeHoach_XStr(n!=""?app.formatPrice(n):""),u.Quy2_KeHoach_XStr(t!=""?app.formatPrice(t):""),u.Quy3_KeHoach_XStr(i!=""?app.formatPrice(i):""),u.Quy4_KeHoach_XStr(r!=""?app.formatPrice(r):""),u.Quy1_KeHoach_YStr(n!=""?app.formatPrice(e):""),u.Quy2_KeHoach_YStr(t!=""?app.formatPrice(o):""),u.Quy3_KeHoach_YStr(i!=""?app.formatPrice(s):""),u.Quy4_KeHoach_YStr(r!=""?app.formatPrice(h):""),u.Nam_KeHoachStr(f!=""?app.formatPrice(f):"")):(u.Quy1_KeHoach_XStr(n),u.Quy2_KeHoach_XStr(t),u.Quy3_KeHoach_XStr(i),u.Quy4_KeHoach_XStr(r),u.Quy1_KeHoach_YStr(e),u.Quy2_KeHoach_YStr(o),u.Quy3_KeHoach_YStr(s),u.Quy4_KeHoach_YStr(h),u.Nam_KeHoachStr(f));u.X(f)};u.AppraiserFromCriteria=ko.observable(!1);t!=null?(t.ParentId==null&&t.ObjNhomMucTieu!=null&&(t.STT=t.ObjNhomMucTieu.Name),u=n.extend(u,ko.mapping.fromJS(t)),u.allocationText(t.AllocationText),u.Appraisers=ko.observableArray([]),t.Appraisers!=null&&t.Appraisers.length>0&&n(t.Appraisers).each(function(){var n=new y(this,u.Appraisers().length+1);u.Appraisers.push(n);n.CriteriaAppraiserId()!=null&&u.AppraiserFromCriteria(!0)}),u.updateStr(),f=u.CongThucDo(),f!=null&&f.indexOf("<br")>=0&&(f=app.replaceBrToNewLine(f)),u.CongThucDoHtml(f),f=u.CachTinh(),f!=null&&f.indexOf("<br")>=0&&(f=app.replaceBrToNewLine(f)),u.CachTinh(f)):(u=n.extend(u,ko.mapping.fromJS(p)),u.STT(r),u.Allocations=ko.observableArray([]),u.Appraisers=ko.observableArray([]));u.isValidAppraiser=function(){var t=!0;return n(u.Appraisers()).each(function(){if(!app.hasValue(this.OwnerId()))return t=!1,!1}),t||app.notify("warning","Trưởng đơn vị bộ phận chứng minh không được trống. Vui lòng kiểm tra lại."),t};u.calcQuy1=function(){var t,n,r;u.errorQuy1_ThucHien()?(u.Quy1_TyLeHoanThanh("0%"),u.Quy1_TyLeTrongSo("0%"),u.Quy1_KetQua("")):(t=i.trongSoTheoNam?u.Nam_TrongSo():u.Quy1_TrongSo(),t=="0%"?(u.Quy1_TyLeHoanThanh("0%"),u.Quy1_TyLeTrongSo("0%"),u.Quy1_KetQua("Không đăng ký")):t!="0%"&&(app.hasValue(u.Quy1_KeHoach_X())?(n=tinhTyLeHoanThanh(u.PhuongPhapDo(),u.Quy1_KeHoach_X(),u.Quy1_KeHoach_Y(),u.Quy1_ThucHien()),u.Quy1_TyLeHoanThanh(n),r=tinhTyLeTrongSo(t,n),u.Quy1_TyLeTrongSo(r),parseInt(n.replace("%",""))<100?u.Quy1_KetQua("Không đạt"):n.replace("%","")==""?u.Quy1_KetQua(""):u.Quy1_KetQua("Đạt")):u.Quy1_KetQua("")))};u.calcQuy2=function(){var n,t;u.errorQuy2_ThucHien()?(u.Quy2_TyLeHoanThanh("0%"),u.Quy2_TyLeTrongSo("0%"),u.Quy2_KetQua("")):u.Quy2_TrongSo()=="0%"?(u.Quy2_TyLeHoanThanh("0%"),u.Quy2_TyLeTrongSo("0%"),u.Quy2_KetQua("Không đăng ký")):u.Quy2_TrongSo()!="0%"?(n=tinhTyLeHoanThanh(u.PhuongPhapDo(),u.Quy2_KeHoach_X(),u.Quy2_KeHoach_Y(),u.Quy2_ThucHien()),u.Quy2_TyLeHoanThanh(n),t=tinhTyLeTrongSo(u.Quy2_TrongSo(),n),u.Quy2_TyLeTrongSo(t),parseInt(n.replace("%",""))<100?u.Quy2_KetQua("Không đạt"):n.replace("%","")==""?u.Quy2_KetQua(""):u.Quy2_KetQua("Đạt")):u.Quy2_KetQua("")};u.calcQuy3=function(){var n,t;u.errorQuy3_ThucHien()?(u.Quy3_TyLeHoanThanh("0%"),u.Quy3_TyLeTrongSo("0%"),u.Quy3_KetQua("")):u.Quy3_TrongSo()=="0%"?(u.Quy3_TyLeHoanThanh("0%"),u.Quy3_TyLeTrongSo("0%"),u.Quy3_KetQua("Không đăng ký")):u.Quy3_TrongSo()!="0%"&&(app.hasValue(u.Quy3_KeHoach_X())?(n=tinhTyLeHoanThanh(u.PhuongPhapDo(),u.Quy3_KeHoach_X(),u.Quy3_KeHoach_Y(),u.Quy3_ThucHien()),u.Quy3_TyLeHoanThanh(n),t=tinhTyLeTrongSo(u.Quy3_TrongSo(),n),u.Quy3_TyLeTrongSo(t),parseInt(n.replace("%",""))<100?u.Quy3_KetQua("Không đạt"):n.replace("%","")==""?u.Quy3_KetQua(""):u.Quy3_KetQua("Đạt")):u.Quy3_KetQua(""))};u.calcQuy4=function(){var n,t;u.errorQuy4_ThucHien()?(u.Quy4_TyLeHoanThanh("0%"),u.Quy4_TyLeTrongSo("0%"),u.Quy4_KetQua("")):u.Quy4_TrongSo()=="0%"?(u.Quy4_TyLeHoanThanh("0%"),u.Quy4_TyLeTrongSo("0%"),u.Quy4_KetQua("Không đăng ký")):u.Quy4_TrongSo()!="0%"&&(app.hasValue(u.Quy4_KeHoach_X())?(n=tinhTyLeHoanThanh(u.PhuongPhapDo(),u.Quy4_KeHoach_X(),u.Quy4_KeHoach_Y(),u.Quy4_ThucHien()),u.Quy4_TyLeHoanThanh(n),t=tinhTyLeTrongSo(u.Quy4_TrongSo(),n),u.Quy4_TyLeTrongSo(t),parseInt(n.replace("%",""))<100?u.Quy4_KetQua("Không đạt"):n.replace("%","")==""?u.Quy4_KetQua(""):u.Quy4_KetQua("Đạt")):u.Quy4_KetQua(""))};u.PhuongPhapDo.subscribe(function(){u.calcQuy1();u.calcQuy2();u.calcQuy3();u.calcQuy4()});u.PhuongPhapDo()<=5?u.formulaId(u.PhuongPhapDo()):u.PhuongPhapDo()<=9?u.formulaId(6):u.formulaId(10);u.tenNguyenTacTinh=ko.observable("");u.NguyenTacTinh.subscribe(function(){n(principles).each(function(){this.id==u.NguyenTacTinh()&&u.tenNguyenTacTinh(this.name)})});n(principles).each(function(){this.id==u.NguyenTacTinh()&&u.tenNguyenTacTinh(this.name)});u.expanded=ko.observable(!0);u.errorNam_KehoachX=ko.observable(!1);u.errorQuy1_KehoachX=ko.observable(!1);u.errorQuy2_KehoachX=ko.observable(!1);u.errorQuy3_KehoachX=ko.observable(!1);u.errorQuy4_KehoachX=ko.observable(!1);u.errorNam_KehoachY=ko.observable(!1);u.errorQuy1_KehoachY=ko.observable(!1);u.errorQuy2_KehoachY=ko.observable(!1);u.errorQuy3_KehoachY=ko.observable(!1);u.errorQuy4_KehoachY=ko.observable(!1);u.errorQuy1_ThucHien=ko.observable(!1);u.errorQuy2_ThucHien=ko.observable(!1);u.errorQuy3_ThucHien=ko.observable(!1);u.errorQuy4_ThucHien=ko.observable(!1);u.checkQuy1_ThucHien=function(){var n=u.Quy1_ThucHien(),t=isValidThucHien(u.PhuongPhapDo(),n);t?u.PhuongPhapDo()!=5?u.Quy1_ThucHienStr(n!=""?app.formatPrice(n):""):u.Quy1_ThucHienStr(n):u.Quy1_ThucHienStr(n);u.Quy1_TrongSo()!="0%"&&u.errorQuy1_ThucHien(!t)};u.checkQuy2_ThucHien=function(){var n=u.Quy2_ThucHien(),i=isValidThucHien(u.PhuongPhapDo(),n),t;i?(t=CheckKeHoachX(u.PhuongPhapDo(),n),n!=t&&u.Quy2_ThucHien(t),u.PhuongPhapDo()!=5?u.Quy2_ThucHienStr(n!=""?app.formatPrice(n):""):u.Quy2_ThucHienStr(n)):u.Quy2_ThucHienStr(n);u.Quy2_TrongSo()!="0%"&&u.errorQuy2_ThucHien(!i)};u.checkQuy3_ThucHien=function(){var n=u.Quy3_ThucHien(),i=isValidThucHien(u.PhuongPhapDo(),n),t;i?(t=CheckKeHoachX(u.PhuongPhapDo(),n),n!=t&&u.Quy3_ThucHien(t),u.PhuongPhapDo()!=5?u.Quy3_ThucHienStr(n!=""?app.formatPrice(n):""):u.Quy3_ThucHienStr(n)):u.Quy3_ThucHienStr(n);u.Quy3_TrongSo()!="0%"&&u.errorQuy3_ThucHien(!i)};u.checkQuy4_ThucHien=function(){var n=u.Quy4_ThucHien(),i=isValidThucHien(u.PhuongPhapDo(),n),t;i?(t=CheckKeHoachX(u.PhuongPhapDo(),n),n!=t&&u.Quy4_ThucHien(t),u.PhuongPhapDo()!=5?u.Quy4_ThucHienStr(n!=""?app.formatPrice(n):""):u.Quy4_ThucHienStr(n)):u.Quy4_ThucHienStr(n);u.Quy4_TrongSo()!="0%"&&u.errorQuy4_ThucHien(!i)};u.Quy1_ThucHien.subscribe(function(){u.checkQuy1_ThucHien();u.calcQuy1()});u.Quy2_ThucHien.subscribe(function(){u.checkQuy2_ThucHien();u.calcQuy2()});u.Quy3_ThucHien.subscribe(function(){u.checkQuy3_ThucHien();u.calcQuy3()});u.Quy4_ThucHien.subscribe(function(){u.checkQuy4_ThucHien();u.calcQuy4()});u.Nam_KeHoach.subscribe(function(){var n=tinhCongThucDo({X:u.Nam_KeHoach(),Y:u.Y()},u.PhuongPhapDo());u.CongThucDoHtml(n);u.updateStr()});u.Y.subscribe(function(){var n=tinhCongThucDo({X:u.Nam_KeHoach(),Y:u.Y()},u.PhuongPhapDo());u.CongThucDoHtml(n);u.updateStr()});u.Quy1_KeHoach_X.subscribe(function(){u.updateStr()});u.Quy2_KeHoach_X.subscribe(function(){u.updateStr()});u.Quy3_KeHoach_X.subscribe(function(){u.updateStr()});u.Quy4_KeHoach_X.subscribe(function(){u.updateStr()});u.Quy1_KeHoach_Y.subscribe(function(){u.updateStr()});u.Quy2_KeHoach_Y.subscribe(function(){u.updateStr()});u.Quy3_KeHoach_Y.subscribe(function(){u.updateStr()});u.Quy4_KeHoach_Y.subscribe(function(){u.updateStr()});u.Nam_TrongSo.subscribe(function(){u.Nam_TrongSo()=="0%"&&(u.Quy1_TrongSo("0%"),u.Quy2_TrongSo("0%"),u.Quy3_TrongSo("0%"),u.Quy4_TrongSo("0%"),u.ParentId()==null&&n(u.childs()).each(function(){this.Nam_TrongSo("0%")}))});u.Quy1_TrongSo.subscribe(function(){u.ParentId()!=null?u.Quy1_TrongSo()=="0%"?u.Quy1_KetQua("Không đăng ký"):u.Quy1_KetQua(""):u.Quy1_TrongSo()=="0%"&&n(u.childs()).each(function(){this.Quy1_TrongSo("0%")});app.hasValue(u.Quy1_ThucHien())&&(u.checkQuy1_ThucHien(),u.calcQuy1())});u.Quy2_TrongSo.subscribe(function(){u.ParentId()!=null?u.Quy2_TrongSo()=="0%"?u.Quy2_KetQua("Không đăng ký"):u.Quy2_KetQua(""):u.Quy2_TrongSo()=="0%"&&n(u.childs()).each(function(){this.Quy2_TrongSo("0%")});app.hasValue(u.Quy2_ThucHien())&&(u.checkQuy2_ThucHien(),u.calcQuy2())});u.Quy3_TrongSo.subscribe(function(){u.ParentId()!=null?u.Quy3_TrongSo()=="0%"?u.Quy3_KetQua("Không đăng ký"):u.Quy3_KetQua(""):u.Quy3_TrongSo()=="0%"&&n(u.childs()).each(function(){this.Quy3_TrongSo("0%")});app.hasValue(u.Quy3_ThucHien())&&(u.checkQuy3_ThucHien(),u.calcQuy3())});u.Quy4_TrongSo.subscribe(function(){u.ParentId()!=null?u.Quy4_TrongSo()=="0%"?u.Quy4_KetQua("Không đăng ký"):u.Quy4_KetQua(""):u.Quy4_TrongSo()=="0%"&&n(u.childs()).each(function(){this.Quy4_TrongSo("0%")});app.hasValue(u.Quy4_ThucHien())&&(u.checkQuy4_ThucHien(),u.calcQuy4())});u.real=ko.computed(function(){var e,o,r,f,s,t;u.Nam_TrongSo(CheckTyLe(u.Nam_TrongSo()));u.Quy1_TrongSo(CheckTyLe(u.Quy1_TrongSo()));u.Quy2_TrongSo(CheckTyLe(u.Quy2_TrongSo()));u.Quy3_TrongSo(CheckTyLe(u.Quy3_TrongSo()));u.Quy4_TrongSo(CheckTyLe(u.Quy4_TrongSo()));i.trongSoTheoNam?(e=u.Nam_TrongSo(),e=="0%"?(u.errorQuy1_KehoachX(!1),u.errorQuy2_KehoachX(!1),u.errorQuy3_KehoachX(!1),u.errorQuy4_KehoachX(!1),u.errorQuy1_KehoachY(!1),u.errorQuy2_KehoachY(!1),u.errorQuy3_KehoachY(!1),u.errorQuy4_KehoachY(!1),u.Quy1_TyLeHoanThanh("0%"),u.Quy1_TyLeTrongSo("0%"),u.Quy1_KetQua("Không đăng ký"),u.Quy2_TyLeHoanThanh("0%"),u.Quy2_TyLeTrongSo("0%"),u.Quy2_KetQua("Không đăng ký"),u.Quy3_TyLeHoanThanh("0%"),u.Quy3_TyLeTrongSo("0%"),u.Quy3_KetQua("Không đăng ký"),u.Quy4_TyLeHoanThanh("0%"),u.Quy4_TyLeTrongSo("0%"),u.Quy4_KetQua("Không đăng ký")):(u.errorQuy1_KehoachX(!app.hasValue(u.Quy1_KeHoach_X())),u.errorQuy2_KehoachX(!app.hasValue(u.Quy2_KeHoach_X())),u.errorQuy3_KehoachX(!app.hasValue(u.Quy3_KeHoach_X())),u.errorQuy4_KehoachX(!app.hasValue(u.Quy4_KeHoach_X())),n.inArray(u.PhuongPhapDo(),[7,8,9,11,12,13])>=0&&(u.errorQuy1_KehoachY(!app.hasValue(u.Quy1_KeHoach_Y())),u.errorQuy2_KehoachY(!app.hasValue(u.Quy2_KeHoach_Y())),u.errorQuy3_KehoachY(!app.hasValue(u.Quy3_KeHoach_Y())),u.errorQuy4_KehoachY(!app.hasValue(u.Quy4_KeHoach_Y()))),model.Status>3&&(u.quy()==1&&app.hasValue(u.Quy1_KeHoach_X())&&u.errorQuy1_ThucHien(!app.hasValue(u.Quy1_ThucHien())),u.quy()==2&&app.hasValue(u.Quy2_KeHoach_X())&&u.errorQuy2_ThucHien(!app.hasValue(u.Quy2_ThucHien())),u.quy()==3&&app.hasValue(u.Quy3_KeHoach_X())&&u.errorQuy3_ThucHien(!app.hasValue(u.Quy3_ThucHien())),u.quy()==4&&app.hasValue(u.Quy4_KeHoach_X())&&u.errorQuy4_ThucHien(!app.hasValue(u.Quy4_ThucHien()))))):(u.Nam_TrongSo()=="0%"?(u.errorNam_KehoachX(!1),u.errorNam_KehoachY(!1),u.Nam_TyLeHoanThanh("0%"),u.Nam_TyLeTrongSo("0%"),u.Nam_ThucHien(""),u.Nam_KetQua("Không đăng ký")):(u.errorNam_KehoachX(!app.hasValue(u.Nam_KeHoach())),n.inArray(u.PhuongPhapDo(),[7,8,9,11,12,13])>=0&&u.errorNam_KehoachY(!app.hasValue(u.Y()))),u.Quy1_TrongSo()=="0%"?(u.errorQuy1_KehoachX(!1),u.errorQuy1_KehoachY(!1),u.Quy1_TyLeHoanThanh("0%"),u.Quy1_TyLeTrongSo("0%"),u.Quy1_KetQua("Không đăng ký")):(u.errorQuy1_KehoachX(!app.hasValue(u.Quy1_KeHoach_X())),n.inArray(u.PhuongPhapDo(),[7,8,9,11,12,13])>=0&&u.errorQuy1_KehoachY(!app.hasValue(u.Quy1_KeHoach_Y())),model.Status>3&&u.quy()==1&&app.hasValue(u.Quy1_KeHoach_X())&&u.errorQuy1_ThucHien(!app.hasValue(u.Quy1_ThucHien()))),u.Quy2_TrongSo()=="0%"?(u.Quy2_TyLeHoanThanh("0%"),u.Quy2_TyLeTrongSo("0%"),u.Quy2_KetQua("Không đăng ký"),u.errorQuy2_KehoachX(!1)):(u.errorQuy2_KehoachX(!app.hasValue(u.Quy2_KeHoach_X())),n.inArray(u.PhuongPhapDo(),[7,8,9,11,12,13])>=0&&u.errorQuy2_KehoachY(!app.hasValue(u.Quy2_KeHoach_Y())),model.Status>3&&u.quy()==2&&app.hasValue(u.Quy2_KeHoach_X())&&u.errorQuy2_ThucHien(!app.hasValue(u.Quy2_ThucHien()))),u.Quy3_TrongSo()=="0%"?(u.Quy3_TyLeHoanThanh("0%"),u.Quy3_TyLeTrongSo("0%"),u.Quy3_KetQua("Không đăng ký"),u.errorQuy3_KehoachX(!1),u.errorQuy3_KehoachY(!1)):(u.errorQuy3_KehoachX(!app.hasValue(u.Quy3_KeHoach_X())),n.inArray(u.PhuongPhapDo(),[7,8,9,11,12,13])>=0&&u.errorQuy3_KehoachY(!app.hasValue(u.Quy3_KeHoach_Y())),model.Status>3&&u.quy()==3&&app.hasValue(u.Quy3_KeHoach_X())&&u.errorQuy3_ThucHien(!app.hasValue(u.Quy3_ThucHien()))),u.Quy4_TrongSo()=="0%"?(u.Quy4_TyLeHoanThanh("0%"),u.Quy4_TyLeTrongSo("0%"),u.Quy4_KetQua("Không đăng ký"),u.errorQuy4_KehoachX(!1)):(u.errorQuy4_KehoachX(!app.hasValue(u.Quy4_KeHoach_X())),n.inArray(u.PhuongPhapDo(),[7,8,9,11,12,13])>=0&&u.errorQuy4_KehoachY(!app.hasValue(u.Quy4_KeHoach_Y())),model.Status>3&&u.quy()==4&&app.hasValue(u.Quy4_KeHoach_X())&&u.errorQuy4_ThucHien(!app.hasValue(u.Quy4_ThucHien()))));u.ParentId()>0&&model.Status>=3&&(u.Nam_TrongSo().replace("%","")=="0"?(u.Nam_TyLeHoanThanh("0%"),u.Nam_TyLeTrongSo("0%"),u.Nam_ThucHien(""),u.Nam_KetQua("Không đăng ký")):(o=tinhTyLeHoanThanhNam(ko.toJS(u)),r=o.toFixed(2)+"%",u.Nam_TyLeHoanThanh(r),f=tinhTyLeTrongSo(u.Nam_TrongSo(),r),u.Nam_TyLeTrongSo(f),u.Nam_KetQua(f),s=tinhThucHienNam(u),u.Nam_ThucHien(s)));t=[];n(u.Appraisers()).each(function(){this.isDelete()||t.length<3&&t.push(this.organizationName())});u.appraiserText(t.join(", "));switch(u.PhuongPhapDo()){case 1:case 2:u.placeholderX("X");u.placeholderY("");break;case 3:u.placeholderX("X");u.placeholderY("");break;case 4:u.placeholderX("số đầu mục");u.placeholderY("% bị trừ");break;case 5:u.placeholderX("dd/mm/yyyy");u.placeholderY("% bị trừ");break;case 7:case 8:case 9:case 14:u.placeholderX("Max");u.placeholderY("Min");break;case 11:case 12:case 13:u.placeholderX("Min");u.placeholderY("Max")}});u.loaded=!0;u.isValidAppraiser=function(){var t=!0;return n("#nguon_chung_minh_modal").hasClass("in")&&(n(u.Appraisers()).each(function(){if(!app.hasValue(this.OwnerId()))return t=!1,!1}),t||app.notify("warning","Trưởng đơn vị bộ phận chứng minh không được trống. Vui lòng kiểm tra lại.")),t};u.isDelete=ko.observable(!1);setTimeout(function(){n(".file-attach").uniform({fileButtonClass:"action btn btn-default btn-xs text-slate",fileButtonHtml:'<i class="icon-file-plus"><\/i>'});(u.RowHeight()<80||u.RowHeight()==null)&&u.RowHeight(80);n(".kd_"+u.guid()+" td textarea").css("height",u.RowHeight()-1+"px");n(".kd_"+u.guid()+" td .resize-height").css("height",u.RowHeight()-1+"px");n(".kd_"+u.guid()+" > td").css("height",u.RowHeight()+"px");n("#attach-dangky-"+u.guid()).change(function(){uploadDinhKem(this,function(n){n.length>0&&u.DangKy_DinhKem(n[0].path)})});n("#attach-quy1-"+u.guid()).change(function(){uploadDinhKem(this,function(n){n.length>0&&u.Quy1_DinhKem(n[0].path)})});n("#attach-quy2-"+u.guid()).change(function(){uploadDinhKem(this,function(n){n.length>0&&u.Quy2_DinhKem(n[0].path)})});n("#attach-quy3-"+u.guid()).change(function(){uploadDinhKem(this,function(n){n.length>0&&u.Quy3_DinhKem(n[0].path)})});n("#attach-quy4-"+u.guid()).change(function(){uploadDinhKem(this,function(n){n.length>0&&u.Quy4_DinhKem(n[0].path)})});n("#switchery-"+u.guid()).change(function(){var t=n(this).is(":checked");u.DongBo_Allow(t);t?u.Id()>0&&app.postData(DOMAIN_API+"/kpi/KpiUpdateAllowSync",{allow:!0,detailId:u.Id()},function(){}):app.postData(DOMAIN_API+"/kpi/KpiUpdateSyncMethod",{quy:currentQuarter,detailId:u.Id(),congThuc:null,text:""},function(){u.DongBo_Text("");u.DongBo_CongThuc(null)})});u.checkQuy1_ThucHien();u.checkQuy2_ThucHien();u.checkQuy3_ThucHien();u.checkQuy4_ThucHien();var t=app.hasValue(u.allocationText())&&u.DongBo_CongThuc()!=null;u.DongBo_Allow(t)},1e3);u.modifyMucTieu=ko.observable(!1);u.modifyCachTinh=ko.observable(!1);u.modifyPhuongPhapDo=ko.observable(!1);u.modifyNam_TrongSo=ko.observable(!1);u.modifyNam_KeHoach=ko.observable(!1);u.modifyQuy1_TrongSo=ko.observable(!1);u.modifyQuy2_TrongSo=ko.observable(!1);u.modifyQuy3_TrongSo=ko.observable(!1);u.modifyQuy4_TrongSo=ko.observable(!1);u.modifyQuy1_KeHoach_X=ko.observable(!1);u.modifyQuy2_KeHoach_X=ko.observable(!1);u.modifyQuy3_KeHoach_X=ko.observable(!1);u.modifyQuy4_KeHoach_X=ko.observable(!1);u.modifyQuy1_KeHoach_Y=ko.observable(!1);u.modifyQuy2_KeHoach_Y=ko.observable(!1);u.modifyQuy3_KeHoach_Y=ko.observable(!1);u.modifyQuy4_KeHoach_Y=ko.observable(!1);u.modifyNguyenTacTinh=ko.observable(!1);u.modifyDonViTinh=ko.observable(!1);u.modifyBPCM=ko.observable(!1);u.modifyDLCM=ko.observable(!1);u.modifyGhiChu=ko.observable(!1);u.modifyY=ko.observable(null);i.mode==2},d=function(){var t=this;t.details=ko.observableArray([]);t.modifies=ko.observableArray([]);t.trangThai=ko.observable(i.mode==1||i.mode==2?model.ModifyStatus:model.Status);t.allowModify=ko.observable(i.allowModify);t.perform=perform;t.mode=ko.observable(i.mode);t.tths1=ko.observable(0);t.tths2=ko.observable(0);t.tths3=ko.observable(0);t.tths4=ko.observable(0);t.activeObject=ko.observable(new v(i.objectEmpty));t.listDonViTinh=ko.observableArray(listDonViTinh);t.activeDetail=ko.observable(new f(null));t.formulas=ko.observableArray([]);t.tongket=ko.observable(new f(null));t.subFormulas=ko.observableArray([]);t.loaded=ko.observable(!1);t.isAdmin=isAdmin;t.isBks=isBks;t.activeCell=ko.observable("");t.isSubmit=ko.observable(!1);t.activeAllocateCell=ko.observable("");t.tempModifies=[];t.n=ko.observable(i.colStates==null||i.colStates.quarters[0]==1);t.q1=ko.observable(i.colStates==null||i.colStates.quarters[1]==1);t.q2=ko.observable(i.colStates==null||i.colStates.quarters[2]==1);t.q3=ko.observable(i.colStates==null||i.colStates.quarters[3]==1);t.q4=ko.observable(i.colStates==null||i.colStates.quarters[4]==1);t.compareChange=function(n,t){n.MucTieu()!=t.MucTieu()&&(n.modifyMucTieu(!0),t.modifyMucTieu(!0));n.CachTinh()!=t.CachTinh()&&(n.modifyCachTinh(!0),t.modifyCachTinh(!0));n.PhuongPhapDo()!=t.PhuongPhapDo()&&(n.modifyPhuongPhapDo(!0),t.modifyPhuongPhapDo(!0));n.Nam_TrongSo()!=t.Nam_TrongSo()&&(n.modifyNam_TrongSo(!0),t.modifyNam_TrongSo(!0));n.Quy1_TrongSo()!=t.Quy1_TrongSo()&&(n.modifyQuy1_TrongSo(!0),t.modifyQuy1_TrongSo(!0));n.Quy2_TrongSo()!=t.Quy2_TrongSo()&&(n.modifyQuy2_TrongSo(!0),t.modifyQuy2_TrongSo(!0));n.Quy3_TrongSo()!=t.Quy3_TrongSo()&&(n.modifyQuy3_TrongSo(!0),t.modifyQuy3_TrongSo(!0));n.Quy4_TrongSo()!=t.Quy4_TrongSo()&&(n.modifyQuy4_TrongSo(!0),t.modifyQuy4_TrongSo(!0));n.Nam_KeHoach()!=t.Nam_KeHoach()&&(n.modifyNam_KeHoach(!0),t.modifyNam_KeHoach(!0));n.Quy1_KeHoach_X()!=t.Quy1_KeHoach_X()&&(n.modifyQuy1_KeHoach_X(!0),t.modifyQuy1_KeHoach_X(!0));n.Quy2_KeHoach_X()!=t.Quy2_KeHoach_X()&&(n.modifyQuy2_KeHoach_X(!0),t.modifyQuy2_KeHoach_X(!0));n.Quy3_KeHoach_X()!=t.Quy3_KeHoach_X()&&(n.modifyQuy3_KeHoach_X(!0),t.modifyQuy3_KeHoach_X(!0));n.Quy4_KeHoach_X()!=t.Quy4_KeHoach_X()&&(n.modifyQuy4_KeHoach_X(!0),t.modifyQuy4_KeHoach_X(!0));n.Quy1_KeHoach_Y()!=t.Quy1_KeHoach_Y()&&(n.modifyQuy1_KeHoach_Y(!0),t.modifyQuy1_KeHoach_Y(!0));n.Quy2_KeHoach_Y()!=t.Quy2_KeHoach_Y()&&(n.modifyQuy2_KeHoach_Y(!0),t.modifyQuy2_KeHoach_Y(!0));n.Quy3_KeHoach_Y()!=t.Quy3_KeHoach_Y()&&(n.modifyQuy3_KeHoach_Y(!0),t.modifyQuy3_KeHoach_Y(!0));n.Quy4_KeHoach_Y()!=t.Quy4_KeHoach_Y()&&(n.modifyQuy4_KeHoach_Y(!0),t.modifyQuy4_KeHoach_Y(!0));n.DonViTinh()!=t.DonViTinh()&&(n.modifyDonViTinh(!0),t.modifyDonViTinh(!0));n.NguyenTacTinh()!=t.NguyenTacTinh()&&(n.modifyNguyenTacTinh(!0),t.modifyNguyenTacTinh(!0));n.appraiserText()!=t.appraiserText()&&(n.modifyBPCM(!0),t.modifyBPCM(!0));n.DuLieuChungMinh()!=null&&t.DuLieuChungMinh()&&n.DuLieuChungMinh()!=t.DuLieuChungMinh()&&(n.modifyDLCM(!0),t.modifyDLCM(!0))};t.real=ko.computed(function(){var i=0,r=0,u=0,f=0,e=0;n(t.details()).each(function(){var l=this,t=0,o=0,s=0,h=0,c=0;n(this.childs()).each(function(){this.Quy1_TrongSo()!="0%"&&(t+=getGTPT(this.Quy1_TyLeTrongSo()));this.Quy2_TrongSo()!="0%"&&(o+=getGTPT(this.Quy2_TyLeTrongSo()));this.Quy3_TrongSo()!="0%"&&(s+=getGTPT(this.Quy3_TyLeTrongSo()));this.Quy4_TrongSo()!="0%"&&(h+=getGTPT(this.Quy4_TyLeTrongSo()));this.Nam_TrongSo()!="0%"&&(c+=getGTPT(this.Nam_TyLeTrongSo()));this.Group()==2&&l.Group()==2});t>100&&(t=100);o>100&&(o=100);s>100&&(s=100);h>100&&(h=100);i+=t*getGTPT(this.Quy1_TrongSo())/100;r+=o*getGTPT(this.Quy2_TrongSo())/100;u+=s*getGTPT(this.Quy3_TrongSo())/100;f+=h*getGTPT(this.Quy4_TrongSo())/100;e+=c*getGTPT(this.Nam_TrongSo())/100;this.Quy1_TyLeHoanThanh(t.toFixed(2)+"%");this.Quy2_TyLeHoanThanh(o.toFixed(2)+"%");this.Quy3_TyLeHoanThanh(s.toFixed(2)+"%");this.Quy4_TyLeHoanThanh(h.toFixed(2)+"%");this.Nam_TyLeHoanThanh(c.toFixed(2)+"%")});t.tongket().Quy1_TyLeHoanThanh(i.toFixed(2)+"%");t.tongket().Quy2_TyLeHoanThanh(r.toFixed(2)+"%");t.tongket().Quy3_TyLeHoanThanh(u.toFixed(2)+"%");t.tongket().Quy4_TyLeHoanThanh(f.toFixed(2)+"%");t.tongket().Nam_TyLeHoanThanh(e.toFixed(2)+"%")});t.modifyDetail=function(i){var r=i.Status();r!=2?(r=2,t.tempModifies.push(ko.toJS(i))):(r=null,n(t.tempModifies).each(function(){this.Id==i.Id()&&(i.Nam_TrongSo(this.Nam_TrongSo),i.Quy1_TrongSo(this.Quy1_TrongSo),i.Quy2_TrongSo(this.Quy2_TrongSo),i.Quy3_TrongSo(this.Quy3_TrongSo),i.Quy4_TrongSo(this.Quy4_TrongSo))}));i.Status(r)};t.deleteDetail=function(n,r){if(i.mode==1)if(n.KpiDetailId()==null)app.postData(DOMAIN_API+"/kpi/deleteKpiyearModifyDetail",{id:n.Id()},function(){r.childs.remove(n);t.resetIndex(n.Group())});else{var u=n.Status();u=u!=1?1:null;n.Status(u)}else n.Id()>0?n.isDelete(!0):r.childs.remove(n),t.resetIndex(n.Group())};t.showAllowcateModal=function(r,u){t.activeDetail(r);n("#allocation_modal").length>0&&n("#allocation_modal").remove();var f=n(u.target);f.button("loading");app.loadData(DOMAIN_API+"/kpi/KpiYearAllocationView",{detailId:r.Id(),dataType:"html",cap:i.cap},null,function(i){f.button("reset");n("body").append(i);n("#allocation_modal").modal("show");setTimeout(function(){initAllocationForm(ko.toJS(r),t.trangThai(),function(n){t.activeDetail().allocationText(n.text);t.activeDetail().DongBo_CongThuc(n.DongBo_CongThuc);var i=app.hasValue(n.text)&&n.DongBo_CongThuc!=null;t.activeDetail().DongBo_Allow(i)})},300)})};t.getOrgs=function(t,i){var u=n(t.target),r="org_selector_modal";n("#"+r).length==0&&app.createEmptyModal({id:r,width:800,headerClass:"p-15",title:"Chọn bộ phận"});u.button("loading");app.loadData(DOMAIN_API+"/general/OrganizationTreeView",{dataType:"html"},null,function(t){u.button("reset");n("#"+r+" .modal-body").html(t);n("#"+r).modal("show");initOrgTreeView(function(t){n("#"+r).modal("hide");i(t)})})};t.getEmps=function(i,r){var f=n(i.target),u="emp_selector_modal";n("#"+u).length==0&&app.createEmptyModal({id:u,width:1200,headerClass:"p-15",title:"Chọn nhân sự nhận mục tiêu"});f.button("loading");app.loadData(DOMAIN_API+"/employee/SuggestionView",{dataType:"html"},null,function(i){f.button("reset");n("#"+u+" .modal-body").html(i);n("#"+u).modal("show");setTimeout(function(){initEmployeeSuggestionView({OrgIdOrHeadCount:t.activeObject().OrganizationId(),TrangThaiCongViec:1},function(t){n("#"+u).modal("hide");r(t)})},400)})};t.showAppraiserModal=function(i){n("#nguon_chung_minh_modal").modal("show");t.activeDetail(i)};t.selectOrgAppraisers=function(r,u){t.getOrgs(u,function(r){n(r).each(function(){var r=this,u=!1;n(t.activeDetail().Appraisers()).each(function(){if(this.OrganizationId()==r.id)return u=!0,!1});u||t.activeDetail().Appraisers.push(new y({OrganizationId:r.id,OrganizationName:r.name,OwnerId:r.owner!=null?r.owner.Id:null,ObjOwner:r.owner,KpiDetailId:i.mode==1?t.activeDetail().KpiDetailId():t.activeDetail().Id()},t.activeDetail().Appraisers().length+1))})})};t.removeAppraiser=function(n){n.Id()>0?n.isDelete(!0):t.activeDetail().Appraisers.remove(n)};t.hideAppraiserModal=function(){t.activeDetail().isValidAppraiser()&&n("#nguon_chung_minh_modal").modal("hide")};t.saveAppraiserModal=function(i,r){var f=n(r.target),u,e;t.activeDetail().isValidAppraiser()&&(u=[],e=ko.toJS(t.activeDetail().Appraisers()),n(e).each(function(){this.childs=null;this.fDesc=null;this.__ko_mapping__=null;this.OrganizationName=null;this.ObjOwner=null;this.CongThucDo="";u.push(this)}),f.button("loading"),app.postData(DOMAIN_API+"/kpi/KpiYearAppraiserCommand",{model:u,detailId:t.activeDetail().Id()},function(){f.button("reset");n("#nguon_chung_minh_modal").modal("hide")}))};t.showNguonChungMinhModal=function(i){n("#nguon_chung_minh_modal").modal("show");t.activeDetail(i)};t.removeDinhKem=function(n,t){if(t==0)n.DangKy_DinhKem("");else switch(t){case 1:n.Quy1_DinhKem("");break;case 2:n.Quy2_DinhKem("");break;case 3:n.Quy3_DinhKem("");break;case 4:n.Quy4_DinhKem("")}};t.showSyncMethodModalModal=function(i){t.activeDetail(i);n("#sync_modal").modal("show");initSyncMethodForm({detailId:t.activeDetail().Id(),value:t.activeDetail().DongBo_CongThuc(),text:t.activeDetail().DongBo_Text()},function(i){i!=null?(t.activeDetail().DongBo_Text(i.text),t.activeDetail().DongBo_CongThuc(i.value)):(t.activeDetail().DongBo_Text(""),t.activeDetail().DongBo_Id(null));n("#sync_modal").modal("hide")})};t.expendGroup=function(t){var i=t.expanded();t.expanded(!i);n(t.childs()).each(function(){this.expanded(!i)})};t.renderSubmitData=function(){var r={Id:t.activeObject().Id(),Year:n(".select-year").val(),OrganizationId:t.activeObject().OrganizationId(),NguoiDuyet1:t.activeObject().NguoiDuyet1(),NguoiDuyet2:t.activeObject().NguoiDuyet2(),OwnerId:model.OwnerId,NgayThanhLap:app.convertVnToEnDate(t.activeObject().NgayThanhLap()),details:[]},u=ko.toJS(t.details()),i;return n(u).each(function(){n(this.childs).each(function(){this.childs=null;this.fDesc=null;this.__ko_mapping__=null;this.CongThucDo="";this.Allocations=null;r.details.push(this)});this.childs=null;this.fDesc=null;this.Appraisers=null;this.CongThucDo="";this.__ko_mapping__=null;r.details.push(this)}),i=ko.toJS(t.tongket()),i.MucTieu="TỔNG KẾT",i.childs=null,i.fDesc=null,i.Summary=!0,i.__ko_mapping__=null,r.details.push(i),r};t.renderPheDuyetData=function(i){var r=[],u;return i=parseInt(i),u=ko.toJS(t.details()),n(u).each(function(){n(this.childs).each(function(){switch(i){case 1:r.push({Id:this.Id,Quy1_GhiChu:this.Quy1_GhiChu});break;case 2:r.push({Id:this.Id,Quy2_GhiChu:this.Quy2_GhiChu});break;case 3:r.push({Id:this.Id,Quy3_GhiChu:this.Quy3_GhiChu});break;case 4:r.push({Id:this.Id,Quy4_GhiChu:this.Quy4_GhiChu})}})}),r};t.checkHSValid=function(t){var r=!0,h=moment();if(typeof model.Quarters=="undefined"&&(model.Quarters=[1,2,3,4]),n(t.details).each(function(){var t=this,e,u,f;if(!t.Summary&&t.ParentId==null)for(u=0;u<model.Quarters.length;u++)if(f=model.Quarters[u],/^\d+(\.\d+)?%$/.test(t["Quy"+f+"_TrongSo"])==!1&&t["Quy"+f+"_TrongSo"]!="")return r=!1,app.notify("warning","Giá trị trọng số không hợp lệ"),!1;if(!t.Summary&&t.ParentId!=null&&!t.isDelete){if(t.MucTieu==null||t.MucTieu=="")return app.notify("warning","Tên mục tiêu chưa đầy đủ"),r=!1,!1;if(t.CachTinh==null||t.CachTinh=="")return app.notify("warning","Giá trị cách tính chưa đầy đủ"),r=!1,!1;if(t.PhuongPhapDo==null||t.PhuongPhapDo=="")return app.notify("warning","Giá trị phương pháp đo chưa đầy đủ"),r=!1,!1;if((i.cap==2||i.cap==4)&&(t.DuLieuChungMinh==null||t.DuLieuChungMinh==""))return app.notify("warning","Dữ liệu chứng minh chưa đầy đủ"),r=!1,!1;if(t.DongBo_Allow&&t.DongBo_CongThuc==null)return app.notify("warning","Công thức phân bổ chưa đầy đủ"),r=!1,!1;if(e=t.Nam_TrongSo,e=="")return app.notify("warning","Trọng số năm chưa đầy đủ"),r=!1,!1;if(t.KpiYearAllocationId!=null&&e=="0%")return app.notify("warning","Trọng số năm phải lớn hơn 0% khi được phân bổ từ cấp trên."),r=!1,!1;if(t.errorNam_KehoachX||t.errorNam_KehoachY)return app.notify("warning","KPIs kế hoạch năm chưa đầy đủ"),r=!1,!1;if(n.inArray(1,model.Quarters)>=0&&t.errorQuy1_KehoachX)return app.notify("warning","KPIs kế hoạch quý 1 chưa đầy đủ"),r=!1,!1;if(n.inArray(2,model.Quarters)>=0&&t.errorQuy2_KehoachX)return app.notify("warning","KPIs kế hoạch quý 2 chưa đầy đủ"),r=!1,!1;if(n.inArray(3,model.Quarters)>=0&&t.errorQuy3_KehoachX)return app.notify("warning","KPIs kế hoạch quý 3 chưa đầy đủ"),r=!1,!1;if(n.inArray(4,model.Quarters)>=0&&t.errorQuy4_KehoachX)return app.notify("warning","KPIs kế hoạch quý 4 chưa đầy đủ"),r=!1,!1;for(u=0;u<model.Quarters.length;u++)if(f=model.Quarters[u],!i.trongSoTheoNam&&/^\d+(\.\d+)?%$/.test(t["Quy"+f+"_TrongSo"])==!1&&t["Quy"+f+"_TrongSo"]!="")return r=!1,app.notify("warning","Giá trị trọng số không hợp lệ"),!1}}),r){var f=0,u=n.inArray(1,model.Quarters)>=0?0:null,e=n.inArray(2,model.Quarters)>=0?0:null,o=n.inArray(3,model.Quarters)>=0?0:null,s=n.inArray(4,model.Quarters)>=0?0:null;if(n(t.details).each(function(){var i=this,c,h,l,v,a;if(i.ParentId==null&&!i.Summary&&i.isDelete==!1){if(c=i.Nam_TrongSo,c=parseInt(c.substr(0,c.length-1)),n.inArray(1,model.Quarters)>=0&&(i["Quy"+a+"_TrongSo"]==""||i["Quy"+a+"_TrongSo"]==null,u+=getGTPT(i.Quy1_TrongSo)),n.inArray(2,model.Quarters)>=0&&(e+=getGTPT(i.Quy2_TrongSo)),n.inArray(3,model.Quarters)>=0&&(o+=getGTPT(i.Quy3_TrongSo)),n.inArray(4,model.Quarters)>=0&&(s+=getGTPT(i.Quy4_TrongSo)),f+=c,l=0,c>0&&(n(t.details).each(function(){this.ParentId!=null&&this.Group==i.Group&&i.isDelete==!1&&(h=this.Nam_TrongSo,h!=""&&(l+=parseFloat(h.substr(0,h.length-1))))}),l!=100))return app.notify("warning","Tổng trọng số năm trong nhóm "+i.MucTieu+" phải là 100%"),r=!1,!1;for(v=0;v<model.Quarters.length;v++)if(a=model.Quarters[v],h=i["Quy"+a+"_TrongSo"],h!="0%"&&(l=0,n(t.details).each(function(){this.ParentId!=null&&this.Group==i.Group&&i.isDelete==!1&&(h=this["Quy"+a+"_TrongSo"],h!=""&&(l+=parseFloat(h.substr(0,h.length-1))))}),l!=100))return app.notify("warning","Trọng số trong nhóm "+i.MucTieu+" quý "+a+" phải là 100%"),r=!1,!1}}),i.type!="Company"&&!i.trongSoTheoNam){if(!r)return!1;if(u!=null&&u>0&&u!=100)return app.notify("warning","Tổng trọng số quý 1 của các nhóm phải là 100%"),r=!1;if(e!=null&&u>0&&e!=100)return app.notify("warning","Tổng trọng số quý 2 của các nhóm phải là 100%"),r=!1;if(o!=null&&u>0&&o!=100)return app.notify("warning","Tổng trọng số quý 3 của các nhóm phải là 100%"),r=!1;if(s!=null&&u>0&&s!=100)return app.notify("warning","Tổng trọng số quý 4 của các nhóm phải là 100%"),r=!1}f>0&&f!=100&&(app.notify("warning","Tổng trọng số năm của các nhóm phải là 100%"),r=!1)}return r};t.checkDCValid=function(t){var r=!0,h=moment();if(typeof model.Quarters=="undefined"&&(model.Quarters=[1,2,3,4]),n(t.details).each(function(){var t=this,e,u,f;if(!t.Summary&&t.ParentId==null)for(u=0;u<model.Quarters.length;u++)if(f=model.Quarters[u],/^\d+(\.\d+)?%$/.test(t["Quy"+f+"_TrongSo"])==!1&&t["Quy"+f+"_TrongSo"]!="")return r=!1,app.notify("warning","Giá trị trọng số không hợp lệ"),!1;if(!t.Summary&&t.ParentId!=null&&t.Status!=1){if(t.MucTieu==null||t.MucTieu=="")return app.notify("warning","Tên mục tiêu chưa đầy đủ"),r=!1,!1;if(t.CachTinh==null||t.CachTinh=="")return app.notify("warning","Giá trị cách tính chưa đầy đủ"),r=!1,!1;if(t.PhuongPhapDo==null||t.PhuongPhapDo=="")return app.notify("warning","Giá trị phương pháp đo chưa đầy đủ"),r=!1,!1;if((i.cap==2||i.cap==4)&&(t.DuLieuChungMinh==null||t.DuLieuChungMinh==""))return app.notify("warning","Dữ liệu chứng minh chưa đầy đủ"),r=!1,!1;if(e=t.Nam_TrongSo,e=="")return app.notify("warning","Trọng số năm chưa đầy đủ"),r=!1,!1;if(t.KpiYearAllocationId!=null&&e=="0%")return app.notify("warning","Trọng số năm phải lớn hơn 0% khi được phân bổ từ cấp trên."),r=!1,!1;if(1>=i.allowModify&&n.inArray(1,model.Quarters)>=0&&t.errorQuy1_KehoachX)return app.notify("warning","KPIs kế hoạch quý 1 chưa đầy đủ"),r=!1,!1;if(2>=i.allowModify&&n.inArray(2,model.Quarters)>=0&&t.errorQuy2_KehoachX)return app.notify("warning","KPIs kế hoạch quý 2 chưa đầy đủ"),r=!1,!1;if(3>=i.allowModify&&n.inArray(3,model.Quarters)>=0&&t.errorQuy3_KehoachX)return app.notify("warning","KPIs kế hoạch quý 3 chưa đầy đủ"),r=!1,!1;if(4>=i.allowModify&&n.inArray(4,model.Quarters)>=0&&t.errorQuy4_KehoachX)return app.notify("warning","KPIs kế hoạch quý 4 chưa đầy đủ"),r=!1,!1;for(u=0;u<model.Quarters.length;u++)if(f=model.Quarters[u],!i.trongSoTheoNam&&/^\d+(\.\d+)?%$/.test(t["Quy"+f+"_TrongSo"])==!1&&t["Quy"+f+"_TrongSo"]!="")return r=!1,app.notify("warning","Giá trị trọng số không hợp lệ"),!1}}),r){var s=0,u=n.inArray(1,model.Quarters)>=0?0:null,f=n.inArray(2,model.Quarters)>=0?0:null,e=n.inArray(3,model.Quarters)>=0?0:null,o=n.inArray(4,model.Quarters)>=0?0:null;if(n(t.details).each(function(){var h=this,a,l,c,y,v;if(h.ParentId==null&&!h.Summary){if(a=h.Nam_TrongSo,a=parseInt(a.substr(0,a.length-1)),1>=i.allowModify&&n.inArray(1,model.Quarters)>=0&&(u+=getGTPT(h.Quy1_TrongSo)),2>=i.allowModify&&n.inArray(2,model.Quarters)>=0&&(f+=getGTPT(h.Quy2_TrongSo)),3>=i.allowModify&&n.inArray(3,model.Quarters)>=0&&(e+=getGTPT(h.Quy3_TrongSo)),4>=i.allowModify&&n.inArray(4,model.Quarters)>=0&&(o+=getGTPT(h.Quy4_TrongSo)),s+=a,l=0,a>0&&(n(t.details).each(function(){this.ParentId!=null&&this.Group==h.Group&&this.Status!=1&&(c=this.Nam_TrongSo,c!=""&&(l+=parseFloat(c.substr(0,c.length-1))))}),l!=100))return app.notify("warning","Tổng trọng số năm trong nhóm "+h.MucTieu+" phải là 100%"),r=!1,!1;if(!i.trongSoTheoNam||i.trongSoTheoNam==null)for(y=0;y<model.Quarters.length;y++)if(v=model.Quarters[y],v>=i.allowModify&&(c=h["Quy"+v+"_TrongSo"],c!="0%"&&(l=0,n(t.details).each(function(){this.ParentId!=null&&this.Group==h.Group&&this.Status!=1&&(c=this["Quy"+v+"_TrongSo"],c!=""&&(l+=parseFloat(c.substr(0,c.length-1))))}),l>0&&l!=100)))return app.notify("warning","Trọng số trong nhóm "+h.MucTieu+" quý "+v+" phải là 100%"),r=!1,!1}}),i.type!="Company"&&!i.trongSoTheoNam){if(!r)return!1;if(1>=i.allowModify&&u!=null&&u!=100)return app.notify("warning","Tổng trọng số quý 1 của các nhóm phải là 100%"),r=!1;if(2>=i.allowModify&&f!=null&&f!=100)return app.notify("warning","Tổng trọng số quý 2 của các nhóm phải là 100%"),r=!1;if(3>=i.allowModify&&e!=null&&e!=100)return app.notify("warning","Tổng trọng số quý 3 của các nhóm phải là 100%"),r=!1;if(4>=i.allowModify&&o!=null&&o!=100)return app.notify("warning","Tổng trọng số quý 4 của các nhóm phải là 100%"),r=!1}s!=100&&(app.notify("warning","Tổng trọng số năm của các nhóm phải là 100%"),r=!1)}return r};t.checkKQValid=function(t){var i=!0,r=t.quy;return n(t.details).each(function(){var n=this;if(!n.Summary&&n.ParentId!=null&&n["errorQuy"+r+"_ThucHien"])return i=!1,app.notify("warning","KPIs thực hiện chưa hợp lệ"),!1}),i};t.resetIndex=function(i){n(t.details()).each(function(){if(this.Group()==i){var t=0;n(this.childs()).each(function(n,i){i.isDelete()==!1&&(i.STT(t+1),t++)})}})};t.events=function(){var t,r,u,f;w();t=0;i.mode!=2?(r=n(".area-tr .table").find("colgroup col"),n(r).each(function(){n(this).css("display")!="none"&&(t+=n(this).width())}),t=parseInt(t),n(".area-tr > div > table").css("width",t),n(".area-br > div > table").css("width",t)):(u=".kpi-table-1",r=n(u+" .area-tr .table").find("colgroup col"),n(r).each(function(){n(this).css("display")!="none"&&(t+=n(this).width())}),t=parseInt(t),n(u+" .area-tr > div > table").css("width",t),n(u+" .area-br > div > table").css("width",t),t=0,f=".kpi-table-2",r=n(f+" .area-tr .table").find("colgroup col"),n(r).each(function(){n(this).css("display")!="none"&&(t+=n(this).width())}),t=parseInt(t),n(f+" .area-tr > div > table").css("width",t),n(f+" .area-br > div > table").css("width",t))};t.addDetail=function(r,u){var e,o;[0,3,7,11,15].indexOf(t.trangThai()>=0)&&(e=n(u.target),e.button("loading"),o=i.mode==1?DOMAIN_API+"/kpi/CreateKpiYearModifyDetail":DOMAIN_API+"/kpi/CreateKpiYearDetail",app.postData(o,{KpiId:model.Id,STT:r.childs().length+1,ParentId:i.mode==1?r.KpiDetailId():r.Id(),Group:r.Group(),Status:0,cap:i.cap},function(n){e.button("reset");r.childs.push(new f(n.Data,r.childs().length+1));var t=Array.prototype.slice.call(document.querySelectorAll(".switchery"));t.forEach(function(n){new Switchery(n,{color:"#2196F3"})})}))};t.initEditGroup=function(t,i){var e="edit_detail_group_modal",u;i.button("loading");u=t==null;app.createPartialModal({url:DOMAIN_API+"/kpi/KpiYearDetailEdit",data:{id:t!=null?t.Id():null,kpiId:model.Id},modal:{title:(u!=!1?"Cập nhật ":"Thêm ")+" nhóm mục tiêu",width:"600px",id:e}},function(){i.button("reset");initKpiYearDetailForm(function(i){n("#"+e).modal("hide");u?r.details.push(new f(i,r.details().length+1)):(i.ObjNhomMucTieu!=null&&t.STT(i.ObjNhomMucTieu.Name),t.MucTieu(i.MucTieu),t.Group(i.Group));r.details(r.details().sort(function(n,t){return n.Group()==t.Group()?0:n.Group()>t.Group()?1:-1}))})})};t.editGroup=function(i,r){var u=n(r.target);t.initEditGroup(i,u)};t.deleteGroup=function(n){app.confirm("warning",null,null,function(t){t&&(n.Id()>0?n.isDelete(!0):r.details.remove(n))})};t.editPhuongPhapDo=function(n){t.activeDetail(n);initPhuongPhapDoModal({PhuongPhapDo:n.PhuongPhapDo(),X:n.X(),Y:n.Y()},function(n){t.activeDetail().X(n.X);t.activeDetail().Y(n.Y);t.activeDetail().PhuongPhapDo(n.phuongPhapDo);t.activeDetail().Nam_KeHoach(n.X);var i=tinhCongThucDo({X:n.X,Y:n.Y},n.phuongPhapDo);t.activeDetail().CongThucDoHtml(i)},!1)};t.resize=function(){var i,r,u;t.setTableHeight(0);i=n(s).width();r=i/2-130;n(s+" h3").css("padding-left",r);u=n(window).height();n("#allocation_modal .table-responsive").css("height",u-240)};t.setTableHeight=function(){var t=n(window).height(),r=i.mode==2?60:0;n(o).css("height",t-topHeight-r);n(h).css("height",t-(topHeight+r+i.head.height));n(h+" > div").css("height",t-(topHeight+r+i.head.height));n(c).css("height",t-(topHeight+r+i.head.height));n(c+" > div").css("height",t-(topHeight+r+i.head.height))};t.setAreaSize=function(t){n(a).css("width",t);n(a+" > div").css("width",t);n(s).css("left",t);n(s+" > div").css("left",t);n(h).css("width",t);n(h+" > div").css("width",t+18);n(c).css("left",t);n(c+" > div").css("left",t)};t.selectCell=function(i,r){t.activeCell(i);n(r.currentTarget).find("textarea").focus()};t.loadDetails=function(u){t.details.removeAll();switch(i.mode){case 1:app.loadData(DOMAIN_API+"/kpi/KpiYearModifyDetailList",{KpiId:model.Id,mode:1,cap:i.cap},null,function(u){n(u).each(function(){if(this.ParentId==null&&!this.Summary){this.Status=0;var i=new f(this);n(u).each(function(){if(this.Group==i.Group()&&this.ParentId!=null&&this.ParentId==i.KpiDetailId()){var n=new f(this,i.childs().length+1);i.childs.push(n)}});i.childs().sort(function(n,t){var i=parseInt(n.STT()),r=parseInt(t.STT());return i>r?1:i<r?-1:0});t.details.push(i)}this.Summary&&(t.tongket().Id(this.Id),t.tongket().Summary(!0))});t.events();t.loaded(!0);i.initCallback!=null&&i.initCallback(r)});break;case 2:app.loadData(DOMAIN_API+"/kpi/KpiYearModifyDetailList",{KpiId:model.Id,mode:2,cap:i.cap},null,function(u){n(u.details).each(function(){if(this.ParentId==null&&!this.Summary){var i=new f(this);n(u.details).each(function(){if(this.Group==i.Group()&&this.ParentId!=null&&this.ParentId==i.Id()){var n=new f(this,i.childs().length+1);n.Status(null);i.childs.push(n)}});i.childs().sort(function(n,t){var i=parseInt(n.STT()),r=parseInt(t.STT());return i>r?1:i<r?-1:0});t.details.push(i)}this.Summary&&(t.tongket().Id(this.Id),t.tongket().Summary(!0))});n(u.modifies).each(function(){if(this.ParentId==null&&!this.Summary){var i=new f(this);n(u.modifies).each(function(){if(this.Group==i.Group()&&this.ParentId!=null&&this.ParentId==i.KpiDetailId()){var n=new f(this,i.childs().length+1);i.childs.push(n)}});i.childs().sort(function(n,t){var i=parseInt(n.STT()),r=parseInt(t.STT());return i>r?1:i<r?-1:0});t.modifies.push(i)}this.Summary&&(t.tongket().Id(this.Id),t.tongket().Summary(!0))});n(t.details()).each(function(){var i=this;i.ParentId()==null&&(n(t.modifies()).each(function(){var t,n;if(this.Group()==i.Group()&&this.childs().length>i.childs().length)for(t=this.childs().length-i.childs().length,n=0;n<t;n++)i.childs.push(new k)}),n(i.childs()).each(function(){var r=this;n(t.modifies()).each(function(){this.Group()==i.Group()&&n(this.childs()).each(function(){this.KpiDetailId()==r.Id()&&t.compareChange(r,this)})})}))});t.events();t.loaded(!0);i.initCallback!=null&&i.initCallback(r)});break;case 3:app.loadData(DOMAIN_API+"/Kpi/KpiYearDetailAppraiserList",{kpiId:model.Id,approverId:empId,cap:i.cap,OrganizationId:appraiser_OrgId},null,function(u){n(u).each(function(){if(this.ParentId==null&&!this.Summary){var r=new f(this);i.mode==1&&r.Status(0);n(u).each(function(){if(this.Group==r.Group()&&this.ParentId!=null&&this.ParentId==r.Id()){var n=new f(this,r.childs().length+1);i.mode==1&&n.Status(null);r.childs.push(n)}});r.childs().sort(function(n,t){var i=parseInt(n.STT()),r=parseInt(t.STT());return i>r?1:i<r?-1:0});t.details.push(r)}this.Summary&&(t.tongket().Id(this.Id),t.tongket().Summary(!0))});t.events();t.loaded(!0);i.initCallback!=null&&i.initCallback(r)});break;default:app.loadData(DOMAIN_API+"/kpi/KpiYearDetailList",{KpiId:model.Id,OrganizationId:u,cap:i.cap},null,function(u){n(u).each(function(){if(this.ParentId==null&&!this.Summary){var r=new f(this);i.mode==1&&r.Status(0);n(u).each(function(){if(this.Group==r.Group()&&this.ParentId!=null&&this.ParentId==r.Id()){var n=new f(this,r.childs().length+1);i.mode==1&&n.Status(null);r.childs.push(n)}});r.childs().sort(function(n,t){var i=parseInt(n.STT()),r=parseInt(t.STT());return i>r?1:i<r?-1:0});t.details.push(r)}this.Summary&&(t.tongket().Id(this.Id),t.tongket().Summary(!0))});t.events();t.loaded(!0);i.initCallback!=null&&i.initCallback(r)})}};t.saveColStates=function(){var r={groups:i.head.groups,quarters:[t.n()?1:0,t.q1()?1:0,t.q2()?1:0,t.q3()?1:0,t.q4()?1:0]};n("#data_state").css("display","block");app.postData(DOMAIN_API+"/kpi/UpdateKpiYearColStates",{kpiId:model.Id,colStates:JSON.stringify(r)},function(){n("#data_state").css("display","none")})};t.sort=function(n){console.log(n)};t.expandQuater=function(i,r){var u,f,e;switch(i){case 0:u=r!=null?r:t.n();t.n(!u);break;case 1:u=r!=null?r:t.q1();t.q1(!u);break;case 2:u=r!=null?r:t.q2();t.q2(!u);break;case 3:u=r!=null?r:t.q3();t.q3(!u);break;case 4:u=r!=null?r:t.q4();t.q4(!u)}f=0;e=n(".area-tr .table").find("colgroup col");n(e).each(function(){n(this).css("display")!="none"&&(f+=n(this).width())});f=parseInt(f);n(".area-tr > div > table").css("width",f);n(".area-br > div > table").css("width",f);t.saveColStates()};t.init=function(){t.setAreaSize(i.mode==2?0:e);t.resize();t.activeObject(new v(model));t.loadDetails(model.OrganizationId);n(formulas).each(function(){this.ParentId==null?t.formulas.push(this):t.subFormulas.push(this)})};t.init()};u.drawEmptyRow=function(n){return'<td style="height: 80px" colspan="'+n+'" data-bind="visible: empty() == true"><\/td>'};u.drawRow=function(t){var r="<td ",f=" ($root.mode() == 1 || $root.mode() ==  2) ",s,o,e,u;switch(t.type){case"modifyState":r+=' class="" >';r+='<span class="modify-state modify-add" data-bind="visible: Status() == 0 && '+f+'">Thêm mới<\/span>';r+='<span class="modify-state modify-delete" style="padding-top: 28px" data-bind="visible: Status() == 1 && '+f+'">Xóa<\/span>';r+='<span class="modify-state modify-edit" data-bind="visible: Status() == 2 && '+f+'">Cập nhật<\/span>';break;case"control":r+=' class="control" style="vertical-align: middle" data-bind="visible: !empty()">';i.mode==1&&(s=' <button class="btn btn-default btn-delete mb-15" data-bind="click: function(data, event) { $root.modifyDetail($data, $parents[1], data, event) },visible: $root.trangThai() == 0  && (KpiDetailId() != null) ',s+='" > <i class="icon-pencil7 text-primary" style = "margin-left: 0px; font-size: 13px;" ><\/i > <\/button > ',r+=s);u=" ";switch(i.mode){case 0:u+=" ($root.trangThai() == 0 || $root.trangThai() == 2) ";break;case 1:u+="  $root.trangThai() == 0  ";break;case 2:u+=" false ";break;case 3:u+=" false "}u+=" && KpiEvaluationCriteriaId() == null && KpiYearAllocationId() == null ";r+='<button class="btn btn-default btn-delete" data-bind="click: function(data, event) {$root.deleteDetail($data, $parents[0], data, event) }, visible: '+u+' "><i class="icon-x text-danger" style="margin-left: 0px; font-size: 13px;"><\/i><\/button>';r+='<span class="resize-y" data-bind="draggable: $data"><\/span>';r+='<span class="modify-state modify-add" data-bind="visible: Status() == 0 && $root.mode() == 2">Thêm mới<\/span>';r+='<span class="modify-state modify-delete" data-bind="visible: Status() == 1 && $root.mode() == 2">Xóa<\/span>';r+='<span class="modify-state modify-edit" data-bind="visible: Status() == 2 && $root.mode() == 2">Cập nhật<\/span>';break;case"expand":r+=' class="text-center" style="vertical-align: middle" data-bind="visible: !empty()"> <button class="btn btn-xs btn-expand" type="button" data-bind="click: $root.expendGroup"><i class="icon-arrow-down5"data-bind="css: { \'icon-arrow-down5\' : expanded() == true, \'icon-arrow-up5\' : expanded() == false }"><\/i><\/button> <\/td>';break;case"STT":i.dependCompany&&(u+=" && KpiYearAllocationId() == null ");r+="data-bind=\"visible: !empty(), css: { 'edit': $root.activeCell() == 'cell_stt_' + guid(), ";r+="'has-error' : $root.isSubmit() == true  && (STT() == '' || STT() == null), 'm-delete': Status() == 1 && "+f+", 'm-add': Status() == 0 && "+f+" }, ";r+='click: function(data, event) { $root.selectCell(\'cell_stt_\' + guid(), event) }" ><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span><textarea class="form-control text-center" rows="4" data-bind="value: STT , ';u=" enable: ";switch(i.mode){case 0:u+=" ($root.trangThai() == 0 || $root.trangThai() == 2) ";break;case 1:u+="  $root.trangThai() == 0 && (Status() == 0 || Status() == 2) ";break;case 2:u+=" false ";break;case 3:u+=" false "}r+=u+'"><\/textarea>';break;case"text":r+=' class="'+(t.class!=null?t.class:"")+'" ';r+=t.bind!=null?'data-bind="'+t.bind+' " > ':'> <span style="'+(t.style!=null?t.style:"")+'" data-bind="text: '+t.attribute+'"><\/span>';o=" visible: ";o+=i.mode==1?" $root.trangThai() == 0  ":i.mode==0?" ($root.trangThai() == 0 || $root.trangThai() == 2) ":" false ";t.addDetail&&allowChangeGroup&&(r+='<button type="button" class="btn bg-teal  btn-add-child ml-15" data-bind="click: $root.addDetail, '+o+'" title="Thêm mục tiêu con"><i class="icon-plus3"><\/i><\/button>',r+='  <button type="button" class="btn bg-teal btn-add-child " data-bind="click: $root.editGroup, '+o+' && KpiYearAllocationId() == null && KpiEvaluationCriteriaId() == null " title="Cập nhật nhóm mục tiêu"><i class="icon-pencil7"><\/i><\/button>',r+='  <button type="button" class="btn bg-teal  btn-add-child " data-bind="click: $root.deleteGroup, '+o+' && KpiYearAllocationId() == null && KpiEvaluationCriteriaId() == null " title="Xóa nhóm mục tiêu"><i class="icon-trash"><\/i><\/button>');break;case"input":r+=' data-bind="visible: !empty() && '+(t.q>0?"$root.q"+t.q:"$root.n")+"() == true, css: { ";r+="'m-delete': Status() == 1 && "+f+" , 'm-add': Status() == 0 && "+f+" , 'edit': $root.activeCell() == 'cell_"+t.code+"_' + guid() ";t.warning&&(r+=", 'has-error' : $root.isSubmit() == true  && ("+t.attribute+"() == '' || "+t.attribute+"() == null) ");r+=" }, ";r+="click: function(data, event) { $root.selectCell('cell_"+t.code+"_' + guid(), event) } "+(t.quy!=null?", style: { 'display' : $root.q"+t.quy+"() == true ? 'table-cell' : 'none' } ":"")+'" class="edit"><input class="form-control text-center" data-bind="value: '+t.attribute+" ";t.realTime&&(r+=" , valueUpdate: 'afterkeydown' ");r+='" /><\/td>';break;case"textarea":r+="data-bind=\"visible: !empty(), css: { 'edit': $root.activeCell() == 'cell_"+t.code+"_' + guid()";t.warning&&(r+=", 'has-error' : $root.isSubmit() == true  && ("+t.attribute+"() == '' || "+t.attribute+"() == null) && ($root.perform != 'create' || ($root.perform == 'create' && Status() != 1))");r+=", 'm-delete': Status() == 1 && "+f+", 'm-add': Status() == 0 && "+f+", 'm-edit': "+f+" && modify"+t.attribute+"() == true ";r+=" }, ";r+="click: function(data, event) { $root.selectCell('cell_"+t.code+'_\' + guid(), event) }" ><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span><textarea class="form-control" rows="4" data-bind="value: '+t.attribute+", ";t.realTime&&(r+="valueUpdate: 'afterkeydown', ");u=" KpiEvaluationCriteriaId() == null && KpiYearAllocationId() == null ";switch(i.mode){case 0:u+=" && ($root.trangThai() == 0 || $root.trangThai() == 2) ";break;case 1:u+=" && $root.trangThai() == 0 && (Status() == 0 || Status() == 2) ";break;case 2:u+=" && false ";break;case 3:u+=" && false "}r+="enable: "+u+'"><\/textarea>';r+='<button type="button" class="btn btn-show-info btn-xs" data-m="1;3;4" data-bind="visible : ('+u+') == false"><i class="icon-warning22"><\/i><\/button>';break;case"GhiChu":r+="data-bind=\"visible: !empty(), css: { 'edit': $root.activeCell() == 'cell_"+t.code+"_' + guid()";t.warning&&(r+=", 'has-error' : $root.isSubmit() == true  && (GhiChu() == '' || GhiChu() == null) && ($root.perform != 'create' || ($root.perform == 'create' && Status() != 1))");r+=", 'disabled' : GhiChuFromCriteria() == true  ";r+=", 'm-delete': Status() == 1 && "+f+", 'm-add': Status() == 0 && "+f+", 'm-edit': "+f+" && modifyGhiChu() == true ";r+=" }, ";r+="click: function(data, event) { $root.selectCell('cell_"+t.code+'_\' + guid(), event) }" ><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span><textarea class="form-control" rows="4" data-bind="value: GhiChu ';t.realTime&&(r+=", valueUpdate: 'afterkeydown'");u=" ";switch(i.mode){case 0:u+=" ($root.trangThai() == 0 || $root.trangThai() == 2) && GhiChuFromCriteria() != true ";break;case 1:u+=" $root.trangThai() == 0 && (Status() == 0 || Status() == 2) && GhiChuFromCriteria() != true ";break;case 2:u+=" false ";break;case 3:u+=" false "}r+=", enable:"+u+'"><\/textarea>';r+='<button type="button" class="btn btn-show-info btn-xs" data-m="1;4" data-bind="visible : ('+u+') == false"><i class="icon-warning22"><\/i><\/button>';break;case"DuLieuChungMinh":r+="data-bind=\"visible: !empty(),css: { 'edit': $root.activeCell() == 'cell_dlcm_' + guid()";r+=", 'm-delete': Status() == 1 && "+f+", 'm-add': Status() == 0 && "+f+" , 'm-edit': "+f+" && modifyDLCM() == true, 'has-error' : $root.isSubmit() == true  && (DuLieuChungMinh() == '' || DuLieuChungMinh() == null) && ($root.perform != 'create' || ($root.perform == 'create' && Status() != 1)) ";r+=" }, ";r+='click: function(data, event) { $root.selectCell(\'cell_dlcm_\' + guid(), event) }" ><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span><textarea class="form-control" rows="4" data-bind="value: DuLieuChungMinh ';u=" (KpiEvaluationCriteriaId() == null || (KpiEvaluationCriteriaId() != null && DuLieuChungMinh() != '' )) ";switch(i.mode){case 0:u+=" && ($root.trangThai() == 0 || $root.trangThai() == 2) ";break;case 1:u+=" && $root.trangThai() == 0 && (Status() == 0 || Status() == 2)  ";break;case 2:u+=" && false ";break;case 3:u+=" && false "}r+=", enable: "+u+'"><\/textarea>';r+='<button type="button" class="btn btn-show-info btn-xs" data-m="1;3;4" data-bind="visible : ('+u+') == false"><i class="icon-warning22"><\/i><\/button>';break;case"select":r+='data-bind="visible: !empty(), css: { ';r+=" 'm-delete': Status() == 1 && "+f+" , 'm-add': Status() == 0 &&  "+f+" , 'm-edit':  "+f+" && modify"+t.attribute+"() == true, 'edit': $root.activeCell() == 'cell_"+t.code+"_' + guid() , ";u=" ";u+=i.mode==1?"  $root.trangThai() == 0 && (Status() == 0 || Status() == 2) ":i.mode==0?" ($root.trangThai() == 0 || $root.trangThai() == 2) ":" false ";i.dependCompany&&(u+=" && KpiYearAllocationId() == null ");u+=" && KpiEvaluationCriteriaId() == null ";r+="  'disabled' :! ( "+u+" ) }, click: function(data, event) { $root.selectCell('cell_"+t.code+"_' + guid(), event) } \">";r+='<span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+=t.attribute=="DonViTinh"?"<select class=\"form-control\" data-bind=\"options: listDonViTinh,optionsText: 'Name',optionsValue: 'Code',value: DonViTinh, enable: "+u+' "><\/select>':"<select class=\"form-control\" data-bind=\"options: principles,optionsText: 'name', optionsValue: 'id',value: NguyenTacTinh, enable : "+u+' "><\/select>';r+='<button type="button" class="btn btn-show-info btn-xs" data-m="1;3;4" data-bind="visible : ('+u+') == false"><i class="icon-warning22"><\/i><\/button>';break;case"ppd":r+=' class="edit" data-bind="visible: !empty(), css: { ';r+=" 'm-delete': Status() == 1 &&  "+f+", 'm-add': Status() == 0 &&  "+f+", 'm-edit':  "+f+" && modifyPhuongPhapDo() == true , 'edit': $root.activeCell() == 'cell_ctd_' + guid(), ";r+="'has-error' : $root.isSubmit() == true  && (CongThucDoHtml() == '' || CongThucDoHtml() == null) && ($root.perform != 'create' || ($root.perform == 'create' && Status() != 1)) }, ";u=" ";switch(i.mode){case 0:u+=" ($root.trangThai() == 0 || $root.trangThai() == 2) ";break;case 1:u+="  $root.trangThai() == 0 && (Status() == 0 || Status() == 2) ";break;case 2:u+=" false ";break;case 3:u+=" false "}i.dependCompany&&(u+=" && KpiYearAllocationId() == null ");u+=" && (KpiEvaluationCriteriaId() == null || (KpiEvaluationCriteriaId() != null && (PhuongPhapDo() == 0 || PhuongPhapDo() == null) )) ";r+="'disabled' : !( "+u+" )  ";r+=' ">';r+='<textarea class="text-label" data-bind="value: CongThucDoHtml, enable: '+u+' "><\/textarea>';r+='<button type="button" class="btn btn-show-modal " data-bind="click: $root.editPhuongPhapDo, enable: '+u+'"><i class="icon-pencil7"><\/i><\/button>';r+='<button type="button" class="btn btn-show-info btn-xs" data-m="1;3;4" data-bind="visible : ('+u+') == false"><i class="icon-warning22"><\/i><\/button>';break;case"ncm":u=" ";u+=i.mode==1?"  $root.trangThai() == 0 && (Status() == 0 || Status() == 2) && (KpiEvaluationCriteriaId() == null || (KpiEvaluationCriteriaId() != null && AppraiserFromCriteria() == false) ) ":i.mode==0?" ($root.trangThai() == 0 || $root.trangThai() == 2) && (KpiEvaluationCriteriaId() == null || (KpiEvaluationCriteriaId() != null && AppraiserFromCriteria() == false) ) ":" false ";i.dependCompany&&(u+=" ");u+=" ";r+="data-bind=\"visible: !empty(), css: { 'disabled' : !( "+u+" ) , 'm-add': Status() == 0 &&  "+f+", 'm-delete': Status() == 1 &&  "+f+", 'm-edit':  "+f+' && modifyBPCM() == true}">';r+='<span class="text-label" data-bind="text: appraiserText" ><\/span>';r+=' <button class="btn btn-show-modal" type="button"data-bind="click: $root.showAppraiserModal, enable : '+u+' "><i class="icon-pencil7"><\/i><\/button>';r+='<button type="button" class="btn btn-show-info btn-xs" data-m="1;4" data-bind="visible : ('+u+') == false"><i class="icon-warning22"><\/i><\/button>';break;case"PhanBoMucTieu":u=" ";u+=i.mode==1?" false ":i.mode==0?" true ":" false ";r+="data-bind=\"visible: !empty(), css: { 'disabled' : !"+u+'}" ><span class="text-label" data-bind="text: allocationText"><\/span><button class="btn btn-show-modal " type="button"data-bind="click: $root.showAllowcateModal "><i class="icon-pencil7 "><\/i><\/button>';break;case"number":u=" ";u+=i.mode==1?"  $root.trangThai() == 0 && (Status() == 0 || Status() == 2) ":" ($root.trangThai() == 0 || $root.trangThai() == 2) ";i.dependCompany&&(u+=" && KpiYearAllocationId() == null ");r+="data-bind=\"visible: !empty(), css: { 'disabled' : !( "+u+" ), ";r+="'edit': $root.activeCell() == 'cell_"+t.code+"_' + guid(), 'm-add': Status() == 0 &&  "+f+" , 'm-delete': Status() == 1 &&  "+f+"  ";t.warning&&(r+=", 'has-error' : $root.isSubmit() == true  && ("+t.attribute+"() == '' || "+t.attribute+"() == null) }, ");r+="} , click: function(data, event) { $root.selectCell('cell_"+t.code+"_' + guid(), event) } ";r+='"><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span><p style="padding: 3px 8px; margin: 0px; text-align: left" data-bind="visible: $root.activeCell() != \'cell_'+t.code+"_' + guid() , text: "+t.attribute+'Str"><\/p>';r+='<textarea class="form-control" rows="4" data-bind="value: '+t.attribute+", visible: $root.activeCell() == 'cell_"+t.code+"_' + guid(), enable : "+u+' "><\/textarea>';break;case"attach":u="";t.quy!=null?(u=" $root.trangThai() == "+(t.quy*4-1),r+="data-bind=\"visible: !empty(), css: { 'disabled' : !( "+u+" )} , 'm-delete': Status() == 1 &&  "+f+" , style: { 'display' : $root.q"+t.quy+"() == true ? 'table-cell' : 'none' } \">",r+=' <div data-bind="visible : '+u+'"><input type="file" data-bind="attr: { \'id\' : \'attach-quy'+t.quy+'-\' + guid() }"  class="file-attach"  /> <\/div>',r+='<a href="#" class="mt-5" title="Xem file" target="_blank" data-bind="attr: { href : Quy'+t.quy+"_DinhKem() }, visible: Quy"+t.quy+"_DinhKem() != null && Quy"+t.quy+'_DinhKem() !=  \'\'"> <i class="icon-file-download"><\/i> <\/a> <a href="#" class="mt-5 ml-10" title="Xóa file đính kèm" target="_blank" data-bind="visible: Quy'+t.quy+"_DinhKem() != null && Quy"+t.quy+"_DinhKem() !=  '' && "+u+", click: function(data, event) { $root.removeDinhKem($data, "+t.quy+' , event) }"> <i class="icon-trash text-danger"><\/i> <\/a>'):(u+=i.mode==1?"  $root.trangThai() == 0 && (Status() == 0 || Status() == 2) ":i.mode==0?" ($root.trangThai() == 0 || $root.trangThai() == 2) ":" false ",i.dependCompany&&(u+=" && KpiYearAllocationId() == null "),r+="data-bind=\"visible: !empty(), css: { 'disabled' : !( "+u+" ), 'm-add': Status() == 0 &&  "+f+",  'm-delete': Status() == 1 &&  "+f+"} "+(t.quy!=null?", style: { 'display' : $root.q"+t.quy+"() == true ? 'table-cell' : 'none' } ":"")+'">',r+=' <div data-bind=""><input type="file" data-bind="attr: { \'id\' : \'attach-dangky-\' + guid() }, enable: '+u+'" class="file-attach"  /> <\/div>',r+='<a href="#" class="mt-5" title="Xem file" target="_blank" data-bind="attr: { href : DangKy_DinhKem() }, visible: DangKy_DinhKem() != null && DangKy_DinhKem() != \'\'"> <i class="icon-file-download"><\/i> <\/a> <a href="#" class="mt-5 ml-10" title="Xóa file đính kèm" target="_blank" data-bind="visible: DangKy_DinhKem() != null && DangKy_DinhKem() != \'\' && '+u+', click: function(data, event) { $root.removeDinhKem($data, 0 , event) }"> <i class="icon-trash text-danger"><\/i> <\/a>');r+='<button type="button" class="btn btn-show-info btn-xs" data-m="3;4" data-bind="visible : ('+u+') == false"><i class="icon-warning22"><\/i><\/button>';break;case"TrongSoQuy":r+="data-bind=\"visible: !empty(), css: {  'm-delete': Status() == 1 &&  "+f+", 'm-add': Status() == 0 &&  "+f+", 'm-edit':  "+f+" && modifyQuy"+ +t.quy+"_TrongSo() == true , 'edit': $root.activeCell() == 'cell_ts"+t.quy+"_' + guid()";t.warning&&(r+=", 'has-error' : $root.isSubmit() == true  && (Quy"+t.quy+"_TrongSo() == '' || Quy"+t.quy+"_TrongSo() == null) && ($root.mode() != 1 || ($root.mode() == 1 && ((Status() == 0 || Status() == 2)))) ");r+=" }, ";r+="click: function(data, event) { $root.selectCell('cell_ts"+t.quy+"_' + guid(), event) }, style: { 'display' : $root.q"+t.quy+'() == true ? \'table-cell\' : \'none\' } " ><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span><textarea class="form-control text-center" rows="4" data-bind="value: Quy'+t.quy+"_TrongSo ";r+=", valueUpdate: 'afterkeydown'";u=", enable: ";switch(i.mode){case 0:u+=" ($root.trangThai() == 0 || $root.trangThai() == 2) ";break;case 1:u+=" $root.trangThai() == 0 && $root.allowModify() <= "+t.quy+" && (Status() == 0 || Status() == 2)";break;case 2:u+=" false ";break;case 3:u+=" false "}r+=u+'"><\/textarea>';break;case"KetQuaQuy":r+=' class="disabled" data-bind="visible: !empty(), css: { ';r+="'m-delete': Status() == 1 &&  "+f+", 'm-add': Status() == 0 &&  "+f+" , 'edit': $root.activeCell() == 'cell_kq"+t.quy+"_' + guid() ";r+="} , click: function(data, event) { $root.selectCell('cell_kq"+t.quy+"_' + guid(), event) } ";r+=", style: { 'display' : $root.q"+t.quy+'() == true ? \'table-cell\' : \'none\' } "><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+='<textarea disabled="disabled" class="form-control text-center" rows="4" data-bind="value: Quy'+t.quy+'_KetQua  "><\/textarea>';break;case"KeHoach_X":u=" ";switch(i.mode){case 0:u+=" ($root.trangThai() == 0 || $root.trangThai() == 2) && ( KpiEvaluationCriteriaId() == null || (KpiEvaluationCriteriaId() != null &&  Default_Quy_KeHoach_X() == '' || Default_Quy_KeHoach_X() == null )) ";break;case 1:u+=" $root.trangThai() == 0 && $root.allowModify() <= "+t.quy+" && (Status() == 0 || Status() == 2) && ( KpiEvaluationCriteriaId() == null || (KpiEvaluationCriteriaId() != null && Default_Quy_KeHoach_X() == '' || Default_Quy_KeHoach_X() == null )) ";break;case 2:u+=" false ";break;case 3:u+=" false "}r+="data-bind=\"visible: !empty(), attr:{'colspan' : PhuongPhapDo() < 4 ? 2 : 0 }, css: { 'disabled' :  !( "+u+" ), ";r+="'m-add': Status() == 0 && "+f+", 'm-delete': Status() == 1 && "+f+", 'm-edit': "+f+" && modifyQuy"+ +t.quy+"_KeHoach_X() == true,  'edit': $root.activeCell() == 'cell_kh_"+t.quy+"_' + guid() ";r+=", 'has-error' : $root.isSubmit() == true  &&  errorQuy"+t.quy+"_KehoachX() == true && ($root.perform != 'create' || ($root.perform == 'create' && Status() != 1)) }, ";r+="} , click: function(data, event) { $root.selectCell('cell_kh_"+t.quy+"_' + guid(), event) } ";r+=", style: { 'display' : $root.q"+t.quy+'() == true ? \'table-cell\' : \'none\' } "><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+='<button type="button" class="btn btn-show-info btn-xs" data-m="1;3;4" data-bind="visible: ('+u+') == false"><i class="icon-warning22"><\/i><\/button>';r+='<textarea readonly="readonly"  class="form-control text-center" rows="4" data-bind="value: Quy'+t.quy+"_KeHoach_XStr, visible: $root.activeCell() != 'cell_kh_"+t.quy+'_\' + guid(), attr: { placeholder : placeholderX  } " placeholder=""><\/textarea>';r+='<textarea class="form-control text-center" rows="4" data-bind="value: Quy'+t.quy+"_KeHoach_X, visible: $root.activeCell() == 'cell_kh_"+t.quy+"_' + guid(), enable : "+u+', attr: { placeholder : placeholderX , eva: KpiEvaluationCriteriaId, dx: Default_Quy_KeHoach_X }  " placeholder=""><\/textarea>';break;case"Y":u=" KpiEvaluationCriteriaId() != null && ( Default_X() == '' ||  Default_X() == null ) ";switch(i.mode){case 0:u+="&& ($root.trangThai() == 0 || $root.trangThai() == 2) ";break;case 1:u+="&&  $root.trangThai() == 0 && (Status() == 0 || Status() == 2) ";break;case 2:u+="&& false ";break;case 3:u+="&& false "}e="'disabled' : !("+u+") , ";e+="'m-add': Status() == 0 && "+f+", 'm-edit': "+f+" && modifyY() == true, 'm-delete': Status() == 1 && "+f+", 'edit': $root.activeCell() == 'cell_y_' + guid() , 'has-error' : $root.isSubmit() == true  &&  errorNam_KehoachY() == true && ($root.perform != 'create' || ($root.perform == 'create' && Status() != 1)) ";r+=' class="disabled" data-bind="visible: !empty() && PhuongPhapDo() >= 4  && $root.n() == true, css: { '+e+"} , click: function(data, event) { $root.selectCell('cell_y_' + guid(), event) } ";r+='"><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+='<textarea disabled="disabled" class="form-control text-center" rows="4" data-bind="value: Y, enable: '+u+', attr: { placeholder : placeholderY  } "><\/textarea>';break;case"KeHoach_Y":u=" ";switch(i.mode){case 0:u+=" ($root.trangThai() == 0 || $root.trangThai() == 2) && ( Default_Quy_KeHoach_Y() == null || Default_Quy_KeHoach_Y() == '' )";break;case 1:u+="  $root.trangThai() == 0 && $root.allowModify() <= "+t.quy+" && (Status() == 0 || Status() == 2)  && ( Default_Quy_KeHoach_Y() == null || Default_Quy_KeHoach_Y() == '' ) ";break;case 2:u+=" false ";break;case 3:u+=" false "}r+='data-bind="visible: !empty() && PhuongPhapDo() >= 4 && $root.q'+t.quy+"() == true, css: { 'disabled' : !( "+u+" ), ";r+="'m-add': Status() == 0 && "+f+", 'm-delete': Status() == 1 && "+f+", 'm-edit': "+f+" && modifyQuy"+ +t.quy+"_KeHoach_Y() == true,  'edit': $root.activeCell() == 'cell_khy_"+t.quy+"_' + guid() ";r+=", 'has-error' : $root.isSubmit() == true  &&  errorQuy"+t.quy+"_KehoachY() == true && ($root.perform != 'create' || ($root.perform == 'create' && Status() != 1)) }, ";r+="} , click: function(data, event) { $root.selectCell('cell_khy_"+t.quy+"_' + guid(), event) } ";r+='"><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+='<textarea readonly="readonly"  class="form-control text-center" rows="4" data-bind="value: Quy'+t.quy+"_KeHoach_YStr, visible: $root.activeCell() != 'cell_khy_"+t.quy+"_' + guid(), attr: { placeholder : placeholderY  }  \"><\/textarea>";r+='<textarea class="form-control text-center" rows="4" data-bind="value: Quy'+t.quy+"_KeHoach_Y, visible: $root.activeCell() == 'cell_khy_"+t.quy+"_' + guid(), enable : "+u+', attr: { placeholder : placeholderY  }  "><\/textarea>';break;case"ThucHien":u=" ";switch(i.mode){case 0:u+=" (($root.trangThai() == "+(t.quy*4-1)+" || $root.trangThai() ==  "+(t.quy*4+2)+" ) && DongBo_Allow() == false) ";break;case 1:u+=" false ";break;case 2:u+=" false ";break;case 3:u+=" false "}r+="data-bind=\"visible: !empty(), css: { 'disabled' : !( "+u+" ), ";r+="'m-add': Status() == 0 && "+f+", 'm-delete': Status() == 1 && "+f+", 'edit': $root.activeCell() == 'cell_th_"+t.quy+"_' + guid() ";r+=", 'has-error' : ($root.trangThai() == "+(t.quy*4-1)+" || $root.trangThai() ==  "+(t.quy*4+2)+" ) && errorQuy"+t.quy+"_ThucHien() == true  ";r+="} , click: function(data, event) { $root.selectCell('cell_th_"+t.quy+"_' + guid(), event) } ";r+=", style: { 'display' : $root.q"+t.quy+'() == true ? \'table-cell\' : \'none\' } "><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span><textarea readonly="readonly" style="padding: 6px 8px; margin: 0px; text-align: center" data-bind="visible: $root.activeCell() != \'cell_th_'+t.quy+"_' + guid() , value: Quy"+t.quy+'_ThucHienStr"><\/textarea>';r+='<button type="button" class="btn btn-show-info btn-xs" data-m="2;4" data-bind="visible: ( '+u+') == false"><i class="icon-warning22"><\/i><\/button>';r+='<textarea class="form-control text-center" rows="4" data-bind="value: Quy'+t.quy+"_ThucHien, visible: $root.activeCell() == 'cell_th_"+t.quy+"_' + guid(), valueUpdate: 'afterkeydown',  enable : "+u+' "><\/textarea>';break;case"TyLeHoanThanh":r+=' class="disabled" data-bind="visible: !empty(), css: { ';r+="'m-add': Status() == 0 && "+f+", 'm-delete': Status() == 1 && "+f+", 'edit': $root.activeCell() == 'cell_tlht_"+t.quy+"_' + guid() ";t.warning&&(r+=", 'has-error' : $root.isSubmit() == true  && (Quy"+t.quy+"_TyLeHoanThanh() == '' || Quy"+t.quy+"_TyLeHoanThanh() == null) }, ");r+="} , click: function(data, event) { $root.selectCell('cell_tlht_"+t.quy+"_' + guid(), event) } ";r+=", style: { 'display' : $root.q"+t.quy+'() == true ? \'table-cell\' : \'none\' } "><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+='<textarea disabled="disabled" class="form-control text-center" rows="4" data-bind="value: Quy'+t.quy+'_TyLeHoanThanh "><\/textarea>';break;case"Quy_GhiChu":u=" ";switch(i.mode){case 0:u+=" $root.trangThai() == 0 || $root.trangThai() == 2 || ($root.trangThai() == "+(t.quy*4-1)+" || $root.trangThai() ==  "+(t.quy*4+2)+" || $root.trangThai() ==  "+(t.quy*4+1)+" ) ";break;case 1:u+=" ($root.trangThai() == 0 || $root.trangThai() == 2) && $root.allowModify() <= "+t.quy+" && (Status() == 0 || Status() == 2) ";break;case 2:u+=" false ";break;case 3:u+=" false "}r+='data-bind="visible: !empty(), css: { ';r+="'disabled' : !("+u+"),  'm-add': Status() == 0 && "+f+", 'm-delete': Status() == 1 && "+f+", 'edit': $root.activeCell() == 'cell_gc_"+t.quy+"_' + guid() ";t.warning&&(r+=", 'has-error' : $root.isSubmit() == true  && (Quy"+t.quy+"_GhiChu() == '' || Quy"+t.quy+"_GhiChu() == null) }, ");r+="} , click: function(data, event) { $root.selectCell('cell_gc_"+t.quy+"_' + guid(), event) } ";r+=", style: { 'display' : $root.q"+t.quy+'() == true ? \'table-cell\' : \'none\' }  "><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+='<textarea class="form-control" rows="4" data-bind="value: Quy'+t.quy+"_GhiChu, enable : "+u+'  "><\/textarea>';r+='<button type="button" class="btn btn-show-info btn-xs" data-m="4" data-bind="visible: ( '+u+') == false"><i class="icon-warning22"><\/i><\/button>';break;case"DinhKemKetQua":u=" ";switch(i.mode){case 0:u+=" ($root.trangThai() == "+(t.quy*4-1)+" || $root.trangThai() ==  "+(t.quy*4+2)+" ) ";break;case 1:u+=" false ";break;case 2:u+=" false ";break;case 3:u+=" false "}r+="data-bind=\"visible: !empty(), css: { 'disabled' : !( "+u+" ),'m-add': Status() == 0 && "+f+",  'm-delete': Status() == 1 && "+f+" } , style: { 'display' : $root.q"+t.quy+"() == true ? 'table-cell' : 'none' } \">";r+=' <div data-bind="visible : '+u+'"><input type="file" data-bind="attr: { \'id\' : \'attach-quy'+t.quy+'-\' + guid() }"  class="file-attach"  /> <\/div>';r+=' <a href="#" class="mt-5" target="_blank" data-bind="attr: { href : Quy'+t.quy+"_DinhKem() }, visible: Quy"+t.quy+"_DinhKem() != null && Quy"+t.quy+"_DinhKem() !=  ''\">Xem file<\/a>";r+='<button type="button" class="btn btn-show-info btn-xs" data-m="4" data-bind="visible: ( '+u+') == false"><i class="icon-warning22"><\/i><\/button>';break;case"TrangThaiDeXuat":r+='class="vertical-center disabled" data-bind="visible: !empty()"><span class="label label-primary" style="padding: 1px 10px; margin-top: 30px;" data-bind="visible: Status() == 2 ">Cập nhật<\/span><span class="label label-success" style = "padding: 1px 10px; margin-top: 30px;" data-bind="visible: Status() == 0 " > Thêm mới<\/span > <span class="label label-warning" style="padding: 1px 10px; margin-top: 30px;" data-bind="visible: Status() == 1 ">Xóa<\/span>';break;case"DongBo":u=" ";switch(i.mode){case 0:u+=" ($root.trangThai() == 0 || $root.trangThai() == 2) ";break;case 1:u+=" (Status() == 0 || Status() == 2) ";break;case 2:u+=" false ";break;case 3:u+=" false "}r+="data-bind=\"visible: !empty(), css: { 'disabled' : !("+u+') }" style="vertical-align: middle; text-align: center"><div class="checkbox checkbox-switchery switchery-xs " style="width: 38px; margin: auto;"><input type="checkbox" class="switchery" data-bind="attr: { id :\'switchery-\' + guid()}, checked: DongBo_Allow() == true"><\/div>';break;case"CongThucDongBo":u=" ";switch(i.mode){case 0:u+=" DongBo_Allow() == true";break;case 1:u+=" DongBo_Allow() == true";break;case 2:u+=" false ";break;case 3:u+=" false "}r+="data-bind=\"visible: !empty()  , css: { 'disabled' : !("+u+') , \'has-error\' : $root.isSubmit() == true  && DongBo_Allow() == true && DongBo_CongThuc() == null  } " ><p class="text-label p-dongbo no-margin" style="overflow-y: auto" readonly="readonly" data-bind="html: DongBo_Text"><\/p><button class="btn btn-show-modal " type="button"data-bind="click: $root.showSyncMethodModalModal, enable: '+u+'"><i class="icon-pencil7 "><\/i><\/button>';break;case"Nam_TrongSo":r+="data-bind=\"visible: !empty() && $root.n() == true, css: { 'm-add': Status() == 0 && "+f+", 'm-delete': Status() == 1 && "+f+", 'm-edit': "+f+" && modifyNam_TrongSo() == true, 'edit': $root.activeCell() == 'cell_tsn_' + guid()";r+=", 'has-error' : $root.isSubmit() == true  && (Nam_TrongSo() == '' || Nam_TrongSo() == null) && ($root.perform != 'create' || ($root.perform == 'create' && Status() != 1)) ";r+=" }, ";r+='click: function(data, event) { $root.selectCell(\'cell_tsn_\' + guid(), event) }" ><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span><textarea class="form-control text-center" rows="4" data-bind="value: Nam_TrongSo ';r+=", valueUpdate: 'afterkeydown', ";u="";u+=i.mode==1?"  $root.trangThai() == 0 && (Status() == 0 || Status() == 2)  ":i.mode==0?"  ($root.trangThai() == 0 || $root.trangThai() == 2) ":"  false ";r+="enable: "+u+'"><\/textarea>';r+='<button type="button" class="btn btn-show-info btn-xs" data-m="4" data-bind="visible : ('+u+') == false"><i class="icon-warning22"><\/i><\/button>';break;case"Nam_TyLeHTSoHienTai":r+=' class="disabled" data-bind="visible: !empty() && $root.n() == true, css: { ';r+="'m-add': Status() == 0 && "+f+", 'm-delete': Status() == 1 && "+f+", 'edit': $root.activeCell() == 'cell_tlnsht_' + guid() ";r+="} , click: function(data, event) { $root.selectCell('cell_tlnsht_' + guid(), event) } ";r+='"><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+='<textarea disabled="disabled" class="form-control text-center" rows="4" data-bind="value: Nam_TyLeHTSoHienTai  "><\/textarea>';break;case"Nam_TyLeHoanThanh":r+=' class="disabled" data-bind="visible: !empty() && $root.n() == true, css: { ';r+="'m-add': Status() == 0 && "+f+", 'm-delete': Status() == 1 && "+f+", 'edit': $root.activeCell() == 'cell_tlhtn_' + guid() ";r+="} , click: function(data, event) { $root.selectCell('cell_tlhtn_' + guid(), event) } ";r+='"><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+='<textarea disabled="disabled" class="form-control text-center" rows="4" data-bind="value: Nam_TyLeHoanThanh "><\/textarea>';break;case"Nam_ThucHien":r+=' class="disabled" data-bind="visible: !empty() && $root.n() == true, css: { ';r+="'m-add': Status() == 0 && "+f+", 'm-delete': Status() == 1 && "+f+", 'edit': $root.activeCell() == 'cell_thn_' + guid() ";r+="} , click: function(data, event) { $root.selectCell('cell_thn_' + guid(), event) } ";r+='"><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+='<textarea disabled="disabled" class="form-control text-center" rows="4" data-bind="value: Nam_ThucHien"><\/textarea>';break;case"Nam_KeHoach":u=" KpiEvaluationCriteriaId() != null && ( Default_X() == '' ||  Default_X() == null ) ";switch(i.mode){case 0:u+=" && ($root.trangThai() == 0 || $root.trangThai() == 2) ";break;case 1:u+=" &&  $root.trangThai() == 0 && (Status() == 0 || Status() == 2) ";break;case 2:u+=" && false ";break;case 3:u+=" && false "}e="'disabled' : !("+u+") , ";e+="'m-add': Status() == 0 && "+f+", 'm-edit': "+f+" && modifyNam_KeHoach() == true , 'm-delete': Status() == 1 && "+f+" , 'edit': $root.activeCell() == 'cell_khn_' + guid() , 'has-error' : $root.isSubmit() == true  &&  errorNam_KehoachX() == true && ($root.perform != 'create' || ($root.perform == 'create' && Status() != 1)) ";r+=' class="disabled" data-bind="visible: !empty() && $root.n() == true, attr:{\'colspan\' : PhuongPhapDo() < 4 ? 2 : 0 } , css: { '+e+"} , click: function(data, event) { $root.selectCell('cell_khn_' + guid(), event) } ";r+='"><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+='<textarea disabled="disabled" class="form-control text-center" rows="4" data-bind="value: Nam_KeHoach, enable: '+u+', attr: { placeholder : placeholderX  }"><\/textarea>';r+='<button type="button" class="btn btn-show-info btn-xs" data-m="1;4;5" data-bind="visible : ('+u+') == false"><i class="icon-warning22"><\/i><\/button>';break;case"Nam_KetQua":r+=' class="disabled" data-bind="visible: !empty() && $root.n() == true, css: { ';r+="'m-add': Status() == 0 && "+f+", 'm-delete': Status() == 1 && "+f+", 'edit': $root.activeCell() == 'cell_kqn_' + guid() ";r+="} , click: function(data, event) { $root.selectCell('cell_kqn_' + guid(), event) } ";r+='"><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+='<textarea disabled="disabled" class="form-control text-center" rows="4" data-bind="value: Nam_KetQua"><\/textarea>';break;case"Nam_GhiChu":u=" ";u+=i.mode==1?" ($root.trangThai() == 0 || $root.trangThai() == 2) && (Status() == 0 || Status() == 2) ":i.mode==0?n.inArray(model.Status,[1,4,5,8,9,12,13,16,17])>=0?" false ":" true ":" false ";r+=' class="disabled" data-bind="visible: !empty() && $root.n() == true, css: { ';r+="'m-add': Status() == 0 && "+f+", 'm-delete': Status() == 1 && "+f+", 'edit': $root.activeCell() == 'cell_gcn_' + guid(), 'disabled' : !"+u+" ";r+="} , click: function(data, event) { $root.selectCell('cell_gcn_' + guid(), event) } ";r+='"><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span>';r+='<textarea class="form-control" rows="4" data-bind="value: Nam_GhiChu , enable: '+u+'"><\/textarea>';break;case"ColExpand":r+='<td class="disabled " style="display: none" data-bind="style: { \'display\' : '+(t.q>0?"$root.q"+t.q:"$root.n")+"() == false ? 'table-cell' : 'none' } \"><\/td>";break;case"MaDongBo":r+="data-bind=\"visible: !empty(), css: { 'edit': $root.activeCell() == 'cell_"+t.code+"_' + guid()";r+=" }, ";r+="click: function(data, event) { $root.selectCell('cell_"+t.code+'_\' + guid(), event) }" ><span class="l1"><\/span><span class="l2"><\/span><span class="l3"><\/span><span class="l4"><\/span><textarea class="form-control text-center" rows="4" data-bind="value: KpiYearAllocationId ';u=", enable: "+(isBanKPI||isAdmin?"true":"false");r+=u+'"><\/textarea>';break;default:t.q!=null&&(r+=" data-bind=\" style: { 'display' : "+(t.q>0?"$root.q"+t.q:"$root.n")+"() == true ? 'table-cell' : 'none' } \" ");r+=' class="'+(t.class!=null?t.class:"")+'"><span  >&nbsp;<\/span>'}return r+"<\/td>"};u.initTable=function(){var r,k="",d="",g=0,t,s,f,h="",p="",rt=i.head.height!=null?i.head.height:32,nt=n(l+" .kpi_container"),b='<div class="kpi-table render_table" style="margin-top: -1px">',c,a,it,v,y,o,ft,tt,w,ut;for(b+='<div class="area area-tl" style="height: '+rt+'px"><\/div>',b+='<div class="area area-bl" style=" "><\/div>',b+='<div class="area area-tr" style="height: '+rt+'px"><\/div>',b+='<div class="area area-br" style=""><\/div>',b+="<\/div>",n(nt).append(b),c=n("<div><\/div>"),a=i.cols.left,k=n("<colgroup><\/colgroup>"),d=n("<colgroup><\/colgroup>"),r=0;r<a.length;r++)v=i.head.groups[r],n.type(v)==="number"?(k.append('<col class="kpi-col" i="'+r+'" style="width: '+i.head.groups[r]+'px">'),e+=i.head.groups[r]):(k.append('<col class="kpi-col" i="'+r+'" style="width: '+v.w+'px">'),e+=v.w);for(r=a.length;r<i.head.groups.length;r++)v=i.head.groups[r],it=!0,i.head.groups[r].q>0&&(i.mode==1||i.mode==2)&&i.head.groups[r].q<i.allowModify&&(it=!1),it&&(n.type(v)==="number"?(d.append('<col class="kpi-col" i="'+r+'" style="width: '+i.head.groups[r]+'px">'),g+=i.head.groups[r]):(d.append('<col class="kpi-col" data-bind="style: { \'display\' : '+(v.q>0?"q"+v.q:"n")+"() == "+(v.e?"false":"true")+" ?  'table-column' : 'none' }\" i=\""+r+'" style="width: '+v.w+'px">'),g+=v.w));for(h=n('<table class="table table-bordered"><\/table>'),h.css("width",e).append(k),f="<thead><tr>",f+="<tr>",r=0;r<a.length;r++)t=a[r],f+="<th ",(t.visible==null||t.visible())&&(t.rowspan!=null&&(f+=' rowspan="'+t.rowspan+'" '),t.colspan!=null&&(f+=' colspan="'+t.colspan+'" '),f+=' style="height: '+(t.height!=null?t.height+"px":"")+";",t.style!=null&&(f+=t.style+"; "),f+='"',w="",t.class!=null&&(w+=t.class),f+=t.sort!=null?'class="'+w+' orderable" orderby="'+t.sort+'" currentOrder="desc">':'class="'+w+'" >',f+=t.title!=null?t.title:"&nbsp;",t.resize&&(f+='<span class="resize-x" i="'+r+'"><i class="icon-arrow-resize7"><\/i><\/span>'),f+="<\/th>");if(f+="<\/tr><\/thead>",h.append(f),c.css("width",e+1).css("height",i.head.height+16+"px").append(h),n(nt).find(".area-tl").append(c),c="<div>",h='<table style="width: '+e+'px" class="table table-bordered">'+n(k).html(),y="<tbody>",i.rows.total!=null){for(p='<tr class="tr-total">',r=0;r<a.length;r++)s=i.rows.total[r],p+=u.drawRow(s);p+="<\/tr>";y+=p}for(o=" <!-- ko foreach : details -->",o+=i.mode==3?' <tr class="tr-parent tr-parent-1 " data-bind="visible: childs().length > 0">':' <tr class="tr-parent tr-parent-1 " data-bind="visible: isDelete() == false">',r=0;r<a.length;r++)s=i.rows.parent[r],o+=u.drawRow(s);for(o+="<\/tr>",o+="<!-- ko foreach: childs -->",o+="<tr data-bind=\"visible: expanded() == true && isDelete() == false && $parents[0].isDelete() == false , css: 'kd_' + guid()\">",r=0;r<a.length;r++)s=i.rows.child[r],o+=u.drawRow(s);for(o+="<\/tr>",o+="<!-- /ko -->",o+="<!-- /ko -->",y+=o,y+="<\/tbody",h+=y,c+=h+"<\/table><\/div>",n(nt).find(".area-bl").append(c),c='<div style="width: '+g+"px, height: "+(i.head.height+16)+'px ">',h='<table class="table table-bordered aa" style="width: '+g+'px">'+n(d).html(),f="<thead>",ft=i.cols.left.length,tt=0;tt<i.cols.right.length;tt++){for(a=i.cols.right[tt],f+="<tr>",r=0;r<a.length;r++)t=a[r],f+="<th ",t.colExpand?f+=' style="display: none; vertical-align: top; text-align: left" rowspan="2" class="bg" data-bind="style: { \'display\' : '+(t.q>0?"q"+t.q:"n")+"() == false ? 'table-cell' : 'none' } \">"+t.title+'<button class="btn btn-xs btn-link  btn-expand-quarter" data-bind="click: function(data, event) { expandQuater('+t.q+', null , event) }"title = "Hiển thị KPIs quý '+(t.q>0?"quý "+t.q:"năm")+'" type="button" q="'+t.q+'" ><i class="icon-arrow-right13"><\/i><\/button ><\/th >':(t.visible==null||t.visible())&&(typeof t.q!="undefined"&&(f+=" data-bind=\"style: { 'display': "+(t.q>0?"q"+t.q:"n")+"() == true ? 'table-cell' : 'none' }\" "),t.rowspan!=null&&(f+=' rowspan="'+t.rowspan+'" '),t.colspan!=null&&(f+=' colspan="'+t.colspan+'" '),f+=' style="height: '+(t.height!=null?t.height+"px":"")+";",t.style!=null&&(f+=t.style+"; "),f+='"',w="",t.class!=null&&(w+=t.class),f+=t.sort!=null?'class="'+w+' orderable" orderby="'+t.sort+'" currentOrder="desc">':'class="'+w+'" >',f+=t.title!=null?t.title:"&nbsp;",t.sort!=null&&(f+='<button class="btn btn-xs btn-link btn-sort" data-bind="click: function(data, event) { sort('+t.q+',  null, event) }" title="Sắp xếp" type="button" q="'+t.q+'"> <i class="icon-sort-alpha-asc"><\/i><\/button>'),t.expand&&(f+='<button class="btn btn-xs btn-link btn-narrow-quarter" data-bind="click: function(data, event) { expandQuater('+t.q+',  null, event) }" title="Ẩn KPIs '+(t.q>0?"quý "+t.q:"năm")+'" type="button" q="'+t.q+'"> <i class="icon-arrow-left12"><\/i><\/button>'),t.resize&&(ut=t.ri!=null?t.ri:i.cols.left.length+r,f+='<span class="resize-x" i="'+ut+'"><i class="icon-arrow-resize7"><\/i><\/span>'),f+="<\/th>");f+="<\/tr>"}if(f+="<\/thead>",h+=f+"<\/table>",c+=h+"<\/div>",n(nt).find(".area-tr").append(c),c="<div>",h='<table style="width: '+g+'px" class="table table-bordered">'+n(d).html(),y="<tbody>",i.rows.total!=null){for(p='<tr class="tr-total">',r=i.cols.left.length;r<i.rows.parent.length;r++)s=i.rows.total[r],p+=u.drawRow(s);p+="<\/tr>";y+=p}for(o=" <!-- ko foreach : details -->",o+=i.mode==3?' <tr class="tr-parent tr-parent-1 " data-bind="visible: childs().length > 0">':' <tr class="tr-parent tr-parent-1 " data-bind="visible: isDelete() == false">',r=i.cols.left.length;r<i.rows.parent.length;r++)s=i.rows.parent[r],o+=u.drawRow(s);for(o+="<\/tr>",o+="<!-- ko foreach: childs -->",o+="<tr data-bind=\"visible: expanded() == true && isDelete() == false  && $parents[0].isDelete() == false , css: 'kd_' + guid()\">",r=i.cols.left.length;r<i.rows.child.length;r++)s=i.rows.child[r],typeof s.visible!="undefined"?s.visible()&&(o+=u.drawRow(s)):o+=u.drawRow(s);o+="<\/tr>";o+="<!-- /ko -->";o+="<!-- /ko -->";y+=o;y+="<\/tbody";h+=y;c+=h+"<\/table><\/div>";n(nt).find(".area-br").append(c)};u.initModifyViewTable=function(){var r,a,y="",p=0,t,o,f,v="",b="",k=i.head.height!=null?i.head.height:32,d=n(l+" .kpi_container"),g='<div class="p-15"><div class="row">',c,tt,s,w,h,nt;for(g+='<div class="col-md-6"><h5 class="text-bold no-margin-top">Bảng chi tiết<\/h5><div class="kpi-table render_table kpi-table-1" style="margin-top: -1px"><div class="area area-tl" style="height: '+k+'px"><\/div><div class="area area-bl" style=" "><\/div><div class="area area-tr" style="height: '+k+'px"><\/div><div class="area area-br area-br-1" style=""><\/div><\/div><\/div>',g+='<div class="col-md-6"><h5 class="text-bold no-margin-top">Bảng cập nhật<\/h5><div class="kpi-table render_table kpi-table-2" style="margin-top: -1px"><div class="area area-tl" style="height: '+k+'px"><\/div><div class="area area-bl" style=" "><\/div><div class="area area-tr" style="height: '+k+'px"><\/div><div class="area area-br area-br-2" style=""><\/div><\/div><\/div>',g+="<\/div>",n(d).append(g),c=n("<div><\/div>"),y=n("<colgroup><\/colgroup>"),r=0;r<i.head.groups.length;r++)s=i.head.groups[r],tt=!0,s.q>0&&(i.mode==1||i.mode==2)&&s.q>0&&s.q<i.allowModify&&(tt=!1),tt&&(n.type(s)==="number"?(y.append('<col class="kpi-col" i="'+r+'" style="width: '+i.head.groups[r]+'px">'),p+=i.head.groups[r]):(y.append('<col class="kpi-col" data-bind="style: { \'display\' : '+(s.q>0?"q"+s.q:"n")+"() == "+(s.e?"false":"true")+" ?  'table-column' : 'none' }\" i=\""+r+'" style="width: '+s.w+'px">'),p+=s.w));for(c='<div style="width: '+p+"px, height: "+(i.head.height+16)+'px ">',v='<table class="table table-bordered" style="width: '+p+'px">'+n(y).html(),f="<thead>",w=0;w<i.cols.right.length;w++){if(f+="<tr>",w==0)for(a=i.cols.left,r=0;r<a.length;r++)t=a[r],f+="<th ",t.colExpand?f+=' style="display: none; vertical-align: top; text-align: left" rowspan="2" class="bg" data-bind="style: { \'display\' : '+(t.q>0?"q"+t.q:"n")+"() == false ? 'table-cell' : 'none' } \">"+t.title+'<button class="btn btn-xs btn-link  btn-expand-quarter" data-bind="click: function(data, event) { expandQuater('+t.q+',  null, event) }"title = "Hiển thị KPIs quý '+(t.q>0?"quý "+t.q:"năm")+'" type="button" q="'+t.q+'" ><i class="icon-arrow-right13"><\/i><\/button ><\/th >':(t.visible==null||t.visible())&&(typeof t.q!="undefined"&&(f+=" data-bind=\"style: { 'display': "+(t.q>0?"q"+t.q:"n")+"() == true ? 'table-cell' : 'none' }\" "),t.rowspan!=null&&(f+=' rowspan="'+t.rowspan+'" '),t.colspan!=null&&(f+=' colspan="'+t.colspan+'" '),f+=' style="height: '+(t.height!=null?t.height+"px":"")+";",t.style!=null&&(f+=t.style+"; "),f+='"',h="",t.class!=null&&(h+=t.class),f+=t.sort!=null?'class="'+h+' orderable" orderby="'+t.sort+'" currentOrder="desc">':'class="'+h+'" >',f+=t.title!=null?t.title:"&nbsp;",t.resize&&(f+='<span class="resize-x" i="'+(r+1)+'"><i class="icon-arrow-resize7"><\/i><\/span>'),f+="<\/th>");for(a=i.cols.right[w],r=0;r<a.length;r++)t=a[r],f+="<th ",t.colExpand?f+=' style="display: none; vertical-align: top; text-align: left" rowspan="2" class="bg" data-bind="style: { \'display\' : '+(t.q>0?"q"+t.q:"n")+"() == false ? 'table-cell' : 'none' } \">"+t.title+'<button class="btn btn-xs btn-link  btn-expand-quarter" data-bind="click: function(data, event) { expandQuater('+t.q+',  null, event) }"title = "Hiển thị KPIs quý '+(t.q>0?"quý "+t.q:"năm")+'" type="button" q="'+t.q+'" ><i class="icon-arrow-right13"><\/i><\/button ><\/th >':(t.visible==null||t.visible())&&(typeof t.q!="undefined"&&(f+=" data-bind=\"style: { 'display': "+(t.q>0?"q"+t.q:"n")+"() == true ? 'table-cell' : 'none' }\" "),t.rowspan!=null&&(f+=' rowspan="'+t.rowspan+'" '),t.colspan!=null&&(f+=' colspan="'+t.colspan+'" '),f+=' style="height: '+(t.height!=null?t.height+"px":"")+";",t.style!=null&&(f+=t.style+"; "),f+='"',h="",t.class!=null&&(h+=t.class),f+=t.sort!=null?'class="'+h+' orderable" orderby="'+t.sort+'" currentOrder="desc">':'class="'+h+'" >',f+=t.title!=null?t.title:"&nbsp;",t.resize&&(f+='<span class="resize-x" i="'+(i.cols.left.length+r+1)+'"><i class="icon-arrow-resize7"><\/i><\/span>'),f+="<\/th>");f+="<\/tr>"}if(f+="<\/thead>",v+=f+"<\/table>",c+=v+"<\/div>",n(d).find(".area-tr").append(c),c="<div>",v='<table style="width: '+p+'px" class="table table-bordered">'+n(y).html(),nt="<tbody>",i.rows.total!=null){for(b='<tr class="tr-total">',r=0;r<i.rows.parent.length;r++)o=i.rows.total[r],b+=u.drawRow(o);b+="<\/tr>";nt+=b}var e=' <tr class="tr-parent tr-parent-1 " data-bind="visible: childs().length > 0 ">';for(r=0;r<i.rows.parent.length;r++)o=i.rows.parent[r],e+=u.drawRow(o);for(e+="<\/tr>",e+="<!-- ko foreach: childs -->",e+="<tr data-bind=\"visible: expanded() == true && Status() >= 0, css: 'kd_' + guid()\">",r=0;r<i.rows.child.length;r++)o=i.rows.child[r],o.type=="TrangThaiDeXuat"?(i.mode==1||i.mode==2)&&(e+=u.drawRow(o)):(o.visible==null||o.visible())&&(e+=u.drawRow(o));e+=u.drawEmptyRow(i.rows.child.length-1);e+="<\/tr>";e+="<!-- /ko -->";e+="<!-- /ko -->";n(d).find(".area-br-1").append(c+v+nt+" <!-- ko foreach : details -->"+e+"<\/tbody<\/table><\/div>");n(d).find(".area-br-2").append(c+v+nt+" <!-- ko foreach : modifies -->"+e+"<\/tbody<\/table><\/div>")};u.init=function(){var c,t,p,k,y,b,f,a,v,s,h;model.Quarters==null&&(model.Quarters=[1,2,3,4]);c=0;tab=="tab3"?(i.perform="create",c=model.ModifyStatus==0?1:2,model.Status>3&&(model.Status==6?i.allowModify=1:model.Status==7||model.Status==10?i.allowModify=2:model.Status==11||model.Status==14?i.allowModify=3:(model.Status==15||model.Status==18)&&(i.allowModify=4))):c=typeof cm!="undefined"&&cm?3:0;p=model.Quarters.length;i.mode=c;i.mode==0&&model.Status==3&&p>0&&p<4&&(k=model.Quarters[0],model.Status=(k-1)*4+3);y=[];b=[];switch(c){case 0:case 3:y=i.cap==2||i.cap==4?[34,45,300,170,150,130,130,200,200,200,200,140,{w:66,q:0},{w:86,q:0},{w:86,q:0},{w:86,q:0},{w:86,q:0},{w:130,q:0},{w:200,q:0},{w:75,q:0,e:!0}]:[34,45,300,170,150,130,130,200,200,200,140,{w:66,q:0},{w:86,q:0},{w:86,q:0},{w:86,q:0},{w:86,q:0},{w:130,q:0},{w:200,q:0},{w:75,q:0,e:!0}];break;case 1:b.push({title:"Đề xuất",rowspan:2});y=i.cap==2||i.cap==4?[80,34,45,300,170,150,130,130,200,200,200,200,140,{w:66,q:0},{w:86,q:0},{w:86,q:0},{w:86,q:0},{w:86,q:0},{w:130,q:0},{w:200,q:0},{w:75,q:0,e:!0}]:[80,34,45,300,170,150,130,130,200,200,200,140,{w:66,q:0},{w:86,q:0},{w:86,q:0},{w:86,q:0},{w:86,q:0},{w:130,q:0},{w:200,q:0},{w:75,q:0,e:!0}];break;case 2:y=i.cap==2||i.cap==4?[80,45,300,170,150,130,130,200,200,200,200,80,{w:66,q:0},{w:86,q:0},{w:86,q:0},{w:86,q:0},{w:86,q:0},{w:130,q:0},{w:200,q:0},{w:75,q:0,e:!0}]:[80,45,300,170,150,130,130,200,200,200,80,{w:66,q:0},{w:86,q:0},{w:86,q:0},{w:86,q:0},{w:86,q:0},{w:130,q:0},{w:200,q:0},{w:75,q:0,e:!0}]}b.push({title:"",rowspan:2,resize:!0,height:83});b.push({title:"STT",rowspan:2,resize:!0});b.push({title:"Mục tiêu",rowspan:2,resize:!0});b.push({title:"Cách tính",rowspan:2});i.head={height:0,groups:[]};switch(i.cap){case 1:i.dependCompany=!1;i.head.height=82;i.type="company";break;case 2:i.dependCompany=!0;i.head.height=82;i.type="department";break;case 3:i.dependCompany=!0;i.head.height=82;i.type="construction";break;case 4:i.dependCompany=!1;i.head.height=82;i.type="director"}for(f=[[{title:"Phương pháp đo",rowspan:2,resize:!0,height:83},{title:"Nguyên tắc tính",rowspan:2,resize:!0},{title:"Đơn vị tính",rowspan:2,resize:!0}],[]],a=7,i.cap==2||i.cap==4?(f[0].push({title:"Nguồn chứng minh",colspan:2}),f[1].push({title:"Dữ liệu CM",resize:!0,ri:7}),f[1].push({title:"Bô phận CM",resize:!0,ri:8}),a=8):(f[0].push({title:"Nguồn chứng minh"}),f[1].push({title:"Bộ phận CM",resize:!0,ri:7})),a++,f[0].push({title:"Ghi chú",rowspan:2,resize:!0,ri:a}),a++,f[0].push({title:"Đối tượng tiếp nhận mục tiêu",rowspan:2,resize:!0,ri:a}),a++,f[0].push({title:"Đính kèm <br/> (Đăng ký)",rowspan:2,resize:!0,ri:a}),a++,f[0].push({title:"Năm",colspan:7,expand:!0,q:0,ri:a}),f[0].push({title:"Năm",q:0,colExpand:!0}),f[1].push({title:"Trọng số",q:0}),f[1].push({title:"KPIS Kế hoạch",q:0,colspan:2}),f[1].push({title:"KPIs thực hiện",q:0}),f[1].push({title:"Tỷ lệ hoàn thành",q:0}),f[1].push({title:"Kết quả",q:0,sort:!0}),f[1].push({title:"Ghi chú",q:0}),h=0;h<p;h++)v=!0,t=model.Quarters[h],(c==1||c==2)&&t<i.allowModify&&(v=!1),v&&(f[0].push({title:"Quý "+t,q:t,colspan:8,expand:!0}),f[0].push({title:"Quý "+t,q:t,colExpand:!0}),f[1].push({title:"Trọng số",q:t}),f[1].push({title:"KPIs Kế hoạch",colspan:2,q:t}),f[1].push({title:"KPIs thực hiện",q:t}),f[1].push({title:"Tỷ lệ hoàn thành",q:t}),f[1].push({title:"Kết quả",q:t,sort:!0}),f[1].push({title:"Ghi chú",q:t}),f[1].push({title:"Đính kèm <br/> (Kết quả)",q:t}),n.merge(y,[{w:76,q:t},{w:86,q:t},{w:86,q:t},{w:86,q:t},{w:86,q:t},{w:130,q:t},{w:200,q:t},{w:140,q:t},{w:75,q:t,e:!0}]));a++;f[0].push({title:"Mã đồng bộ",rowspan:2,resize:!0,ri:a});y.push(80);i.defaultGroups=y;i.head.groups=i.colStates!=null&&i.mode==0?i.colStates.groups:y;i.cols={left:b,right:f};var o=[],e=[],l=[];for(c==1&&(o.push({type:""}),e.push({type:""}),l.push({type:"modifyState"})),n.merge(o,[{type:""},{type:""},{type:"text",bind:"text: 'TỔNG KẾT'"}]),(i.cap==2||i.cap==4)&&o.push({type:""}),s=0;s<8;s++)o.push({type:""});for(s=0;s<4;s++)o.push({type:"",q:0});for(o.push({type:"text",bind:"text: tongket().Nam_TyLeHoanThanh, style: { 'display' : $root.n() == true ? 'table-cell' : 'none' } ",code:"tlhtn",q:0}),s=0;s<2;s++)o.push({type:"",q:0});for(o.push({type:"ColExpand",q:0}),h=0;h<p;h++)t=model.Quarters[h],v=!0,(c==1||c==2)&&t<i.allowModify&&(v=!1),v&&(o.push({type:"",q:t}),o.push({type:"",q:t}),o.push({type:"",q:t}),o.push({type:"",q:t}),o.push({type:"text",bind:"text: tongket().Quy"+t+"_TyLeHoanThanh, style: { 'display' : $root.q"+t+"() == true ? 'table-cell' : 'none' } ",code:"tlhtn",q:t}),o.push({type:"",q:t}),o.push({type:"",q:t}),o.push({type:"",q:t}),o.push({type:"ColExpand",q:t}));for(o.push({type:"",q:0}),n.merge(e,[{type:"expand"},{type:"text","class":"text-center",attribute:"STT"},{type:"text",style:"float: left",attribute:"MucTieu",addDetail:!0},{type:""}]),s=0;s<7;s++)e.push({type:""});for((i.cap==2||i.cap==4)&&e.push({type:""}),e.push({type:"input",code:"nts",attribute:"Nam_TrongSo",realTime:!0,warning:!0,q:0}),s=0;s<3;s++)e.push({type:"",q:0});for(e.push({type:"text",code:"ntlht",attribute:"Nam_TyLeHoanThanh",realTime:!0,q:0}),s=0;s<2;s++)e.push({type:"",q:0});for(e.push({type:"ColExpand",q:0}),h=0;h<p;h++)t=model.Quarters[h],v=!0,(c==1||c==2)&&t<i.allowModify&&(v=!1),v&&(e.push({type:"input",quy:t,warning:!0,attribute:"Quy"+t+"_TrongSo",q:t}),e.push({type:"",q:t}),e.push({type:"",q:t}),e.push({type:"",q:t}),e.push({type:"text",code:"tlht",bind:"text: Quy"+t+"_TyLeHoanThanh, style: { 'display' : $root.q"+t+"() == true ? 'table-cell' : 'none' } ",quy:t}),e.push({type:"",q:t}),e.push({type:"",q:t}),e.push({type:"",q:t}),e.push({type:"ColExpand",q:t}));for(e.push({type:"",q:0}),n.merge(l,[{type:"control"},{type:"STT",warning:!0},{type:"textarea",attribute:"MucTieu",code:"mt",realTime:!0,warning:!0},{type:"textarea",attribute:"CachTinh",code:"ct",warning:!0},{type:"ppd"},{type:"select",attribute:"NguyenTacTinh",code:"ntt"},{type:"select",attribute:"DonViTinh",code:"dvt"},{type:"DuLieuChungMinh",visible:function(){return i.cap==2||i.cap==4}},{type:"ncm"},{type:"GhiChu"},{type:"PhanBoMucTieu"},{type:"attach"},{type:"Nam_TrongSo",q:0},{type:"Nam_KeHoach",q:0},{type:"Y",q:0},{type:"Nam_ThucHien",q:0},{type:"Nam_TyLeHoanThanh",q:0},{type:"Nam_KetQua",q:0},{type:"Nam_GhiChu",q:0},{type:"ColExpand",q:0}]),h=0;h<p;h++)t=model.Quarters[h],v=!0,(c==1||c==2)&&t<i.allowModify&&(v=!1),v&&(l.push({type:"TrongSoQuy",quy:t,warning:!0}),l.push({type:"KeHoach_X",quy:t}),l.push({type:"KeHoach_Y",quy:t}),l.push({type:"ThucHien",quy:t}),l.push({type:"TyLeHoanThanh",quy:t}),l.push({type:"KetQuaQuy",quy:t}),l.push({type:"Quy_GhiChu",quy:t}),l.push({type:"DinhKemKetQua",quy:t}),l.push({type:"ColExpand",q:t}));l.push({type:"MaDongBo"});i.rows={total:o,parent:e,child:l};typeof perform=="undefined"&&(perform="");typeof isBks=="undefined"&&(isBks=!1);typeof isAdmin=="undefined"&&(isAdmin=!1);typeof tab=="undefined"&&(tab="tab1");tab!="tab1"?(i.mode==2?u.initModifyViewTable():u.initTable(),r=new d,ko.applyBindings(r,n("#applyBinding")[0])):w()};u.init()}})(jQuery);ko.bindingHandlers.draggable={init:function(n,t){var i=t();$(n).draggable({axis:"y",start:function(){},stop:function(n,t){var r=t.position.top,f,u;r=parseInt(r);r<45&&(r=45);i.RowHeight(r);f=$(n.target);u=$(f).closest("tr").attr("class");$("."+u+" td textarea").css("height",r-1+"px");$("."+u+" td .p-dongbo").css("height",r-1+"px");$("."+u+" td .resize-height").css("height",r-1+"px");$("."+u+" > td").css("height",r+"px");$(f).css("top","unset")}})},update:function(n,t){var i=t()}};ko.bindingHandlers.readonly={update:function(n,t){t()?($(n).attr("readonly","readonly"),$(n).addClass("disabled")):($(n).removeAttr("readonly"),$(n).removeClass("disabled"))}}