(function(n){n.fn.otpChecking=function(t){function f(){r.vm=new u;ko.applyBindings(r.vm,n("#otpModal")[0]);n(".otp-value").on("focus",function(){n(this).select()});n(".otp-value").keyup(function(){var i=n(this).val(),t=parseInt(n(this).attr("index"));i.length>0&&(t<6?n('.otp-value[index="'+(t+1)+'"]').trigger("focus"):r.vm.checkOTP())})}function e(){var t,i;for(n("#otpModal").length>0&&n("#otpModal").remove(),t='<div class="modal otpchecking-modal" id="otpModal" style="display: none" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"data-bind="enable: checkingOTP() == false"><span aria-hidden="true">&times;<\/span><\/button><h4 class="modal-title text-bold">Xác nhận tài khoản<\/h4><\/div><div class="modal-body p-15"><div data-bind="visible: step() == 1"><p class="text-bold">Chọn phương thức phù hợp<\/p><div class="radio" data-bind="visible: allowSMS() == true" style="display: none"><label class="no-padding" data-bind="click: function(data, event) { selectType(0, data, event) }"><i class="icon-radio-unchecked position-left"data-bind="css: { \'icon-radio-checked\' : type() == 0, \'icon-radio-unchecked\' : type() != 0 }"><\/i>SMS OTP<\/label><\/div><div class="radio"  data-bind="visible: allowEmail() == true" style="display: none"><label class="no-padding" data-bind="click: function(data, event) { selectType(1, data, event) }"><i class="icon-radio-unchecked position-left"data-bind="css: { \'icon-radio-checked\'  : type() == 1, \'icon-radio-unchecked\'  : type() != 1 }"><\/i>Email OTP<\/label><\/div><div class="alert alert-danger no-border no-margin-bottom mt-10" data-bind="text: errorMessage, visible: hasError() == true"><\/div><button type="button" data-bind="enable: type() >= 0, click: sendOTP"\tclass="btn btn-primary btn-block text-bold mt-15"\tdata-loading-text="<i class=\'icon-spinner10 fa-spin position-left\'><\/i>"\tdisabled>\tTiếp tục<\/button><\/div><div  data-bind="visible: step() == 2"><h6 data-bind="html: mess"><\/h6><div class="row" style="margin-left: -5px; margin-right: -5px;">',i=1;i<=6;i++)t+='<div class="col-md-2 col-xs-2 col"><input class="form-control otp-value" index="'+i+'" maxlength="1" data-bind="enable: checkingOTP() == false" /><\/div>';t+='<\/div><div class="row "><div class="col-md-12" data-bind="visible: hasError() == true"><div class="alert alert-danger no-border no-margin-bottom mt-10" data-bind="text: errorMessage"><\/div><\/div><div class="col-md-12" data-bind="visible: checkingOTP() == false"><button class="btn btn-link btn-change-option mt-15" type="button" data-bind="click: changeType" >Chọn phương thức khác<\/button><button class="btn btn-link btn-resend mt-15 pull-right" type="button" data-bind="click: sendOTP" data-loading-text="<i class=\'icon-spinner10 fa-spin position-left\'><\/i>Gửi lại tin nhắn">Gửi lại tin nhắn<\/button><\/div><div class="col-md-12 text-center mt-15" data-bind="visible: checkingOTP() == true"><i class="icon-spinner10 fa-spin" style="font-size: 19px"><\/i><\/div><\/div><\/div>';t+='<div class="text-center" data-bind="visible: step() == 3">';t+='<div class="icon-object border-success text-success"><i class="icon-checkmark4"><\/i><\/div><h5 class="text-semibold">Xác thực thành công<\/h5>';t+="<\/div>";t+="<\/div><\/div><\/div><\/div>";n("body").append(t)}function o(){e();f()}var s=this.selector,r=this,i=n.extend({url:null,contextMenu:null,phoneNumber:null,email:null,callback:null},t),u;return r.checkByPhoneNumber=function(t,u){i.phoneNumber=t;i.callback=u;i.email=null;for(var f=1;f<=6;f++)n('.otp-value[index="'+f+'"]').val("");r.vm.step(1);r.vm.allowSMS(!0);r.vm.type(2);r.vm.allowEmail(!1);n("#otpModal").modal("show")},u=function(){var t=this;t.step=ko.observable(1);t.type=ko.observable(-1);t.checkingOTP=ko.observable(!1);t.sending=ko.observable(!1);t.allowSMS=ko.observable(i.phoneNumber!=null);t.allowEmail=ko.observable(i.email!=null);t.mess=ko.computed(function(){return"Vui lòng nhập mã OTP đã được gửi về "+(t.type()==1?'email <span class="text-primary-800">'+i.email+"<\/span>":'số điện thoại <span class="text-primary-800">'+i.phoneNumber+"<\/span>")});t.hasError=ko.observable(!1);t.errorMessage=ko.observable("");t.selectType=function(n){t.type(n)};t.sendOTP=function(r,u){var e=n(u.currentTarget),f,o;for(e.button("loading"),f=1;f<=6;f++)n('.otp-value[index="'+f+'"]').val("");o=i.url.send;t.errorMessage("");app.postData(o,{type:t.type(),email:i.email,phoneNumber:i.phoneNumber},function(i){e.button("reset");i.Success?(t.step(2),t.hasError(!1),n('.otp-value[index="1"]').focus()):(t.hasError(!0),t.errorMessage(i.Message))})};t.changeType=function(){t.step(1)};t.resend=function(){t.sendOTP()};t.checkOTP=function(){var u,r,f,e;for(t.checkingOTP(!0),u="",r=1;r<=6;r++)f=n('.otp-value[index="'+r+'"]').val(),u+=f;e=i.url.check;t.errorMessage("");app.postData(e,{type:t.type(),email:i.email,phoneNumber:i.phoneNumber,otpCode:u},function(r){t.checkingOTP(!1);r.Success?(t.step(3),t.hasError(!1),setTimeout(function(){n("#otpModal").modal("hide");i.callback!=null&&i.callback()},1e3)):(t.hasError(!0),t.errorMessage(r.Message))})}},o(),r}})(jQuery)