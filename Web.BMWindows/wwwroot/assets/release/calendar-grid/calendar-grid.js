(function(n){n.fn.calendarGrid=function(t){var i=this,u=this.selector,r;return i.searchParams={keyword:"",page:1,limit:null},i.editParams={},i.sourceData=[],i.viewData=[],i.count=0,i.count=0,i.formId="",i.sumarray=[],i.tounchTr=null,i.moveObjectId=null,i.clickSubContextMenu=!1,i.activeParentId=null,i.months=[],i.days=[],i.colRight=0,i.searching=!1,i.editLoader=".calendar-grid-edit-loader",r=n.extend({footer:null,tableSize:null,rootUrl:null,dataUrl:null,paging:null,params:null,autoLoad:null,border:null,width:null,height:null,selectRow:null,toolbars:null,idAttribute:null,rows:[],cols:null,editController:null,model:"",filterable:!1,checkAll:null,beforeSubmit:null,detailRow:null,childs:null,modal:null,contextMenu:null,skipCols:0,loadDataCallback:null,loadModalCallback:null,selectRowCallback:null,submitFormCallback:null,sumInfo:null,beforeSearch:null,expandable:null,multiLevel:!0,symbols:null},t),i.set=r,i.sequentially={number:10,loaded:0,first:!1,done:!1,loading:!1},r.paging!=null&&(i.searchParams.page=r.paging.page!=null?r.paging.page:1,i.searchParams.limit=r.paging.limit!=null?r.paging.limit:20),r.params!=null&&(typeof r.params.search!="undefined"&&n.extend(i.searchParams,r.params.search),typeof r.params.edit!="undefined"&&n.extend(i.editParams,r.params.edit)),i.showTableLoading=function(){console.log("zo");var t=n(u).find(".main-content");n(t).find(".loading").length==0&&n(t).append(app.loading());n(u).find(".loading").show()},i.hideTableLoading=function(){n(u).find(".loading").hide()},i.drawCheckbox=function(n){return'<td class="first-col" style="width: 40px"><div class="checkbox checkbox-info"><input type="checkbox"  class="styled" value="" dataId="'+n+'"/><label><\/label><\/div><\/td>'},i.setDateData=function(n,t,i,u,f){var e='<td data-attr="'+u.attr+'" ',s,o,l,c,h;return u.rootAttr!=null&&(e+=' data-root-attr="'+u.rootAttr+'" '),s=" day-"+i.dw+" ",o="",typeof n!="undefined"&&(o=n[u.attr],(typeof o=="undefined"||o=="undefined")&&(o="")),u.editInline&&r.symbols.locks.indexOf(o)<0&&(i.dw==0?u.allowCn&&(s+=" edit-inline "):s+=" edit-inline "),r.contextMenuDate!=null&&(s+=" context-menu-date "),n!=null&&(u.highlight&&(e+=' hl="1" ',n[u.attr]!=n[u.rootAttr]&&(s+=r.symbols.ks.indexOf(n[u.attr])>=0||n[u.attr]==""?" highlight ":" error ")),n.N==1&&(s+=" has-comment")),l=u.height!=null?u.height:30,u.style!=null&&(e+=' style="'+u.style+"; height: "+l+'px" '),e+='i="'+f+'" class="'+s+' cell-date" data-y="'+t.y+'" data-m="'+t.m+'" data-dm="'+i.dm+'" data-dw="'+i.dw+'">',u.editInline?(c=!1,r.symbols.locks.indexOf(o)<0&&(i.dw==0?u.allowCn&&(c=!0):c=!0),c?(e+='<span  class="span-edit-inline'+(u.textAlign!=null?" text-"+u.textAlign:"")+'" >'+o+"<\/span>",e+='<div class="form-group inline-form"><input class="form-control  '+(u.textAlign!=null?"text-"+u.textAlign:"")+'" data-type="text" value="'+o+'" style="height: '+(l-1)+'px" /><\/div>'):(e+='<span  class="'+(u.textAlign!=null?"text-"+u.textAlign:"")+'" >'+o+"<\/span>",e+='<div class="locked-group"><i class="icon-lock2 " data-toggle="tooltip" data-placement="top" title="Ký hiệu đã khóa"><\/i><\/div>')):e+='<span  class="'+(u.textAlign!=null?"text-"+u.textAlign:"")+'" >'+o+"<\/span>",h='<div class="btn-group"><button type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-expanded="false"  title="Ghi chú"><i class="icon-info3"><\/i><\/button>',h+='<ul class="dropdown-menu"><li><a href="#" class="add-comment"><i class="icon-comment position-left text-orange-300"><\/i>Tạo ghi chú<\/a><\/li>',h+='<li><a href="#" class="edit-comment"><i class="icon-pencil7 position-left"><\/i>Sửa ghi chú<\/a><\/li>',h+='<li><a href="#" class="delete-comment"><i class="icon-x position-left"><\/i>Xóa ghi chú<\/a><\/li>',h+="<\/ul><\/div>",e+='<div class="comment-group">'+h+'<span class="arrow"><\/span><div class="comment-content">'+app.loading()+"<\/div><\/div>",e+"<\/td>"},i.setTdData=function(n,t,u,f){var e='<td data-attr="'+t.attribute+'"',h="",s,o,c;t.class!=null&&(h+=" "+t.class+" ");t.editInline&&(h+=" edit-inline ");e+=' class="'+h+'"';e+=' style="height: '+r.height.row+"px; ";t.style!=null&&(e+=t.style+"");e+='"';t.colspan!=null&&t.colspan.if(n)&&(e+=' colspan="'+t.colspan.value+'" ');switch(t.type){case"text":t.sumable?(typeof i.sumarray[u]=="undefined"&&(i.sumarray[u]=0),t.sumValue!=null&&(i.sumarray[u]+=t.sumValue(n))):i.sumarray[u]=null;e+=">";s="";t.attribute!=null&&n[t.attribute]!=null&&(s=n[t.attribute]);t.render!=null?e+='<span class=""> '+t.render(n)+"<\/span>":(e+="<span ",t.aline!=null&&(e+=' class="aline"'),e+="> "+s+"<\/span>");t.editInline&&(e+='<div class="form-group inline-form"><input class="form-control" data-type="text" attr="'+t.attribute+'" value="'+s+'" /><\/div>');break;case"date":e+=">";e+=app.formatDate(n[t.attribute]);i.sumarray[u]=null;break;case"time":e+=">";e+=app.formatTime(n[t.attribute]);i.sumarray[u]=null;break;case"datetime":e+=">";e+=app.formatDateTime(n[t.attribute]);i.sumarray[u]=null;break;case"html":e+=">";t.render!=null?e+=t.render(n).replace(/\n/g,"<br/>"):t.attribute!=null&&(e+=n[t.attribute]!=null?n[t.attribute]:"");i.sumarray[u]=null;break;case"number":t.sumable&&typeof i.sumarray[u]=="undefined"&&(i.sumarray[u]=0);e+=">";o=0;o=t.render!=null?t.render(n):n[t.attribute];i.sumarray[u]+=o;c=t.fixed?parseFloat(o).toFixed(2):o;e+="<span> "+c+"<\/span>";t.editInline&&(e+='<div class="form-group inline-form"><input class="form-control" data-type="number" attr="'+t.attribute+'" value="'+o+'" /><\/div>');break;case"ai":e+=">";e+=f;t.sumable?(typeof i.sumarray[u]=="undefined"&&(i.sumarray[u]=0),i.sumarray[u]+=1):i.sumarray[u]=null}return e+"<\/td>"},i.drawRow=function(t,u,f,e,o,s){var w={left:"",right:""},b=r.skipCols,c="<tr ",k,v,y,l,p,h,a,d,g;if(r.contextMenu!=null&&(c+=' data-toggle="context" data-target=".context-table-row" '),c+=' dataid="'+t[u]+'" ai="'+e+'" groupid="'+s+'" ',k=' class="tr-child  ',r.rowStyle!=null&&(c+=" "+r.rowStyle(t)+'" '),k+='"',c+=k,typeof t.Code!="undefined"&&(c+=' datacode="'+t.Code+'" '),t.ParentId!=null&&(c+=' parent="'+t.ParentId+'" '),c+=">",b>0){for(v=0,y=b,a="",h=v;h<y;h++)l=r.rows[h],p=app.hasValue(l.visible)?l.visible():!0,p&&(a+=i.setTdData(t,l,h,e));w.left=c+a+"<td>&nbsp;<\/td><\/tr>"}for(a="",v=b,y=r.rows.length,d=0,g=n.parseJSON(t.Detail),n(i.months).each(function(){var t=this;n(this.days).each(function(){var r=this,u;n(g).each(function(){var n=moment(this.D,"D-M-YYYY");if(n.date()==r.dm&&n.month()+1==t.m){u=this;return}});n(i.set.dateItems).each(function(n,f){a+=i.setDateData(u,t,r,f,d);d++})})}),h=v;h<y;h++)l=r.rows[h],p=app.hasValue(l.visible)?l.visible():!0,p&&(a+=i.setTdData(t,l,h));return w.right=c+a+"<\/tr>",w},i.drawEmptyRow=function(n){var t=r.skipCols,u='<tr class="empty">',f;if(n){if(t==0)return"";t>0&&(r.checkAll==null||r.checkAll)&&(u+=i.drawCheckbox(),t--);f=t}else(r.checkAll==null||r.checkAll)&&(t==0?u+=i.drawCheckbox():t--),f=r.rows.length-t;return u+='<td colspan="'+f+'"><\/td>',u+"<td>&nbsp;<\/td><\/tr>"},i.loopDrawchild=function(t,r,u,f,e){n.each(r,function(n,o){if(o.ParentId==u){var s=i.drawRow(o,f,e,n+1);t.find(".area-bl tbody").append(s.left);t.find(".area-br tbody").append(s.right);i.loopDrawchild(t,r,o.Id,f,e+1)}})},i.showBackground=function(){var r=n(u).find("> .calendar-table > .main-content"),f=r.find(".area-bl tbody"),e=r.find(".area-br tbody"),t;r.find(".area-bl tbody tr").css("display","none");r.find(".area-br tbody tr").css("display","none");r.find(".area-bl tbody tr.tr-background").remove();r.find(".area-br tbody tr.tr-background").remove();n(i.viewData).each(function(){if(this.active){r.find('tr.tr-group[groupid="'+this.gid+'"]').css("display","table-row");var i="",u="",o=f.find('tr.tr-group[groupid="'+this.gid+'"]'),s=e.find('tr.tr-group[groupid="'+this.gid+'"]');for(t=0;t<this.count;t++)this.left[t].active&&(i+=this.left[t].bg,u+=this.right[t].bg,f.find('tr.tr-child[dataid="'+this.left[t].id+'"]').attr("data-top",this.left[t].top),e.find('tr.tr-child[dataid="'+this.left[t].id+'"]').attr("data-top",this.left[t].top));for(n(o).after(i),n(s).after(u),t=0;t<this.count;t++)this.left[t].active&&(f.find('tr.tr-child[dataid="'+this.left[t].id+'"]').attr("data-top",this.left[t].top),e.find('tr.tr-child[dataid="'+this.left[t].id+'"]').attr("data-top",this.left[t].top))}})},i.showData=function(t){var o=n(u).find("> .calendar-table > .main-content"),f=o.find(".area-bl tbody"),e=o.find(".area-br tbody"),l=f.find("tr.tr-child"),a=o.find(".area-br").height(),s=[],h=[],c;n(l).each(function(){var i=parseInt(n(this).attr("data-top")),u=r.height.row;(i<=t&&t<=i+u||i-a<=t&&t<i)&&s.push(parseInt(n(this).attr("dataid")))});c=f.find("tr.tr-child.tr-real");n(c).each(function(){var t=parseInt(n(this).attr("dataid"));n.inArray(t,s)<0&&h.push(t)});n(i.viewData).each(function(){if(this.groupChilds.length>0)n(this.groupChilds).each(function(){for(var t=0;t<this.count;t++)n.inArray(this.left[t].id,h)>=0&&(f.find('tr.tr-real[dataid="'+this.left[t].id+'"]').replaceWith(this.left[t].bg),e.find('tr.tr-real[dataid="'+this.right[t].id+'"]').replaceWith(this.right[t].bg))});else for(var t=0;t<this.count;t++)n.inArray(this.left[t].id,h)>=0&&(f.find('tr.tr-real[dataid="'+this.left[t].id+'"]').replaceWith(this.left[t].bg),e.find('tr.tr-real[dataid="'+this.right[t].id+'"]').replaceWith(this.right[t].bg))});n(i.viewData).each(function(){if(this.active)for(var t=0;t<this.count;t++)n.inArray(this.left[t].id,s)>=0&&(f.find('tr.tr-background[dataid="'+this.left[t].id+'"]').replaceWith(this.left[t].html),e.find('tr.tr-background[dataid="'+this.right[t].id+'"]').replaceWith(this.right[t].html),f.find('tr.tr-child[dataid="'+this.left[t].id+'"]').attr("data-top",this.left[t].top),e.find('tr.tr-child[dataid="'+this.left[t].id+'"]').attr("data-top",this.left[t].top))});i.setRowEvents()},i.clearViewData=function(){n(i.viewData).each(function(){this.left=[];this.right=[];this.count=0;this.active=!1});var t=n(u).find("> .salary-table > .main-content .area tbody");t.find("tr.tr-child").remove();t.find(".tr-group").removeClass("showed-child");t.find(".tr-background").remove()},i.loadDataSequentially=function(t,f){i.searchParams.orgStr=t.join(";");i.sequentially.ajax=n.ajax({url:r.dataUrl!=null?r.dataUrl:"/api/"+r.model+"List",type:"GET",dataType:"JSON",contentType:"application/json; charset=utf-8",data:i.searchParams,success:function(e){var h=e.length>0?e:[],l=n(u).find("> .salary-table > .main-content"),o,s,c;i.sourceData=n.merge(i.sourceData,h);i.count+=e.Count;i.sumarray=[];r.rows.length>0&&h!=null&&h.length>0&&(s="Id",r.idAttribute!=null&&(s=r.idAttribute),n.each(h,function(t,u){o=i.drawRow(u,s,1,t+1,!0,u[r.group.attr]);c=!1;n(i.viewData).each(function(){if(this.gid==u[r.group.attr]){c=!0;this.active=!0;this.left.push({keyword:u.Keyword,active:!0,id:u[s],html:o.left,bg:""});this.right.push({id:u[s],html:o.right,bg:""});this.count++;return}});c||i.viewData.push({keyword:u.Keyword,active:!0,gid:u[r.group.attr],left:[{active:!0,html:o.left,bg:""}],right:[{html:o.left,bg:""}],count:1,loaded:!0})}));i.sequentially.first&&(i.sequentially.first=!1);i.sequentially.loaded+=t.length;app.loadingAsyncData({mode:1,tl:i.sequentially.loaded/i.viewData.length});t=[];n(i.viewData).each(function(){if(!this.loaded)if(t.length<i.sequentially.number)t.push(this.gid),this.loaded=!0;else return});t.length>0?i.loadDataSequentially(t):(i.sequentially.loading=!1,app.loadingAsyncData({mode:2}),i.sortai(),i.setRowPositions(),i.showBackground(),i.showData(0),i.hideTableLoading(),r.loadDataCallback!=null&&r.loadDataCallback(e),f!=null&&f(e))}})},i.setRowPositions=function(){var u=r.height.row,t=-r.height.row;n(i.viewData).each(function(){var r,n,e,f;if(this.active&&(t+=u,this.top=t,this.count>0)){for(r=0,n=0;n<this.count;n++)this.left[n].active&&(t+=u,r++,e=this.left[n].id,this.left[n].top=t,f=i.drawBackground(e,u,t,this.gid),this.left[n].html=this.left[n].html.replace("##top##",t),this.right[n].html=this.right[n].html.replace("##top##",t),this.left[n].bg=f.left,this.right[n].bg=f.right);this.top=u*r}})},i.drawBackground=function(n,t,u,f){var e='<tr dataid="'+n+'" data-top="'+u+'" class="tr-background tr-child" groupid="'+f+'" style=""><td style="height: '+t+'px" colspan="'+r.skipCols+'">&nbsp;<\/td><\/tr>',o='<tr dataid="'+n+'" data-top="'+u+'" class="tr-background tr-child" groupid="'+f+'" style=""><td style="height: '+t+'px" colspan="'+i.colRight+'">&nbsp;<\/td><\/tr>';return{left:e,right:o}},i.sortai=function(){var t;n(i.viewData).each(function(){this.active&&(t=0,n(this.left).each(function(){var i,r;this.active&&(i=n(this.html),t++,i.find("td:eq(0)").text(t),r=n("<div>").append(i.clone()).html(),this.html=r)}))})},i.loadData=function(t,f,e){var o,h,s;t!=null&&n.extend(i.searchParams,t);o=n(u).find("> .calendar-table > .main-content");r.multiLevel&&(i.activeParentId!=null?(h=o.find('.area-br tbody tr[dataid="'+i.activeParentId+'"]'),i.reloadChilds(h)):r.group!=null&&r.group.sequentially?(s=[],n(i.viewData).each(function(){if(!this.loaded)if(s.length<i.sequentially.number)s.push(this.gid),this.loaded=!0;else return}),s.length>0&&(i.sequentially.loading=!0,i.sequentially.first=!0,app.loadingAsyncData({mode:0,text:"Đang tải dữ liệu bảng công"}),i.clearViewData(),i.loadDataSequentially(s,f))):(i.showTableLoading(),n.ajax({url:r.dataUrl!=null?r.dataUrl:"/api/"+r.model+"List",type:"GET",dataType:"JSON",contentType:"application/json; charset=utf-8",data:i.searchParams,success:function(t){var a=t.Count!=null?t.Count:0,s=t.Many!=null?t.Many:t.length>0?t:[],v,h,u,c,l;a==0&&(a=s.length);v=r.optionMenu!=null;i.sourceData=s;i.count=t.Count;r.rows.length>0&&(s!=null&&s.length>0?(h="Id",r.idAttribute!=null&&(h=r.idAttribute),i.sumarray=[],i.viewData=[],e&&r.group==null&&(o.find(".area-bl tbody").html(""),o.find(".area-br tbody").html("")),n.each(s,function(t,u){var f,e;r.group!=null?(f=i.drawRow(u,h,1,t+1,!0,u[r.group.attr]),e=!1,n(i.viewData).each(function(){if(this.gid==u[r.group.attr]){e=!0;this.left+=f.left;this.right+=f.right;this.count+=1;return}}),e||i.viewData.push({gid:u[r.group.attr],left:f.left,right:f.right,count:1})):(f=i.drawRow(u,h,1,t+1,!0,""),o.find(".area-bl tbody").append(f.left),o.find(".area-br tbody").append(f.right));v&&o.find(".area-bom tbody").append(i.drawOptionMenu(u,h))}),r.group!=null?(o.find("tbody tr.tr-child").remove(),c=-r.height.row,n(i.viewData).each(function(){u=r.height.row*this.count;c+=r.height.row;var t=o.find('.area-bl tbody tr[groupid="'+this.gid+'"]').attr("data-top",c).attr("data-height",u+r.height.row);n(t).after('<tr class="tr-background" groupid="'+this.gid+'"><td style="height: '+u+'px" colspan="'+r.skipCols+'">&nbsp;<\/td><\/tr>');t=o.find('.area-br tbody tr[groupid="'+this.gid+'"]').attr("data-top",c).attr("data-height",u+r.height.row);n(t).after('<tr class="tr-background" groupid="'+this.gid+'"><td style="height: '+u+'px" colspan="'+i.colRight+'">&nbsp;<\/td><\/tr>');c+=u}),i.sortai(),i.showData(0)):i.setRowEvents(),o.find(".empty-message").css("display","none")):(l=i.drawEmptyRow(!0),o.find(".area-bl tbody").append(l),l=i.drawEmptyRow(!1),o.find(".area-br tbody").append(l),o.find(".empty-message").css("display","block")));o.find(" .total-row span").text(a);i.hideTableLoading();r.loadDataCallback!=null&&r.loadDataCallback(t,e);f!=null&&f(t)}})))},i.searchGroup=function(t){t.length>0?(t=parseInt(t),n(i.viewData).each(function(){this.active=this.gid==t?!0:!1})):n(i.viewData).each(function(){this.active=this.count>0?!0:!1});i.setRowPositions();i.showBackground();i.showData(0)},i.search=function(t){var r=n(u).find("> .calendar-table > .main-content .area tbody");r.find("tr.tr-child").remove();r.find(".tr-background").remove();i.showTableLoading();n(i.viewData).each(function(){if(this.active=!1,this.count>0)for(var n=0;n<this.count;n++)t.length>0?this.left[n].keyword.indexOf(t)>=0?(this.active=!0,this.left[n].active=!0):this.left[n].active=!1:(this.active=!0,this.left[n].active=!0)});i.sortai();i.setRowPositions();i.showBackground();i.showData(0);i.hideTableLoading()},i.setData=function(t,f){var o=t.Count!=null?t.Count:0,e=t.Many!=null?t.Many:t.length>0?t:null,s;e!=null&&(o==0&&(o=e.length),n(u).find(".area-bl tbody").html(""),n(u).find(".area-br tbody").html(""),i.sourceData=e);i.count=o;r.rows.length>0&&e!=null&&e.length>0&&(s="Id",r.idAttribute!=null&&(s=r.idAttribute),i.sumarray=[],n.each(e,function(t,r){var f=i.drawRow(r,s,1,t+1,!0);n(u).find(".area-bl tbody").append(f);f=i.drawRow(r,s,1,t+1,!1);n(u).find(".area-br tbody").append(f)}));n(u).find(".main-content .total-row span").text(o);i.hideTableLoading();i.setRowEvents();r.loadDataCallback!=null&&r.loadDataCallback(t);f!=null&&f(t)},i.setSubmitEvent=function(n){var t=!0;if(r.beforeSubmit!=null&&(t=r.beforeSubmit()),!t||!r.autoSubmit)return!1;i.submitForm(n)},i.hideModal=function(){var t=parseInt(n("#"+r.model+"FormEditModal").attr("data-type"));t==2?n("#"+r.model+"FormEditModal").fadeOut("fast",function(){n("#"+r.model+"FormEditModal").remove()}):n("#"+r.model+"FormEditModal").modal("hide");n("body").removeClass("overflow-hidden")},i.eventModal=function(){var u;n(".form-cancel").unbind().click(function(){i.hideModal()});var t=n(window).height(),f="#formEditModal",e=n(f+" form").height();e+=117;u=(t-e)/4;t<e&&(u=0,e=t);n(f+" .wtable-epanel-content").css("height",e+"px").css("top",u+"px");n(window).resize(function(){var h=r.modal,s,i,o,e;h.type==2&&(s=n(window).width(),t=n(window).height(),i=h.width,o="",i.indexOf("%")>-1?(i=i.substr(0,i.length-1),o=(100-parseInt(i))/2+"%"):i.indexOf("px")>-1&&(i=i.substr(0,i.length-2),i=parseInt(i),o=s>i?(s-i)/2+"px":"0px"),e=n(f+" form").height(),e+=117,u=(t-e)/4,t<e&&(u=0,e=t),n(f+" .wtable-epanel-content").css("left",o).css("height",e+"px").css("top",u+"px"))});n(f).on("keyup keypress",function(n){var t=n.keyCode||n.which;if(t===13)return n.preventDefault(),!1})},i.initModal=function(t,i){var u="";if(t.type==2){var o=n(window).width(),f=t.width,e="";f.indexOf("%")>-1?(f=f.substr(0,f.length-1),e=(100-parseInt(f))/2+"%"):f.indexOf("px")>-1&&(f=f.substr(0,f.length-2),f=parseInt(f),o>f&&(e=(o-f)/2+"px"));u='<div class="wtable-epanel" id="'+r.model+'FormEditModal" data-type="'+t.type+'">';u+=t.width!=""?'<div class="wtable-epanel-content" style="width:'+t.width+";left: "+e+'">':'<div class="wtable-epanel-content">';u+='<div class="panel panel-flat wtable-panel">';u+=i;u+="<\/div><\/div><\/div>";n("body").append(u)}else{if(u='<div class="modal" id="'+r.model+'FormEditModal" data-type="'+t.type+'" data-backdrop="static"  role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">',u+=t.width!=""?'    <div class="modal-dialog" style="width:'+t.width+'">':'    <div class="modal-dialog" >',u+='<div class="modal-content">',u+='      <div class="modal-header p-15 '+(t.headerClass!=null?t.headerClass:"")+'">',u+='          <button class="close" aria-hidden="true" data-dismiss="modal" type="button">×<\/button>',u+='              <h5 class="modal-title text-bold">'+t.title+"<\/h5>",u+='          <\/div><form id="'+r.model+'Form" class="form-horizontal"><div class="modal-body '+(t.noPaddingBody!=null?"no-padding":"pt-15 pl-15 pr-15 pb-5")+'">',u+=i,u+="<\/div>",t.footerTemplate!=null)u+=n(t.footerTemplate).html();else switch(t.mode){case 2:u+='<div class="panel-footer panel-footer p-15"><div class="pull-right"><button class="btn btn-sm btn-default form-cancel mr-10 btn-rounded" data-dismiss="modal"><i class="fa fa-remove"><\/i> Thoát<\/button><button class="btn btn-sm bg-slate mr-10 btn-submit btn-rounded" type="button" data-mode="1" data-loading-text="<i class=\'icon-spinner4 fa-spin position-left\'><\/i> Lưu tạm"><i class="icon-floppy-disk position-left"><\/i> Lưu tạm<\/button><button class="btn btn-sm btn-success btn-submit btn-rounded" type="button" data-mode="2" data-loading-text="<i class=\'icon-spinner4 fa-spin position-left\'><\/i> Lưu và gửi đề xuất"><i class="icon-paperplane position-left"><\/i> Lưu và gửi đề xuất<\/button><\/div><\/div>';break;case 3:u+='<div class="panel-footer panel-footer p-15"><div class="pull-right"><button class="btn btn-sm btn-default form-cancel mr-10 btn-rounded" data-dismiss="modal"><i class="fa fa-remove"><\/i> Thoát<\/button><button class="btn btn-sm bg-slate mr-10 btn-submit btn-rounded" type="button" data-mode="1" data-loading-text="<i class=\'icon-spinner4 fa-spin position-left\'><\/i> Lưu tạm"><i class="icon-floppy-disk position-left"><\/i> Lưu tạm<\/button><button class="btn btn-sm btn-success btn-submit btn-rounded" type="button" data-mode="3" data-loading-text="<i class=\'icon-spinner4 fa-spin position-left\'><\/i> Lưu và gửi đề xuất"><i class="icon-check position-left"><\/i> Lưu và ký chốt<\/button><\/div><\/div>';break;default:u+='<div class="panel-footer panel-footer p-15"><div class="pull-right"><button class="btn btn-sm btn-default form-cancel mr-10 btn-rounded" data-dismiss="modal"><i class="fa fa-remove"><\/i> Thoát<\/button><button class="btn btn-sm btn-fill btn-primary m-r-5 btn-submit btn-rounded" type="button" data-loading-text="<i class=\'icon-spinner4 fa-spin\'><\/i> Đang xử lý ..."><i class="fa fa-save"><\/i> Lưu lại<\/button><\/div><\/div>'}u+="<\/form><\/div><\/div><\/div>";n("body").append(u);n("#"+r.model+"FormEditModal").on("hidden.bs.modal",function(){n("body").removeClass("overflow-hidden");n("#"+r.model+"FormEditModal").remove()})}},i.showModal=function(){var t=parseInt(n("#"+r.model+"FormEditModal").attr("data-type"));t==2?n("#"+r.model+"FormEditModal").fadeIn("fast"):n("#"+r.model+"FormEditModal").modal("show");n("body").addClass("overflow-hidden")},i.createOrUpdateComment=function(t,r,u,f){var o=t==0?"Tạo":"Sửa",e;o+=" ghi chú";e="calendarCommentForm";i.showTableLoading();app.createPartialModal({url:DOMAIN_API+"/cb/CbTimekeepingCommentCommand",data:r,modal:{width:"500px",title:o,id:e}},function(){u();initCbTimekeepingCommentForm(function(){n("#"+e).remove();n(".modal-backdrop").remove();f()});i.hideTableLoading();n("#"+e).on("hidden.bs.modal",function(){n("#"+e).remove()})})},i.createOrUpdateObject=function(t,u,f){i.showTableLoading();var e=r.editController!=null?r.editController+"/":"/admin/";e+=r.model+"Edit";n.extend(i.editParams,{id:t});n.ajax({url:e,type:"GET",data:i.editParams,dataType:"html",success:function(n){i.hideTableLoading();var e=r.modal;i.initModal({title:(t!=null?"Cập nhật ":"Thêm mới ")+e.title,width:e.width,type:e.type!=null?e.type:1,noPaddingBody:e.noPaddingBody,headerClass:e.headerClass,noFooter:e.noFooter,mode:e.mode},n);i.eventModal();i.showModal();r.loadModalCallback!=null&&r.loadModalCallback(f);u&&u()}})},i.getSelectedIds=function(){var t=[];return n.each(n(u).find("> .calendar-table > .main-content .area-br tr"),function(i,r){n(r).hasClass("active")&&t.push(n(r).attr("dataid"))}),t},i.getCheckedRowIds=function(){var t=[];return n.each(n(u).find('> .calendar-table > .main-content .first-col input[type="checkbox"]'),function(){n(this).prop("checked")==!0&&t.push(n(this).closest("tr").attr("dataid"))}),t},i.getCheckedDatas=function(){var f=[],e="Id",u,t;for(r.idAttribute!=null&&(e=r.idAttribute),u=i.getCheckedRowIds(),t=0;t<u.length;t++)n(i.sourceData).each(function(){if(this[e]==u[t])return f.push(this),!1});return f},i.setCheckedRowIds=function(t){for(var r,f,e=n(u).find("> .calendar-table > .main-content"),i=0;i<t.length;i++)r=e.find('.area-bl tr[dataid="'+t[i]+'"]'),f=n(r).find('.first-col input[type="checkbox"]'),f.prop("checked",!0);n.uniform.update()},i.getSelectedRow=function(){return n(u).find('> .calendar-table > .main-content .area-br tr[class="active"]').first()},i.getSelectedDatas=function(){var f=[],e="Id",u,t;for(r.idAttribute!=null&&(e=r.idAttribute),u=i.getSelectedIds(),t=0;t<u.length;t++)n(i.sourceData).each(function(){if(this[e]==u[t])return f.push(this),!1});return f},i.addChild=function(t,u){var e,f;i.showTableLoading();e=r.editController!=null?r.editController+"/":"/admin/";e+=r.model+"Edit";f=r.modal;n.ajax({url:e,type:"GET",data:t,dataType:"html",success:function(n){i.hideTableLoading();i.initModal({title:"Thêm "+f.title.toLowerCase(),width:f.width,type:f.type!=null?f.type:1,mode:f.mode},n);i.eventModal();i.showModal();r.loadModalCallback!=null&&r.loadModalCallback(u)}})},i.getDataById=function(t){var u,f="Id";return r.idAttribute!=null&&(f=r.idAttribute),n(i.sourceData).each(function(){if(this[f]==t)return u=this,!1}),u},i.getActiveTabIndex=function(){return n(u).find("> .calendar-table > .sub-content > .tab-content > div.active").index()},i.loadFilterOption=function(t,i){var f,u,e;if(!n(t).hasClass("loaded")&&(f=t.attr("data-index"),u=r.rows[f].filter,u.ajax!=null))return e=u.ajax.data,app.loadData(u.ajax.url,e,null,function(r){t.addClass("loaded");var f=r.Many!=null?r.Many:r;n(f).each(function(){var n=new Option(this[u.ajax.attr.text],this[u.ajax.attr.id],!0,!0);t.append(n)});t.select2("val","");i!=null&&i()}),!0},i.setStaticEvents=function(){var o,f,e;i.resize();n(window).resize(function(){i.resize()});var t=n(u).find("> .calendar-table > .main-content"),s=n(u).find("> .calendar-table > .resize"),h=n(u).find("> .calendar-table > .sub-content"),c=n("#sub_content_modal");window.addEventListener("touchstart",function(t){i.tounchTr=n(t.target).closest(".area")});n(t).find(" .area").mouseover(function(){i.tounchTr=n(this)});t.find(".area-tr > div").scroll(function(){if(n(i.tounchTr).length==0||n(i.tounchTr).hasClass("area-tr")){var r=n(this).scrollLeft();t.find(".area-br > div").scrollLeft(r)}});t.find(".area-br > div").scroll(function(){if(n(i.tounchTr).length==0||n(i.tounchTr).hasClass("area-br")){clearTimeout(n.data(this,"scrollCheck"));var r=n(this).scrollTop(),u=n(this).scrollLeft();t.find(".area-bl > div").scrollTop(r);t.find(".area-tr > div").scrollLeft(u);n.data(this,"scrollCheck",setTimeout(function(){i.searching||i.showData(r)},100))}});t.find(".area-bl > div").scroll(function(){if(n(i.tounchTr).length==0||n(i.tounchTr).hasClass("area-bl")){var r=n(this).scrollTop();t.find(".area-br > div").scrollTop(r);clearTimeout(n.data(this,"scrollCheck"));n.data(this,"scrollCheck",setTimeout(function(){i.searching||i.showData(r)},100))}});t.find(".checkAll").click(function(){n(this).prop("checked")?(t.find(".area-bl .first-col input").prop("checked",!0),t.find(".area-br .first-col input").prop("checked",!0),r.toolbars!=null&&(r.toolbars.delete!=null&&n(r.toolbars.delete.ele).prop("disabled",!1),r.toolbars.edit!=null&&n(r.toolbars.edit.ele).prop("disabled",!0))):(t.find(".area-bl .first-col input").prop("checked",!1),t.find(".area-br .first-col input").prop("checked",!1),r.toolbars!=null&&(r.toolbars.delete!=null&&n(r.toolbars.delete.ele).prop("disabled",!0),r.toolbars.edit!=null&&n(r.toolbars.edit.ele).prop("disabled",!0)));n.uniform.update();r.selectRowCallback!=null&&r.selectRowCallback()});s.draggable({axis:"y",start:function(n,t){o=t.position.top},stop:function(n,r){var e=r.position.top,f=e-o,u=t.find(".areas").height();i.setMainTableHeight(u+f);s.css("top",0);u=h.find("> .tab-content").height();i.setSubContentHeight(u+70-f)}});r.toolbars!=null&&(r.toolbars.create!=null&&n(r.toolbars.create.ele).unbind().click(function(){if(r.toolbars.create.click!=null)r.toolbars.create.click();else{var t=n(this);t.button("loading");i.createOrUpdateObject(null,function(){t.button("reset")})}}),r.toolbars.edit!=null&&(f=r.toolbars.edit,n(f.ele).prop("disabled",!0),n(f.ele).unbind().click(function(){var t=i.getSelectedIds()[0],e=i.getSelectedRow(),r=n(this),u;app.hasValue(t)?(u=i.getDataById(t),(f.before==null||f.before(u))&&(f.click!=null?f.click(t):(r.button("loading"),i.createOrUpdateObject(t,function(){r.button("reset")},e)))):app.notify("warning","Vui lòng chọn đối tượng cần sửa")})),r.toolbars.delete!=null&&(e=r.toolbars.delete,n(e.ele).prop("disabled",!0),n(e.ele).unbind().click(function(){var n=i.getCheckedRowIds();n.length>0?(e.before==null||e.before(n))&&i.deleteObjects("bulk",n,function(){i.loadData()}):app.notify("warning","Vui lòng chọn đối tượng cần xóa")})),r.toolbars.reload!=null&&n(r.toolbars.reload.ele).unbind().click(function(){i.loadData()}),r.toolbars.reorder!=null&&n(r.toolbars.reorder.ele).unbind().click(function(){var n=i.getCheckedRowIds();n.length==0&&app.notify("warning","Vui lòng chọn dữ liệu để sắp xếp")}));t.find('.first-col input[type="checkbox"]').click(function(){var e=t.find(".checkAll"),s=n(this).closest("tr"),i=s.attr("dataid"),f,o;n(this).prop("checked")?(n(u).find('.area-bl tr[dataid="'+i+'"]').addClass("active"),n(u).find('.area-br tr[dataid="'+i+'"]').addClass("active")):(n(u).find('.area-bl tr[dataid="'+i+'"]').removeClass("active"),n(u).find('.area-br tr[dataid="'+i+'"]').removeClass("active"),e.prop("checked")&&e.prop("checked",!1));f=0;o=t.find(" .first-col input");o.each(function(){n(this).prop("checked")==!0&&f++});o.length==f&&e.prop("checked",!0);r.toolbars!=null&&r.toolbars.delete!=null&&(f>0?n(r.toolbars.delete.ele).prop("disabled",!1):n(r.toolbars.delete.ele).prop("disabled",!0));n.uniform.update();r.selectRowCallback!=null&&r.selectRowCallback(s)});t.find(".area-tr th .th-scroll").draggable({axis:"x",start:function(n,t){o=t.position.left},stop:function(r,u){var o=u.position.left,e=n(r.target),s=e.attr("i"),h=e.closest("table").find("> colgroup"),f;h.find('col[i="'+s+'"]').css("width",o+5);f=0;h.find("col").each(function(){f+=parseInt(n(this).width())});e.closest("table").css("width",f).attr("data-w",f);t.find('.area-br colgroup col[i="'+s+'"]').css("width",o+5);t.find(".area-br table").css("width",f).attr("data-w",f);i.setMainTableWidth()}});r.height.correlate!=null&&r.height.correlate.attrchange({callback:function(){var e=n(this).height(),t=e-(r.toolbars!=null?40:0),f=n(u).find("> .calendar-table");f.css("height",t);r.subContent!=null?(f.hasClass("expand")?i.setMainTableHeight(t-35):i.setMainTableHeight(parseInt(t/2)),i.setSubContentHeight(parseInt(t/2))):i.setMainTableHeight(t-35)}});t.find(".btn-change-limit").unbind().click(function(){var r=n(this).attr("data"),u=n(this).text(),t;n(this).closest(".btn-group").find(" .dropdown-toggle span").text(u);t={};r!=""?t.limit=parseInt(r):t.unlimited=!0;i.search(t,function(){})});t.find(".area-tr .table th.orderable").unbind().click(function(){var u=n(this).attr("orderby"),t=n(this).attr("currentorder"),r=n(this).find("i");t=t=="desc"?"asc":"desc";i.searchParams.orderby=u;i.searchParams.orderType=t;n(this).attr("currentorder",t);r.hasClass("fa-caret-down")?r.removeClass("fa-caret-down").addClass("fa-caret-up"):r.removeClass("fa-caret-up").addClass("fa-caret-down");i.loadData()})},i.reorder=function(){var t;n("#reorder_modal").length==0&&(t='<div class="modal fade" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"><div class="modal-dialog modal-sm" role="document"><div class="modal-content"><\/div><\/div><\/div>')},i.loadComment=function(t){var u=n(t).find(".comment-group");if(!u.hasClass("loaded")){var f=n(t).closest("tr"),e=t.attr("data-m")+"/"+t.attr("data-dm")+"/"+t.attr("data-y"),o={detailId:f.attr("dataid"),date:e,type:r.contextMenuDate.type,dataType:"html"};i.showTableLoading();app.loadData(DOMAIN_API+"/cb/getTimekeepingCommentView",o,null,function(t){n(u).find(".comment-content").html(t);u.addClass("loaded");i.hideTableLoading()})}},i.setRowEvents=function(t){var f=n(u).find("> .calendar-table > .main-content"),e,s,h,c,o;t!=null?(console.log("events - "+t),f.find('.area-bl tr.tr-group[groupid="'+t+'"] .btn-expander').unbind().click(function(){var t=n(this),r=t.closest("tr");i.expandChild(t,r,f)}),h='.area-bl tr.tr-child[groupid="'+t+'"]',c='.area-br tr.tr-child[groupid="'+t+'"]',f.find(h).unbind().hover(function(){var t=n(this).attr("dataid");n(u).find('.area-br tr.tr-child[dataid="'+t+'"]').addClass("hover");n(this).addClass("hover")},function(){var t=n(this).attr("dataid");n(u).find('.area-br tr.tr-child[dataid="'+t+'"]').removeClass("hover");n(this).removeClass("hover")}),f.find('.area-br tr.tr-child[groupid="'+t+'"]').unbind().hover(function(){var t=n(this).attr("dataid");n(u).find('.area-bl tr.tr-child[dataid="'+t+'"]').addClass("hover");n(this).addClass("hover")},function(){var t=n(this).attr("dataid");n(u).find('.area-bl tr.tr-child[dataid="'+t+'"]').removeClass("hover");n(this).removeClass("hover")}),f.find(h+" td,"+h+" p,"+h+" span,"+h+" div").unbind().click(function(t){t.target==this&&i.selectRow(n(this).closest("tr"))}),e=c+" td",f.find(e).unbind(),s=f.find(e+".edit-inline > span"),s.unbind(),f.find(e+".edit-inline").click(function(t){if(t.target==this&&!n(this).hasClass("editing")){f.find(".area td.editing").each(function(){var t=n(this).find("> .inline-form input");i.closeEditInline(t,t.val(),t.attr("data-type"))});n(this).addClass("editing");var r=n(this).find("input");r.select()}}),s.click(function(t){t.target==this&&n(this).closest("td").trigger("click")}),f.find(e).hover(function(){n(this).addClass("hover");n(this).hasClass("has-comment")&&i.loadComment(n(this))},function(){n(this).removeClass("hover")}),o=f.find(".area td.edit-inline input"),o.unbind(),o.keydown(function(){var s=event.keyCode?event.keyCode:event.which,u=n(this).val(),h,f,e,t,o,r;if(s==9)return i.closeEditInline(n(this),u),u=n(this).val(),h=n(this).attr("attr"),o=n(this).closest("td"),e=parseInt(o.attr("i")),f=n(this).closest("tr"),r=f.find("td.edit-inline"),t=null,n(r).each(function(){var i=parseInt(n(this).attr("i"));if(i>e)return t=n(this),!1}),t==null&&(t=r.first()),t.length>0&&(t.addClass("editing"),t.find("input").focus().select()),!1}),o.keyup(function(){var c=event.keyCode?event.keyCode:event.which,h=n(this).val(),e,u,o,f,t,r,s;if(!(c>=65)||!(c<=90))switch(c){case 13:case 40:i.closeEditInline(n(this),h);e=n(this).closest("td").attr("i");u=n(this).closest("tr");o=u.closest("body");f=parseInt(u.attr("ai"));t=o.find('tr[ai="'+(f+1)+'"]');t.length==0&&(t=o.find('tr[ai="1"]'));t.length>0&&(r=t.find('td[i="'+e+'"]'),r.length>0&&(r.addClass("editing"),r.find("input").focus().select()));break;case 39:i.closeEditInline(n(this),h);e=n(this).attr("attr");r=n(this).closest("td");f=parseInt(r.attr("i"));u=n(this).closest("tr");s=u.find("td.edit-inline");t=null;n(s).each(function(){var i=parseInt(n(this).attr("i"));if(i>f)return t=n(this),!1});t==null&&(t=s.first());t.length>0&&(t.addClass("editing"),t.find("input").focus().select());break;case 37:i.closeEditInline(n(this),h);e=n(this).attr("attr");r=n(this).closest("td");f=parseInt(r.attr("i"));u=n(this).closest("tr");s=u.find("td.edit-inline");t=null;n(s).each(function(){var i=parseInt(n(this).attr("i"));i<f&&(t=n(this))});t==null&&(t=s.last());t.length>0&&(t.addClass("editing"),t.find("input").focus().select());break;case 38:i.closeEditInline(n(this),h);e=n(this).closest("td").attr("i");u=n(this).closest("tr");o=u.closest("body");f=parseInt(u.attr("ai"));t=o.find('tr[ai="'+(f-1)+'"]');t.length==0&&(t=o.find("tr:not(.tr-total)").last());t.length>0&&(r=t.find('td[i="'+e+'"]'),r.length>0&&(r.addClass("editing"),r.find("input").focus().select()))}})):(f.find(".area-bl tr").unbind().hover(function(){var t=n(this).attr("dataid");n(u).find('.area-br tr[dataid="'+t+'"]').addClass("hover");n(this).addClass("hover")},function(){var t=n(this).attr("dataid");n(u).find('.area-br tr[dataid="'+t+'"]').removeClass("hover");n(this).removeClass("hover")}),f.find(".area-br tr").unbind().hover(function(){var t=n(this).attr("dataid");n(u).find('.area-bl tr[dataid="'+t+'"]').addClass("hover");n(this).addClass("hover")},function(){var t=n(this).attr("dataid");n(u).find('.area-bl tr[dataid="'+t+'"]').removeClass("hover");n(this).removeClass("hover")}),f.find(".area-bl tr td").unbind().click(function(t){t.target==this&&i.selectRow(n(this).closest("tr"))}),e=".area-br tr td",f.find(e).unbind(),s=f.find(".area td.edit-inline > span"),s.unbind(),n(".add-comment").unbind().click(function(){var t=n(this).closest("td"),u=t.closest("tr"),f=n(u).attr("dataid"),e=t.attr("data-m")+"/"+t.attr("data-dm")+"/"+t.attr("data-y");console.log(45454);i.createOrUpdateComment(0,{date:e,detailId:f,type:r.contextMenuDate.type,AuthEmployeeId:auth.EmployeeId},function(){},function(){i.saveAfterChangeComment(t,1)})}),n(".edit-comment").unbind().click(function(){var t=n(this).closest("td"),u=t.closest("tr"),f=n(u).attr("dataid"),e=t.attr("data-m")+"/"+t.attr("data-dm")+"/"+t.attr("data-y");i.createOrUpdateComment(1,{date:e,detailId:f,type:r.contextMenuDate.type,AuthEmployeeId:auth.EmployeeId},function(){},function(){i.saveAfterChangeComment(t,1)})}),n(".delete-comment").unbind().click(function(){var t=n(this).closest("td"),u=t.closest("tr"),f=n(u).attr("dataid"),e=t.attr("data-m")+"/"+t.attr("data-dm")+"/"+t.attr("data-y");app.confirm("warning",null,null,function(n){n&&app.postData(DOMAIN_API+"/cb/DeleteCbTimekeepingComment",{date:e,detailId:f,type:r.contextMenuDate.type,AuthEmployeeId:auth.EmployeeId},function(){i.saveAfterChangeComment(t,0)})})}),f.find(e+".edit-inline").click(function(t){if(t.target==this&&!n(this).hasClass("editing")){f.find(".area td.editing").each(function(){var t=n(this).find("> .inline-form input");i.closeEditInline(t,t.val(),t.attr("data-type"))});n(this).addClass("editing");var r=n(this).find("input");r.select()}}),s.click(function(t){t.target==this&&n(this).closest("td").trigger("click")}),f.find(e).hover(function(){n(this).addClass("hover");n(this).hasClass("has-comment")&&i.loadComment(n(this))},function(){n(this).removeClass("hover")}),f.find(".btn-expander").unbind().click(function(){var t=n(this),r=t.closest("tr");i.expandChild(t,r,f)}),o=f.find(".area td.edit-inline input"),o.unbind(),o.keydown(function(){var s=event.keyCode?event.keyCode:event.which,u=n(this).val(),h,f,e,t,o,r;if(s==9)return i.closeEditInline(n(this),u),u=n(this).val(),h=n(this).attr("attr"),o=n(this).closest("td"),e=parseInt(o.attr("i")),f=n(this).closest("tr"),r=f.find("td.edit-inline"),t=null,n(r).each(function(){var i=parseInt(n(this).attr("i"));if(i>e)return t=n(this),!1}),t==null&&(t=r.first()),t.length>0&&(t.addClass("editing"),t.find("input").focus().select()),!1}),o.keyup(function(){var c=event.keyCode?event.keyCode:event.which,h=n(this).val(),e,u,o,f,t,r,s;if(!(c>=65)||!(c<=90))switch(c){case 13:case 40:i.closeEditInline(n(this),h);e=n(this).closest("td").attr("i");u=n(this).closest("tr");o=u.closest("body");f=parseInt(u.attr("ai"));t=o.find('tr[ai="'+(f+1)+'"]');t.length==0&&(t=o.find('tr[ai="1"]'));t.length>0&&(r=t.find('td[i="'+e+'"]'),r.length>0&&(r.addClass("editing"),r.find("input").focus().select()));break;case 39:i.closeEditInline(n(this),h);e=n(this).attr("attr");r=n(this).closest("td");f=parseInt(r.attr("i"));u=n(this).closest("tr");s=u.find("td.edit-inline");t=null;n(s).each(function(){var i=parseInt(n(this).attr("i"));if(i>f)return t=n(this),!1});t==null&&(t=s.first());t.length>0&&(t.addClass("editing"),t.find("input").focus().select());break;case 37:i.closeEditInline(n(this),h);e=n(this).attr("attr");r=n(this).closest("td");f=parseInt(r.attr("i"));u=n(this).closest("tr");s=u.find("td.edit-inline");t=null;n(s).each(function(){var i=parseInt(n(this).attr("i"));i<f&&(t=n(this))});t==null&&(t=s.last());t.length>0&&(t.addClass("editing"),t.find("input").focus().select());break;case 38:i.closeEditInline(n(this),h);e=n(this).closest("td").attr("i");u=n(this).closest("tr");o=u.closest("body");f=parseInt(u.attr("ai"));t=o.find('tr[ai="'+(f-1)+'"]');t.length==0&&(t=o.find("tr:not(.tr-total)").last());t.length>0&&(r=t.find('td[i="'+e+'"]'),r.length>0&&(r.addClass("editing"),r.find("input").focus().select()))}}));n('[data-toggle="tooltip"]').tooltip()},i.expandChild=function(t,r,u){var f=parseInt(r.attr("groupid")),e=t.find("i"),o=u.find('tr[groupid="'+f+'"]:not(.tr-group)');u.find("tbody tr.tr-real").remove();r.hasClass("expanded")?(o.remove(),n(i.viewData).each(function(){if(this.count>0&&(this.active=!0,this.gid==f&&this.count>0))for(var n=0;n<this.count;n++)this.left[n].active=!1}),r.removeClass("expanded"),e.removeClass("icon-arrow-down5").addClass("icon-arrow-right5")):(n(i.viewData).each(function(){if(this.count>0&&(this.active=!0,this.gid==f&&this.count>0))for(var n=0;n<this.count;n++)this.left[n].active=!0}),r.addClass("expanded"),e.removeClass("icon-arrow-right5").addClass("icon-arrow-down5"));i.setRowPositions();i.showBackground();i.showData(0)},i.updateRowValue=function(n){for(var s=parseInt(n.attr("dataid")),f=i.getDataById(s),h=-1,u,e,o,t=0;t<i.sourceData.length;t++)if(i.sourceData[t].Id==s){h=t;break}for(t=0;t<r.rows.length;t++)u=r.rows[t],u.formula!=null&&(e=u.formula(f),o=n.find('td[data-attr="'+u.attribute+'"]'),o.find("span").text(e),o.find("input").val(e),f[u.attribute]=parseFloat(e));return i.sourceData[h]=f,f},i.saveAfterChangeComment=function(t,u){var e,s;u==1?(t.addClass("has-comment"),t.find(".comment-group").removeClass("loaded"),t.find(".comment-content").html(app.loading())):t.removeClass("has-comment");var o=t.closest("tr"),h=o.attr("dataid"),f=moment([parseInt(t.attr("data-y")),parseInt(t.attr("data-m"))-1,parseInt(t.attr("data-dm"))]).format("DD-MM-YYYY");n(i.sourceData).each(function(){var e,r,i,o;this.Id==h&&(e=this,t.hasClass("cell-date")?(i=[],e.Detail!=null?(i=n.parseJSON(e.Detail),o=!1,n(i).each(function(){this.D==f&&(this.N=u,o=!0)}),o||(r={D:f,N:u},i.push(r))):(r={D:f,N:u},i.push(r)),this.Detail=JSON.stringify(i)):this.N=u)});e=r.editController!=null?r.editController+"/":"/admin/";e+=r.model+"EditDate";s=i.updateRowValue(o);n(i.editLoader).show();app.postData(e,s,function(){n(i.editLoader).hide()})},i.closeEditInline=function(t,u,f){var a=t.closest("tr"),v=a.attr("dataid"),e=t.closest("td"),o=e.attr("data-attr"),y=e.attr("data-root-attr"),h=moment([parseInt(e.attr("data-y")),parseInt(e.attr("data-m"))-1,parseInt(e.attr("data-dm"))]).format("DD-MM-YYYY"),c=0,p=e.attr("hl"),s,l;n(i.sourceData).each(function(){var f,t,i,s;this.Id==v&&(f=this,e.hasClass("cell-date")?(i=[],f.Detail!=null?(i=n.parseJSON(f.Detail),s=!1,n(i).each(function(){this.D==h&&(this[o]=u,s=!0,p=="1"&&this[o]!=this[y]&&(c=r.symbols.ks.indexOf(this[o])>=0||this[o]==""?1:2))}),s||(t={D:h},t[o]=u,i.push(t))):(t={D:h},t[o]=u,i.push(t)),this.Detail=JSON.stringify(i)):this[o]=u)});s=i.updateRowValue(a);l=r.editController!=null?r.editController+"/":"/admin/";l+=r.model+"EditDate";r.beforeSaveDetail!=null&&(s=r.beforeSaveDetail(s));n(i.editLoader).show();app.postData(l,s,function(){n(i.editLoader).hide()});e=t.closest("td");f=="price"&&(u=u.replace(/,/g,""),u=app.formatPrice(u));e.find("> span").text(u);e.removeClass("editing");switch(c){case 0:e.removeClass("highlight").removeClass("error");break;case 1:e.addClass("highlight").removeClass("error");break;case 2:e.addClass("error").removeClass("highlight");app.notify("warning","Ký hiệu chấm công chưa đúng !")}},i.displayChilds=function(t,r,f){var e=f?n(u).find("> .calendar-table > .main-content .area-bl tr"):n(u).find("> .calendar-table > .main-content .area-br tr");e.each(function(){var u=n(this).attr("parent");u==t&&(n(this).css("display",r),i.displayChilds(n(this).attr("dataid"),r,f))})},i.reloadChilds=function(t){var e=t.attr("dataid"),f,s,c;for(n(t).closest("tbody").find('tr[parent="'+e+'"]').each(function(){n(this).remove()}),f=0;f<i.sourceData.length;f++)i.sourceData[f].ParentId==e&&(i.sourceData.splice(f,1),f--);var o=t.find(".expand-child"),l=o.hasClass("expand"),f=o.find("i"),h=t.attr("ai");l||o.addClass("expand");f.removeClass("icon-arrow-right13");f.addClass("icon-spinner10 spinner");s=o.attr("level");c=r.dataUrl!=null?r.dataUrl:"/api/"+r.model+"List";loadData(c,{parentId:e},null,function(t){var c=t.Many,l,a,v;f.removeClass("icon-spinner10 spinner").addClass("icon-arrow-down12");c!=null&&c.length>0&&r.rows.length>0?(l="Id",r.idAttribute!=null&&(l=r.idAttribute),i.sumarray=[],a=n(u).find('.area-bl tbody tr[dataid="'+e+'"]'),v=n(u).find('.area-br tbody tr[dataid="'+e+'"]'),n.each(c,function(t,r){var u=i.drawRow(r,l,parseInt(s)+1,h+"."+(t+1),!0);n(u).insertAfter(a);a=n(a).next();u=i.drawRow(r,l,parseInt(s)+1,h+"."+(t+1),!1);n(u).insertAfter(v);v=n(v).next()}),i.setRowEvents(e),f.removeClass("hide"),i.sourceData=n.merge(c,i.sourceData)):f.addClass("hide");o.addClass("loaded")})},i.selectContentTab=function(t,f){var c=browser=="Web"?n(u).find("> .calendar-table > .sub-content"):n("#sub_content_modal"),e=r.subContent.tabs[t],s,o,h,l;f==null&&(f=c.find(".tab-content > div").eq(t).attr("id"));s=n(f);o=i.getSelectedIds()[0];o!=null&&(s.hasClass("loaded")||(c.find(".tab-content > .loading").css("display","block"),h={dataType:"html",id:o},n.isFunction(e.data)?(l=e.data(i.getDataById(o)),n.extend(h,l)):n.extend(h,e.data),app.loadData(e.url,h,null,function(n){s.addClass("loaded");c.find(".tab-content > .loading").css("display","none");s.html(n);e.loadCallback!=null&&(e.table=e.loadCallback(o,f,i.getDataById(o)))})))},i.bulkDelete=function(n){var t=i.getSelectedIds();t.length>0?i.deleteObjects("bulk",t,n):app.confirm("info","Vui lòng chọn đối tượng cần xóa",null,null)},i.deleteObjects=function(t,i,f){app.confirm("warning",null,i.length+" đối tượng được chọn để xóa.",function(){var e=r.editController!=null?r.editController:"/admin";t=="bulk"?app.postData(e+"/delete"+r.model+"ByIds",{ids:i},function(){f!=null&&f()}):n.ajax({url:e+"/delete"+r.model,type:"POST",data:{model:r.model,id:i[0]},success:function(){typeof webaby!="undefined"&&webaby.hideModalLoading();n("#deleteModal").modal("hide");f!=null&&f()}});n(u).find(".checkAll").prop("checked",!1);n.uniform.update()})},i.setSubData=function(){},i.selectRow=function(t,f){var o=t.attr("dataid"),h,c,e,s;t.hasClass("active")?(n(u).find('.area-bl tr[dataid="'+o+'"]').removeClass("active"),n(u).find('.area-br tr[dataid="'+o+'"]').removeClass("active"),n(u).find('.area-bom tr[dataid="'+o+'"]').removeClass("active")):(n(u).find(".area-bl tr.active").removeClass("active"),n(u).find('.area-bl tr[dataid="'+o+'"]').addClass("active"),n(u).find(".area-br tr.active").removeClass("active"),n(u).find('.area-br tr[dataid="'+o+'"]').addClass("active"),n(u).find(".area-bom tr.active").removeClass("active"),n(u).find('.area-bom tr[dataid="'+o+'"]').addClass("active"),r.subContent!=null&&i.setSubData(o),r.selectRowCallback!=null&&r.selectRowCallback(t));r.subContent!=null&&(browser=="Web"?(h=n(u).find("> .calendar-table > .sub-content"),(h.attr("aid")!=o||f)&&(e=h.find('.tabs-group li[class="active"]'),e.length==0?(e=h.find(".tabs-group li:eq(0)"),e.find("a").tab("show")):(s=e.index(),s<0&&(s=0),h.find(".tab-content .tab-pane").html("").removeClass("loaded"),h.attr("aid",o),i.selectContentTab(s,e.find(" > a").attr("href"))))):(c=n("#sub_content_modal"),c.modal("show"),e=c.find('.tabs-group li[class="active"]'),e.length==0?(e=c.find(".tabs-group li:eq(0)"),e.find("a").tab("show")):(s=e.index(),s<0&&(s=0),c.find(".tab-content .tab-pane").html("").removeClass("loaded"),c.attr("aid",o),i.selectContentTab(s,e.find(" > a").attr("href")))))},i.resize=function(){var t=null,s=null,f,e;if(app.hasValue(r.height.fix)&&(t=r.height.fix),app.hasValue(r.width.fix)&&(s=r.width.fix),t==null){var c=n(window).height(),o=c-r.height.top,h=n(u).find("> .calendar-table");h.css("height",o+15);r.subContent!=null&&browser=="Web"?(h.hasClass("expand")?i.setMainTableHeight(o-35):i.setMainTableHeight(parseInt(o/2)),i.setSubContentHeight(parseInt(o/2))):i.setMainTableHeight(o-35)}else f=r.head.height!=null?r.head.height:39,r.filterable&&(f+=36),r.footer==!1&&(t+=50),e=15,n(u).find(".main-content").css("height",t+35),n(u).find(".areas").css("height",t-e),n(u).find(".area-bl").css("height",t-f-16-e),n(u).find(".area-bl > div").css("height",t-f-16-e),n(u).find(".area-br").css("height",t-f+1-e),n(u).find(".area-br > div").css("height",t-f+1-e);s==null&&i.setMainTableWidth()},i.setMainTableWidth=function(){var t=n(u).find("> .calendar-table > .main-content .area-tr"),s=n(u).find("> .calendar-table > .main-content .area-br"),r=t.find("> div").width(),f=parseInt(t.find("table").attr("data-w")),e=t.find("table > colgroup col").last(),o=s.find("table > colgroup col").last(),i;r>=f?(i=r-f-19,e.css("width",i),o.css("width",i)):(e.css("width",0),o.css("width",0))},i.setMainTableHeight=function(t){var f=r.head.height!=null?r.head.height:54,i;r.filterable&&(f+=37);r.cols.colSub!=null&&(f+=40);r.footer==!1&&(t+=50);i=n(u).find("> .calendar-table > .main-content");i.css("height",t+35);i.find("> .areas").css("height",t);i.find("> .areas .area-bl").css("height",t-f-18);i.find("> .areas .area-bl > div").css("height",t-f-18);i.find("> .areas .area-br").css("height",t-f-1);i.find("> .areas .area-br > div").css("height",t-f-1)},i.setSubContentHeight=function(t){var i=n(u).find(".sub-content .tab-content");i.css("height",t-70)},i.initTable=function(){var v=r.skipCols,ii=n(window).height(),ft="",g="",d=0,tt=0,ct=r.head.dateWidth,y=0,t,et,f,e=n('<div class="calendar-table '+(r.border?"bordered":"")+'"><\/div>'),rt,s,p,o,wt,bt,dt,w,ut,ht,c,lt,kt,at,it,ni,nt,ti,b,vt,yt,pt;if(app.hasValue(r.height.fix)?e.css("height",r.height.fix):e.css("height",ii-r.height.top),e.append('<div class="main-content"><div class="areas '+(v>0?"has-left":"")+'"><span class="empty-message" style="display: none">Không tìm thấy dữ liệu phù hợp<\/span><\/div><\/div>'),n(u).append(e),rt=r.head.height!=null?r.head.height:54,r.filterable&&(rt+=37),r.cols.colSub!=null&&(rt+=40),s=n('<div class="area area-tl" style="height: '+rt+'px"><div><\/div><\/div>'),v>0){for(e=n('<table class="table table-bordered"><\/table>'),ft=n("<colgroup><\/colgroup>"),d=0,(r.checkAll==null||r.checkAll)&&(ft.append('<col style="width: 40px">'),d+=40,v--),p=0;p<v;p++)ft.append('<col style="width: '+r.head.groups[p]+'px">'),d+=r.head.groups[p];for(e.css("width",d).append(ft.html()),f="<thead>",v=r.skipCols,it=r.cols.left,o=0;o<it.length;o++){for(wt=it[o],f+="<tr>",o==0&&(r.checkAll==null||r.checkAll)&&(f+='<th rowspan="'+it.length+'" style="height: 31px"><div class="checkbox"><input type="checkbox" class="styled checkAll" /><label><\/label><\/div><\/th>',v--),et=0;et<wt.length;et++)t=wt[et],(t.visible==null||t.visible())&&(f+="<th ",t.rowspan!=null&&(f+=' rowspan="'+t.rowspan+'" '),t.colspan!=null&&(f+=' colspan="'+t.colspan+'" '),f+=' style="',t.style!=null&&(f+=t.style+"; "),f+='"',nt="",t.class!=null&&(nt+=t.class),f+=t.sort!=null?'class="'+nt+' orderable" orderby="'+t.sort+'" currentOrder="desc">':'class="'+nt+'" >',f+=t.render!=null?t.render():t.title!=null?t.title:"&nbsp;",f+=(t.sort!=null?'<i style="margin-left:5px;" class="fa fa-caret-down"><\/i>':"")+"<\/th>");f+="<\/tr>"}f+="<\/thead>";e.append(f);bt="<tbody>";bt+="<\/tbody>";e.append(bt);s.css("width",d+1).find("> div").append(e)}n(u).find(".areas").append(s);dt=n(window).width();s=n('<div class="area area-bl" style="width:'+(d+(dt>375?31:1))+'px"><\/div>');s.append('<div><table class="table table-bordered table-hover" style="width:'+d+'px"><\/table><\/div>');s.find("table").append(ft);w="<tbody>";r.group!=null&&(ut=0,n(r.group.data).each(function(){ut++;w+='<tr class="tr-group expanded" gai="'+ut+'" groupid="'+this.id+'" ><td colspan="'+v+'">';w+='<div><button class="btn btn-icon btn-xs btn-expander"><i class="icon-arrow-down5"><\/i><\/button>';w+=r.group.render!=null?r.group.render(this):this.text;w+="<\/div><\/td><\/tr>";var n={gid:this.id,left:[],right:[],count:this.totalChild!=null?this.totalChild:0,loaded:!1,groupChilds:[]};i.viewData.push(n)}));w+="<\/tbody>";s.find("table").append(w);n(u).find(".areas").append(s);var gt=r.optionMenu!=null&&browser=="Wap",l=moment(r.cols.date[0],"MM-DD-YYYY"),k=moment(r.cols.date[1],"MM-DD-YYYY"),lt=moment(r.cols.date[0],"MM-DD-YYYY"),ot,h,a,o,st=k.diff(l,"months"),ri=k.diff(l,"days");if(st==0&&k.month()!=l.month()&&(st=k.year()==l.year()?k.month()-l.month():12-l.month()+k.month()),st==0){for(c={m:l.month()+1,y:l.year(),days:[]};l<=k;)ot=l.date(),c.days.push(ot),l.add(1,"days");i.months.push(c)}else for(ht=0;ht<=st;ht++)if(ht==0){for(c={m:l.month()+1,y:l.year(),days:[]},h=l.daysInMonth(),a=l.date();a<=h;a++)c.days.push({dm:a,dw:moment(c.m+"-"+a+"-"+c.y,"MM-DD-YYYY").day()});i.months.push(c)}else if(ht==st){for(c={m:k.month()+1,y:k.year(),days:[]},h=k.daysInMonth(),a=1;a<=k.date();a++)c.days.push({dm:a,dw:moment(c.m+"-"+a+"-"+c.y,"MM-DD-YYYY").day()});i.months.push(c)}else{for(lt=l.add(1,"month"),c={m:lt.month()+1,y:lt.year(),days:[]},h=lt.daysInMonth(),a=1;a<=h;a++)c.days.push({dm:a,dw:moment(c.m+"-"+a+"-"+c.y,"MM-DD-YYYY").day()});i.months.push(c)}for(v=r.skipCols,s=n('<div class="area area-tr" style="left: '+(d+1)+"px; height: "+rt+"px; "+(gt?"right: 35px;":"")+'"><div><\/div><\/div>'),e=n('<table class="table table-bordered"><\/table>'),g="<colgroup>",tt=0,(r.checkAll==null||r.checkAll)&&(v==0?(g+='<col style="width: 40px">',tt+=40):v--),y=0,p=0;p<=ri;p++)if(r.cols.colSub!=null)for(kt=0;kt<r.cols.colSub.length;kt++)g+='<col i="'+y+'" style="width: '+ct+'px">',tt+=ct,y++;else g+='<col i="'+y+'" style="width: '+ct+'px">',tt+=ct,y++;for(p=v;p<r.head.groups.length;p++)g+='<col i="'+y+'" style="width: '+r.head.groups[p]+'px">',tt+=r.head.groups[p],y++;for(g+="<col>",g+="<\/colgroup>",e.attr("data-w",tt).css("width",+tt+"px").append(g),f="<thead>",f+="<tr>",v=r.skipCols,o=0;o<i.months.length;o++)h=i.months[o],at=h.days.length,r.cols.colSub!=null&&(at=at*r.cols.colSub.length),f+='<th class="calendar-month"  colspan="'+at+'" > <label>Tháng<\/label> '+h.m+"/"+h.y+"<\/th>";for(it=r.cols.right,ni=r.cols.colSub!=null?3:2,o=0;o<it.length;o++)t=it[o],(t.visible==null||t.visible())&&(f+='<th  rowspan="'+ni+'" ',t.colspan!=null&&(f+=' colspan="'+t.colspan+'" '),f+=' style="',t.style!=null&&(f+=t.style+"; "),f+='"',nt="",t.class!=null&&(nt+=t.class),t.color!=null&&(nt+=" hc-"+t.color+" "),f+=t.sort!=null?'class="'+nt+' orderable" orderby="'+t.sort+'" currentOrder="desc">':'class="'+nt+'" >',ti=et+v,f+=t.render!=null?t.render():t.title!=null?t.title:"&nbsp;",f+=(t.sort!=null?'<i style="margin-left:5px;" class="fa fa-caret-down"><\/i>':"")+'<span class="th-scroll" i="'+ti+'"><\/span><\/th>');for(f+="<\/tr><tr>",y=0,o=0;o<i.months.length;o++)for(h=i.months[o],b=0;b<h.days.length;b++)f+='<th class="calendar-day" i="'+y+'" '+(r.cols.colSub!=null?'colspan="'+r.cols.colSub.length+'"':"")+'> <span class="day day-of-month day-'+h.days[b].dw+'" >'+h.days[b].dm+'<\/span><span class="day day-of-week day-'+h.days[b].dw+'">'+daysOfWeek[h.days[b].dw]+"<\/span><\/th>",y++;if(f+="<\/tr>",r.cols.colSub!=null){for(f+='<tr class="tr-col-sub">',y=0,o=0;o<i.months.length;o++)for(h=i.months[o],b=0;b<h.days.length;b++)for(vt=0;vt<r.cols.colSub.length;vt++)ot=r.cols.colSub[vt],f+='<th class="calendar-day" data-code="'+ot.code+'" data-day="'+h.days[b].dw+'" class="calendar-sub " i="'+y+'" > <span class="sub text-bold text-center day  day-'+h.days[b].dw+'" >'+ot.text+"<\/span><\/th>",y++;f+="<\/tr>"}i.colRight=y+r.cols.right.length;f+="<\/thead>";e.append(f);s.find("> div").append(e);n(u).find(".areas").append(s);v=r.skipCols;s=n('<div class="area area-br" style="left: '+(d+1)+"px;"+(gt?"right: 35px;":"")+'"><div><\/div><\/div>');e=n('<table class="table table-bordered table-hover"><\/table>');w="<tbody>";r.group!=null&&(ut=0,n(r.group.data).each(function(){ut++;w+='<tr class="tr-group" gai="'+ut+'" groupid="'+this.id+'"><td colspan="'+i.colRight+'">&nbsp;<\/td><\/tr>'}));w+="<\/tbody>";e.css("width",+tt+"px").append(g).append(w);s.find("> div").append(e);n(u).find(".areas").append(s);r.optionMenu!=null&&browser=="Wap"&&(s=n('<div class="area area-tom" style="right: 0; height: '+rt+'px"><div><\/div><\/div>'),e=n('<table class="table"><colgroup><col style="width: 40px" /><\/colgroup><thead><th style="height: 30px">&nbsp;<\/th><\/thead><\/table>'),r.filterable&&e.append('<tbody><tr class="tr-filter"><td><\/td> <\/tr><\/tbody>'),s.find("> div").append(e),n(u).find(".areas").append(s),s=n('<div class="area area-bom" style="right: 0; top: 63px"><div><\/div><\/div>'),e=n('<table class="table table-bordered"><tbody><\/tbody><\/table>'),s.find("> div").append(e),n(u).find(".areas").append(s));n(u).find(".areas").append('<span class="buffer-bl" style="width: '+d+'px"><\/span>');r.footer!=!1&&(yt=n('<div class="area-footer"><\/div'),yt.append('<span class="heading-text total-row"><span class="text-bold">0<\/span> kết quả<\/span>'),pt=n('<div class="icons-list pull-right"><\/div>'),pt.append('<li class="btn-group dropup " style="float:left; margin-right: 10px"><span class="">Hiển thị<button type="button" class="dropdown-toggle btn btn-xs btn-default position-right" data-toggle="dropdown" aria-expanded="false"><span>20 kết quả<\/span> <label class="caret"><\/label><\/button><ul class="dropdown-menu dropdown-menu-right"><li><a href="#" class="btn-change-limit" data="10">10 kết quả<\/a><\/li><li><a href="#" class="btn-change-limit" data="20">20 kết quả<\/a><\/li><li><a href="#" class="btn-change-limit" data="50">50 kết quả<\/a><\/li><li><a href="#" class="btn-change-limit" data="">Tất cả<\/a><\/li><\/ul><\/li>'),pt.append('<li><ul class="pagination pagination-flat pagination-xs"><\/ul><\/li>'),yt.append(pt),n(u).find(".main-content").append(yt));i.setStaticEvents();r.autoLoad!=!1&&i.loadData()},i.initTable(),this}})(jQuery)