(function(n){n.fn.pdfSignature=function(t){var i=this,e=this.selector,u="data:application/pdf;base64,",f=n.extend({signData:null,pdfData:null},t),r;return i.set=f,i.signs=[],r="#viewerContainer",i.pointToPixcel=function(t){var i=n(r).find(".textLayer"),u=i.width(),f=i.height(),e=u*t.point[0]/612,o=f*t.point[1]/792;return[e,o]},i.pixelToPoint=function(t){var i=n("#"+t.id).closest(".textLayer"),r=i.width(),u=i.height(),f=612*t.pixel[0]/r,e=792*t.pixel[1]/u;return[f,e]},i.pushSignature=function(t){var f=t.pixel[0],e=t.pixel[1],u=t.id,o='<div class="signiture" id="'+u+'" style="left:'+f+"px; top: "+e+'px"><div class="closer"><i class="icon-x"><\/i><\/div><div class="info">Click và kéo đến vị trí hiển thị chữ ký<\/div><div class="dragable">'+t.text+"<\/div><\/div>",s=window.PDFViewerApplication.pagesCount,h=n(r+" .page").last();n(h).find(".textLayer").append(o);setTimeout(function(){var t;n("#"+u).draggable({start:function(i,r){var u=n(r);t=r.position.top},stop:function(t,r){n(i.signs).each(function(){u==this.id&&(this.pixel=[r.position.left,r.position.top])})}})},300);window.PDFViewerApplication.pdfViewer.currentPageNumber=s},i.add=function(n){n.id="sign_"+app.newGuid(20);n.pixel=i.pointToPixcel(n);i.signs.push(n);i.pushSignature(n)},i.get=function(){return n(i.signs).each(function(){this.point=i.pixelToPoint(this)}),i.signs},i.convertDataURIToBinary=function(n){for(var e=n.indexOf(u)+u.length,o=n.substring(e).replace(/[\n\r]/g,""),i=window.atob(o),r=i.length,f=new Uint8Array(new ArrayBuffer(r)),t=0;t<r;t++)f[t]=i.charCodeAt(t)&255;return f},i.setPdfData=function(n){var t=i.convertDataURIToBinary(n);DEFAULT_URL=t;window.PDFViewerApplication.open(DEFAULT_URL)},i.init=function(){i.set.pdfData!=null&&i.setPdfData(i.set.pdfData);i.set.signData!=null&&setTimeout(function(){n(r).length>0&&n(i.set.signData).each(function(){i.add(this)})},500)},i.init(),i}})(jQuery)