function FolderNode(n){return'<li dataid="'+n.id+'" class="node" id="fn_'+n.id+'"><div class="wtree-wholerow"><\/div><i class="wtree-icon fa wtree-ocl  fa-angle-right"><\/i><a class="wtree-anchor" href="#">  <div class="folder-group">     <i class="wtree-icon fa fa-folder" ><\/i>     <i class="fa fa-user '+(n.share_status!="shared"?"hide":"")+'"><\/i>  <\/div>'+(n.renameable?' <div class="edit-form hide"><input class="form-control" value="'+n.name+'" />     <button class="btn btn-default btn-xs cancel-rename"><i class="fa fa-times"><\/i><\/button>  <\/div>':"")+'  <span class="name">'+n.name+'<\/span><\/a><div class="btn-group dropdown '+(!n.createable&&!n.renameable&&!n.shareable&&!n.removeable?"hide":"")+'">     <button class="btn btn-default btn-xs" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-gear"><\/i><\/button>     <ul class="dropdown-menu dropdown-menu-right">'+(n.createable?'<li><a  href="javascript:void(0)" class="create-child" dataid="'+n.id+'"><i class="fa fa-plus"><\/i> Tạo thư mục<\/a><\/li>':"")+(n.renameable?'<li><a  href="javascript:void(0)" class="rename" dataid="'+n.id+'"><i class="fa fa-i-cursor"><\/i> Sửa tên<\/a><\/li>':"")+(n.shareable?'<li><a  href="javascript:void(0)" class="share '+(n.share_status=="shared"?"hide":"")+'" dataid="'+n.id+'"><i class="fa fa-share-alt"><\/i> Chia sẽ<\/a><\/li>':"")+(n.shareable?'<li><a  href="javascript:void(0)" class="unshare  '+(n.share_status!="shared"?"hide":"")+'" dataid="'+n.id+'"><i class="fa fa-share-alt-square"><\/i> Hủy chia sẽ<\/a><\/li>':"")+(n.deleteable?' <li><a  href="javascript:void(0)" class="delete" dataid="'+n.id+'"><i class="fa fa-trash-o"><\/i> Xóa<\/a><\/li>':"")+'     <\/ul><\/div> <ul class="wtree-children hide create-child-form">     <li>         <div class="wtree-anchor">             <div class="folder-group"><i class="wtree-icon fa fa-folder" ><\/i><\/div>             <div class="edit-form">                 <input class="form-control" />                 <button class="btn btn-default btn-xs cancel-create"><i class="fa fa-times"><\/i><\/button>             <\/div>         <\/div>     <\/li> <\/ul><\/li>'}function initMediaManager(n){isSystem=n.system;n.folderable?($("#folder_bindings").css("display","block"),$(mm+" .resize-bar").css("display","block"),folderViewModel=new FolderViewModel({root:"#folder_bindings",isMobile:n.isMobile,folder:n.folder,rootPath:n.activePath})):$("#media_bindings").css("margin-left","0");mediaViewModel=new MediaViewModel(n);ko.applyBindings(mediaViewModel,$("#media_bindings")[0]);$(mm+" input[type=checkbox],"+mm+" input[type=radio]").uniform({radioClass:"choice"});$("#mediaUploadingModal").on("hidden.bs.modal",function(){$("body").addClass("modal-open")})}var isSystem=null,mediaViewModel,folderViewModel,mediaUploader,_URL=window.URL||window.webkitURL,mm="#mediaManagerModal",baseUrl="/",imgFormats=["jpg","jpeg","png","gif"],videoFormats=["flv","avi","mp4","mkv"],fileFormats=["txt","pdf","xls","xlsx","doc","docx","ppt","pptx"],Folder=function(n,t){var i=this;n!=null?(i.id=ko.observable(n.id),i.name=ko.observable(n.name),i.path=ko.observable(n.path),i.shared=ko.observable(!1),i.renameable=ko.observable(t.renameable),i.shareable=ko.observable(!1),i.createable=ko.observable(t.createable),i.folderType=ko.observable(n.folderType),i.state=ko.observable(n.state),i.deleteable=ko.observable(t.deleteable)):(i.id=ko.observable(0),i.name=ko.observable(""),i.path=ko.observable(""),i.renameable=ko.observable(!1),i.shareable=ko.observable(!1),i.createable=ko.observable(!1),i.shared=ko.observable(!1),i.folderType=ko.observable(""),i.state=ko.observable(""),i.deleteable=ko.observable(!1));i.visible=ko.observable(!0);i.active=ko.observable(!1);i.opened=ko.observable(!1);i.childs=ko.observableArray([]);i.newChild=ko.observable("");i.creating=ko.observable(!1);i.renaming=ko.observable(!1)},FolderViewModel=function(n){var t=this,u=0,i=n.root,r=0;return t.rootPath=n.rootPath,t.folders=[],t.currentMediaPage=1,t.totalMedia=ko.observable(0),t.loadMedia=function(){},t.selectFolder=function(n){$(i+" .node").each(function(){$(this).hasClass("active")&&$(this).removeClass("active")});$("#fn_"+n).addClass("active");var r=t.getDataFolder(n);r!=null&&($("#media_overview").fadeIn("fast"),$.ajax({url:DOMAIN_API+"/apimedia/mediaList",data:{path:r.path,isSystem:isSystem,folderType:r.folderType,hasCount:!0,unlimited:!0},dataType:"JSON",success:function(i){$("#media_overview").fadeOut("fast");i.Many.length>0&&$("#childs_of_"+n).length==0&&($("#fn_"+n).append('<ul class="wtree-children" style="display:none" id="childs_of_'+n+'" ><\/ul>'),$.each(i.Many,function(i,u){if(u.type=="folder"){var f={id:t.folders.length,name:u.name,path:u.path,share_status:u.share_status,folderType:r.folderType,state:"",createable:r.folderType=="shared"?!1:!0,renameable:r.folderType=="shared"?!1:!0,shareable:!1,deleteable:r.folderType=="shared"?!1:!0};t.folders.push(f);$("#childs_of_"+n).prepend(FolderNode(f))}}));t.events();t.sortChilds(n);mediaViewModel.reload(i,t,r.path,r.folderType);$("#media_overview").fadeOut("fast")}}))},t.getDataFolder=function(n){var i=null;return n=parseInt(n),$.each(t.folders,function(){if(this.id==n)return i=this,!1}),i},t.sortChilds=function(n){var t=$("ul#childs_of_"+n),i=t.children(".node");i.sort(function(n,t){var i=$(n).find("> a .name").text(),r=$(t).find("> a .name").text();return i>r?1:i<r?-1:0});i.detach().appendTo(t)},t.deleteFolder=function(n,i){n!=null?$(t.folders).each(function(i,r){r.id==parseInt(n)&&(t.deleteFolder(null,r.id),t.folders.splice(i,1),$("#fn_"+n).remove())}):i!=null&&$(t.folders).each(function(n,r){r.parent==i&&(t.deleteFolder(null,r.id),t.folders.splice(n,1))})},t.loadSubFolders=function(n){var i=null;$(t.folders).each(function(){if(this.id==parseInt(n)){i=this;return}});i!=null&&$.ajax({url:DOMAIN_API+"/apimedia/mediaList",data:{path:i.path,isSystem:isSystem,type:"folder",folderType:i.folderType,unlimited:!0},dataType:"JSON",success:function(r){$.each(r.Many,function(r,u){var f={id:t.folders.length,parent:n,name:u.name,path:u.path,share_status:u.share_status,folderType:i.folderType,createable:i.folderType=="shared"?!1:!0,renameable:i.folderType=="shared"?!1:!0,shareable:!1,deleteable:i.folderType=="shared"?!1:!0};t.folders.push(f);$("#childs_of_"+n).append(FolderNode(f))});t.sortChilds(n);t.events()}})},t.expand=function(n,u){var f,e;n<0?(f=$(i+" #fn_"+r+" > .wtree-ocl"),f.hasClass("fa-angle-right")&&(f.removeClass("fa-angle-right").addClass("fa-angle-down"),$("#childs_of_"+r).show()),$("#childs_of_"+r).length==0&&(e='<ul class="wtree-children"  id="childs_of_'+r+'"><\/ul>',$("#fn_"+r).append(e)),$(t.folders).each(function(n,t){if(t.path==u)return r=t.id,!1}),t.selectFolder(r)):(f=$(i+" #fn_"+n+" > .wtree-ocl"),f.hasClass("fa-angle-down")?(f.removeClass("fa-angle-down").addClass("fa-angle-right"),$("#childs_of_"+n).hide()):(f.removeClass("fa-angle-right").addClass("fa-angle-down"),$("#childs_of_"+n).length==0?(e='<ul class="wtree-children"  id="childs_of_'+n+'"><\/ul>',$("#fn_"+n).append(e)):$("#childs_of_"+n).show(),$("#childs_of_"+n).html()==""&&t.loadSubFolders(n)))},t.insertName=function(n,i,r){var u=$(n).find("input").focus();$(u).unbind().keyup(function(f){var e,o;f.which==13&&(n.addClass("hide"),e=t.getDataFolder(r),e!=null&&(o={name:$(this).val(),type:i,path:e.path,isSystem:isSystem},$(this).val(""),o.name!=""&&$.ajax({url:DOMAIN_API+"/apimedia/createOrUpdateFolder",data:o,type:"POST",success:function(i){if(i!=null)if(o.type=="new"){var f={path:i,parent:r,name:o.name,id:t.folders.length,folderType:e.folderType,createable:e.folderType=="shared"?!1:!0,renameable:e.folderType=="shared"?!1:!0,shareable:!1,deleteable:e.folderType=="shared"?!1:!0};t.folders.push(f);$("#childs_of_"+r).append(FolderNode(f))}else $(u).closest("a").find("span").text(o.name),$.each(t.folders,function(){if(this.id==r)return this.name=o.name,!1}),$(n).closest(".node").find(".btn-group").removeClass("hide"),$(n).closest(".node").find("> a .name").removeClass("hide");t.sortChilds(r);t.events()}})))})},t.events=function(){$(i+" .wtree-icon,"+i+" .wtree-anchor,"+i+" .wtree-ocl,"+i+" .wtree-wholerow,"+i+" .create-child,"+i+" .rename,"+i+" .share,"+i+" .unshare,"+i+" .delete,"+i+" .reload,"+i+" .add-folder,"+i+" #reload_folders").unbind();$(i+" .reload").click(function(){t.folders=[];$(i+" .wtree").html("");t.loadFolders()});$(i+" .add-folder").click(function(){$.ajax({url:DOMAIN_API+"/apimedia/createOrUpdateFolder",data:{name:"New folder",type:"new",isSystem:isSystem},type:"POST",success:function(n){var r=t.folders.length,f={id:r,name:"New folder",path:n,folderType:"",renameable:!0,shareable:!1,deleteable:!1,createable:!0},u;t.folders.push(f);$(i+" .wtree").append(FolderNode(f));$("#fn_"+r).find("> .btn-group").addClass("hide");u=$("#fn_"+r).find("> a > .edit-form").removeClass("hide");u.next().addClass("hide").text();u.find("input").val(f.name);t.insertName(u,"rename",r);t.events()}})});$(i+" .wtree-icon,"+i+"  .wtree-anchor").hover(function(){$(this).closest("li").find("> .wtree-wholerow").addClass("wholerow-hovered")},function(){$(this).closest("li").find("> .wtree-wholerow").removeClass("wholerow-hovered")});$(i+" .wtree-ocl").click(function(){t.expand($(this).closest("li").attr("dataid"),null)});$(i+" .wtree-wholerow").click(function(){t.selectFolder($(this).closest("li").attr("dataid"))});$(i+" .wtree-anchor").click(function(){t.selectFolder($(this).closest("li").attr("dataid"))});$(i+" .create-child").click(function(){var n=$(this).attr("dataid"),i;($("#childs_of_"+n).length==0||$("#childs_of_"+n).css("display")=="none")&&t.expand(n,null);i=$("#fn_"+n).find("> .create-child-form").removeClass("hide");t.insertName(i,"new",n)});$(i+" .rename").click(function(){$(this).closest(".btn-group").addClass("hide");var i=$(this).attr("dataid"),n=$("#fn_"+i).find("> a > .edit-form").removeClass("hide"),r=n.next().addClass("hide").text();n.find("input").val(r);t.insertName(n,"rename",i)});$(i+" .delete").click(function(){var i=$(this).attr("dataid"),n=t.getDataFolder(i);n.shared?app.alert('<i class="fa fa-warning"><\/i> Không thể xóa thư mục khi đang được chia sẽ.'):app.confirm("warning","Bạn chắc chắn muốn xóa thư mục này ? ",null,function(){$.ajax({url:DOMAIN_API+"/apimedia/deleteFolder",type:"POST",data:{path:n.path,name:n.name},success:function(n){switch(n){case"none":t.deleteFolder(i);t.selectFolder(t.folders[0].id);break;default:app.alert("Có lỗi xảy ra hoặc bạn không có quyền xóa.",null)}}})})});$(i+" .cancel-rename").click(function(){var n=$(this).closest(".edit-form"),t=n.next().removeClass("hide").text();n.addClass("hide").find("input").val(t);$(this).closest(".node").find(".btn-group").removeClass("hide")});$(i+" .cancel-create").click(function(){$(this).closest(".create-child-form").addClass("hide").find("input").val("")});$(i+" .share").click(function(){var n=$(this).attr("dataid"),i=t.getDataFolder(n);i.shared?app.alert("Chia sẽ này đã được chia sẽ",null):($("#mediaShareFolderModal").modal("show"),r=n)});$(i+" .unshare").click(function(){var n=$(this).attr("dataid");app.confirm("Bạn đồng ý hủy chia sẽ thư mục này ?",function(){var i=t.getDataFolder(n);i!=null&&$.ajax({url:DOMAIN_API+"/apimedia/unshareFolder",type:"POST",data:{path:i.path,name:i.name},success:function(n){switch(n){case"none":$("#fn_"+i.id+" > a .fa-user").addClass("hide");$("#fn_"+i.id+" > .btn-group .share").removeClass("hide");$("#fn_"+i.id+" > .btn-group .unshare").addClass("hide");break;default:app.alert("Có lỗi xảy ra hoặc bạn không có quyền chia sẽ.",null)}}})})});$(i+" #reload_folders").click(function(){t.loadFolders()})},t.loadFolders=function(){$.ajax({url:DOMAIN_API+"/apimedia/mediaList",dataType:"JSON",data:{isSystem:isSystem,type:"folder"},success:function(n){n.Error?($(i+" .not-allow").css("display","block"),console.log(n.Message)):($(i+" .not-allow").css("display","none"),n.Many.length>0&&($.each(n.Many,function(n,r){var u={id:t.folders.length,name:r.name,path:r.path,folderType:"",state:r.state,renameable:!isSystem,shareable:!1,deleteable:!isSystem,createable:!0};t.folders.push(u);$(i+" .wtree").append(FolderNode(u))}),t.selectFolder(t.folders[0].id)));t.events()}})},t.reload=function(){u=0;t.folders=[];t.loadFolders()},t.init=function(){t.loadFolders();$(i+" .submitShareFolder").click(function(){$("#mediaShareFolderModal").modal("hide");var n=t.getDataFolder(r);n!=null&&$.ajax({url:DOMAIN_API+"/apimedia/shareFolder",type:"POST",data:{path:n.path,name:n.name},success:function(i){switch(i){case"none":$.each(t.folders,function(){if(this.id==n.id)return this.shared=!0,!1});$("#fn_"+n.id+" > a .fa-user").removeClass("hide");$("#fn_"+n.id+" > .btn-group .share").addClass("hide");$("#fn_"+n.id+" > .btn-group .unshare").removeClass("hide");break;case"folder_has_been_share":app.alert("Chia sẽ này đã được chia sẽ",null);break;default:app.alert("Có lỗi xảy ra hoặc bạn không có quyền chia sẽ.",null)}}})})},t.init(),this},File=function(n){var t=this;if(n!=null?(t.id=ko.observable(n.id),t.mdPath=ko.observable(DOMAIN_API+app.thumb(n.type,n.path,"512x512")),t.path=ko.observable(n.path),t.name=ko.observable(n.name),t.size=ko.observable(n.size),t.use_state=ko.observable(0)):(t.id=ko.observable(0),t.name=ko.observable(""),t.mdPath=ko.observable(""),t.path=ko.observable(""),t.size=ko.observable(""),t.use_state=ko.observable("")),t.detail=ko.observable(""),t.visible=ko.observable(!0),t.active=ko.observable(!1),t.editing=ko.observable(!1),t.width=ko.observable(0),t.height=ko.observable(150),t.dimensions=ko.observable(""),t.format=ko.computed(function(){if(t.name()=="")return"file";var n=t.name().replace(/^.*\./,"");if(jQuery.inArray(n,imgFormats)>=0)return"image";if(jQuery.inArray(n,videoFormats)>=0)return"video";if(jQuery.inArray(n,fileFormats)>=0){switch(n){case"txt":return"text";case"ppt":case"pptx":return"powerpoint";case"doc":case"docx":return"word";case"xls":case"xlsx":return"excel";case"pdf":return"pdf"}return""}return"file"}),n!=null&&t.format()=="image"){t.dimensions(n.dimensions);t.height(150);var u=n.dimensions.split(" x "),i=parseInt(u[0]),r=parseInt(u[1]);r>150?(t.width(150*i/r),t.height(150)):i>400?(t.width(400),t.height(400*r/i)):(t.width(i),t.height(r))}},Unit=function(n,t){var i=this,r;i.id=ko.observable(0);i.type=ko.observable("image");i.name=ko.observable(n.name);i.path=ko.observable(t);i.size=ko.computed(function(){var t="",i=n.size/1024,r;return parseInt(i)>1024?(r=i/1024,t=r.toFixed(2)+" MB"):t=i.toFixed(2)+" KB",t});i.uploadPercent=ko.observable(0);i.status=ko.observable("0%");i.posted=ko.observable(!1);i.callback=null;r=1e6;i.uploadComplete=function(n){$.ajax({url:DOMAIN_API+"/apimedia/SaveChunksForLibrary",type:"POST",data:{fileName:i.name(),completed:!0,count:n.count,type:n.type,fileCode:n.fileCode,size:i.size(),path:app.hasValue(i.path)?i.path:null,isSystem:isSystem,dimensions:n.dimensions},success:function(t){t=="folder_has_been_full"?app.alert('<i class="fa fa-warning"><\/i> Quá trình tải thất bại do ổ cứng hệ thống đã đầy. Vui lòng liên hệ người quản trị để được hỗ trợ. Xin cám ơn !'):(i.uploadPercent(100),i.status("Hoàn tất"),i.posted(!0),i.callback!=null&&i.callback({name:i.name(),path:t,type:n.type,size:i.size(),dimensions:n.dimensions}))}})};i.postChunk=function(n,t){var r=new XMLHttpRequest;r.onload=function(){n.completed=n.completed+1;var t=Math.floor(n.completed/n.count*100);n.completed===n.count?(i.uploadPercent(99),i.status("Đang xử lý..."),i.uploadComplete(n)):(i.uploadPercent(t),i.status(t+"%"),i.analyst(n))};r.onreadystatechange=function(){r.readyState==4&&r.status==200&&(n.fileCode=r.responseText)};r.open("POST",DOMAIN_API+"/apimedia/PostChunk",!0);r.send(t)};i.analyst=function(n){var u,t;n.start<n.size&&(typeof n.blob.slice=="function"?u=n.blob.slice(n.start,n.end):typeof n.blob.webkitSlice=="function"&&(u=n.blob.webkitSlice(n.start,n.end)),t=new FormData,t.append("chunk",u),t.append("index",n.completed),t.append("fileCode",n.fileCode),t.append("type",n.type),i.postChunk(n,t),n.start=n.end,n.end=n.start+r)};i.newGuid=function(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()};i.post=function(t){if(i.valid()){i.callback=t;var f={blob:n,size:n.size,end:r,start:0,completed:0,success:!1,type:"images",extension:n.name.replace(/^.*\./,""),fileCode:i.newGuid(),count:n.size%r==0?n.size/r:Math.floor(n.size/r)+1},u=new Image;u.onload=function(){var n=u.width,t=u.height;f.dimensions=n+" x "+t;i.analyst(f)};u.src=_URL.createObjectURL(n)}else t!=null&&i.callback()};i.isImageValid=function(n){var t=n.replace(/^.*\./,"");return(t=t==n?"":t.toLowerCase(),jQuery.inArray(t,imgFormats)>=0)?!0:!1};i.isVideoValid=function(n){var t=n.replace(/^.*\./,"");return(t=t==n?"":t.toLowerCase(),jQuery.inArray(t,videoFormats)>=0)?!0:!1};i.isDocValid=function(n){var t=n.replace(/^.*\./,"");return(t=t==n?"":t.toLowerCase(),jQuery.inArray(t,fileFormats)>=0)?!0:!1};i.valid=ko.computed(function(){return n.size>512e5?!1:i.isImageValid(i.name())?!0:i.isVideoValid(i.name())?!0:i.isDocValid(i.name())?!0:!1})},Uploader=function(n){var t=this;t.parent=n;t.files=ko.observableArray([]);t.result=ko.observableArray([]);t.postNumber=ko.observable(0);t.posting=!1;t.started=ko.observable(!1);t.upload=function(i,r){var u,f;for(t.files.removeAll(),t.result.removeAll(),t.started(!0),u=0;u<i.length;u++)t.files.push(new Unit(i[u],t.parent.activePath()));t.posting=!1;t.postNumber(0);f=setInterval(function(){t.posting||$.each(t.files(),function(i,r){if(!r.posted())return t.posting=!0,r.post(function(i){t.postNumber(t.postNumber()+1);t.posting=!1;var r=new File({id:0,path:i.path,name:i.name,type:i.type,size:i.size,dimensions:i.dimensions});n.files.push(r);t.result.push(r)}),!1});t.postNumber()==t.files().length&&(t.started(!1),$(mm+" .input-file-upload").val(""),clearInterval(f),r!=null&&r(ko.toJS(t.result())),setTimeout(function(){t.postNumber(0)},200))},300)};t.processStatus=ko.computed(function(){var n=t.postNumber()/t.files().length*100;return parseInt(n)});t.init=function(){$(mm+" .input-file-upload").on("change",function(){var n=$(this).get(0).files;t.upload(n)})};t.init()},LocalUploader=function(){var n=this;n.files=ko.observableArray([]);n.result=ko.observableArray([]);n.postNumber=ko.observable(0);n.posting=!1;n.started=ko.observable(!1);n.upload=function(t,i){var r,u;for(n.files.removeAll(),n.result.removeAll(),n.started(!0),r=0;r<t.length;r++)n.files.push(new Unit(t[r],"/apimedia/private"));n.posting=!1;n.postNumber(0);u=setInterval(function(){n.posting||$.each(n.files(),function(t,i){if(!i.posted())return n.posting=!0,i.post(function(t){n.postNumber(n.postNumber()+1);n.posting=!1;var i=new File({id:0,path:t.path,name:t.name,type:t.type,size:t.size,dimensions:t.dimensions});n.result.push(i)}),!1});n.postNumber()==n.files().length&&(n.started(!1),clearInterval(u),i!=null&&i(ko.toJS(n.result())),setTimeout(function(){n.postNumber(0)},200))},300)};n.processStatus=ko.computed(function(){var t=n.postNumber()/n.files().length*100;return parseInt(t)})},MediaViewModel=function(n){var t=this;t.tree=null;t.parentPath=ko.observable("");t.options=n;t.uploader=ko.observable(new Uploader(t));t.folders=ko.observableArray([]);t.files=ko.observableArray([]);t.activeFiles=ko.observableArray([]);t.activeFolders=ko.observableArray([]);t.folderType=ko.observableArray("");t.renameFileText=ko.observable("");t.selectAll=ko.observable(!1);t.keyword=ko.observable("");t.search=function(){return t.keyword()!=""?$.each(t.files(),function(n,i){i.name().toLowerCase().indexOf(t.keyword().toLowerCase())<0?i.visible(!1):i.visible(!0)}):$.each(t.files(),function(n,i){i.name().toLowerCase().indexOf(t.keyword().toLowerCase())<0?i.visible(!1):i.visible(!0)}),!0};t.loading=ko.observable(!1);t.currentMediaPage=ko.observable(1);t.activePath=ko.observable("");app.hasValue(n.activePath)&&t.activePath(n.activePath);t.sortType=ko.observable("A - Z");t.sort=function(n){t.sortType(n);switch(n){case"A - Z":t.files.sort(function(n,t){return n.name()==t.name()?0:n.name()<t.name()?-1:1});t.folders.sort(function(n,t){return n.name()==t.name()?0:n.name()<t.name()?-1:1});break;case"Z - A":t.files.sort(function(n,t){return n.name()==t.name()?0:n.name()>t.name()?-1:1});t.folders.sort(function(n,t){return n.name()==t.name()?0:n.name()>t.name()?-1:1})}};t.listType=ko.observable("fa-th");t.selectTypeList=function(n){t.listType(n)};t.lazyload=function(){};t.loadMedias=function(n,i){t.loading()||$.each(n.Many,function(n,r){r.type=="folder"?t.folders.push(new Folder({id:n,name:r.name,path:r.path,share_status:r.share_status,folderType:i},{shareable:!1,renameable:!0})):t.files.push(new File({name:r.name,path:r.path,size:r.size,dimensions:r.dimensions,id:0}))})};t.viewMoreMedia=function(){console.log(123)};t.getMedias=function(){$("#media_overview").fadeIn("fast");$.ajax({url:DOMAIN_API+"/apimedia/mediaList",data:{isSystem:isSystem,file:"file",folderType:"company",path:n.activePath},dataType:"JSON",contentType:"application/json; charset=utf-8",success:function(i){$("#media_overview").fadeOut("fast");t.reload(i,null,n.activePath,"company")}})};t.reload=function(n,i,r,u){i!=null&&(t.tree=i);t.activePath(r);t.folderType(u);t.folders.removeAll();t.files.removeAll();t.activeFiles.removeAll();t.activeFolders.removeAll();t.loadMedias(n,u)};t.clearSelected=function(){t.activeFiles.removeAll();$(t.files()).each(function(n,t){t.active()&&t.active(!1)});$(mm+" .modal-header .btn-select-file").css("display","none");$(mm+" .modal-header .btn-options").css("display","none")};t.selectAll.subscribe(function(){t.selectAll()==!0?$(t.files()).each(function(n,i){i.active()||(i.active(!0),t.activeFiles.push(i))}):t.clearSelected()});t.selectFile=function(n){t.options.selectType=="single"?(t.clearSelected(),n.active()?(n.active(!1),t.activeFiles.remove(n)):(n.active(!0),t.activeFiles.push(n))):n.active()?(n.active(!1),t.activeFiles.remove(n)):(n.active(!0),t.activeFiles.push(n));$(mm+" .modal-header .btn-select-file").length>0&&(t.activeFiles().length>0?($(mm+" .modal-header .btn-select-file").css("display","block"),$(mm+" .modal-header .btn-options").css("display","block")):($(mm+" .modal-header .btn-select-file").css("display","none"),$(mm+" .modal-header .btn-options").css("display","none")))};t.setOptions=function(n){t.options=n};t.selectFolder=function(n,i){var r=$(i.currentTarget);if(r.hasClass("clicked")){t.tree.expand(-1,n.path());return}r.addClass("clicked");n.active()?(n.active(!1),t.activeFolders.remove(n)):(n.active(!0),t.activeFolders.push(n));setTimeout(function(){r.removeClass("clicked")},500)};t.removeMany=function(){app.confirm("warning","Bạn đồng ý xóa những file này ?",null,function(){var n=[];$.each(t.activeFiles(),function(t,i){n.push(i.path())});$("#media_overview").fadeIn("fast");$.ajax({url:DOMAIN_API+"/apimedia/deleteFiles",data:{paths:n},dataType:"JSON",type:"POST",success:function(){$("#media_overview").fadeOut("fast");$.each(t.activeFiles(),function(n,i){t.files.remove(i)});t.activeFiles.removeAll()}})})};t.download=function(){if(t.activeFiles().length>0){var n=t.activeFiles()[0].path();app.hasValue(DOMAIN_API)&&(n=DOMAIN_API+t.activeFiles()[0].path());window.open(n,"_blank")}};t.selectFilesComplete=function(){t.options.receiveFiles(ko.toJS(t.activeFiles()))};t.rename=function(){t.renameFileText(t.activeFiles()[0].name());$("#mediaRenameFileModal").modal("show");$("#media_rename_file_control").select()};t.getlink=function(){$("#mediaGetLinkModal").modal("show");var n=t.activeFiles()[0].path();app.hasValue(DOMAIN_API)&&(n=DOMAIN_API+t.activeFiles()[0].path());$("#media_file_link_control").val(n).select()};t.submitRenameFile=function(){$.ajax({url:DOMAIN_API+"/apimedia/renameFile",data:{path:t.activeFiles()[0].path(),name:t.renameFileText()},type:"POST",success:function(){t.activeFiles()[0].name(t.renameFileText());t.renameFileText("");$("#mediaRenameFileModal").modal("hide")}})};t.init=function(){var i=$(window).height();n.isMobile?($(mm+" .modal-header .btn-select-file").click(function(){t.selectFilesComplete()}),$(mm+" .modal-header .btn-delete-file").click(function(){t.removeMany()})):($("#media_bindings").height(i-95),$(".gallery-panel .webaby-tree ").height(i-208),$(".gallery-panel .media-content").height(i-188),$(window).resize(function(){var n=$(window).height();$("#media_bindings").height(n-95);$(".gallery-panel .webaby-tree ").height(n-208);$(".gallery-panel .media-content").height(n-188)}),$(".gallery-panel .resize-bar").draggable({containment:"#gallery_container",axis:"x",start:function(){var n=$(this).position();$("#folder_bindings").css("width",n.left+"px");$("#media_bindings").css("margin-left",n.left+"px")},drag:function(){var n=$(this).position();$("#folder_bindings").css("width",n.left+"px");$("#media_bindings").css("margin-left",n.left+"px")},stop:function(){var n=$(this).position();$("#folder_bindings").css("width",n.left+"px");$("#media_bindings").css("margin-left",n.left+"px")}}));$(mm+" .select-all-files").click(function(){$(this).is(":checked")?t.files().length==0?new PNotify({title:"Không có file để chọn",addclass:"alert bg-warning alert-styled-left"}):(t.activeFiles.removeAll(),$(t.files()).each(function(n,i){i.active(!0);t.activeFiles.push(i)})):t.activeFiles().length>0&&($(t.activeFiles()).each(function(n,t){t.active(!1)}),t.activeFiles.removeAll())});!isSystem;$("#view_more_media").unbind().click(function(){var n=$(this)})};t.init()};$(document).on("show.bs.modal",".modal",function(){var n=1040+10*$(".modal:visible").length;$(this).css("z-index",n);setTimeout(function(){$(".modal-backdrop").not(".modal-stack").css("z-index",n-1).addClass("modal-stack")},0)});ko.bindingHandlers.fadeVisible={init:function(n,t){var i=t();$(n).toggle(ko.unwrap(i))},update:function(n,t){var i=t();ko.unwrap(i)?$(n).fadeIn(200):$(n).fadeOut(200)}}